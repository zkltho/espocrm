/*! espocrm 2024-10-10 */
define("views/email/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{sideView="views/email/record/detail-side";duplicateAction=!1;shortcutKeyCtrlEnterAction="send";layoutNameConfigure(){if(!this.model.isNew()){var t=this.model.get("status");if("Draft"!==t){let e="Sent"===t?!0:!1;"Archived"===t&&(this.model.get("createdById")!==this.getHelper().getAppParam("systemUserId")&&this.model.get("createdById")&&!this.model.get("isImported")||(e=!0)),e&&(this.layoutName+="Restricted"),this.isRestricted=e}else this.layoutName="composeSmall"}}init(){super.init(),this.layoutNameConfigure()}setup(){super.setup(),["Archived","Sent"].includes(this.model.get("status"))&&(this.shortcutKeyCtrlEnterAction="save"),this.addButtonEdit({name:"send",action:"send",label:"Send",style:"primary",title:"Ctrl+Enter"},!0),this.addButtonEdit({name:"saveDraft",action:"save",label:"Save Draft",title:"Ctrl+S"},!0),this.addButton({name:"sendFromDetail",label:"Send",hidden:!0}),this.controlSendButton(),this.listenTo(this.model,"change:status",()=>this.controlSendButton()),"Draft"!==this.model.get("status")&&this.model.has("isRead")&&!this.model.get("isRead")&&this.model.set("isRead",!0),this.listenTo(this.model,"sync",()=>{this.model.get("isRead")||"Draft"===this.model.get("status")||this.model.set("isRead",!0)}),this.model.get("isHtml")&&this.model.get("bodyPlain")||this.listenToOnce(this.model,"sync",()=>{this.model.get("isHtml")&&this.model.get("bodyPlain")&&this.showActionItem("showBodyPlain")}),this.model.get("isUsers")&&(this.addDropdownItem({label:"Mark as Important",name:"markAsImportant",hidden:this.model.get("isImportant"),groupIndex:1}),this.addDropdownItem({label:"Unmark Importance",name:"markAsNotImportant",hidden:!this.model.get("isImportant"),groupIndex:1}),this.addDropdownItem({label:"Move to Trash",name:"moveToTrash",hidden:this.model.get("inTrash"),groupIndex:2}),this.addDropdownItem({label:"Retrieve from Trash",name:"retrieveFromTrash",hidden:!this.model.get("inTrash"),groupIndex:2}),this.addDropdownItem({labelTranslation:"Email.actions.moveToArchive",name:"moveToArchive",groupIndex:2,hidden:this.model.get("inArchive"),onClick:()=>this.actionMoveToArchive()}),this.addDropdownItem({label:"Move to Folder",name:"moveToFolder",groupIndex:2})),this.addDropdownItem({label:"Show Plain Text",name:"showBodyPlain",hidden:!(this.model.get("isHtml")&&this.model.get("bodyPlain")),groupIndex:7}),this.addDropdownItem({label:"Print",name:"print",groupIndex:7}),this.listenTo(this.model,"change:isImportant",()=>{this.model.get("isImportant")?(this.hideActionItem("markAsImportant"),this.showActionItem("markAsNotImportant")):(this.hideActionItem("markAsNotImportant"),this.showActionItem("markAsImportant"))}),this.listenTo(this.model,"change:inTrash",()=>{this.model.get("inTrash")?(this.hideActionItem("moveToTrash"),this.showActionItem("retrieveFromTrash")):(this.hideActionItem("retrieveFromTrash"),this.showActionItem("moveToTrash"))}),this.listenTo(this.model,"change:inArchive",()=>{this.model.get("inArchive")?this.hideActionItem("moveToArchive"):this.showActionItem("moveToArchive")}),this.handleTasksField(),this.listenTo(this.model,"change:tasksIds",()=>this.handleTasksField()),this.getUser().isAdmin()&&this.addDropdownItem({label:"View Users",name:"viewUsers"}),this.setFieldReadOnly("replied"),"Draft"===this.model.get("status")&&(this.setFieldReadOnly("dateSent"),this.controlSelectTemplateField(),this.on("after:mode-change",()=>this.controlSelectTemplateField())),this.isRestricted&&(this.handleAttachmentField(),this.listenTo(this.model,"change:attachmentsIds",()=>this.handleAttachmentField()),this.handleCcField(),this.listenTo(this.model,"change:cc",()=>this.handleCcField()),this.handleBccField(),this.listenTo(this.model,"change:bcc",()=>this.handleBccField()))}controlSelectTemplateField(){this.mode,this.MODE_EDIT,this.hideField("selectTemplate")}controlSendButton(){if("Draft"===this.model.get("status"))return this.showActionItem("send"),this.showActionItem("saveDraft"),this.showActionItem("sendFromDetail"),this.hideActionItem("save"),void this.hideActionItem("saveAndContinueEditing");this.hideActionItem("sendFromDetail"),this.hideActionItem("send"),this.hideActionItem("saveDraft"),this.showActionItem("save"),this.showActionItem("saveAndContinueEditing")}actionSaveDraft(){this.actionSaveAndContinueEditing()}actionMarkAsImportant(){Espo.Ajax.postRequest("Email/inbox/important",{id:this.model.id}),this.model.set("isImportant",!0)}actionMarkAsNotImportant(){Espo.Ajax.deleteRequest("Email/inbox/important",{id:this.model.id}),this.model.set("isImportant",!1)}actionMoveToTrash(){Espo.Ajax.postRequest("Email/inbox/inTrash",{id:this.model.id}).then(()=>{Espo.Ui.warning(this.translate("Moved to Trash","labels","Email"))}),this.model.set("inTrash",!0),this.model.collection&&this.model.collection.trigger("moving-to-trash",this.model.id,!0)}actionRetrieveFromTrash(){Espo.Ajax.deleteRequest("Email/inbox/inTrash",{id:this.model.id}).then(()=>{Espo.Ui.warning(this.translate("Retrieved from Trash","labels","Email"))}),this.model.set("inTrash",!1),this.model.collection&&this.model.collection.trigger("retrieving-from-trash",this.model.id,!0)}actionMoveToFolder(){this.createView("dialog","views/email-folder/modals/select-folder",{headerText:this.translate("Move to Folder","labels","Email")},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),Espo.Ajax.postRequest("Email/inbox/folders/"+e,{id:this.model.id}).then(()=>{this.model.set("inArchive","archive"===e),"inbox"!==e&&"archive"!==e||(e=null),this.model.set("folderId",e),Espo.Ui.success(this.translate("Done"))})})})}actionMoveToArchive(){Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Email/inbox/folders/archive",{id:this.model.id}).then(()=>{this.model.set("inArchive",!0),Espo.Ui.info(this.translate("Moved to Archive","labels","Email")),this.model.collection&&this.model.collection.trigger("moving-to-archive",this.model.id,!0)})}actionShowBodyPlain(){this.createView("bodyPlain","views/email/modals/body-plain",{model:this.model},e=>{e.render()})}handleAttachmentField(){0===(this.model.get("attachmentsIds")||[]).length?this.hideField("attachments"):this.showField("attachments")}handleCcField(){this.model.get("cc")?this.showField("cc"):this.hideField("cc")}handleBccField(){this.model.get("bcc")?this.showField("bcc"):this.hideField("bcc")}send(){const e=this.model,t=e.get("status"),s=(e.set("status","Sending"),this.isSending=!0,()=>{e.trigger("after:send"),this.trigger("after:send"),this.isSending=!1});return this.once("after:save",s,this),this.once("cancel:save",()=>{this.off("after:save",s),this.isSending=!1,e.set("status",t)}),this.once("before:save",()=>{Espo.Ui.notify(this.translate("Sending...","labels","Email"))}),this.save()}actionSendFromDetail(){this.setEditMode().then(()=>this.send()).then(()=>{this.setDetailMode()})}exitAfterDelete(){let e=((this.collection||{}).data||{}).folderId||null;var t={isReturn:!0,isReturnThroughLink:!1,folder:e="inbox"===e?null:e};let s="#"+this.scope,i=null;return e&&(i="list",s+="/list/folder="+e),this.getRouter().dispatch(this.scope,i,t),this.getRouter().navigate(s,{trigger:!1}),!0}actionViewUsers(e){var t=this.getMetadata().get(["clientDefs",this.model.entityType,"relationshipPanels","users","viewModalView"])||this.getMetadata().get(["clientDefs","User","modalViews","relatedList"])||"views/modals/related-list";const s={model:this.model,link:"users",scope:"User",filtersDisabled:!0,url:this.model.entityType+"/"+this.model.id+"/users",createDisabled:!0,selectDisabled:!this.getUser().isAdmin(),rowActionsView:"views/record/row-actions/relationship-view-and-unlink"};if(e.viewOptions)for(const i in e.viewOptions)s[i]=e.viewOptions[i];Espo.Ui.notify(" ... "),this.createView("modalRelatedList",t,s,e=>{Espo.Ui.notify(!1),e.render(),this.listenTo(e,"action",(e,t)=>{Espo.Utils.handleAction(this,e,t)}),this.listenToOnce(e,"close",()=>{this.clearView("modalRelatedList")})})}actionSend(){this.send().then(()=>{this.model.set("status","Sent"),this.mode!==this.MODE_DETAIL&&(this.setDetailMode(),this.setFieldReadOnly("dateSent"),this.setFieldReadOnly("name"),this.setFieldReadOnly("attachments"),this.setFieldReadOnly("isHtml"),this.setFieldReadOnly("from"),this.setFieldReadOnly("to"),this.setFieldReadOnly("cc"),this.setFieldReadOnly("bcc"))})}actionPrint(){const t=this.getFieldView("body");if(t){let e=t.$el.find("iframe").get(0);if(e)e.contentWindow.print();else{var s=t.$el.get(0);const i=this.$el.get(0),a=((e=document.createElement("iframe")).style.display="none",i.append(e),e.contentWindow);a.document.open(),a.document.write(s.innerHTML),a.document.close(),a.focus(),a.print(),a.onafterprint=()=>{i.removeChild(e)}}}}errorHandlerSendingFail(t){this.model.id||(this.model.id=t.id);let s=this.translate("sendingFailed","strings","Email");if(t.message){let e=t.message;this.getLanguage().has(e,"messages","Email")&&(e=this.translate(e,"messages","Email")),s+=": "+e}Espo.Ui.error(s,!0),console.error(s)}handleTasksField(){0!==(this.model.get("tasksIds")||[]).length?this.showField("tasks"):this.hideField("tasks")}handleShortcutKeyCtrlS(e){this.inlineEditModeIsOn||this.buttonsDisabled||(e.preventDefault(),e.stopPropagation(),this.mode===this.MODE_EDIT&&this.saveAndContinueEditingAction&&(this.hasAvailableActionItem("saveDraft")||this.hasAvailableActionItem("saveAndContinueEditing"))&&this.actionSaveAndContinueEditing())}}e.default=i}),define("views/email/fields/email-address",["exports","views/fields/base","ui/autocomplete"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}afterRender(){super.afterRender(),this.$input=this.$el.find("input"),this.mode===this.MODE_SEARCH&&this.getAcl().check("Email","create")&&this.initSearchAutocomplete(),this.mode===this.MODE_SEARCH&&this.$input.on("input",()=>{this.trigger("change")})}initSearchAutocomplete(){this.$input=this.$input||this.$el.find("input");let t;const e=new s.default(this.$input.get(0),{name:this.name,autoSelectFirst:!0,triggerSelectOnValidInput:!0,focusOnSelect:!0,minChars:1,forceHide:!0,handleFocusMode:2,onSelect:e=>{this.$input.val(e.emailAddress)},formatResult:e=>this.getHelper().escapeString(e.name)+" &#60;"+this.getHelper().escapeString(e.id)+"&#62;",lookupFunction:e=>(t&&t.getReadyState()<4&&t.abort(),(t=Espo.Ajax.getRequest("EmailAddress/search",{q:e,maxSize:this.getAutocompleteMaxCount()})).then(e=>{let t=e.map(e=>({id:e.emailAddress,name:e.entityName,emailAddress:e.emailAddress,entityId:e.entityId,entityName:e.entityName,entityType:e.entityType,data:e.emailAddress,value:e.emailAddress}));if(this.skipCurrentInAutocomplete){const s=this.$input.val();t=t.filter(e=>e.emailAddress!==s)}return t}))});this.once("render remove",()=>e.dispose())}fetchSearch(){let e=this.$element.val();return(e="function"==typeof e.trim?e.trim():e)?{type:"equals",value:e}:null}}e.default=a}),define("views/user/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{sideView="views/user/record/detail-side";bottomView="views/user/record/detail-bottom";editModeDisabled=!0;setup(){super.setup(),this.setupNonAdminFieldsAccess(),this.getUser().isAdmin()&&!this.model.isPortal()&&this.addButton({name:"access",label:"Access",style:"default",onClick:()=>this.actionAccess()});var e=this.model.isPortal()||this.model.id===this.getUser().id&&this.getUser().isPortal();(this.model.id===this.getUser().id||this.getUser().isAdmin())&&this.getConfig().get("auth2FA")&&(this.model.isRegular()||this.model.isAdmin()||e&&this.getConfig().get("auth2FAInPortal"))&&this.addButton({name:"viewSecurity",label:"Security"}),this.model.id!==this.getUser().id||this.model.isApi()||!this.getUser().isAdmin()&&this.getHelper().getAppParam("passwordChangeForNonAdminDisabled")||this.addDropdownItem({name:"changePassword",label:"Change Password",style:"default"}),this.getUser().isAdmin()&&(this.model.isRegular()||this.model.isAdmin()||this.model.isPortal())&&!this.model.isSuperAdmin()&&(this.addDropdownItem({name:"sendPasswordChangeLink",label:"Send Password Change Link",action:"sendPasswordChangeLink",hidden:!this.model.get("emailAddress")}),this.addDropdownItem({name:"generateNewPassword",label:"Generate New Password",action:"generateNewPassword",hidden:!this.model.get("emailAddress")}),this.model.get("emailAddress")||this.listenTo(this.model,"sync",()=>{this.model.get("emailAddress")?(this.showActionItem("generateNewPassword"),this.showActionItem("sendPasswordChangeLink")):(this.hideActionItem("generateNewPassword"),this.hideActionItem("sendPasswordChangeLink"))})),(this.model.isPortal()||this.model.isApi())&&this.hideActionItem("duplicate"),this.model.id===this.getUser().id&&this.listenTo(this.model,"after:save",()=>{this.getUser().set(this.model.getClonedAttributes())}),this.getUser().isAdmin()&&this.model.isRegular()&&!this.getConfig().get("authAnotherUserDisabled")&&this.addDropdownItem({label:"Log in",name:"login",action:"login"}),this.setupFieldAppearance()}setupActionItems(){super.setupActionItems(),this.model.isApi()&&this.getUser().isAdmin()&&this.addDropdownItem({label:"Generate New API Key",name:"generateNewApiKey"})}setupNonAdminFieldsAccess(){if(!this.getUser().isAdmin()){let e=["userName","isActive","teams","roles","password","portals","portalRoles","defaultTeam","contact","accounts","type","emailAddress"];(e=e.filter(e=>{if(!this.model.hasField(e))return!0;e=this.getMetadata().get(["entityAcl","User","fields",e]);return!e||!!e.nonAdminReadOnly})).forEach(e=>{this.setFieldReadOnly(e,!0)}),this.getAcl().checkScope("Team")||this.setFieldReadOnly("defaultTeam",!0),this.hideField("layoutSet",!0)}}setupFieldAppearance(){this.controlFieldAppearance(),this.listenTo(this.model,"change",()=>{this.controlFieldAppearance()})}controlFieldAppearance(){"portal"===this.model.get("type")?(this.hideField("roles"),this.hideField("teams"),this.hideField("defaultTeam"),this.showField("portals"),this.showField("portalRoles"),this.showField("contact"),this.showField("accounts"),this.showPanel("portal"),this.hideField("title")):(this.showField("roles"),this.showField("teams"),this.showField("defaultTeam"),this.hideField("portals"),this.hideField("portalRoles"),this.hideField("contact"),this.hideField("accounts"),this.hidePanel("portal"),"api"===this.model.get("type")?(this.hideField("title"),this.hideField("emailAddress"),this.hideField("phoneNumber"),this.hideField("name"),this.hideField("gender"),"Hmac"===this.model.get("authMethod")?this.showField("secretKey"):this.hideField("secretKey")):this.showField("title")),this.model.id!==this.getUser().id&&("admin"===this.model.get("type")||"regular"===this.model.get("type"))?(this.setFieldNotReadOnly("type"),this.setFieldOptionList("type",["regular","admin"])):this.setFieldReadOnly("type"),this.getConfig().get("auth2FA")&&(this.model.isRegular()||this.model.isAdmin())||this.hideField("auth2FA")}actionChangePassword(){Espo.Ui.notify(" ... "),this.createView("changePassword","views/modals/change-password",{userId:this.model.id},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"changed",()=>{setTimeout(()=>{this.getBaseController().logout()},2e3)})})}actionPreferences(){this.getRouter().navigate("#Preferences/edit/"+this.model.id,{trigger:!0})}actionEmailAccounts(){this.getRouter().navigate("#EmailAccount/list/userId="+this.model.id,{trigger:!0})}actionExternalAccounts(){this.getRouter().navigate("#ExternalAccount",{trigger:!0})}actionAccess(){Espo.Ui.notify(" ... "),Espo.Ajax.getRequest(`User/${this.model.id}/acl`).then(e=>{this.createView("access","views/user/modals/access",{aclData:e,model:this.model},e=>{Espo.Ui.notify(!1),e.render()})})}getGridLayout(s){var e=this.options.layoutName||this.layoutName;this.getHelper().layoutManager.get(this.model.entityType,e,e=>{const t=Espo.Utils.cloneDeep(e);e=void 0!==t.find(e=>e.tabBreak),this.getUser().isPortal()||(t.push({label:"Teams and Access Control",name:"accessControl",tabBreak:e,tabLabel:this.translate("Settings","scopeNames"),rows:[[{name:"type"},{name:"isActive"}],[{name:"teams"},{name:"defaultTeam"}],[{name:"roles"},!1]]}),this.model.isPortal()&&(t.push({label:"Portal",name:"portal",rows:[[{name:"portals"},{name:"contact"}],[{name:"portalRoles"},{name:"accounts"}]]}),this.getUser().isAdmin()&&t.push({label:"Misc",name:"portalMisc",rows:[[{name:"dashboardTemplate"},!1]]})),(this.model.isAdmin()||this.model.isRegular())&&t.push({label:"Misc",name:"misc",rows:[[{name:"workingTimeCalendar"},{name:"layoutSet"}]]})),this.getUser().isAdmin()&&this.model.isApi()&&t.push({name:"auth",rows:[[{name:"authMethod"},!1],[{name:"apiKey"},{name:"secretKey"}]]}),this.detailLayout=t,e={type:"record",layout:this.convertDetailLayout(t)};s(e)})}actionGenerateNewApiKey(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest("UserSecurity/apiKey/generate",{id:this.model.id}).then(e=>{this.model.set(e)})})}actionViewSecurity(){this.createView("dialog","views/user/modals/security",{userModel:this.model},e=>{e.render()})}actionSendPasswordChangeLink(){this.confirm({message:this.translate("sendPasswordChangeLinkConfirmation","messages","User"),confirmText:this.translate("Send","labels","Email")}).then(()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("UserSecurity/password/recovery",{id:this.model.id}).then(()=>{Espo.Ui.success(this.translate("Done"))})})}actionGenerateNewPassword(){this.confirm(this.translate("generateAndSendNewPassword","messages","User")).then(()=>{Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("UserSecurity/password/generate",{id:this.model.id}).then(()=>{Espo.Ui.success(this.translate("Done"))})})}actionLogin(){var e=this.model.get("userName"),t=this.getUser().get("userName");this.createView("dialog","views/user/modals/login-as",{model:this.model,anotherUser:e,username:t}).then(e=>e.render())}}e.default=i}),define("views/user/record/detail-side",["views/record/detail-side"],function(t){return t.extend({setupPanels:function(){if(t.prototype.setupPanels.call(this),this.model.isApi()||this.model.isSystem())return this.hidePanel("activities",!0),this.hidePanel("history",!0),this.hidePanel("tasks",!0),void this.hidePanel("stream",!0);var e=this.getAcl().checkUserPermission(this.model);e||"team"===this.getAcl().get("userPermission")&&(this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",function(){this.getAcl().checkUserPermission(this.model)&&this.onPanelsReady(function(){this.showPanel("activities","acl"),this.showPanel("history","acl"),this.model.isPortal()||this.showPanel("tasks","acl")})},this)),e||(this.hidePanel("activities",!1,"acl"),this.hidePanel("history",!1,"acl"),this.hidePanel("tasks",!1,"acl")),this.model.isPortal()&&this.hidePanel("tasks",!0)}})}),define("views/user/modals/select-position",["exports","views/modal","model","views/record/edit-for-modal","views/fields/enum"],function(e,t,s,i,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=o(t),s=o(s),i=o(i),a=o(a);class l extends t.default{templateContent='<div class="record no-side-margin">{{{record}}}</div>';className="dialog dialog-record";shortcutKeys={"Control+Enter":"apply"};constructor(e){super(e),this.props=e}setup(){this.headerText=this.translate("changePosition","actions","User")+" Â· "+this.props.name,this.buttonList=[{name:"save",label:"Save",style:"primary",onClick:()=>this.apply()},{name:"cancel",label:"Cancel"}],this.model=new s.default,this.model.setMultiple({position:this.props.position}),this.recordView=new i.default({model:this.model,detailLayout:[{rows:[[{view:new a.default({name:"position",params:{options:["",...this.props.positionList]},labelText:this.translate("teamRole","fields","User")})},!1]]}]}),this.assignView("record",this.recordView,".record")}apply(){this.recordView.validate()||(this.props.onApply(this.model.attributes.position),this.close())}onBackdropClick(){this.recordView.isChanged||this.close()}}e.default=l}),define("views/settings/fields/theme",["exports","views/fields/enum","theme-manager","ui/select"],function(e,t,s,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),s=a(s),i=a(i);class o extends t.default{editTemplateContent=`
        <div class="grid-auto-fit-xxs">
            <div>
                <select data-name="{{name}}" class="form-control main-element">
                    {{options
                        params.options value
                        scope=scope
                        field=name
                        translatedOptions=translatedOptions
                        includeMissingOption=true
                        styleMap=params.style
                    }}
                </select>
            </div>
            {{#if navbarOptionList.length}}
            <div>
                <select data-name="themeNavbar" class="form-control">
                    {{options navbarOptionList navbar translatedOptions=navbarTranslatedOptions}}
                </select>
            </div>
            {{/if}}
        </div>
    `;data(){const t=super.data();return t.navbarOptionList=this.getNavbarOptionList(),t.navbar=this.getNavbarValue()||this.getDefaultNavbar(),t.navbarTranslatedOptions={},t.navbarOptionList.forEach(e=>{t.navbarTranslatedOptions[e]=this.translate(e,"themeNavbars")}),t}setup(){super.setup(),this.initThemeManager(),this.model.on("change:theme",(e,t,s)=>{this.initThemeManager(),s.ui&&this.reRender().then(()=>i.default.focus(this.$element,{noTrigger:!0}))})}afterRenderEdit(){this.$navbar=this.$el.find('[data-name="themeNavbar"]'),this.$navbar.on("change",()=>this.trigger("change")),i.default.init(this.$navbar)}getNavbarValue(){return(this.model.get("themeParams")||{}).navbar}getNavbarDefs(){if(!this.themeManager)return null;var e=this.themeManager.getParam("params");return e&&e.navbar?Espo.Utils.cloneDeep(e.navbar):null}getNavbarOptionList(){var e=this.getNavbarDefs();if(!e)return[];e=e.options||[];return e.length&&1!==e.length?e:[]}getDefaultNavbar(){return(this.getNavbarDefs()||{}).default||null}initThemeManager(){var e=this.model.get("theme");this.themeManager=e?new s.default(this.getConfig(),this.getPreferences(),this.getMetadata(),e):null}getAttributeList(){return[this.name,"themeParams"]}setupOptions(){this.params.options=Object.keys(this.getMetadata().get("themes")||{}).sort((e,t)=>"EspoRtl"===t?-1:this.translate(e,"theme").localeCompare(this.translate(t,"theme")))}fetch(){const e=super.fetch(),t={};return this.$navbar.length&&(t.navbar=this.$navbar.val()),e.themeParams=t,e}}e.default=o}),define("views/settings/fields/tab-list",["exports","views/fields/array"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{addItemModalView="views/settings/modals/tab-list-field-add";noGroups=!1;noDelimiters=!1;setup(){super.setup(),this.selected.forEach(e=>{e&&"object"==typeof e&&(e.id||(e.id=this.generateItemId()))}),this.events['click [data-action="editGroup"]']=e=>{e=$(e.currentTarget).parent().data("value").toString();this.editGroup(e)}}generateItemId(){return Math.floor(1e6*Math.random()+1).toString()}setupOptions(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>!this.getMetadata().get(`scopes.${e}.disabled`)&&(!!this.getAcl().checkScope(e)&&this.getMetadata().get(`scopes.${e}.tab`))).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),this.noDelimiters||(this.params.options.push("_delimiter_"),this.params.options.push("_delimiter-ext_")),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"scopeNamesPlural")}),this.translatedOptions._delimiter_=". . .",this.translatedOptions["_delimiter-ext_"]=". . ."}addValue(e){var t;if(e&&"object"==typeof e)return e.id||(e.id=this.generateItemId()),t=this.getItemHtml(e),this.$list.append(t),this.selected.push(e),void this.trigger("change");super.addValue(e)}removeValue(e){var t=this.getGroupIndexById(e);if(~t)return this.$list.children(`[data-value="${e}"]`).remove(),this.selected.splice(t,1),void this.trigger("change");super.removeValue(e)}getItemHtml(e){return e&&"object"==typeof e?this.getGroupItemHtml(e):super.getItemHtml(e)}getGroupItemHtml(e){var t=e.text||"";const s=$("<span>").text(t);let i=null;"group"===e.type&&(i=$("<span>").addClass("far fa-list-alt").addClass("text-muted")),"url"===e.type&&(i=$("<span>").addClass("fas fa-link fa-sm").addClass("text-muted")),"divider"===e.type&&s.addClass("text-soft").addClass("text-italic");const a=$("<span>").append(s);return i&&a.prepend(i," "),$("<div>").addClass("list-group-item").attr("data-value",e.id).css("cursor","default").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-value",e.id).attr("data-action","editGroup").css("margin-right","7px").append($("<span>").addClass("fas fa-pencil-alt fa-sm")),a,"&nbsp;",$("<a>").addClass("pull-right").attr("role","button").attr("tabindex","0").attr("data-value",e.id).attr("data-action","removeValue").append($("<span>").addClass("fas fa-times"))).get(0).outerHTML}fetchFromDom(){const i=[];this.$el.find(".list-group .list-group-item").each((e,t)=>{var t=$(t).data("value").toString(),s=this.getGroupValueById(t);s?i.push(s):i.push(t)}),this.selected=i}getGroupIndexById(t){for(let e=0;e<this.selected.length;e++){var s=this.selected[e];if(s&&"object"==typeof s&&s.id===t)return e}return-1}getGroupValueById(e){for(const t of this.selected)if(t&&"object"==typeof t&&t.id===e)return t;return null}editGroup(e){var t=Espo.Utils.cloneDeep(this.getGroupValueById(e)||{});const i=this.getGroupIndexById(e),a=Espo.Utils.cloneDeep(this.selected);e={divider:"views/settings/modals/edit-tab-divider",url:"views/settings/modals/edit-tab-url"}[t.type]||"views/settings/modals/edit-tab-group";this.createView("dialog",e,{itemData:t,parentType:this.model.entityType},s=>{s.render(),this.listenToOnce(s,"apply",e=>{for(const t in e)a[i][t]=e[t];this.model.set(this.name,a),s.close()})})}getAddItemModalOptions(){return{...super.getAddItemModalOptions(),noGroups:this.noGroups}}getValueForDisplay(){const t=this.translatedOptions||{},e=this.selected.map(e=>"string"!=typeof e?" - "+(e.text||"?"):t[e]||e);return e.map(e=>$("<div>").addClass("multi-enum-item-container").text(e).get(0).outerHTML).join("")}}e.default=i}),define("views/settings/fields/quick-create-list",["exports","views/fields/array"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get(`scopes.${e}.disabled`))return this.getMetadata().get(`scopes.${e}.entity`)&&this.getMetadata().get(`scopes.${e}.object`)}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),super.setup()}}e.default=i}),define("views/import/record/panels/imported",["exports","views/record/panels/relationship"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{link="imported";readOnly=!0;rowActionsView="views/record/row-actions/relationship-no-unlink";setup(){this.entityType=this.model.get("entityType"),this.title=this.title||this.translate("Imported","labels","Import"),super.setup()}}e.default=i}),define("views/email-template/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{duplicateAction=!0;saveAndContinueEditingAction=!0;setup(){super.setup(),this.listenToInsertField(),this.hideField("insertField"),this.on("before:set-edit-mode",()=>this.showField("insertField")),this.on("before:set-detail-mode",()=>this.hideField("insertField"))}listenToInsertField(){this.listenTo(this.model,"insert-field",e=>{e=`{${e.entityType}.${e.field}}`;const t=this.getFieldView("body");if(t){if(this.model.attributes.isHtml){const a=$(window.getSelection().anchorNode);return a.closest(".note-editing-area").length?void t.insertText(e):void 0}const i=$(t.element.querySelector("textarea.main-element"));var s=i.val();s+=e,i.val(s)}})}}e.default=i}),define("views/email-account/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.setupFieldsBehaviour(),this.initSslFieldListening(),this.initSmtpFieldsControl(),this.getUser().isAdmin()?this.setFieldNotReadOnly("assignedUser"):this.setFieldReadOnly("assignedUser")}modifyDetailLayout(e){e.filter(e=>"$label:SMTP"===e.tabLabel).forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{const t=this.translate(e.name,"fields","EmailAccount");t&&0===t.indexOf("SMTP ")&&(e.labelText=Espo.Utils.upperCaseFirst(t.substring(5)))})})})}setupFieldsBehaviour(){this.controlStatusField(),this.listenTo(this.model,"change:status",(e,t,s)=>{s.ui&&this.controlStatusField()}),this.listenTo(this.model,"change:useImap",(e,t,s)=>{s.ui&&this.controlStatusField()}),this.wasFetched()?this.setFieldReadOnly("fetchSince"):this.setFieldNotReadOnly("fetchSince")}controlStatusField(){const e=["username","port","host","monitoredFolders"];"Active"===this.model.get("status")&&this.model.get("useImap")?e.forEach(e=>{this.setFieldRequired(e)}):e.forEach(e=>{this.setFieldNotRequired(e)})}wasFetched(){return!this.model.isNew()&&!!(this.model.get("fetchData")||{}).lastUID}initSslFieldListening(){this.listenTo(this.model,"change:security",(e,t,s)=>{s.ui&&(t?this.model.set("port",993):this.model.set("port",143))}),this.listenTo(this.model,"change:smtpSecurity",(e,t,s)=>{s.ui&&("SSL"===t?this.model.set("smtpPort",465):"TLS"===t?this.model.set("smtpPort",587):this.model.set("smtpPort",25))})}initSmtpFieldsControl(){this.controlSmtpFields(),this.listenTo(this.model,"change:useSmtp",this.controlSmtpFields,this),this.listenTo(this.model,"change:smtpAuth",this.controlSmtpFields,this)}controlSmtpFields(){if(this.model.get("useSmtp"))return this.showField("smtpHost"),this.showField("smtpPort"),this.showField("smtpAuth"),this.showField("smtpSecurity"),this.showField("smtpTestSend"),this.setFieldRequired("smtpHost"),this.setFieldRequired("smtpPort"),void this.controlSmtpAuthField();this.hideField("smtpHost"),this.hideField("smtpPort"),this.hideField("smtpAuth"),this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.hideField("smtpSecurity"),this.hideField("smtpTestSend"),this.setFieldNotRequired("smtpHost"),this.setFieldNotRequired("smtpPort"),this.setFieldNotRequired("smtpUsername")}controlSmtpAuthField(){if(this.model.get("smtpAuth"))return this.showField("smtpUsername"),this.showField("smtpPassword"),this.showField("smtpAuthMechanism"),void this.setFieldRequired("smtpUsername");this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.setFieldNotRequired("smtpUsername")}}e.default=i}),define("views/email/detail",["exports","views/detail","email-helper"],function(e,t,d){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),d=s(d);class i extends t.default{setup(){super.setup();var e=this.model.get("status");"Draft"===e?this.menu={buttons:[],dropdown:[],actions:[]}:(this.addMenuItem("buttons",{name:"reply",label:"Reply",action:this.getPreferences().get("emailReplyToAllByDefault")?"replyToAll":"reply",style:"danger",className:"btn-s-wide"},!0),this.addMenuItem("dropdown",!1),"Archived"===e&&(this.model.get("parentId")||(this.addMenuItem("dropdown",{label:"Create Lead",action:"createLead",acl:"create",aclScope:"Lead"}),this.addMenuItem("dropdown",{label:"Create Contact",action:"createContact",acl:"create",aclScope:"Contact"}))),this.addMenuItem("dropdown",{label:"Create Task",action:"createTask",acl:"create",aclScope:"Task"}),"Case"===this.model.get("parentType")&&this.model.get("parentId")||this.addMenuItem("dropdown",{label:"Create Case",action:"createCase",acl:"create",aclScope:"Case"}),this.getAcl().checkScope("Document","create")&&(void 0!==this.model.get("attachmentsIds")&&!this.model.getLinkMultipleIdList("attachments").length||(this.addMenuItem("dropdown",{text:this.translate("Create Document","labels","Document"),action:"createDocument",acl:"create",aclScope:"Document",hidden:void 0===this.model.get("attachmentsIds")}),void 0===this.model.get("attachmentsIds")&&this.listenToOnce(this.model,"sync",()=>{this.model.getLinkMultipleIdList("attachments").length&&this.showHeaderActionItem("createDocument")})))),this.listenTo(this.model,"change",()=>{if(this.isRendered()&&(this.model.hasChanged("isImportant")||this.model.hasChanged("inTrash")||this.model.hasChanged("inArchive"))){const e=this.getHeaderView();e&&e.reRender()}}),this.shortcutKeys["Control+Backspace"]=e=>{if(!$(e.target).hasClass("note-editable")){const t=this.getRecordView();this.model.get("isUsers")&&!this.model.get("inArchive")&&(e.preventDefault(),e.stopPropagation(),t.actionMoveToArchive())}},this.shortcutKeys["Control+Delete"]=e=>{if(!$(e.target).hasClass("note-editable")){const t=this.getRecordView();this.model.get("isUsers")&&!this.model.get("inTrash")&&(e.preventDefault(),e.stopPropagation(),t.actionMoveToTrash())}},this.shortcutKeys["Control+KeyI"]=e=>{if(!$(e.target).hasClass("note-editable")){const t=this.getRecordView();this.model.get("isUsers")&&(e.preventDefault(),e.stopPropagation(),this.model.get("isImportant")?t.actionMarkAsNotImportant():t.actionMarkAsImportant())}},this.shortcutKeys["Control+KeyM"]=e=>{if(!$(e.target).hasClass("note-editable")){const t=this.getRecordView();this.model.get("isUsers")&&(e.preventDefault(),e.stopPropagation(),t.actionMoveToFolder())}}}actionCreateLead(){const e={},t=new d.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());var s=this.model.get("fromString")||this.model.get("fromName");if(s){const a=t.parseNameFromStringAddress(s);a&&(s=a.split(" ").slice(0,-1).join(" "),i=a.split(" ").slice(-1).join(" "),e.firstName=s,e.lastName=i)}if(this.model.get("replyToString")){const o=this.model.get("replyToString");var s=o.split(";")[0];e.emailAddress=t.parseAddressFromStringAddress(s);const l=t.parseNameFromStringAddress(s);l&&(i=l.split(" ").slice(0,-1).join(" "),s=l.split(" ").slice(-1).join(" "),e.firstName=i,e.lastName=s)}e.emailAddress||(e.emailAddress=this.model.get("from")),e.originalEmailId=this.model.id;var i=this.getMetadata().get("clientDefs.Lead.modalViews.edit")||"views/modals/edit";Espo.Ui.notify(" ... "),this.createView("quickCreate",i,{scope:"Lead",attributes:e},e=>{e.render(),e.notify(!1),this.listenTo(e,"before:save",()=>{this.getRecordView().blockUpdateWebSocket(!0)}),this.listenToOnce(e,"after:save",()=>{this.model.fetch(),this.removeMenuItem("createContact"),this.removeMenuItem("createLead"),e.close()})})}actionCreateCase(){const s={};var e=this.model.get("parentId"),t=this.model.get("parentType"),i=this.model.get("parentName"),a=this.model.get("accountId"),o=this.model.get("accountName");e&&("Account"===t?(s.accountId=e,s.accountName=i):"Contact"===t?(s.contactId=e,s.contactName=i,s.contactsIds=[e],s.contactsNames={},s.contactsNames[e]=i,a&&(s.accountId=a,s.accountName=o||a)):"Lead"===t&&(s.leadId=e,s.leadName=i)),s.emailsIds=[this.model.id],s.originalEmailId=this.model.id,s.name=this.model.get("name"),s.description=this.model.get("bodyPlain")||"";const l=this.getMetadata().get("clientDefs.Case.modalViews.edit")||"views/modals/edit";Espo.Ui.notify(" ... "),new Promise(t=>{(this.model.get("attachmentsIds")||[]).length?Espo.Ajax.postRequest(`Email/${this.model.id}/attachments/copy`,{parentType:"Case",field:"attachments"}).then(e=>{s.attachmentsIds=e.ids,s.attachmentsNames=e.names,t()}):t()}).then(()=>{this.createView("quickCreate",l,{scope:"Case",attributes:s},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"after:save",()=>{this.model.fetch(),this.removeMenuItem("createCase"),e.close()}),this.listenTo(e,"before:save",()=>{this.getRecordView().blockUpdateWebSocket(!0)})})})}actionCreateTask(){const e={};e.parentId=this.model.get("parentId"),e.parentName=this.model.get("parentName"),e.parentType=this.model.get("parentType"),e.emailId=this.model.id;var t=this.model.get("name"),t=(e.description="["+this.translate("Email","scopeNames")+": "+t+"](#Email/view/"+this.model.id+")\n",this.getMetadata().get("clientDefs.Task.modalViews.edit")||"views/modals/edit");Espo.Ui.notify(" ... "),this.createView("quickCreate",t,{scope:"Task",attributes:e},e=>{const t=e.getRecordView();var s=t.getFieldView("name");let i=[];(i=s&&s.params.options?i.concat(s.params.options):i).push(this.translate("replyToEmail","nameOptions","Task")),t.setFieldOptionList("name",i),e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{e.close(),this.model.fetch()})})}actionCreateContact(){const e={},t=new d.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());var s=this.model.get("fromString")||this.model.get("fromName");if(s){const a=t.parseNameFromStringAddress(s);a&&(s=a.split(" ").slice(0,-1).join(" "),i=a.split(" ").slice(-1).join(" "),e.firstName=s,e.lastName=i)}if(this.model.get("replyToString")){const o=this.model.get("replyToString");var s=o.split(";")[0];e.emailAddress=t.parseAddressFromStringAddress(s);const l=t.parseNameFromStringAddress(s);l&&(i=l.split(" ").slice(0,-1).join(" "),s=l.split(" ").slice(-1).join(" "),e.firstName=i,e.lastName=s)}e.emailAddress||(e.emailAddress=this.model.get("from")),e.originalEmailId=this.model.id;var i=this.getMetadata().get("clientDefs.Contact.modalViews.edit")||"views/modals/edit";Espo.Ui.notify(" ... "),this.createView("quickCreate",i,{scope:"Contact",attributes:e},e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{this.model.fetch(),this.removeMenuItem("createContact"),this.removeMenuItem("createLead"),e.close()}),this.listenTo(e,"before:save",()=>{this.getRecordView().blockUpdateWebSocket(!0)})})}actionReply(e,t,s){const i=new d.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());e=i.getReplyAttributes(this.model,e,s),Espo.Ui.notify(" ... "),s=this.getMetadata().get("clientDefs.Email.modalViews.compose")||"views/modals/compose-email";this.createView("quickCreate",s,{attributes:e,focusForCreate:!0},e=>{e.render(),e.notify(!1),this.listenTo(e,"after:save",()=>{this.model.fetch()})})}actionReplyToAll(e,t){this.actionReply(e,t,!0)}actionForward(){const i=new d.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Email/action/getDuplicateAttributes",{id:this.model.id}).then(e=>{const t=this.model.clone(),s=(t.set("body",e.body),i.getForwardAttributes(t));s.attachmentsIds=e.attachmentsIds,s.attachmentsNames=e.attachmentsNames,Espo.Ui.notify(" ... ");e=this.getMetadata().get("clientDefs.Email.modalViews.compose")||"views/modals/compose-email";this.createView("quickCreate",e,{attributes:s},e=>{e.render(),e.notify(!1)})})}getHeader(){var e=this.model.get("name"),t=this.model.get("isImportant"),s=this.model.get("inTrash"),i=this.model.get("inArchive"),a=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope,o=this.getHeaderIconHtml();let l=$("<a>").attr("href",a).attr("data-action","navigateToRoot").addClass("action").text(this.getLanguage().translate(this.model.name,"scopeNamesPlural")),d=(o&&(l=$("<span>").append(o,l).get(0).innerHTML),"");return t?d="text-warning":s?d="text-muted":i&&(d="text-info"),this.buildHeaderHtml([l,$("<span>").addClass("font-size-flexible title").addClass(d).text(e)])}actionNavigateToRoot(e,t){t.stopPropagation(),this.getRouter().checkConfirmLeaveOut(()=>{var e=this.options.rootUrl||this.options.params.rootUrl||"#"+this.scope;this.getRouter().navigate(e,{trigger:!1}),this.getRouter().dispatch(this.scope,null,{isReturn:!0,isReturnThroughLink:!0})})}actionCreateDocument(){const e=this.model.getLinkMultipleIdList("attachments");if(e.length){const t=this.model.get("attachmentsNames")||{},s=this.model.get("attachmentsTypes")||{},i=e=>{const t={};this.model.get("accountId")&&(t.accountsIds=[this.model.get("accountId")],t.accountsNames={},t.accountsNames[this.model.get("accountId")]=this.model.get("accountName")),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Attachment/copy/"+e,{relatedType:"Document",field:"file"}).then(e=>{t.fileId=e.id,t.fileName=e.name,t.name=e.name;e=this.getMetadata().get("clientDefs.Document.modalViews.edit")||"views/modals/edit";this.createView("quickCreate",e,{scope:"Document",attributes:t},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"after:save",()=>{e.close()})})})};if(1!==e.length){const a=[];e.forEach(e=>{a.push({id:e,name:t[e]||e,type:s[e]})}),this.createView("dialog","views/attachment/modals/select-one",{dataList:a,fieldLabel:this.translate("attachments","fields","Email")},e=>{e.render(),this.listenToOnce(e,"select",i.bind(this))})}else i(e[0])}}}e.default=i}),define("views/email/record/list",["exports","views/record/list","helpers/mass-action"],function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),a=s(a);class i extends t.default{rowActionsView="views/email/record/row-actions/default";massActionList=["remove","massUpdate"];toRemoveIdList;setup(){super.setup(),this.collection.url===this.entityType&&(this.addMassAction({name:"retrieveFromTrash",groupIndex:-6},!1),this.addMassAction({name:"moveToTrash",groupIndex:-5},!1),this.addMassAction({name:"moveToArchive",groupIndex:-5},!1),this.addMassAction({name:"moveToFolder",groupIndex:-5},!0),this.addMassAction({name:"markAsImportant",groupIndex:-4},!1),this.addMassAction({name:"markAsNotImportant",groupIndex:-4},!1),this.addMassAction({name:"markAsRead",groupIndex:-3},!1),this.addMassAction({name:"markAsNotRead",groupIndex:-3},!1),this.dropdownItemList.push({name:"markAllAsRead",label:"Mark all as read"}),this.controlEmailMassActionsVisibility(),this.listenTo(this.collection,"select-folder",()=>this.controlEmailMassActionsVisibility())),this.listenTo(this.collection,"moving-to-trash",(e,t)=>{const s=this.collection.get(e);s&&s.set("inTrash",!0),"trash"!==this.collection.selectedFolderId&&"all"!==this.collection.selectedFolderId&&(t?this.toRemoveIdList.push(e):this.removeRecordFromList(e))}),this.listenTo(this.collection,"retrieving-from-trash",(e,t)=>{const s=this.collection.get(e);s&&s.set("inTrash",!1),"trash"===this.collection.selectedFolderId&&(t?this.toRemoveIdList.push(e):this.removeRecordFromList(e))}),this.listenTo(this.collection,"moving-to-archive",(e,t)=>{const s=this.collection.get(e);s&&s.set("inArchive",!0),"archive"!==this.collection.selectedFolderId&&(t?this.toRemoveIdList.push(e):this.removeRecordFromList(e))}),this.toRemoveIdList=[]}removeQueuedRecord(){this.toRemoveIdList.forEach(e=>this.removeRecordFromList(e))}massActionMarkAsRead(){const e=[];for(const t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.postRequest("Email/inbox/read",{ids:e}),e.forEach(e=>{const t=this.collection.get(e);t&&t.set("isRead",!0)})}massActionMarkAsNotRead(){const e=[];for(const t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.deleteRequest("Email/inbox/read",{ids:e}),e.forEach(e=>{const t=this.collection.get(e);t&&t.set("isRead",!1)})}massActionMarkAsImportant(){const e=[];for(const t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.postRequest("Email/inbox/important",{ids:e}),e.forEach(e=>{const t=this.collection.get(e);t&&t.set("isImportant",!0)})}massActionMarkAsNotImportant(){const e=[];for(const t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.deleteRequest("Email/inbox/important",{ids:e}),e.forEach(e=>{const t=this.collection.get(e);t&&t.set("isImportant",!1)})}massActionMoveToTrash(){const e=[];for(const t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.postRequest("Email/inbox/inTrash",{ids:e}).then(()=>{Espo.Ui.warning(this.translate("Moved to Trash","labels","Email"))}),"trash"!==this.collection.selectedFolderId&&e.forEach(e=>{this.collection.trigger("moving-to-trash",e),this.uncheckRecord(e,null,!0)})}massActionRetrieveFromTrash(){const e=[];for(const t in this.checkedList)e.push(this.checkedList[t]);Espo.Ajax.deleteRequest("Email/inbox/inTrash",{ids:e}).then(()=>{Espo.Ui.success(this.translate("Done"))}),"trash"===this.collection.selectedFolderId&&e.forEach(e=>{this.collection.trigger("retrieving-from-trash",e),this.uncheckRecord(e,null,!0)})}massMoveToFolder(t){var e=this.getMassActionSelectionPostData();const s=new a.default(this);var i=!!e.searchParams&&s.checkIsIdle();Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("MassAction",{entityType:this.entityType,action:"moveToFolder",params:e,idle:i,data:{folderId:t}}).then(e=>{if(Espo.Ui.notify(!1),!e.id)return"archive"===t?([...this.checkedList].forEach(e=>{this.collection.trigger("moving-to-archive",e),this.uncheckRecord(e,null,!0)}),void Espo.Ui.info(this.translate("Moved to Archive","labels","Email"))):void this.collection.fetch().then(()=>Espo.Ui.success(this.translate("Done")));s.process(e.id,"moveToFolder").then(e=>{this.listenToOnce(e,"close:success",()=>{this.collection.fetch().then(()=>Espo.Ui.success(this.translate("Done")))})})})}massActionMoveToFolder(){this.createView("dialog","views/email-folder/modals/select-folder",{headerText:this.translate("Move to Folder","labels","Email")},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),this.massMoveToFolder(e)})})}massActionMoveToArchive(){this.massMoveToFolder("archive")}actionMarkAsImportant(e){e=(e=e||{}).id;Espo.Ajax.postRequest("Email/inbox/important",{id:e});const t=this.collection.get(e);t&&t.set("isImportant",!0)}actionMarkAsNotImportant(e){e=(e=e||{}).id;Espo.Ajax.deleteRequest("Email/inbox/important",{id:e});const t=this.collection.get(e);t&&t.set("isImportant",!1)}actionMarkAllAsRead(){Espo.Ajax.postRequest("Email/inbox/read",{all:!0}),this.collection.forEach(e=>{e.set("isRead",!0)}),this.collection.trigger("all-marked-read")}actionMoveToArchive(e){const t=e.id;Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Email/inbox/folders/archive",{id:t}).then(()=>{Espo.Ui.info(this.translate("Moved to Archive","labels","Email")),this.collection.trigger("moving-to-archive",t,this.collection.get(t))})}actionMoveToTrash(e){const t=e.id;Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Email/inbox/inTrash",{id:t}).then(()=>{Espo.Ui.warning(this.translate("Moved to Trash","labels","Email")),this.collection.trigger("moving-to-trash",t)})}actionRetrieveFromTrash(e){const t=e.id;Espo.Ui.notify(" ... "),this.retrieveFromTrash(t).then(()=>{Espo.Ui.warning(this.translate("Retrieved from Trash","labels","Email")),this.collection.trigger("retrieving-from-trash",t)})}retrieveFromTrash(e){return Espo.Ajax.deleteRequest("Email/inbox/inTrash",{id:e})}massRetrieveFromTrashMoveToFolder(e){const t=[];for(const s in this.checkedList)t.push(this.checkedList[s]);Espo.Ajax.deleteRequest("Email/inbox/inTrash",{ids:t}).then(()=>(t.forEach(e=>{this.collection.trigger("retrieving-from-trash",e)}),Espo.Ajax.postRequest("Email/inbox/folders/"+e,{ids:t}).then(()=>{Espo.Ui.success(this.translate("Done"))})))}actionRetrieveFromTrashMoveToFolder(e){const t=e.id,s=e.folderId;Espo.Ui.notify(" ... "),this.retrieveFromTrash(t).then(()=>this.moveToFolder(t,s)).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done"))})})}moveToFolder(e,t){return Espo.Ajax.postRequest("Email/inbox/folders/"+t,{id:e})}actionMoveToFolder(e){const t=e.id,s=e.folderId;if(s)return Espo.Ui.notify(" ... "),void this.moveToFolder(t,s).then(()=>{if("archive"===s)return this.collection.trigger("moving-to-archive",t),void Espo.Ui.info(this.translate("Moved to Archive","labels","Email"));this.collection.fetch().then(()=>Espo.Ui.success(this.translate("Done")))});this.createView("dialog","views/email-folder/modals/select-folder",{headerText:this.translate("Move to Folder","labels","Email")},e=>{e.render(),this.listenToOnce(e,"select",e=>{this.clearView("dialog"),Espo.Ui.notify(" ... "),this.moveToFolder(t,e).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done"))})})})})}actionMarkAsRead(e){e=e.id;const t=this.collection.get(e);Espo.Ajax.postRequest("Email/inbox/read",{ids:[e]}),t&&t.set("isRead",!0)}actionSend(e){const t=e.id;this.confirm({message:this.translate("sendConfirm","messages","Email"),confirmText:this.translate("Send","labels","Email")}).then(()=>{const e=this.collection.get(t);e&&(Espo.Ui.notify(this.translate("Sending...","labels","Email")),e.save({status:"Sending"}).then(()=>{Espo.Ui.success(this.translate("emailSent","messages","Email")),"drafts"===this.collection.selectedFolderId&&(this.removeRecordFromList(t),this.uncheckRecord(t,null,!0),this.collection.trigger("draft-sent"))}))})}toggleMassMarkAsImportant(){this.checkedList.map(e=>this.collection.get(e)).find(e=>!e.get("isImportant"))?this.massActionMarkAsImportant():this.massActionMarkAsNotImportant()}controlEmailMassActionsVisibility(){"trash"!==this.collection.selectedFolderId&&"archive"!==this.collection.selectedFolderId?this.showMassAction("moveToArchive"):this.hideMassAction("moveToArchive"),"trash"===this.collection.selectedFolderId?(this.hideMassAction("moveToTrash"),this.showMassAction("retrieveFromTrash")):(this.showMassAction("moveToTrash"),this.hideMassAction("retrieveFromTrash")),"important"===this.collection.selectedFolderId?this.hideMassAction("markAsImportant"):this.showMassAction("markAsImportant")}}e.default=i}),define("views/email/record/edit",["exports","views/record/edit","views/email/record/detail"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{shortcutKeyCtrlEnterAction="send";init(){super.init(),s.default.prototype.layoutNameConfigure.call(this)}setup(){super.setup(),["Archived","Sent"].includes(this.model.get("status"))&&(this.shortcutKeyCtrlEnterAction="save"),this.addButton({name:"send",label:"Send",style:"primary",title:"Ctrl+Enter"},!0),this.addButton({name:"saveDraft",label:"Save Draft",title:"Ctrl+S"},!0),this.controlSendButton(),"Draft"===this.model.get("status")&&(this.setFieldReadOnly("dateSent"),this.hideField("selectTemplate")),this.handleAttachmentField(),this.handleCcField(),this.handleBccField(),this.listenTo(this.model,"change:attachmentsIds",()=>this.handleAttachmentField()),this.listenTo(this.model,"change:cc",()=>this.handleCcField()),this.listenTo(this.model,"change:bcc",()=>this.handleBccField())}handleAttachmentField(){0!==(this.model.get("attachmentsIds")||[]).length||this.isNew||"Draft"===this.model.get("status")?this.showField("attachments"):this.hideField("attachments")}handleCcField(){this.model.get("cc")||"Draft"===this.model.get("status")?this.showField("cc"):this.hideField("cc")}handleBccField(){this.model.get("bcc")||"Draft"===this.model.get("status")?this.showField("bcc"):this.hideField("bcc")}controlSendButton(){if("Draft"===this.model.get("status"))return this.showActionItem("send"),this.showActionItem("saveDraft"),this.hideActionItem("save"),void this.hideActionItem("saveAndContinueEditing");this.hideActionItem("send"),this.hideActionItem("saveDraft"),this.showActionItem("save"),this.showActionItem("saveAndContinueEditing")}actionSaveDraft(){this.actionSaveAndContinueEditing()}actionSend(){s.default.prototype.send.call(this).then(()=>this.exit()).catch(()=>{})}handleShortcutKeyCtrlS(e){this.inlineEditModeIsOn||this.buttonsDisabled||(e.preventDefault(),e.stopPropagation(),this.mode===this.MODE_EDIT&&this.saveAndContinueEditingAction&&(this.hasAvailableActionItem("saveDraft")||this.hasAvailableActionItem("saveAndContinueEditing"))&&this.actionSaveAndContinueEditing())}}e.default=a}),define("views/email/modals/import-eml",["exports","views/modal","views/record/edit-for-modal","model","views/fields/file"],function(e,t,s,i,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=o(t),s=o(s),i=o(i),a=o(a);class l extends t.default{templateContent=`
        <div class="record no-side-margin">{{{record}}}</div>
    `;setup(){this.headerText=this.translate("Import EML","labels","Email"),this.addButton({name:"import",label:"Proceed",style:"danger",onClick:()=>this.actionImport()}),this.addButton({name:"cancel",label:"Cancel",onClick:()=>this.close()}),this.model=new i.default({},{entityType:"ImportEml"}),this.recordView=new s.default({model:this.model,detailLayout:[{rows:[[{view:new a.default({name:"file",params:{required:!0,accept:[".eml"]},labelText:this.translate("file","otherFields","Email")})}]]}]}),this.assignView("record",this.recordView,".record")}actionImport(){this.recordView.validate()||(this.disableButton("import"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Email/importEml",{fileId:this.model.attributes.fileId}).then(e=>{Espo.Ui.notify(!1),this.getRouter().navigate("Email/view/"+e.id,{trigger:!0})}).catch(()=>this.enableButton("import")))}}e.default=l}),define("views/email/fields/person-string-data",["exports","views/fields/varchar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{listTemplate="email/fields/person-string-data/list";getAttributeList(){return["personStringData","isReplied"]}data(){const e=super.data();return e.isReplied=this.model.get("isReplied"),e}}e.default=i}),define("views/email/fields/from-address-varchar",["exports","views/fields/base","views/email/fields/email-address","helpers/record-modal","email-helper"],function(e,t,s,i,d){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),s=a(s),i=a(i),d=a(d);class o extends t.default{detailTemplate="email/fields/email-address-varchar/detail";validations=["required","email"];skipCurrentInAutocomplete=!0;emailAddressRegExp=new RegExp(/^[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+(?:\.[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+)*/.source+/@([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])?\.)+[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]/.source);setup(){super.setup(),this.erasedPlaceholder="ERASED:",this.on("render",()=>{this.mode!==this.MODE_SEARCH&&this.initAddressList()})}events={'click [data-action="createContact"]':function(e){e=$(e.currentTarget).data("address");this.createPerson("Contact",e)},'click [data-action="createLead"]':function(e){e=$(e.currentTarget).data("address");this.createPerson("Lead",e)},'click [data-action="addToContact"]':function(e){e=$(e.currentTarget).data("address");this.addToPerson("Contact",e)},'click [data-action="addToLead"]':function(e){e=$(e.currentTarget).data("address");this.addToPerson("Lead",e)},"auxclick a[href][data-scope][data-id]":function(e){if(1===e.button&&(e.ctrlKey||e.metaKey)){const i=$(e.currentTarget);var t=i.attr("data-id"),s=i.attr("data-scope");e.preventDefault(),e.stopPropagation(),this.quickView({id:t,scope:s})}}};data(){const e=super.data();var t=this.model.get(this.name);return!t||t in this.idHash||!this.model.get("parentId")||this.getAcl().check("Contact","edit")&&(e.showCreate=!0),e.valueIsSet=this.model.has(this.name),e}afterRender(){super.afterRender(),this.mode===this.MODE_SEARCH&&this.getAcl().check("Email","create")&&s.default.prototype.initSearchAutocomplete.call(this),this.mode===this.MODE_EDIT&&this.getAcl().check("Email","create")&&s.default.prototype.initSearchAutocomplete.call(this),this.mode===this.MODE_SEARCH&&this.$input.on("input",()=>{this.trigger("change")})}getAutocompleteMaxCount(){return s.default.prototype.getAutocompleteMaxCount.call(this)}initAddressList(){this.nameHash={},this.typeHash=this.model.get("typeHash")||{},this.idHash=this.model.get("idHash")||{},_.extend(this.nameHash,this.model.get("nameHash")||{})}getAttributeList(){const e=super.getAttributeList();return e.push("nameHash"),e.push("idHash"),e.push("accountId"),e}getValueForDisplay(){var e;return this.mode===this.MODE_DETAIL?(e=this.model.get(this.name),this.getDetailAddressHtml(e)):super.getValueForDisplay()}getDetailAddressHtml(e){if(!e)return"";var t=this.model.get("fromString")||this.model.get("fromName"),t=this.nameHash[e]||this.parseNameFromStringAddress(t)||null,s=this.typeHash[e]||null,i=this.idHash[e]||null;if(i)return $("<div>").append($("<a>").attr("href",`#${s}/view/`+i).attr("data-scope",s).attr("data-id",i).text(t)," ",$("<span>").addClass("text-muted middle-dot")," ",$("<span>").text(e)).get(0).outerHTML;const a=$("<div>");return(this.getAcl().check("Contact","create")||this.getAcl().check("Lead","create"))&&a.append(this.getCreateHtml(e)),t?a.append($("<span>").addClass("email-address-line").text(t).append(" ",$("<span>").addClass("text-muted middle-dot")," ",$("<span>").text(e))):a.append($("<span>").addClass("email-address-line").text(e)),a.get(0).outerHTML}getCreateHtml(e){const t=$("<ul>").addClass("dropdown-menu").attr("role","menu"),s=$("<span>").addClass("dropdown email-address-create-dropdown pull-right").append($("<button>").addClass("dropdown-toggle btn btn-link btn-sm").attr("data-toggle","dropdown").append($("<span>").addClass("caret text-muted")),t);return this.getAcl().check("Contact","create")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","createContact").attr("data-address",e).text(this.translate("Create Contact","labels","Email")))),this.getAcl().check("Lead","create")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","createLead").attr("data-address",e).text(this.translate("Create Lead","labels","Email")))),this.getAcl().check("Contact","edit")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","addToContact").attr("data-address",e).text(this.translate("Add to Contact","labels","Email")))),this.getAcl().check("Lead","edit")&&t.append($("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","addToLead").attr("data-address",e).text(this.translate("Add to Lead","labels","Email")))),"from"===this.name&&this.getAcl().check("EmailFilter","create")&&(t.children().length&&t.append('<li class="divider"></li>'),e="#EmailFilter/create?from="+encodeURI(e)+"&returnUrl="+encodeURI(this.getRouter().getCurrentUrl()),t.append($("<li>").append($("<a>").attr("tabindex","0").attr("href",e).text(this.translate("Create EmailFilter","labels","EmailFilter"))))),s.get(0).outerHTML}parseNameFromStringAddress(e){e=e||"";const t=new d.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());return t.parseNameFromStringAddress(e)}createPerson(o,l){var e,t=this.model.get("fromString")||this.model.get("fromName");let s=this.nameHash[l]||null;if(!s&&"from"===this.name&&t){const a=new d.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());s=a.parseNameFromStringAddress(t)}s=s&&this.getHelper().escapeString(s);const i={emailAddress:l};this.model.get("accountId")&&"Contact"===o&&(i.accountId=this.model.get("accountId"),i.accountName=this.model.get("accountName")),s&&(t=s.split(" ").slice(0,-1).join(" "),e=s.split(" ").slice(-1).join(" "),i.firstName=t,i.lastName=e);t=this.getMetadata().get(`clientDefs.${o}.modalViews.edit`)||"views/modals/edit";this.createView("create",t,{scope:o,attributes:i},e=>{e.render(),this.listenTo(e,"after:save",e=>{const t=Espo.Utils.clone(this.model.get("nameHash")||{}),s=Espo.Utils.clone(this.model.get("typeHash")||{}),i=Espo.Utils.clone(this.model.get("idHash")||{}),a=(i[l]=e.id,t[l]=e.get("name"),s[l]=o,this.idHash=i,this.nameHash=t,this.typeHash=s,{nameHash:t,idHash:i,typeHash:s});setTimeout(()=>{this.model.set(a),this.model.get("icsContents")&&this.model.fetch()},50)})})}addToPerson(o,l){var e=this.model.get("fromString")||this.model.get("fromName");let t=this.nameHash[l]||null;if(!t&&"from"===this.name&&e){const a=new d.default(this.getLanguage(),this.getUser(),this.getDateTime(),this.getAcl());t=a.parseNameFromStringAddress(e)}t=t&&this.getHelper().escapeString(t);const s={emailAddress:l};this.model.get("accountId")&&"Contact"===o&&(s.accountId=this.model.get("accountId"),s.accountName=this.model.get("accountName"));e=this.getMetadata().get(`clientDefs.${o}.modalViews.select`)||"views/modals/select-records";Espo.Ui.notify(" ... ");const i={};t&&(i.name={type:"equals",field:"name",value:t}),this.createView("dialog",e,{scope:o,createButton:!1,filters:i},e=>{e.render(),Espo.Ui.notify(!1),this.listenToOnce(e,"select",a=>{const s=()=>{const e=Espo.Utils.clone(this.model.get("nameHash")||{}),t=Espo.Utils.clone(this.model.get("typeHash")||{}),s=Espo.Utils.clone(this.model.get("idHash")||{}),i=(s[l]=a.id,e[l]=a.get("name"),t[l]=o,this.idHash=s,this.nameHash=e,this.typeHash=t,{nameHash:e,idHash:s,typeHash:t});setTimeout(()=>{this.model.set(i),this.model.get("icsContents")&&this.model.fetch()},50)};a.get("emailAddress")?a.fetch().then(()=>{const e=a.get("emailAddressData")||[];var t={emailAddress:l,primary:0===e.length};e.push(t),a.save({emailAddressData:e},{patch:!0}).then(s)}):a.save({emailAddress:l},{patch:!0}).then(s)})})}fetchSearch(){var e=this.$element.val().trim();return e?{type:"equals",value:e}:null}validateEmail(){const e=this.model.get(this.name);var t;if(e)return t=String(e).toLowerCase(),this.emailAddressRegExp.test(t)||0===e.indexOf(this.erasedPlaceholder)?void 0:(t=this.translate("fieldShouldBeEmail","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(t),!0)}quickView(e){const t=new i.default(this.getMetadata(),this.getAcl());t.showDetail(this,{id:e.id,scope:e.scope})}}e.default=o}),define("helpers/misc/field-language",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.metadata=e,this.language=t}translateAttribute(e,t){let s=this.language.translate(t,"fields",e);var i;return t.indexOf("Id")===t.length-2?(i=t.slice(0,t.length-2),this.metadata.get(["entityDefs",e,"fields",i])&&(s=this.language.translate(i,"fields",e)+" ("+this.language.translate("id","fields")+")")):t.indexOf("Name")===t.length-4?(i=t.slice(0,t.length-4),this.metadata.get(["entityDefs",e,"fields",i])&&(s=this.language.translate(i,"fields",e)+" ("+this.language.translate("name","fields")+")")):t.indexOf("Type")===t.length-4&&(i=t.slice(0,t.length-4),this.metadata.get(["entityDefs",e,"fields",i])&&(s=this.language.translate(i,"fields",e)+" ("+this.language.translate("type","fields")+")")),t.indexOf("Ids")===t.length-3?(i=t.slice(0,t.length-3),this.metadata.get(["entityDefs",e,"fields",i])&&(s=this.language.translate(i,"fields",e)+" ("+this.language.translate("ids","fields")+")")):t.indexOf("Names")===t.length-5?(i=t.slice(0,t.length-5),this.metadata.get(["entityDefs",e,"fields",i])&&(s=this.language.translate(i,"fields",e)+" ("+this.language.translate("names","fields")+")")):t.indexOf("Types")===t.length-5&&(i=t.slice(0,t.length-5),this.metadata.get(["entityDefs",e,"fields",i])&&(s=this.language.translate(i,"fields",e)+" ("+this.language.translate("types","fields")+")")),s}}}),define("handlers/select-related",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.viewHelper=e}getFilters(e){return Promise.resolve({})}}}),define("handlers/login",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t){this.loginView=e,this.data=t}process(){return Promise.resolve({})}}}),define("handlers/map/renderer",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e}render(e){}}}),define("views/wysiwyg/modals/insert-link",["views/modal"],function(e){return e.extend({className:"dialog dialog-record",template:"wysiwyg/modals/insert-link",events:{'input [data-name="url"]':function(){this.controlInputs()},'paste [data-name="url"]':function(){this.controlInputs()}},shortcutKeys:{"Control+Enter":function(){this.hasAvailableActionItem("insert")&&this.actionInsert()}},data:function(){return{labels:this.options.labels||{}}},setup:function(){var e=this.options.labels||{};this.headerText=e.insert,this.buttonList=[{name:"insert",text:this.translate("Insert"),style:"primary",disabled:!0}],this.linkInfo=this.options.linkInfo||{},this.linkInfo.url&&this.enableButton("insert")},afterRender:function(){this.$url=this.$el.find('[data-name="url"]'),this.$text=this.$el.find('[data-name="text"]'),this.$openInNewWindow=this.$el.find('[data-name="openInNewWindow"]');var e=this.linkInfo;this.$url.val(e.url||""),this.$text.val(e.text||""),"isNewWindow"in e&&(this.$openInNewWindow.get(0).checked=!!e.isNewWindow)},controlInputs:function(){this.$url.val().trim()?this.enableButton("insert"):this.disableButton("insert")},actionInsert:function(){var e=this.$url.val().trim(),e={url:e,text:this.$text.val().trim()||e,isNewWindow:this.$openInNewWindow.get(0).checked,range:this.linkInfo.range};this.trigger("insert",e),this.close()}})}),define("views/wysiwyg/modals/insert-image",["views/modal"],function(e){return e.extend({className:"dialog dialog-record",template:"wysiwyg/modals/insert-image",events:{'click [data-action="insert"]':function(){this.actionInsert()},'input [data-name="url"]':function(){this.controlInsertButton()},'paste [data-name="url"]':function(){this.controlInsertButton()}},shortcutKeys:{"Control+Enter":function(){this.$el.find('[data-name="insert"]').hasClass("disabled")||this.actionInsert()}},data:function(){return{labels:this.options.labels||{}}},setup:function(){var e=this.options.labels||{};this.headerText=e.insert,this.buttonList=[]},afterRender:function(){let e=this.$el.find('[data-name="files"]');e.replaceWith(e.clone().on("change",e=>{this.trigger("upload",e.target.files||e.target.value),this.close()}).val(""))},controlInsertButton:function(){var e=this.$el.find('[data-name="url"]').val().trim();let t=this.$el.find('[data-name="insert"]');e?t.removeClass("disabled").removeAttr("disabled"):t.addClass("disabled").attr("disabled","disabled")},actionInsert:function(){var e=this.$el.find('[data-name="url"]').val().trim();this.trigger("insert",e),this.close()}})}),define("views/working-time-range/fields/users",["views/fields/link-multiple"],function(e){return e.extend({getSelectPrimaryFilterName:function(){return"active"}})}),define("views/working-time-range/fields/date-end",["views/fields/date"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("afterOrSame")},validateAfterOrSame:function(){var e="dateStart",t=this.model.get(this.name),s=this.model.get(e);if(t&&s&&moment(t).unix()<moment(s).unix())return t=this.translate("fieldShouldAfter","messages").replace("{field}",this.getLabelText()).replace("{otherField}",this.translate(e,"fields",this.model.entityType)),this.showValidationMessage(t),!0;return!1}})}),define("views/working-time-calendar/fields/time-ranges",["views/fields/base"],function(t){return t.extend({listTemplateContent:`
            <div class="item-list">
            {{#each itemDataList}}
                <span class="item" data-key="{{key}}"
                >{{{var viewKey ../this}}}</span>{{#unless isLast}} &nbsp;&middot;&nbsp; {{/unless}}
            {{/each}}
            </div>
            {{#unless itemDataList.length}}
            <span class="none-value">{{translate 'None'}}</span>
            {{/unless}}
        `,detailTemplateContent:`
            <div class="item-list">
            {{#each itemDataList}}
                <div class="item" data-key="{{key}}">
                    {{{var viewKey ../this}}}
                </div>
            {{/each}}
            </div>
            {{#unless itemDataList.length}}
            <span class="none-value">{{translate 'None'}}</span>
            {{/unless}}
        `,editTemplateContent:`
            <div class="item-list">
            {{#each itemDataList}}
                <div class="item" data-key="{{key}}">
                    {{{var viewKey ../this}}}
                </div>
            {{/each}}
            </div>
            <div class="add-item-container margin-top-sm">
                <a
                    role="button"
                    tabindex="0"
                    class="add-item"
                    title="{{translate 'Add'}}"
                ><span class="fas fa-plus"></span></a>
            </div>
        `,fetchEmptyAsNull:!1,validations:["required","valid"],events:{"click .add-item":function(){this.addItem()},"click .remove-item":function(e){e=parseInt($(e.currentTarget).attr("data-key"));this.removeItem(e)}},data:function(){let e=t.prototype.data.call(this);return e.itemDataList=this.itemKeyList.map((e,t)=>({key:e.toString(),viewKey:this.composeViewKey(e),isLast:t===this.itemKeyList.length-1})),e},prepare:function(){return this.initItems(),this.createItemViews()},initItems:function(){this.itemKeyList=[],this.getItemListFromModel().forEach((e,t)=>{this.itemKeyList.push(t)})},createItemView:function(e,t){var s=this.isEditMode()?"views/working-time-calendar/fields/time-ranges/item-edit":"views/working-time-calendar/fields/time-ranges/item-detail";return this.createView(this.composeViewKey(t),s,{value:e,selector:'.item[data-key="'+t+'"]',key:t}).then(e=>(this.listenTo(e,"change",()=>{this.trigger("change")}),e))},createItemViews:function(){if(this.itemKeyList.forEach(e=>{this.clearView(this.composeViewKey(e))}),!this.model.has(this.name))return Promise.resolve();let s=this.getItemListFromModel(),i=[];return this.itemKeyList.forEach((e,t)=>{t=s[t],t=this.createItemView(t,e);i.push(t)}),Promise.all(i)},getItemView:function(e){return this.getView(this.composeViewKey(e))},composeViewKey:function(e){return"item-"+e},getItemListFromModel:function(){return Espo.Utils.cloneDeep(this.model.get(this.name)||[])},addItem:function(){let e=this.getItemListFromModel(),t=null;var s=[t=e.length?e[e.length-1][1]:t,null];e.push(s);let i=this.itemKeyList[this.itemKeyList.length-1];void 0===i&&(i=0),i++,this.itemKeyList.push(i),this.$el.find(".item-list").append($("<div>").addClass("item").attr("data-key",i)),this.createItemView(s,i).then(e=>e.render()).then(()=>{this.trigger("change")})},removeItem:function(t){var s=this.itemKeyList.indexOf(t);if(-1!==t){let e=this.getItemListFromModel();this.itemKeyList.splice(s,1),e.splice(s,1),this.model.set(this.name,e,{ui:!0}),this.clearView(this.composeViewKey(t)),this.$el.find(`.item[data-key="${t}"`).remove(),this.trigger("change")}},fetch:function(){let t=[],e=(this.itemKeyList.forEach(e=>{t.push(this.getItemView(e).fetch())}),{});return e[this.name]=Espo.Utils.cloneDeep(t),0===e[this.name].length&&(e[this.name]=null),e},validateRequired:function(){if(!this.isRequired())return!1;if(this.getItemListFromModel().length)return!1;var e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText());return this.showValidationMessage(e,".add-item-container"),!0},validateValid:function(){if(!this.isRangesInvalid())return!1;var e=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText());return this.showValidationMessage(e,".add-item-container"),!0},isRangesInvalid:function(){var t=this.getItemListFromModel();for(let e=0;e<t.length;e++){var s=t[e];if(this.isRangeInvalid(s[0],s[1],!0))return!0;if(0!==e){var i=s[e-1];if(this.isRangeInvalid(i[1],s[0]))return!0}}return!1},isRangeInvalid:function(e,t,s){if(null===e||null===t)return!0;e=parseFloat(e.replace(":",".")),t=parseFloat(t.replace(":","."));return!(!s||e!==t)||t<e}})}),define("views/working-time-calendar/fields/time-ranges/item-edit",["view","lib!moment"],function(e,s){return e.extend({templateContent:`
            <div class="row">
                <div class="start-container col-xs-5">
                    <input
                        class="form-control"
                        type="text"
                        data-name="start"
                        value="{{start}}"
                        autocomplete="espo-start"
                        spellcheck="false"
                    >
                </div>
                <div class="start-container col-xs-1 center-align">
                    <span class="field-row-text-item">&nbsp;â&nbsp;</span>
                </div>
                <div class="end-container col-xs-5">
                    <input
                        class="form-control"
                        type="text"
                        data-name="end"
                        value="{{end}}"
                        autocomplete="espo-end"
                        spellcheck="false"
                    >
                </div>
                <div class="col-xs-1 center-align">
                    <a
                        role="button"
                        tabindex="0"
                        class="remove-item field-row-text-item"
                        data-key="{{key}}"
                        title="{{translate 'Remove'}}"
                    ><span class="fas fa-times"></span></a>
                </div>
            </div>
        `,timeFormatMap:{"HH:mm":"H:i","hh:mm A":"h:i A","hh:mm a":"h:i a","hh:mmA":"h:iA","hh:mma":"h:ia"},minuteStep:30,data:function(){let e={};return e.start=this.convertTimeToDisplay(this.value[0]),e.end=this.convertTimeToDisplay(this.value[1]),e.key=this.key,e},setup:function(){this.value=this.options.value||[null,null],this.key=this.options.key},convertTimeToDisplay:function(e){if(!e)return"";let t=s(e,"HH:mm");return t.isValid()?t.format(this.getDateTime().timeFormat):""},convertTimeFromDisplay:function(e){if(!e)return null;let t=s(e,this.getDateTime().timeFormat);return t.isValid()?t.format("HH:mm"):null},afterRender:function(){this.$start=this.$el.find('[data-name="start"]'),this.$end=this.$el.find('[data-name="end"]'),this.initTimepicker(this.$start),this.initTimepicker(this.$end),this.setMinTime(),this.$start.on("change",()=>this.setMinTime())},setMinTime:function(){var e=this.$start.val();this.$end.timepicker("option","maxTime",this.convertTimeToDisplay("23:59")),e?this.$end.timepicker("option","minTime",e):this.$end.timepicker("option","minTime",null)},initTimepicker:function(e){e.timepicker({step:this.minuteStep,timeFormat:this.timeFormatMap[this.getDateTime().timeFormat]}),e.on("change",()=>this.trigger("change")),e.attr("autocomplete","espo-time-range-item")},fetch:function(){return[this.convertTimeFromDisplay(this.$start.val()),this.convertTimeFromDisplay(this.$end.val())]}})}),define("views/working-time-calendar/fields/time-ranges/item-detail",["view","lib!moment"],(e,s)=>{class t extends e{templateContent=`
            {{start}}
            &nbsp;â&nbsp;
            {{end}}
        `;data(){return{start:this.convertTimeToDisplay(this.value[0]),end:this.convertTimeToDisplay(this.value[1])}}setup(){this.value=this.options.value}convertTimeToDisplay(e){if(!e)return"";let t=s(e,"HH:mm");return t.isValid()?t.format(this.getDateTime().timeFormat):""}}return t}),define("views/webhook/record/list",["views/record/list"],function(e){return e.extend({massActionList:["remove","massUpdate","export"]})}),define("views/webhook/fields/user",["views/fields/link"],function(e){return e.extend({selectPrimaryFilterName:"activeApi"})}),define("views/webhook/fields/event",["views/fields/varchar"],function(e){return e.extend({setupOptions:function(){var t=[];this.getMetadata().getScopeObjectList().sort(function(e,t){return e.localeCompare(t)}.bind(this)).forEach(function(e){t.push(e+".create"),t.push(e+".update"),t.push(e+".delete")},this),this.params.options=t}})}),define("views/user-security/modals/two-factor-sms",["views/modal","model"],function(e,s){return e.extend({template:"user-security/modals/two-factor-sms",className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},events:{'click [data-action="sendCode"]':function(){this.actionSendCode()}},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger",hidden:!0},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp";var e=this.getConfig().get("auth2FASmsCodeLength")||7;let t=new s;t.name="UserSecurity",t.set("phoneNumber",null),t.setDefs({fields:{code:{type:"varchar",required:!0,maxLength:e},phoneNumber:{type:"enum",required:!0}}}),this.internalModel=t,this.wait(Espo.Ajax.postRequest("UserSecurity/action/getTwoFactorUserSetupData",{id:this.model.id,password:this.model.get("password"),auth2FAMethod:this.model.get("auth2FAMethod"),reset:this.options.reset}).then(e=>{this.phoneNumberList=e.phoneNumberList,this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:t,detailLayout:[{rows:[[{name:"phoneNumber",labelText:this.translate("phoneNumber","fields","User")},!1],[{name:"code",labelText:this.translate("Code","labels","User")},!1]]}]},e=>{e.setFieldOptionList("phoneNumber",this.phoneNumberList),this.phoneNumberList.length&&t.set("phoneNumber",this.phoneNumberList[0]),e.hideField("code")})}))},afterRender:function(){this.$sendCode=this.$el.find('[data-action="sendCode"]'),this.$pInfo=this.$el.find("p.p-info"),this.$pButton=this.$el.find("p.p-button"),this.$pInfoAfter=this.$el.find("p.p-info-after")},actionSendCode:function(){this.$sendCode.attr("disabled","disabled").addClass("disabled"),Espo.Ajax.postRequest("TwoFactorSms/action/sendCode",{id:this.model.id,phoneNumber:this.internalModel.get("phoneNumber")}).then(()=>{this.showButton("apply"),this.$pInfo.addClass("hidden"),this.$pButton.addClass("hidden"),this.$pInfoAfter.removeClass("hidden"),this.getView("record").setFieldReadOnly("phoneNumber"),this.getView("record").showField("code")}).catch(()=>{this.$sendCode.removeAttr("disabled").removeClass("disabled")})},actionApply:function(){var e=this.getView("record").processFetch();e&&(this.model.set("code",e.code),this.hideButton("apply"),this.hideButton("cancel"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.save().then(()=>{Espo.Ui.notify(!1),this.trigger("done")}).catch(()=>{this.showButton("apply"),this.showButton("cancel")}))}})}),define("views/user-security/modals/two-factor-email",["views/modal","model"],function(e,s){return e.extend({template:"user-security/modals/two-factor-email",className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},events:{'click [data-action="sendCode"]':function(){this.actionSendCode()}},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger",hidden:!0},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp";var e=this.getConfig().get("auth2FAEmailCodeLength")||7;let t=new s;t.entityType=t.name="UserSecurity",t.set("emailAddress",null),t.setDefs({fields:{code:{type:"varchar",required:!0,maxLength:e},emailAddress:{type:"enum",required:!0}}}),this.internalModel=t,this.wait(Espo.Ajax.postRequest("UserSecurity/action/getTwoFactorUserSetupData",{id:this.model.id,password:this.model.get("password"),auth2FAMethod:this.model.get("auth2FAMethod"),reset:this.options.reset}).then(e=>{this.emailAddressList=e.emailAddressList,this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:t,detailLayout:[{rows:[[{name:"emailAddress",labelText:this.translate("emailAddress","fields","User")},!1],[{name:"code",labelText:this.translate("Code","labels","User")},!1]]}]},e=>{e.setFieldOptionList("emailAddress",this.emailAddressList),this.emailAddressList.length&&t.set("emailAddress",this.emailAddressList[0]),e.hideField("code")})}))},afterRender:function(){this.$sendCode=this.$el.find('[data-action="sendCode"]'),this.$pInfo=this.$el.find("p.p-info"),this.$pButton=this.$el.find("p.p-button"),this.$pInfoAfter=this.$el.find("p.p-info-after")},actionSendCode:function(){this.$sendCode.attr("disabled","disabled").addClass("disabled"),Espo.Ajax.postRequest("TwoFactorEmail/action/sendCode",{id:this.model.id,emailAddress:this.internalModel.get("emailAddress")}).then(()=>{this.showButton("apply"),this.$pInfo.addClass("hidden"),this.$pButton.addClass("hidden"),this.$pInfoAfter.removeClass("hidden"),this.getView("record").setFieldReadOnly("emailAddress"),this.getView("record").showField("code")}).catch(()=>{this.$sendCode.removeAttr("disabled").removeClass("disabled")})},actionApply:function(){var e=this.getView("record").processFetch();e&&(this.model.set("code",e.code),this.hideButton("apply"),this.hideButton("cancel"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.save().then(()=>{Espo.Ui.notify(!1),this.trigger("done")}).catch(()=>{this.showButton("apply"),this.showButton("cancel")}))}})}),define("views/user-security/modals/totp",["views/modal","model"],function(e,s){let i;return e.extend({template:"user-security/modals/totp",className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger"},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp";var t=new s;t.name="UserSecurity",this.wait(Espo.Ajax.postRequest("UserSecurity/action/getTwoFactorUserSetupData",{id:this.model.id,password:this.model.get("password"),auth2FAMethod:this.model.get("auth2FAMethod"),reset:this.options.reset}).then(e=>{this.label=e.label,this.secret=e.auth2FATotpSecret,t.set("secret",e.auth2FATotpSecret)})),t.setDefs({fields:{code:{type:"varchar",required:!0,maxLength:7},secret:{type:"varchar",readOnly:!0}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:t,detailLayout:[{rows:[[{name:"secret",labelText:this.translate("Secret","labels","User")},!1],[{name:"code",labelText:this.translate("Code","labels","User")},!1]]}]}),Espo.loader.requirePromise("lib!qrcodejs").then(e=>{i=e})},afterRender:function(){new i(this.$el.find(".qrcode").get(0),{text:"otpauth://totp/"+this.label+"?secret="+this.secret,width:256,height:256,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.CorrectLevel.H})},actionApply:function(){var e=this.getView("record").processFetch();e&&(this.model.set("code",e.code),this.hideButton("apply"),this.hideButton("cancel"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.save().then(()=>{Espo.Ui.notify(!1),this.trigger("done")}).catch(()=>{this.showButton("apply"),this.showButton("cancel")}))}})}),define("views/user/password-change-request",["view","model"],function(e,s){return e.extend({template:"user/password-change-request",data:function(){return{requestId:this.options.requestId,notFound:this.options.notFound,notFoundMessage:this.notFoundMessage}},events:{"click #btn-submit":function(){this.submit()}},setup:function(){let e=this.model=new s;e.entityType=e.name="User",this.createView("password","views/user/fields/password",{model:e,mode:"edit",selector:'.field[data-name="password"]',defs:{name:"password",params:{required:!0,maxLength:255}},strengthParams:this.options.strengthParams}),this.createView("passwordConfirm","views/fields/password",{model:e,mode:"edit",selector:'.field[data-name="passwordConfirm"]',defs:{name:"passwordConfirm",params:{required:!0,maxLength:255}}}),this.createView("generatePassword","views/user/fields/generate-password",{model:e,mode:"detail",readOnly:!0,selector:'.field[data-name="generatePassword"]',defs:{name:"generatePassword"},strengthParams:this.options.strengthParams}),this.createView("passwordPreview","views/fields/base",{model:e,mode:"detail",readOnly:!0,selector:'.field[data-name="passwordPreview"]',defs:{name:"passwordPreview"}}),this.model.on("change:passwordPreview",()=>this.reRender());var t=this.baseUrl=window.location.href.split("?")[0];this.notFoundMessage=this.translate("passwordChangeRequestNotFound","messages","User").replace("{url}",t)},submit:function(){this.getView("password").fetchToModel(),this.getView("passwordConfirm").fetchToModel();var e=this.getView("password").validate()||this.getView("passwordConfirm").validate(),t=this.model.get("password");if(!e){let e=this.$el.find(".btn-submit");e.addClass("disabled"),Espo.Ajax.postRequest("User/changePasswordByRequest",{requestId:this.options.requestId,password:t}).then(e=>{this.$el.find(".password-change").remove();e=e.url||this.baseUrl,e=this.translate("passwordChangedByRequest","messages","User")+' <a href="'+e+'">'+this.translate("Login","labels","User")+"</a>.";this.$el.find(".msg-box").removeClass("hidden").html('<span class="text-success">'+e+"</span>")}).catch(()=>e.removeClass("disabled"))}}})}),define("views/user/list",["views/list"],function(e){return e.extend({storeViewAfterUpdate:!1,setup:function(){e.prototype.setup.call(this)}})}),define("views/user/detail",["views/detail"],function(t){return t.extend({setup:function(){var e;t.prototype.setup.call(this),this.getUser().isPortal()&&(this.rootLinkDisabled=!0),this.model.id!==this.getUser().id&&!this.getUser().isAdmin()||((this.model.isRegular()||this.model.isAdmin()||this.model.isPortal())&&this.addMenuItem("dropdown",{name:"preferences",label:"Preferences",style:"default",action:"preferences",link:"#Preferences/edit/"+this.getUser().id}),(this.model.isRegular()||this.model.isAdmin())&&((this.getAcl().check("EmailAccountScope")&&this.model.id===this.getUser().id||this.getUser().isAdmin())&&this.addMenuItem("dropdown",{name:"emailAccounts",label:"Email Accounts",style:"default",action:"emailAccounts",link:"#EmailAccount/list/userId="+this.model.id+"&userName="+encodeURIComponent(this.model.get("name"))}),this.model.id===this.getUser().id&&this.getAcl().checkScope("ExternalAccount")&&this.menu.buttons.push({name:"externalAccounts",label:"External Accounts",style:"default",action:"externalAccounts",link:"#ExternalAccount"}))),this.getAcl().checkScope("Calendar")&&(this.model.isRegular()||this.model.isAdmin())&&((e=this.getAcl().checkUserPermission(this.model))||"team"===this.getAcl().get("userPermission")&&(this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",function(){this.getAcl().checkUserPermission(this.model)&&this.showHeaderActionItem("calendar")},this)),this.menu.buttons.push({name:"calendar",iconHtml:'<span class="far fa-calendar-alt"></span>',text:this.translate("Calendar","scopeNames"),style:"default",link:"#Calendar/show/userId="+this.model.id+"&userName="+encodeURIComponent(this.model.get("name")),hidden:!e}))},actionPreferences:function(){this.getRouter().navigate("#Preferences/edit/"+this.model.id,{trigger:!0})},actionEmailAccounts:function(){this.getRouter().navigate("#EmailAccount/list/userId="+this.model.id+"&userName="+encodeURIComponent(this.model.get("name")),{trigger:!0})},actionExternalAccounts:function(){this.getRouter().navigate("#ExternalAccount",{trigger:!0})}})}),define("views/user/record/list",["views/record/list"],function(e){return e.extend({quickEditDisabled:!0,rowActionsView:"views/user/record/row-actions/default",massActionList:["remove","massUpdate","export"],checkAllResultMassActionList:["massUpdate","export"],setupMassActionItems:function(){e.prototype.setupMassActionItems.call(this),"ApiUser"===this.scope&&(this.removeMassAction("massUpdate"),this.removeMassAction("export"),this.layoutName="listApi"),"PortalUser"===this.scope&&(this.layoutName="listPortal"),this.getUser().isAdmin()||(this.removeMassAction("massUpdate"),this.removeMassAction("export"))},getModelScope:function(e){return this.collection.get(e).isPortal()?"PortalUser":this.scope}})}),define("views/user/record/edit",["exports","views/record/edit","views/user/record/detail"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{sideView="views/user/record/edit-side";setup(){super.setup(),this.setupNonAdminFieldsAccess(),this.model.id===this.getUser().id&&this.listenTo(this.model,"after:save",()=>{this.getUser().set(this.model.getClonedAttributes())}),this.hideField("sendAccessInfo"),this.passwordInfoMessage=this.getPasswordSendingMessage(),this.passwordInfoMessage||this.hideField("passwordInfo");let t=!1;this.listenToOnce(this.model,"change:password",()=>{t=!0,this.model.isNew()?this.controlSendAccessInfoFieldForNew():this.controlSendAccessInfoField()}),this.listenTo(this.model,"change",e=>{(this.model.isNew()||t)&&(e.hasChanged("emailAddress")||e.hasChanged("portalsIds")||e.hasChanged("password"))&&(this.model.isNew()?this.controlSendAccessInfoFieldForNew():this.controlSendAccessInfoField())}),s.default.prototype.setupFieldAppearance.call(this),this.hideField("passwordPreview"),this.listenTo(this.model,"change:passwordPreview",(e,t)=>{(t=t||"").length?this.showField("passwordPreview"):this.hideField("passwordPreview")}),this.listenTo(this.model,"after:save",()=>{this.model.unset("password",{silent:!0}),this.model.unset("passwordConfirm",{silent:!0})})}controlSendAccessInfoField(){this.isPasswordSendable()&&this.model.get("password")?this.showField("sendAccessInfo"):(this.hideField("sendAccessInfo"),this.model.has("sendAccessInfo")&&this.model.set("sendAccessInfo",!1))}controlSendAccessInfoFieldForNew(){var e=!1===this.recordHelper.getFieldStateParam("sendAccessInfo","hidden");if(this.isPasswordSendable())return this.showField("sendAccessInfo"),void(e||this.model.set("sendAccessInfo",!0));this.hideField("sendAccessInfo"),this.model.set("sendAccessInfo",!1)}isPasswordSendable(){return!(this.model.isPortal()&&!(this.model.get("portalsIds")||[]).length)&&!!this.model.get("emailAddress")}setupNonAdminFieldsAccess(){s.default.prototype.setupNonAdminFieldsAccess.call(this)}controlFieldAppearance(){s.default.prototype.controlFieldAppearance.call(this)}getGridLayout(s){this.getHelper().layoutManager.get(this.model.entityType,this.options.layoutName||this.layoutName,e=>{const t=Espo.Utils.cloneDeep(e);t.push({label:"Teams and Access Control",name:"accessControl",rows:[[{name:"type"},{name:"isActive"}],[{name:"teams"},{name:"defaultTeam"}],[{name:"roles"},!1]]}),t.push({label:"Portal",name:"portal",rows:[[{name:"portals"},{name:"contact"}],[{name:"portalRoles"},{name:"accounts"}]]}),this.getUser().isAdmin()&&this.model.isPortal()&&t.push({label:"Misc",name:"portalMisc",rows:[[{name:"dashboardTemplate"},!1]]}),(this.model.isAdmin()||this.model.isRegular())&&t.push({label:"Misc",name:"misc",rows:[[{name:"workingTimeCalendar"},{name:"layoutSet"}]]}),this.type===this.TYPE_EDIT&&this.getUser().isAdmin()&&!this.model.isApi()&&t.push({label:"Password",rows:[[{name:"password",type:"password",params:{required:!1,readyToChange:!0},view:"views/user/fields/password"},{name:"generatePassword",view:"views/user/fields/generate-password",customLabel:""}],[{name:"passwordConfirm",type:"password",params:{required:!1,readyToChange:!0}},{name:"passwordPreview",view:"views/fields/base",params:{readOnly:!0}}],[{name:"sendAccessInfo"},{name:"passwordInfo",type:"text",customLabel:"",customCode:this.passwordInfoMessage}]]}),this.getUser().isAdmin()&&this.model.isApi()&&t.push({name:"auth",rows:[[{name:"authMethod"},!1]]});e={type:"record",layout:this.convertDetailLayout(t)};s(e)})}getPasswordSendingMessage(){if(this.getConfig().get("outboundEmailFromAddress"))return"";var e=this.translate("setupSmtpBefore","messages","User").replace("{url}","#Admin/outboundEmails");return this.getHelper().transformMarkdownInlineText(e)}fetch(){const e=super.fetch();return this.isNew||"password"in e&&(""===e.password||null==e.password)&&(delete e.password,delete e.passwordConfirm,this.model.unset("password"),this.model.unset("passwordConfirm")),e}exit(e){"create"!==e&&"save"!==e||this.model.unset("sendAccessInfo",{silent:!0}),super.exit(e)}errorHandlerUserNameExists(){Espo.Ui.error(this.translate("userNameExists","messages","User"))}}e.default=a}),define("views/user/record/edit-side",["views/record/edit-side"],function(e){return e.extend({})}),define("views/user/record/edit-quick",["views/record/edit-small","views/user/record/detail"],function(e,t){return e.extend({sideView:"views/user/record/edit-side",setup:function(){e.prototype.setup.call(this),t.prototype.setupNonAdminFieldsAccess.call(this),t.prototype.setupFieldAppearance.call(this)},controlFieldAppearance:function(){t.prototype.controlFieldAppearance.call(this)}})}),define("views/user/record/detail-quick",["views/record/detail-small","views/user/record/detail"],function(e,t){return e.extend({sideView:"views/user/record/detail-quick-side",bottomView:null,editModeEnabled:!1,setup:function(){e.prototype.setup.call(this),t.prototype.setupNonAdminFieldsAccess.call(this),t.prototype.setupFieldAppearance.call(this)},controlFieldAppearance:function(){t.prototype.controlFieldAppearance.call(this)}})}),define("views/user/record/detail-quick-side",["views/record/detail-side","views/user/record/detail-side"],function(e,t){return e.extend({setupPanels:function(){t.prototype.setupPanels.call(this)}})}),define("views/user/record/detail-bottom",["exports","views/record/detail-bottom"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupPanels(){super.setupPanels();var e=this.getAcl().checkUserPermission(this.model);e||"team"!==this.getAcl().getPermissionLevel("userPermission")||this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",()=>{this.getAcl().checkUserPermission(this.model)&&this.onPanelsReady(()=>{this.showPanel("stream","acl")})}),this.panelList.push({name:"stream",label:"Stream",view:"views/user/record/panels/stream",sticked:!0,hidden:!e}),e||this.recordHelper.setPanelStateParam("stream","hiddenAclLocked",!0)}}e.default=i}),define("views/user/record/row-actions/relationship-followers",["views/record/row-actions/relationship"],function(e){return e.extend({getActionList:function(){var e=[{action:"quickView",label:"View",data:{id:this.model.id},link:"#"+this.model.entityType+"/view/"+this.model.id}];return(this.getUser().isAdmin()||"no"!==this.getAcl().get("followerManagementPermission")||this.model.isPortal()&&"yes"===this.getAcl().get("portalPermission")||this.model.id===this.getUser().id)&&e.push({action:"unlinkRelated",label:"Unlink",data:{id:this.model.id}}),e}})}),define("views/user/record/row-actions/default",["views/record/row-actions/default"],function(e){return e.extend({getActionList:function(){var e="User",t=(this.model.isPortal()?e="PortalUser":this.model.isApi()&&(e="ApiUser"),[{action:"quickView",label:"View",data:{id:this.model.id,scope:e},link:"#"+e+"/view/"+this.model.id}]);return this.options.acl.edit&&t.push({action:"quickEdit",label:"Edit",data:{id:this.model.id,scope:e},link:"#"+e+"/edit/"+this.model.id}),t}})}),define("views/user/record/panels/stream",["views/stream/panel"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this);let e=this.getAcl().checkPermission("message",this.model);this.model.id===this.getUser().id?this.placeholderText=this.translate("writeMessageToSelf","messages"):this.placeholderText=this.translate("writeMessageToUser","messages").replace("{user}",this.model.get("name")),e||(this.postDisabled=!0,"team"===this.getAcl().getPermissionLevel("message")&&(this.model.has("teamsIds")||this.listenToOnce(this.model,"sync",()=>{(e=this.getAcl().checkUserPermission(this.model))&&(this.postDisabled=!1,this.$el.find(".post-container").removeClass("hidden"))})))},prepareNoteForPost:function(e){var t=[this.model.id],s={};s[t]=this.model.get("name"),e.set("usersIds",t),e.set("usersNames",s),e.set("targetType","users")}})}),define("views/user/record/panels/default-side",["views/record/panels/default-side"],function(e){return e.extend({complexCreatedDisabled:!0,complexModifiedDisabled:!0})}),define("views/user/modals/select-followers",["views/modals/select-records"],function(e){return e.extend({setup:function(){this.filterList=["active"],this.getAcl().getPermissionLevel("portalPermission")&&this.filterList.push("activePortal"),e.prototype.setup.call(this)}})}),define("views/user/modals/security",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{templateContent='<div class="record no-side-margin">{{{record}}}</div>';className="dialog dialog-record";shortcutKeys={"Control+Enter":"apply"};setup(){this.buttonList=[{name:"apply",label:"Apply",hidden:!0,style:"danger",onClick:()=>this.apply()},{name:"cancel",label:"Close"}],this.dropdownItemList=[{name:"reset",text:this.translate("Reset 2FA"),hidden:!0,onClick:()=>this.reset()}],this.userModel=this.options.userModel,this.$header=$("<span>").append($("<span>").text(this.translate("Security")),' <span class="chevron-right"></span> ',$("<span>").text(this.userModel.get("userName")));const e=this.model=new s.default;e.name="UserSecurity",e.id=this.userModel.id,e.url="UserSecurity/"+this.userModel.id;var t=this.getConfig().get("auth2FAMethodList")||[];e.setDefs({fields:{auth2FA:{type:"bool",labelText:this.translate("auth2FAEnable","fields","User")},auth2FAMethod:{type:"enum",options:t,translation:"Settings.options.auth2FAMethodList"}}}),this.wait(e.fetch().then(()=>{this.initialAttributes=Espo.Utils.cloneDeep(e.attributes),e.get("auth2FA")&&this.showActionItem("reset"),this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:this.model,detailLayout:[{rows:[[{name:"auth2FA",labelText:this.translate("auth2FAEnable","fields","User")},{name:"auth2FAMethod",labelText:this.translate("auth2FAMethod","fields","User")}]]}]},e=>{this.controlFieldsVisibility(e),this.listenTo(this.model,"change:auth2FA",()=>{this.controlFieldsVisibility(e)})})})),this.listenTo(this.model,"change",()=>{this.initialAttributes&&(this.isChanged()?this.showActionItem("apply"):this.hideActionItem("apply"))})}controlFieldsVisibility(e){this.model.get("auth2FA")?(e.showField("auth2FAMethod"),e.setFieldRequired("auth2FAMethod")):(e.hideField("auth2FAMethod"),e.setFieldNotRequired("auth2FAMethod"))}isChanged(){return this.initialAttributes.auth2FA!==this.model.get("auth2FA")||this.initialAttributes.auth2FAMethod!==this.model.get("auth2FAMethod")}reset(){this.confirm(this.translate("security2FaResetConfirmation","messages","User"),()=>{this.apply(!0)})}getRecordView(){return this.getView("record")}apply(e){this.getRecordView().processFetch()&&(this.hideActionItem("apply"),new Promise(s=>{this.createView("dialog","views/user/modals/password",{},t=>{t.render(),this.listenToOnce(t,"cancel",()=>this.showActionItem("apply")),this.listenToOnce(t,"proceed",e=>{this.model.set("password",e.password),t.close(),s()})})}).then(()=>this.processApply(e)))}processApply(e){var t;if(this.model.get("auth2FA"))return t=this.model.get("auth2FAMethod"),(t=this.getMetadata().get(["app","authentication2FAMethods",t,"userApplyView"]))?(Espo.Ui.notify(" ... "),void this.createView("dialog",t,{model:this.model,reset:e},e=>{Espo.Ui.notify(!1),e.render(),this.listenToOnce(e,"cancel",()=>{this.close()}),this.listenToOnce(e,"apply",()=>{e.close(),this.processSave()}),this.listenToOnce(e,"done",()=>{Espo.Ui.success(this.translate("Done")),this.trigger("done"),e.close(),this.close()})})):(e&&this.model.set("auth2FA",!1),void this.processSave());this.processSave()}processSave(){this.hideActionItem("apply"),this.model.save().then(()=>{this.close(),Espo.Ui.success(this.translate("Done"))}).catch(()=>this.showActionItem("apply"))}}e.default=a}),define("views/user/modals/password",["views/modal","model"],function(e,t){return e.extend({templateContent:'<div class="record no-side-margin">{{{record}}}</div>',className:"dialog dialog-record",shortcutKeys:{"Control+Enter":"apply"},setup:function(){this.buttonList=[{name:"apply",label:"Apply",style:"danger"},{name:"cancel",label:"Cancel"}],this.headerHtml="&nbsp",this.userModel=this.options.userModel;var e=this.model=new t;e.name="UserSecurity",e.setDefs({fields:{password:{type:"password",required:!0}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",selector:".record",model:this.model,detailLayout:[{rows:[[{name:"password",labelText:this.translate("yourPassword","fields","User"),params:{readyToChange:!0}},!1]]}]})},actionApply:function(){var e=this.getView("record").processFetch();e&&this.trigger("proceed",e)}})}),define("views/user/modals/mass-update",["views/modals/mass-update"],function(e){return e.extend({setup:function(){"ApiUser"===this.options.scope?this.layoutName="massUpdateApi":"PortalUser"===this.options.scope&&(this.layoutName="massUpdatePortal"),e.prototype.setup.call(this)}})}),define("views/user/modals/login-as",["views/modal"],function(e){return e.extend({backdrop:!0,templateContent:`
            <div class="well">
                {{translate 'loginAs' category='messages' scope='User'}}
            </div>
            <a href="{{viewObject.url}}" class="text-large">{{translate 'Login Link' scope='User'}}</a>
        `,setup:function(){this.$header=$("<span>").append($("<span>").text(this.model.get("name"))," ",$("<span>").addClass("chevron-right")," ",$("<span>").text(this.translate("Login"))),this.url="?entryPoint=loginAs"+`&anotherUser=${this.options.anotherUser}&username=`+this.options.username}})}),define("views/user/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0,getScope:function(){return this.model.isPortal()?"PortalUser":"User"}})}),define("views/user/modals/access",["views/modal"],function(e){return e.extend({cssName:"user-access",multiple:!1,template:"user/modals/access",backdrop:!0,styleMap:{yes:"success",all:"success",account:"info",contact:"info",team:"info",own:"warning",no:"danger",enabled:"success",disabled:"danger","not-set":"default"},data:function(){return{valuePermissionDataList:this.getValuePermissionList(),levelListTranslation:this.getLanguage().get("Role","options","levelList")||{},styleMap:this.styleMap}},getValuePermissionList:function(){const e=this.getMetadata().get(["app","acl","valuePermissionList"],[]),s=[];return e.forEach(e=>{const t={};t.name=e,t.value=this.options.aclData[e],s.push(t)}),s},setup:function(){this.buttonList=[{name:"cancel",label:"Cancel"}];var e=Espo.Utils.cloneDeep(this.options.aclData.fieldTable||{});for(const t in e){const s=e[t]||{};for(const i in s)null!==this.getMetadata().get(["app","acl","mandatory","scopeFieldLevel",t,i])&&delete s[i],s[i]&&this.getMetadata().get(["entityDefs",t,"fields",i,"readOnly"])&&"no"===s[i].edit&&"yes"===s[i].read&&delete s[i]}this.createView("table","views/role/record/table",{acl:{data:this.options.aclData.table,fieldData:e},final:!0,selector:".user-access-table"}),this.headerText=this.translate("Access")}})}),define("views/user/fields/user-name",["views/fields/varchar"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("userName")},afterRender:function(){e.prototype.afterRender.call(this);let s=this.getUserNameRegularExpression();this.isEditMode()&&this.$element.on("change",()=>{let e=this.$element.val();var t=new RegExp(s,"gi");e=e.replace(t,"").replace(/[\s]/g,"_").toLowerCase(),this.$element.val(e),this.trigger("change")})},getUserNameRegularExpression:function(){return this.getConfig().get("userNameRegularExpression")||"[^a-z0-9-@_.s]"},validateUserName:function(){var t=this.model.get(this.name);if(t){var s=this.getUserNameRegularExpression();let e=new RegExp(s,"gi");if(e.test(t))return s=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(s),!0}}})}),define("views/user/fields/teams",["views/fields/link-multiple-with-role"],function(e){return e.extend({forceRoles:!0,setup:function(){e.prototype.setup.call(this),this.roleListMap={},this.loadRoleList(()=>{this.isEditMode()&&(this.isRendered()||this.isBeingRendered())&&this.reRender()}),this.listenTo(this.model,"change:teamsIds",()=>{let t=!1;this.ids.forEach(e=>{e in this.roleListMap||(t=!0)}),t&&this.loadRoleList(()=>{this.reRender()})})},loadRoleList:function(s,i){if(this.getAcl().checkScope("Team","read")){let t=this.ids||[];0!==t.length&&this.getCollectionFactory().create("Team",e=>{e.maxSize=50,e.where=[{type:"in",field:"id",value:t}],this.listenToOnce(e,"sync",()=>{e.models.forEach(e=>{this.roleListMap[e.id]=e.get("positionList")||[]}),s.call(i)}),e.fetch()})}},getDetailLinkHtml:function(e,t){t=t||this.nameHash[e]||e;var s=(this.columns[e]||{})[this.columnName]||"";const i=$("<div>").append($("<a>").attr("href","#"+this.foreignScope+"/view/"+e).attr("data-id",e).text(t));return s&&(s=this.getHelper().escapeString(s),i.append($("<span>").text(" "),$("<span>").addClass("text-muted middle-dot"),$("<span>").text(" "),$("<span>").addClass("text-muted").text(s))),i.get(0).outerHTML},getJQSelect:function(e,s){let t=Espo.Utils.clone(this.roleListMap[e]||[]);if(!t.length&&!s)return null;t.unshift(""),s&&-1===t.indexOf(s)&&t.push(s);let i=$("<select>").addClass("role form-control input-sm pull-right").attr("data-id",e);return t.forEach(e=>{let t=$("<option>").val(e).text(e);e===(s||"")&&t.attr("selected","selected"),i.append(t)}),i}})}),define("views/user/fields/password",["exports","views/fields/password"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{validations=["required","strength","confirm"];init(){const e=[],t=(this.strengthParams=this.options.strengthParams||{passwordStrengthLength:this.getConfig().get("passwordStrengthLength"),passwordStrengthLetterCount:this.getConfig().get("passwordStrengthLetterCount"),passwordStrengthNumberCount:this.getConfig().get("passwordStrengthNumberCount"),passwordStrengthBothCases:this.getConfig().get("passwordStrengthBothCases")},this.strengthParams.passwordStrengthLength),s=(t&&e.push("* "+this.translate("passwordStrengthLength","messages","User").replace("{length}",t.toString())),this.strengthParams.passwordStrengthLetterCount),i=(s&&e.push("* "+this.translate("passwordStrengthLetterCount","messages","User").replace("{count}",s.toString())),this.strengthParams.passwordStrengthNumberCount);i&&e.push("* "+this.translate("passwordStrengthNumberCount","messages","User").replace("{count}",i.toString())),this.strengthParams.passwordStrengthBothCases&&e.push("* "+this.translate("passwordStrengthBothCases","messages","User")),e.length&&(this.tooltip=!0,this.tooltipText=this.translate("Requirements","labels","User")+":\n"+e.join("\n")),super.init()}validateStrength(){if(this.model.get(this.name)){const i=this.model.get(this.name),t=this.strengthParams.passwordStrengthLength;var e;if(t)if(i.length<t)return e=this.translate("passwordStrengthLength","messages","User").replace("{length}",t.toString()),this.showValidationMessage(e),!0;const s=this.strengthParams.passwordStrengthLetterCount;if(s){let t=0;if(i.split("").forEach(e=>{e.toLowerCase()!==e.toUpperCase()&&t++}),t<s)return e=this.translate("passwordStrengthLetterCount","messages","User").replace("{count}",s.toString()),this.showValidationMessage(e),!0}const a=this.strengthParams.passwordStrengthNumberCount;if(a){let t=0;if(i.split("").forEach(e=>{"0"<=e&&e<="9"&&t++}),t<a)return e=this.translate("passwordStrengthNumberCount","messages","User").replace("{count}",a.toString()),this.showValidationMessage(e),!0}if(this.strengthParams.passwordStrengthBothCases){let t=0,s=(i.split("").forEach(e=>{e.toLowerCase()!==e.toUpperCase()&&e===e.toUpperCase()&&t++}),0);if(i.split("").forEach(e=>{e.toLowerCase()!==e.toUpperCase()&&e===e.toLowerCase()&&s++}),!t||!s)return e=this.translate("passwordStrengthBothCases","messages","User"),this.showValidationMessage(e),!0}}}}e.default=i}),define("views/user/fields/name",["views/fields/person-name"],function(e){return e.extend({listTemplate:"user/fields/name/list-link",listLinkTemplate:"user/fields/name/list-link",data:function(){return _.extend({avatar:this.getAvatarHtml(),frontScope:this.model.isPortal()?"PortalUser":"User",isOwn:this.model.id===this.getUser().id},e.prototype.data.call(this))},getAvatarHtml:function(){return this.getHelper().getAvatarHtml(this.model.id,"small",20,"avatar-link")}})}),define("views/user/fields/generate-password",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{templateContent=`
        <button
            type="button"
            class="btn btn-default"
            data-action="generatePassword"
        >{{translate 'Generate' scope='User'}}</button>`;events={'click [data-action="generatePassword"]':function(){this.actionGeneratePassword()}};setup(){super.setup(),this.listenTo(this.model,"change:password",(e,t,s)=>{s.isGenerated||(void 0===t?this.model.unset("passwordPreview"):this.model.set("passwordPreview",null))}),this.strengthParams=this.options.strengthParams||{},this.passwordStrengthLength=this.strengthParams.passwordStrengthLength||this.getConfig().get("passwordStrengthLength"),this.passwordStrengthLetterCount=this.strengthParams.passwordStrengthLetterCount||this.getConfig().get("passwordStrengthLetterCount"),this.passwordStrengthNumberCount=this.strengthParams.passwordStrengthNumberCount||this.getConfig().get("passwordStrengthNumberCount"),this.passwordGenerateLength=this.strengthParams.passwordGenerateLength||this.getConfig().get("passwordGenerateLength"),this.passwordGenerateLetterCount=this.strengthParams.passwordGenerateLetterCount||this.getConfig().get("passwordGenerateLetterCount"),this.passwordGenerateNumberCount=this.strengthParams.passwordGenerateNumberCount||this.getConfig().get("passwordGenerateNumberCount")}fetch(){return{}}actionGeneratePassword(){let e=this.passwordStrengthLength,t=this.passwordStrengthLetterCount,s=this.passwordStrengthNumberCount;var i=this.passwordGenerateLength||10,a=this.passwordGenerateLetterCount||4,o=this.passwordGenerateNumberCount||2,i=(e=void 0===e?i:e,t=void 0===t?a:t,s=void 0===s?o:s,e<i&&(e=i),t<a&&(t=a),s<o&&(s=o),this.generatePassword(e,t,s,!0));this.model.set({password:i,passwordConfirm:i,passwordPreview:i},{isGenerated:!0})}generatePassword(e,t,s,i){const a=["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz","0123456789","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789","ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz"];let o=0,l=0,d=(i&&(o=1,l=1,2<=t?t-=2:t=0),e-(t+s+o+l));const n=[t,s,d=d<0?0:d,o,l];return function(e){let t=e.length,s,i;for(;0!==t;)i=Math.floor(Math.random()*t),s=e[--t],e[t]=e[i],e[i]=s;return e}(n.map((e,t)=>Array(e).fill(a[t]).map(e=>e[Math.floor(Math.random()*e.length)]).join("")).concat()).join("")}}e.default=i}),define("views/user/fields/default-team",["exports","views/fields/link"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.validations.push("isUsers")}getOnEmptyAutocomplete(){const t=this.model.get("teamsNames")||{};var e=this.model.getTeamIdList().map(e=>({id:e,name:t[e]||e}));return Promise.resolve(e)}validateIsUsers(){var e=this.model.get("defaultTeamId");if(!e)return!1;if(this.model.getTeamIdList().includes(e))return!1;e=this.translate("defaultTeamIsNotUsers","messages","User");return this.showValidationMessage(e),!0}}e.default=i}),define("views/user/fields/contact",["views/fields/link"],function(i){return i.extend({select:function(e){i.prototype.select.call(this,e);var t,s={};e.get("accountId")&&((t={})[e.get("accountId")]=e.get("accountName"),s.accountsIds=[e.get("accountId")],s.accountsNames=t),s.firstName=e.get("firstName"),s.lastName=e.get("lastName"),s.salutationName=e.get("salutationName"),s.emailAddress=e.get("emailAddress"),s.emailAddressData=e.get("emailAddressData"),s.phoneNumber=e.get("phoneNumber"),s.phoneNumberData=e.get("phoneNumberData"),this.model.isNew()&&!this.model.get("userName")&&s.emailAddress&&(s.userName=s.emailAddress),this.model.set(s)}})}),define("views/user/fields/avatar",["exports","views/fields/image","model","views/fields/colorpicker"],function(e,t,s,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),s=a(s),i=a(i);class o extends t.default{getAttributeList(){return this.isEditMode()?[...super.getAttributeList(),"avatarColor"]:[]}setup(){super.setup(),this.on("after:inline-save",()=>{this.suspendCache=!0,this.reRender()}),this.setupSub()}setupSub(){this.subModel=new s.default;const i=()=>{this.subModel.set({color:this.model.attributes.avatarColor})};i(),this.listenTo(this.model,"change:avatarColor",(e,t,s)=>{s.ui||i()}),this.listenTo(this.subModel,"change",(e,t)=>{t.ui&&this.trigger("change")})}onEditModeSet(){if(this.hasColor())return this.colorView=new i.default({name:"color",model:this.subModel,labelText:this.translate("avatarColor","fields","User"),mode:"edit"}),this.assignView("colorField",this.colorView,'[data-sub-field="color"]')}afterRender(){if(super.afterRender(),this.isEditMode()){const e=document.createElement("div");e.setAttribute("data-sub-field","color"),e.classList.add("avatar-field-color"),this.element.appendChild(e),this.colorView&&this.colorView.reRender().then(()=>{const e=this.colorView.element.querySelector("input");e.placeholder=this.translate("avatarColor","fields","User")})}}hasColor(){if(this.recordHelper&&this.recordHelper.getFieldStateParam("avatarColor","readOnly"))return!1;var e=this.model.get("type");return["regular","admin","api"].includes(e)}fetch(){return this.hasColor()?{...super.fetch(),avatarColor:this.subModel.attributes.color}:super.fetch()}handleUploadingFile(t){return new Promise((s,i)=>{const e=new FileReader;e.onload=e=>{this.createView("crop","views/modals/image-crop",{contents:e.target.result}).then(e=>{e.render();let t=!1;this.listenToOnce(e,"crop",e=>{t=!0,setTimeout(()=>{fetch(e).then(e=>e.blob()).then(e=>{s(new File([e],"avatar.jpg",{type:"image/jpeg"}))})},10)}),this.listenToOnce(e,"remove",()=>{t||(setTimeout(()=>this.render(),10),i()),this.clearView("crop")})})},e.readAsDataURL(t)})}getValueForDisplay(){if(!this.isReadMode())return"";var e=this.model.get(this.idName),t=this.model.id;let s=this.cacheTimestamp=this.cacheTimestamp||Date.now();this.suspendCache&&(s=Date.now());const i=this.getBasePath()+"?entryPoint=avatar&size="+this.previewSize+"&id="+t+"&t="+s+"&attachmentId="+(e||"false"),a=$("<img>").attr("src",i).attr("alt",this.labelText).css({maxWidth:(this.imageSizes[this.previewSize]||{})[0],maxHeight:(this.imageSizes[this.previewSize]||{})[1]});if(!this.isDetailMode()){this.getCache()&&(s=this.getCache().get("app","timestamp"));const i=`${this.getBasePath()}?entryPoint=avatar&size=${this.previewSize}&id=${t}&t=`+s;a.attr("width","16").attr("src",i).css("maxWidth","16px")}return(e?$("<a>").attr("data-id",e).attr("data-action","showImagePreview").attr("href",this.getBasePath()+"?entryPoint=image&id="+e).append(a):a).get(0).outerHTML}}e.default=o}),define("views/preferences/fields/auto-follow-entity-type-list",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".stream")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e.prototype.setup.call(this)}})}),define("views/template/record/edit",["views/record/edit"],function(e){return e.extend({saveAndContinueEditingAction:!0,setup:function(){var l;e.prototype.setup.call(this),this.model.isNew()||this.setFieldReadOnly("entityType"),this.model.get("entityType")?this.showField("variables"):this.hideField("variables"),this.model.isNew()&&(l={},this.listenTo(this.model,"change:entityType",function(e){var t,s,i,a=this.model.get("entityType");if(!a)return this.model.set("header",""),this.model.set("body",""),this.model.set("footer",""),void this.hideField("variables");if(this.showField("variables"),a in l)return this.model.set("header",l[a].header),this.model.set("body",l[a].body),void this.model.set("footer",l[a].footer);var o=null;this.getMetadata().get(["entityDefs","Template","defaultTemplates",a])?o=a:(a=this.getMetadata().get(["scopes",a,"type"]))&&this.getMetadata().get(["entityDefs","Template","defaultTemplates",a])&&(o=a),o&&(t=this.getMetadata().get(["entityDefs","Template","defaultTemplates",o,"header"]),s=this.getMetadata().get(["entityDefs","Template","defaultTemplates",o,"body"]),i=this.getMetadata().get(["entityDefs","Template","defaultTemplates",o,"footer"])),t=t||null,i=i||null,this.model.set("body",s=s||""),this.model.set("header",t),this.model.set("footer",i)},this),this.listenTo(this.model,"change",function(e,t){t.ui&&(!(this.model.hasChanged("header")||this.model.hasChanged("body")||this.model.hasChanged("footer"))||(t=this.model.get("entityType"))&&(l[t]={header:this.model.get("header"),body:this.model.get("body"),footer:this.model.get("footer")}))},this))}})}),define("views/template/record/detail",["views/record/detail"],function(e){return e.extend({saveAndContinueEditingAction:!0,setup:function(){e.prototype.setup.call(this),this.hideField("variables"),this.on("after:set-edit-mode",function(){this.showField("variables")},this),this.on("after:set-detail-mode",function(){this.hideField("variables")},this)}})}),define("views/template/fields/variables",["views/fields/base","ui/select"],function(e,t){return e.extend({inlineEditDisabled:!0,detailTemplate:"template/fields/variables/detail",editTemplate:"template/fields/variables/edit",data:function(){return{attributeList:this.attributeList,entityType:this.model.get("entityType"),translatedOptions:this.translatedOptions}},events:{'change [data-name="variables"]':function(){var e=this.$el.find('[data-name="variables"]').val(),t=this.$el.find('[data-name="copy"]');""!==e?this.textVariables[e]?t.val("{{{"+e+"}}}"):t.val("{{"+e+"}}"):t.val("")}},setup:function(){this.setupAttributeList(),this.setupTranslatedOptions(),this.listenTo(this.model,"change:entityType",()=>{this.setupAttributeList(),this.setupTranslatedOptions(),this.reRender()})},setupAttributeList:function(){this.translatedOptions={};var l=this.model.get("entityType"),e=this.getFieldManager().getEntityTypeFieldList(l),i=[],e=(e.forEach(e=>{var t=this.getMetadata().get(["entityAcl",l,"fields",e])||{},s=this.getMetadata().get(["entityDefs",l,"fields",e])||{};(t.onlyAdmin||t.forbidden||t.internal||s.disabled||s.utility||s.directAccessDisabled||s.templatePlaceholderDisabled)&&i.push(e)}),this.getFieldManager().getEntityTypeAttributeList(l)||[]),t=Espo.Utils.clone(this.getAcl().getScopeForbiddenAttributeList(l)),d=(i.forEach(e=>{this.getFieldManager().getEntityTypeFieldAttributeList(l,e).forEach(function(e){t.push(e)})}),(e=e.filter(e=>{if(!~t.indexOf(e)&&"map"!==this.getMetadata().get(["entityDefs",l,"fields",e,"type"]))return!0})).push("id"),"personName"===this.getMetadata().get("entityDefs."+l+".fields.name.type")&&(~e.indexOf("name")||e.unshift("name")),this.addAdditionalPlaceholders(l,e),e=e.sort((e,t)=>this.translate(e,"fields",l).localeCompare(this.translate(t,"fields",l))),this.attributeList=e,this.textVariables={},this.attributeList.forEach(e=>{~["text","wysiwyg"].indexOf(this.getMetadata().get(["entityDefs",l,"fields",e,"type"]))&&(this.textVariables[e]=!0)}),~this.attributeList.indexOf("now")||this.attributeList.unshift("now"),~this.attributeList.indexOf("today")||this.attributeList.unshift("today"),e.unshift("pagebreak"),this.attributeList.unshift(""),this.getMetadata().get("entityDefs."+l+".links")||{});return Object.keys(d).sort((e,t)=>this.translate(e,"links",l).localeCompare(this.translate(t,"links",l))).forEach(s=>{var i,a,e,t,o;"belongsTo"!==d[s].type||(i=d[s].entity)&&(d[s].disabled||d[s].utility||this.getMetadata().get(["entityAcl",l,"links",s,"onlyAdmin"])||this.getMetadata().get(["entityAcl",l,"links",s,"forbidden"])||this.getMetadata().get(["entityAcl",l,"links",s,"internal"])||(e=this.getFieldManager().getEntityTypeFieldList(i),a=[],e.forEach(e=>{var t=this.getMetadata().get(["entityAcl",l,"fields",e])||{},s=this.getMetadata().get(["entityDefs",l,"fields",e])||{};(t.onlyAdmin||t.forbidden||t.internal||s.disabled||s.utility||s.directAccessDisabled||s.templatePlaceholderDisabled)&&a.push(e)}),e=this.getFieldManager().getEntityTypeAttributeList(i)||[],t=Espo.Utils.clone(this.getAcl().getScopeForbiddenAttributeList(i)),a.forEach(e=>{this.getFieldManager().getEntityTypeFieldAttributeList(i,e).forEach(e=>{t.push(e)})}),(e=e.filter(e=>{if(!~t.indexOf(e)&&"map"!==this.getMetadata().get(["entityDefs",i,"fields",e,"type"]))return!0})).push("id"),"personName"===this.getMetadata().get("entityDefs."+i+".fields.name.type")&&e.unshift("name"),o=Espo.Utils.clone(e),this.addAdditionalPlaceholders(i,e,s,l),e.sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i))),e.forEach(e=>{~o.indexOf(e)?this.attributeList.push(s+"."+e):this.attributeList.push(e)}),e.forEach(e=>{var t=s+"."+e;~["text","wysiwyg"].indexOf(this.getMetadata().get(["entityDefs",i,"fields",e,"type"]))&&(this.textVariables[t]=!0)})))}),this.attributeList},addAdditionalPlaceholders:function(e,t,s,i){function a(e,t){for(var s=0;s<e.length;s++)e[s]===t&&e.splice(s,1)}var o,l=this.getMetadata().get(["entityDefs",e,"fields"])||{};for(o in l){var d,n=l[o].type,r=o;s&&(r=s+"."+r),Espo.Utils.clone(t);"image"===n?(a(t,o+"Name"),a(t,o+"Id"),t.push(d="imageTag "+r+"Id"),this.translatedOptions[d]=this.translate(o,"fields",e),s&&(this.translatedOptions[d]=this.translate(s,"links",i)+"."+this.translatedOptions[d])):"barcode"===n&&(a(t,o),d="barcodeImage "+r+" type='"+this.getMetadata().get(["entityDefs",e,"fields",o,"codeType"])+"'",t.push(d),this.translatedOptions[d]=this.translate(o,"fields",e),s&&(this.translatedOptions[d]=this.translate(s,"links",i)+"."+this.translatedOptions[d]))}},setupTranslatedOptions:function(){var l=this.model.get("entityType");this.attributeList.forEach(e=>{var t,s,i,a,o;!~["today","now","pagebreak"].indexOf(e)||this.getMetadata().get(["entityDefs",l,"fields",e])?(a=l,t=!1,~(s=e).indexOf(".")&&(t=!0,s=e.split(".")[1],i=e.split(".")[0],a=this.getMetadata().get("entityDefs."+l+".links."+i+".entity")),this.translatedOptions[e]||(this.translatedOptions[e]=this.translate(s,"fields",a),s.indexOf("Id")===s.length-2?(o=s.substr(0,s.length-2),this.getMetadata().get(["entityDefs",a,"fields",o])&&(this.translatedOptions[e]=this.translate(o,"fields",a)+" ("+this.translate("id","fields")+")")):s.indexOf("Name")===s.length-4?(o=s.substr(0,s.length-4),this.getMetadata().get(["entityDefs",a,"fields",o])&&(this.translatedOptions[e]=this.translate(o,"fields",a)+" ("+this.translate("name","fields")+")")):s.indexOf("Type")===s.length-4&&(o=s.substr(0,s.length-4),this.getMetadata().get(["entityDefs",a,"fields",o])&&(this.translatedOptions[e]=this.translate(o,"fields",a)+" ("+this.translate("type","fields")+")")),s.indexOf("Ids")===s.length-3?(o=s.substr(0,s.length-3),this.getMetadata().get(["entityDefs",a,"fields",o])&&(this.translatedOptions[e]=this.translate(o,"fields",a)+" ("+this.translate("ids","fields")+")")):s.indexOf("Names")===s.length-5?(o=s.substr(0,s.length-5),this.getMetadata().get(["entityDefs",a,"fields",o])&&(this.translatedOptions[e]=this.translate(o,"fields",a)+" ("+this.translate("names","fields")+")")):s.indexOf("Types")===s.length-5&&(o=s.substr(0,s.length-5),this.getMetadata().get(["entityDefs",a,"fields",o])&&(this.translatedOptions[e]=this.translate(o,"fields",a)+" ("+this.translate("types","fields")+")")),t&&(this.translatedOptions[e]=this.translate(i,"links",l)+"."+this.translatedOptions[e]))):this.translatedOptions[e]=this.getLanguage().translateOption(e,"placeholders","Template")})},afterRender:function(){e.prototype.afterRender.call(this),this.mode===this.MODE_EDIT&&t.init(this.$el.find('[data-name="variables"]'))},fetch:function(){}})}),define("views/template/fields/style",["exports","views/fields/text"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(s=t)&&s.__esModule?s:{default:s};let i;class a extends t.default{detailTemplateContent=`
        {{#if isNotEmpty}}
            <div id="{{containerId}}">{{value}}</div>
        {{else}}
            <span class="none-value">{{translate 'None'}}</span>
        {{/if}}
    `;editTemplateContent=`
        <div id="{{containerId}}">{{value}}</div>
    `;height=50;maxLineDetailCount=80;maxLineEditCount=200;setup(){super.setup(),this.height=this.options.height||this.params.height||this.height,this.maxLineDetailCount=this.options.maxLineDetailCount||this.params.maxLineDetailCount||this.maxLineDetailCount,this.maxLineEditCount=this.options.maxLineEditCount||this.params.maxLineEditCount||this.maxLineEditCount,this.containerId="editor-"+Math.floor(1e4*Math.random()+1).toString(),this.mode!==this.MODE_EDIT&&this.mode!==this.MODE_DETAIL||this.wait(this.requireAce()),this.on("remove",()=>{this.editor&&this.editor.destroy()})}requireAce(){return Espo.loader.requirePromise("lib!ace").then(e=>{i=e;const t=[Espo.loader.requirePromise("lib!ace-ext-language_tools"),Espo.loader.requirePromise("lib!ace-mode-css")];return this.getThemeManager().getParam("isDark")&&t.push(Espo.loader.requirePromise("lib!ace-theme-tomorrow_night")),Promise.all(t)})}data(){const e=super.data();return e.containerId=this.containerId,e}afterRender(){if(super.afterRender(),this.$editor=this.$el.find("#"+this.containerId),this.$editor.length&&(this.mode===this.MODE_EDIT||this.mode===this.MODE_DETAIL||this.mode===this.MODE_LIST)){this.$editor.css("fontSize","14px"),this.mode===this.MODE_EDIT&&this.$editor.css("minHeight",this.height+"px");const e=this.editor=i.edit(this.containerId),t=(e.setOptions({maxLines:this.mode===this.MODE_EDIT?this.maxLineEditCount:this.maxLineDetailCount,enableLiveAutocompletion:!0}),this.getThemeManager().getParam("isDark")&&e.setOptions({theme:"ace/theme/tomorrow_night"}),this.isEditMode()&&(e.getSession().on("change",()=>{this.trigger("change",{ui:!0})}),e.getSession().setUseWrapMode(!0)),this.isReadMode()&&(e.setReadOnly(!0),e.renderer.$cursorLayer.element.style.display="none",e.renderer.setShowGutter(!1)),e.setShowPrintMargin(!1),e.getSession().setUseWorker(!1),e.commands.removeCommand("find"),e.setHighlightActiveLine(!1),i.require("ace/mode/css").Mode);e.session.setMode(new t)}}fetch(){const e={};return e[this.name]=this.editor.getValue(),e}}e.default=a}),define("views/template/fields/font-face",["views/fields/enum"],function(e){return e.extend({setupOptions:function(){var e=this.getConfig().get("pdfEngine")||"Dompdf",e=this.getMetadata().get(["app","pdfEngines",e,"fontFaceList"])||[];(e=Espo.Utils.clone(e)).unshift(""),this.params.options=e}})}),define("views/template/fields/entity-type",["views/fields/entity-type"],function(e){return e.extend({checkAvailability:function(e){e=this.scopesMetadataDefs[e]||{};return!!e.pdfTemplate||(!(!e.entity||!e.object)||void 0)}})}),define("views/template/fields/body",["exports","views/fields/wysiwyg"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{htmlPurificationForEditDisabled=!0;noStylesheet=!0;useIframe=!0;tableClassName="bordered";handlebars=!0}e.default=i}),define("views/team/record/list",["views/record/list"],function(e){return e.extend({quickDetailDisabled:!0,quickEditDisabled:!0,checkAllResultDisabled:!0})}),define("views/team/record/edit",["views/record/edit"],function(e){return e.extend({})}),define("views/team/record/detail",["views/record/detail"],function(e){return e.extend({})}),define("views/team/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0})}),define("views/site-portal/navbar",["exports","views/site/navbar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getLogoSrc(){var e=this.getConfig().get("companyLogoId");return e?this.getBasePath()+`?entryPoint=LogoImage&id=${e}&t=`+e:this.getBasePath()+(this.getThemeManager().getParam("logo")||"client/img/logo.svg")}getTabList(){const e=[...this.getConfig().get("tabList")||[]];return(this.getThemeManager().getParam("navbarIsVertical")||e.length)&&e.unshift("Home"),e}}e.default=i}),define("views/site-portal/master",["exports","views/site/master"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{views={header:{id:"header",view:"views/site-portal/header"},main:{id:"main",view:!1},footer:{fullSelector:"body > footer",view:"views/site/footer"}};afterRender(){super.afterRender(),this.element.querySelector("#main").classList.add("main-portal")}}e.default=i}),define("views/site-portal/header",["exports","views/site/header"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{navbarView="views/site-portal/navbar";customViewPath=["clientDefs","App","portalNavbarView"]}e.default=i}),define("views/site/navbar/quick-create",["exports","view"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{templateContent=`
        <a
            id="nav-quick-create-dropdown"
            class="dropdown-toggle"
            data-toggle="dropdown"
            role="button"
            tabindex="0"
            title="{{translate 'Create'}}"
        ><i class="fas fa-plus icon"></i></a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="nav-quick-create-dropdown">
            <li class="dropdown-header">{{translate 'Create'}}</li>
            {{#each list}}
                <li><a
                    href="#{{./this}}/create"
                    data-name="{{./this}}"
                    data-action="quickCreate"
                >{{translate this category='scopeNames'}}</a></li>
            {{/each}}
        </ul>
    `;data(){return{list:this.list}}setup(){this.addActionHandler("quickCreate",(e,t)=>{e.preventDefault(),this.processCreate(t.dataset.name)});const t=this.getMetadata().get("scopes")||{},e=this.getConfig().get("quickCreateList")||[];this.list=e.filter(e=>!!t[e]&&((t[e]||{}).disabled?void 0:!(t[e]||{}).acl||this.getAcl().check(e,"create")))}isAvailable(){return 0<this.list.length}processCreate(e){Espo.Ui.notify(" ... ");var t=this.getMetadata().get(["clientDefs",e,"quickCreateModalType"])||"edit",t=this.getMetadata().get(["clientDefs",e,"modalViews",t])||"views/modals/edit";this.createView("dialog",t,{scope:e}).then(e=>e.render()).then(()=>Espo.Ui.notify(!1))}}e.default=i}),define("views/settings/modals/tab-list-field-add",["exports","views/modals/array-field-add"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.options.noGroups||this.buttonList.push({name:"addGroup",text:this.translate("Group Tab","labels","Settings"),onClick:()=>this.actionAddGroup()}),this.buttonList.push({name:"addDivider",text:this.translate("Divider","labels","Settings"),onClick:()=>this.actionAddDivider()}),this.addButton({name:"addUrl",text:this.translate("URL","labels","Settings"),onClick:()=>this.actionAddUrl()})}actionAddGroup(){this.trigger("add",{type:"group",text:this.translate("Group Tab","labels","Settings"),iconClass:null,color:null})}actionAddDivider(){this.trigger("add",{type:"divider",text:null})}actionAddUrl(){this.trigger("add",{type:"url",text:this.translate("URL","labels","Settings"),url:null,iconClass:null,color:null,aclScope:null,onlyAdmin:!1})}}e.default=i}),define("views/settings/modals/edit-tab-url",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{className="dialog dialog-record";templateContent='<div class="record no-side-margin">{{{record}}}</div>';setup(){super.setup(),this.headerText=this.translate("URL","labels","Settings"),this.buttonList.push({name:"apply",label:"Apply",style:"danger"}),this.buttonList.push({name:"cancel",label:"Cancel"}),this.shortcutKeys={"Control+Enter":()=>this.actionApply()};var e=[{rows:[[{name:"url",labelText:this.translate("URL","labels","Settings"),view:"views/settings/fields/tab-url"}],[{name:"text",labelText:"Preferences"===this.options.parentType?this.translate("label","tabFields","Preferences"):this.translate("label","fields","Admin")},{name:"iconClass",labelText:"Preferences"===this.options.parentType?this.translate("iconClass","tabFields","Preferences"):this.translate("iconClass","fields","EntityManager")},{name:"color",labelText:"Preferences"===this.options.parentType?this.translate("color","tabFields","Preferences"):this.translate("color","fields","EntityManager")}],[{name:"aclScope",labelText:this.translate("aclScope","fields","Admin")},{name:"onlyAdmin",labelText:this.translate("onlyAdmin","fields","Admin")},!1]]}];const t=this.model=new s.default;t.set(this.options.itemData),t.setDefs({fields:{text:{type:"varchar"},iconClass:{type:"base",view:"views/admin/entity-manager/fields/icon-class"},color:{type:"base",view:"views/fields/colorpicker"},url:{type:"url",required:!0},aclScope:{type:"enum",translation:"Global.scopeNames",options:["",...this.getAclScopes()]},onlyAdmin:{type:"bool"}}}),this.createView("record","views/record/edit-for-modal",{detailLayout:e,model:t,selector:".record"}).then(e=>{"Preferences"===this.options.parentType&&(e.hideField("aclScope"),e.hideField("onlyAdmin"))})}actionApply(){const e=this.getView("record");var t;e.validate()||(t=e.fetch(),this.trigger("apply",t))}getAclScopes(){return this.getMetadata().getScopeList().filter(e=>this.getMetadata().get(`scopes.${e}.acl`))}}e.default=a}),define("views/settings/modals/edit-tab-group",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{className="dialog dialog-record";templateContent='<div class="record no-side-margin">{{{record}}}</div>';setup(){super.setup(),this.headerText=this.translate("Group Tab","labels","Settings"),this.buttonList.push({name:"apply",label:"Apply",style:"danger"}),this.buttonList.push({name:"cancel",label:"Cancel"}),this.shortcutKeys={"Control+Enter":()=>this.actionApply()};var e=[{rows:[[{name:"text",labelText:"Preferences"===this.options.parentType?this.translate("label","tabFields","Preferences"):this.translate("label","fields","Admin")},{name:"iconClass",labelText:"Preferences"===this.options.parentType?this.translate("iconClass","tabFields","Preferences"):this.translate("iconClass","fields","EntityManager")},{name:"color",labelText:"Preferences"===this.options.parentType?this.translate("color","tabFields","Preferences"):this.translate("color","fields","EntityManager")}],[{name:"itemList",labelText:"Preferences"===this.options.parentType?this.translate("tabList","fields","Preferences"):this.translate("tabList","fields","Settings")},!1]]}];const t=this.model=new s.default;t.name="GroupTab",t.set(this.options.itemData),t.setDefs({fields:{text:{type:"varchar"},iconClass:{type:"base",view:"views/admin/entity-manager/fields/icon-class"},color:{type:"base",view:"views/fields/colorpicker"},itemList:{type:"array",view:"views/settings/fields/group-tab-list"}}}),this.createView("record","views/record/edit-for-modal",{detailLayout:e,model:t,selector:".record"})}actionApply(){const e=this.getView("record");var t;e.validate()||(t=e.fetch(),this.trigger("apply",t))}}e.default=a}),define("views/settings/modals/edit-tab-divider",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{className="dialog dialog-record";templateContent='<div class="record no-side-margin">{{{record}}}</div>';setup(){super.setup(),this.headerText=this.translate("Divider","labels","Settings"),this.buttonList.push({name:"apply",label:"Apply",style:"danger"}),this.buttonList.push({name:"cancel",label:"Cancel"}),this.shortcutKeys={"Control+Enter":()=>this.actionApply()};var e=[{rows:[[{name:"text",labelText:"Preferences"===this.options.parentType?this.translate("label","tabFields","Preferences"):this.translate("label","fields","Admin")},!1]]}];let t=this.model=new s.default({},{entityType:"Dummy"});t.set(this.options.itemData),t.setDefs({fields:{text:{type:"varchar"}}}),this.createView("record","views/record/edit-for-modal",{detailLayout:e,model:t,selector:".record"})}actionApply(){let e=this.getView("record");var t;e.validate()||(t=e.fetch(),this.trigger("apply",t))}}e.default=a}),define("views/settings/fields/time-format",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=this.getMetadata().get(["app","dateTime","timeFormatList"])||[]}}e.default=i}),define("views/settings/fields/thousand-separator",["exports","views/fields/varchar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{validations=["required","thousandSeparator"];validateThousandSeparator(){var e;if(this.model.get("thousandSeparator")===this.model.get("decimalMark"))return e=this.translate("thousandSeparatorEqualsDecimalMark","messages","Admin"),this.showValidationMessage(e),!0}fetch(){const e={};var t=this.$element.val();return e[this.name]=t||"",e}}e.default=i}),define("views/settings/fields/tab-url",["exports","views/fields/url"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{optionalProtocol=!1;validateValid(){const e=this.model.get(this.name);return(!e||!e.startsWith("#"))&&super.validateValid()}}e.default=i}),define("views/settings/fields/stream-email-notifications-entity-list",["exports","views/fields/entity-type-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get(`scopes.${e}.disabled`)&&this.getMetadata().get(`scopes.${e}.object`)&&this.getMetadata().get(`scopes.${e}.stream`))return!0})}}e.default=i}),define("views/settings/fields/sms-provider",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{fetchEmptyValueAsNull=!0;setupOptions(){this.params.options=Object.keys(this.getMetadata().get(["app","smsProviders"])||{}),this.params.options.unshift("")}}e.default=i}),define("views/settings/fields/phone-number-preferred-country-list",["exports","views/fields/multi-enum","intl-tel-input-globals"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{setupOptions(){try{const e=s.default.getCountryData();this.params.options=e.map(e=>e.iso2),this.translatedOptions=e.reduce((e,t)=>(e[t.iso2]=t.iso2.toUpperCase()+" +"+t.dialCode,e),{})}catch(e){console.error(e)}}}e.default=a}),define("views/settings/fields/pdf-engine",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Object.keys(this.getMetadata().get(["app","pdfEngines"])),0===this.params.options.length&&(this.params.options=[""])}}e.default=i}),define("views/settings/fields/outbound-email-from-address",["exports","views/fields/email-address"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{useAutocompleteUrl=!0;getAutocompleteUrl(e){return"InboundEmail?searchParams="+JSON.stringify({select:["emailAddress"],maxSize:7,where:[{type:"startsWith",attribute:"emailAddress",value:e},{type:"isTrue",attribute:"useSmtp"}]})}transformAutocompleteResult(e){const t=super.transformAutocompleteResult(e);return t.forEach(e=>{e.value=e.attributes.emailAddress}),t}}e.default=i}),define("views/settings/fields/oidc-teams",["exports","views/fields/link-multiple-with-role"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{forceRoles=!0;roleType="varchar";columnName="group";roleMaxLength=255;setup(){super.setup(),this.rolePlaceholderText=this.translate("IdP Group","labels","Settings")}}e.default=i}),define("views/settings/fields/oidc-redirect-uri",["exports","views/fields/varchar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{detailTemplateContent=`
        {{#if isNotEmpty}}
            <a
                role="button"
                data-action="copyToClipboard"
                class="pull-right text-soft"
                title="{{translate 'Copy to Clipboard'}}"
            ><span class="far fa-copy"></span></a>
            {{value}}
        {{else}}
            <span class="none-value">{{translate 'None'}}</span>
        {{/if}}
    `;portalCollection=null;data(){var e="AuthenticationProvider"!==this.model.entityType||this.portalCollection;return{value:this.getValueForDisplay(),isNotEmpty:e}}copyToClipboard(){var e=this.getValueForDisplay();navigator.clipboard.writeText(e).then(()=>{Espo.Ui.success(this.translate("Copied to clipboard"))})}getValueForDisplay(){return"AuthenticationProvider"===this.model.entityType?this.portalCollection?this.portalCollection.models.map(e=>{var t="oauth-callback.php";const s=(e.get("url")||"").replace(/\/+$/,"")+"/"+t;e=`/portal/${e.id}/`+t;return s.endsWith(e)?s.slice(0,-e.length)+"/portal/"+t:s}).join("\n"):null:(this.getConfig().get("siteUrl")||"").replace(/\/+$/,"")+"/oauth-callback.php"}setup(){super.setup(),"AuthenticationProvider"===this.model.entityType&&this.getCollectionFactory().create("Portal").then(e=>{e.data.select=["url","isDefault"].join(","),e.fetch().then(()=>{this.portalCollection=e,this.reRender()})})}}e.default=i}),define("views/settings/fields/language",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","language","list"])||[]),this.translatedOptions=Espo.Utils.clone(this.getLanguage().translate("language","options")||{})}}e.default=i}),define("views/settings/fields/history-entity-list",["exports","views/fields/entity-type-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get("scopes."+e+".disabled")&&this.getMetadata().get("scopes."+e+".object")&&this.getMetadata().get("scopes."+e+".activity"))return!0})}}e.default=i}),define("views/settings/fields/group-tab-list",["exports","views/settings/fields/tab-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{noGroups=!0;noDelimiters=!0}e.default=i}),define("views/settings/fields/global-search-entity-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{var t=this.getMetadata().get(["scopes",e])||{};if(!t.disabled&&"Note"!==e)return t.customizable&&t.entity}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),super.setup()}}e.default=i}),define("views/settings/fields/fiscal-year-shift",["exports","views/fields/enum-int"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=[],this.translatedOptions={};const e=this.getLanguage().get("Global","lists","monthNames")||[];e.forEach((e,t)=>{this.params.options.push(t),this.translatedOptions[t]=e})}}e.default=i}),define("views/settings/fields/email-address-lookup-entity-type-list",["exports","views/fields/entity-type-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get(["scopes",e,"disabled"])&&this.getMetadata().get(["scopes",e,"object"])){if(["User","Contact","Lead","Account"].includes(e))return!0;e=this.getMetadata().get(["scopes",e,"type"]);return"Company"===e||"Person"===e||void 0}})}}e.default=i}),define("views/settings/fields/default-currency",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.validations.push(()=>this.validateExisting())}setupOptions(){this.params.options=Espo.Utils.clone(this.getConfig().get("currencyList")||[])}validateExisting(){const e=this.model.get("currencyList");if(!e)return!1;var t=this.model.get(this.name);if(e.includes(t))return!1;t=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText());return this.showValidationMessage(t),!0}}e.default=i}),define("views/settings/fields/date-format",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=this.getMetadata().get(["app","dateTime","dateFormatList"])||[]}}e.default=i}),define("views/settings/fields/dashboard-layout",["exports","views/fields/base","gridstack"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{detailTemplate="settings/fields/dashboard-layout/detail";editTemplate="settings/fields/dashboard-layout/edit";validationElementSelector='button[data-action="addDashlet"]';WIDTH_MULTIPLIER=3;data(){return{dashboardLayout:this.dashboardLayout,currentTab:this.currentTab,isEmpty:this.isEmpty()}}hasLocked(){return"Preferences"===this.model.entityType}setup(){this.addActionHandler("selectTab",(e,t)=>{t=parseInt(t.dataset.tab);this.selectTab(t)}),this.addActionHandler("removeDashlet",(e,t)=>{t=t.dataset.id;this.removeDashlet(t)}),this.addActionHandler("editDashlet",(e,t)=>{var s=t.dataset.id,t=t.dataset.name;this.editDashlet(s,t)}),this.addActionHandler("editTabs",()=>this.editTabs()),this.addActionHandler("addDashlet",()=>{this.createView("addDashlet","views/modals/add-dashlet",{parentType:this.model.entityType},e=>{e.render(),this.listenToOnce(e,"add",e=>this.addDashlet(e))})}),this.dashboardLayout=Espo.Utils.cloneDeep(this.model.get(this.name)||[]),this.dashletsOptions=Espo.Utils.cloneDeep(this.model.get("dashletsOptions")||{}),this.hasLocked()&&(this.dashboardLocked=this.model.get("dashboardLocked")||!1),this.listenTo(this.model,"change",()=>{this.model.hasChanged(this.name)&&(this.dashboardLayout=Espo.Utils.cloneDeep(this.model.get(this.name)||[])),this.model.hasChanged("dashletsOptions")&&(this.dashletsOptions=Espo.Utils.cloneDeep(this.model.get("dashletsOptions")||{})),this.model.hasChanged(this.name)&&this.dashboardLayout.length&&this.isDetailMode()&&this.selectTab(0),this.hasLocked()&&(this.dashboardLocked=this.model.get("dashboardLocked")||!1)}),this.currentTab=-1,this.currentTabLayout=null,this.dashboardLayout.length&&this.selectTab(0)}selectTab(e){this.currentTab=e,this.setupCurrentTabLayout(),this.isRendered()&&this.reRender().then(()=>{this.$el.find(`[data-action="selectTab"][data-tab="${e}"]`).focus()})}setupCurrentTabLayout(){~this.currentTab||(this.currentTabLayout=null);var e=this.dashboardLayout[this.currentTab].layout||[],e=s.default.Utils.sort(e);this.currentTabLayout=e}addDashletHtml(e,t){const s=this.prepareGridstackItem(e,t);this.grid.addWidget(s.get(0),{x:0,y:0,w:2*this.WIDTH_MULTIPLIER,h:2})}generateId(){return Math.floor(10000001*Math.random()).toString()}addDashlet(e){const t="d"+Math.floor(1000001*Math.random()).toString();~this.currentTab?(this.addDashletHtml(t,e),this.fetchLayout()):(this.dashboardLayout.push({name:"My Espo",layout:[],id:this.generateId()}),this.currentTab=0,this.setupCurrentTabLayout(),this.once("after:render",()=>{setTimeout(()=>{this.addDashletHtml(t,e),this.fetchLayout()},50)}),this.reRender())}removeDashlet(s){const e=this.$gridstack.find('.grid-stack-item[data-id="'+s+'"]'),i=(this.grid.removeWidget(e.get(0),!0),this.dashboardLayout[this.currentTab].layout);i.forEach((e,t)=>{e.id===s&&i.splice(t,1)}),delete this.dashletsOptions[s],this.setupCurrentTabLayout()}editTabs(){const e={dashboardLayout:this.dashboardLayout,tabListIsNotRequired:!0};this.hasLocked()&&(e.dashboardLocked=this.dashboardLocked),this.createView("editTabs","views/modals/edit-dashboard",e,t=>{t.render(),this.listenToOnce(t,"after:save",e=>{t.close();const a=[];e.dashboardTabList.forEach(t=>{let s=[],i=this.generateId();this.dashboardLayout.forEach(e=>{e.name===t&&(s=e.layout,i=e.id)}),t in e.renameMap&&(t=e.renameMap[t]),a.push({name:t,layout:s,id:i})}),this.dashboardLayout=a,this.hasLocked()&&(this.dashboardLocked=e.dashboardLocked),this.selectTab(0),this.deleteNotExistingDashletsOptions()})})}deleteNotExistingDashletsOptions(){const t=[];(this.dashboardLayout||[]).forEach(e=>{(e.layout||[]).forEach(e=>{t.push(e.id)})}),Object.keys(this.dashletsOptions).forEach(e=>{~t.indexOf(e)||delete this.dashletsOptions[e]})}editDashlet(s,i){let t=this.dashletsOptions[s]||{};t=Espo.Utils.cloneDeep(t);const a=this.getMetadata().get(["dashlets",i,"options","defaults"])||{};Object.keys(a).forEach(e=>{e in t||(t[e]=Espo.Utils.cloneDeep(a[e]))}),"title"in t||(t.title=this.translate(i,"dashlets"));var e=this.getMetadata().get(["dashlets",i,"options","view"])||"views/dashlets/options/base";this.createView("options",e,{name:i,optionsData:t,fields:this.getMetadata().get(["dashlets",i,"options","fields"])||{},userId:"Preferences"===this.model.entityType?this.model.id:null},e=>{e.render(),this.listenToOnce(e,"save",t=>{if(this.dashletsOptions[s]=t,e.close(),"title"in t){let e=t.title;e=e||this.translate(i,"dashlets"),this.$el.find('[data-id="'+s+'"] .panel-title').text(e)}})})}fetchLayout(){~this.currentTab&&(this.dashboardLayout[this.currentTab].layout=_.map(this.$gridstack.find(".grid-stack-item"),e=>{const t=$(e);var e=t.attr("gs-x"),s=t.attr("gs-y"),i=t.attr("gs-h"),a=t.attr("gs-w");return{id:t.data("id"),name:t.data("name"),x:e/this.WIDTH_MULTIPLIER,y:s,width:a/this.WIDTH_MULTIPLIER,height:i}}),this.setupCurrentTabLayout())}afterRender(){if(this.currentTabLayout){const e=this.$gridstack=this.$el.find("> .grid-stack"),t=this.grid=s.default.init({minWidth:4,cellHeight:60,margin:10,column:12,resizable:{handles:"se",helper:!1},disableOneColumnMode:!0,animate:!1,staticGrid:"edit"!==this.mode,disableResize:"edit"!==this.mode,disableDrag:"edit"!==this.mode});t.removeAll(),this.currentTabLayout.forEach(e=>{const t=this.prepareGridstackItem(e.id,e.name);this.grid.addWidget(t.get(0),{x:e.x*this.WIDTH_MULTIPLIER,y:e.y,w:e.width*this.WIDTH_MULTIPLIER,h:e.height})}),e.find(" .grid-stack-item").css("position","absolute"),e.on("change",()=>{this.fetchLayout(),this.trigger("change")})}}prepareGridstackItem(e,t){const s=$("<div>").addClass("grid-stack-item");let i="",a=(this.isEditMode()&&(i=(i+=$("<div>").addClass("btn-group pull-right").append($("<button>").addClass("btn btn-default").attr("data-action","removeDashlet").attr("data-id",e).attr("title",this.translate("Remove")).append($("<span>").addClass("fas fa-times"))).get(0).outerHTML)+$("<div>").addClass("btn-group pull-right").append($("<button>").addClass("btn btn-default").attr("data-action","editDashlet").attr("data-id",e).attr("data-name",t).attr("title",this.translate("Edit")).append($("<span>").addClass("fas fa-pencil-alt fa-sm").css({position:"relative",top:"-1px"}))).get(0).outerHTML),this.getOption(e,"title"));a=a||this.translate(t,"dashlets");var o=$("<div>").addClass("panel-heading").append(i).append($("<h4>").addClass("panel-title").text(a)).get(0).outerHTML;const l=$("<div>").addClass("grid-stack-item-content panel panel-default").append(o);return l.attr("data-id",e),l.attr("data-name",t),s.attr("data-id",e),s.attr("data-name",t),s.append(l),s}getOption(e,t){return((this.model.get("dashletsOptions")||{})[e]||{})[t]}isEmpty(){let t=!0;return this.dashboardLayout&&this.dashboardLayout.length&&this.dashboardLayout.forEach(e=>{e.layout&&e.layout.length&&(t=!1)}),t}validateRequired(){var e;if(this.isRequired())return this.isEmpty()?(e=this.translate("fieldIsRequired","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0):void 0}fetch(){const e={};return this.dashboardLayout&&this.dashboardLayout.length?(e[this.name]=Espo.Utils.cloneDeep(this.dashboardLayout),e.dashletsOptions=Espo.Utils.cloneDeep(this.dashletsOptions),this.hasLocked()&&(e.dashboardLocked=this.dashboardLocked)):(e[this.name]=null,e.dashletsOptions={}),e}}e.default=a}),define("views/settings/fields/currency-rates",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{editTemplate="settings/fields/currency-rates/edit";data(){const t=this.model.get("baseCurrency"),s=this.model.get("currencyRates")||{},i={};return(this.model.get("currencyList")||[]).forEach(e=>{e!==t&&(i[e]=s[e],i[e]||(s[t]&&(i[e]=Math.round(1/s[t]*1e3)/1e3),i[e]||(i[e]=1)))}),{rateValues:i,baseCurrency:t}}fetch(){const e={},s={},i=this.model.get("baseCurrency"),t=this.model.get("currencyList")||[];t.forEach(e=>{var t;e!==i&&(t=this.$el.find(`input[data-currency="${e}"]`).val()||"1",s[e]=parseFloat(t))}),delete s[i];for(const a in s)~t.indexOf(a)||delete s[a];return e[this.name]=s,e}}e.default=i}),define("views/settings/fields/currency-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{matchAnyWord=!0;setupOptions(){this.params.options=this.getMetadata().get(["app","currency","list"])||[],this.translatedOptions={},this.params.options.forEach(e=>{let t=e;var s=this.getLanguage().get("Currency","names",e);s&&(t+=" - "+s),this.translatedOptions[e]=t})}}e.default=i}),define("views/settings/fields/calendar-entity-list",["exports","views/fields/entity-type-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get(`scopes.${e}.disabled`)&&this.getMetadata().get(`scopes.${e}.object`)&&this.getMetadata().get(`scopes.${e}.calendar`))return!0})}}e.default=i}),define("views/settings/fields/busy-ranges-entity-list",["exports","views/fields/entity-type-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.params.options=this.params.options.filter(e=>{if(!this.getMetadata().get(["scopes",e,"disabled"])&&this.getMetadata().get(["scopes",e,"object"])&&this.getMetadata().get(["scopes",e,"calendar"]))return!0})}}e.default=i}),define("views/settings/fields/authentication-method",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=[];var e=this.getMetadata().get(["authenticationMethods"])||{};for(const t in e)e[t].settings&&e[t].settings.isAvailable&&this.params.options.push(t)}}e.default=i}),define("views/settings/fields/auth-two-fa-method-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=[];var e=this.getMetadata().get(["app","authentication2FAMethods"])||{};for(const t in e)e[t].settings&&e[t].settings.isAvailable&&this.params.options.push(t)}}e.default=i}),define("views/settings/fields/assignment-notifications-entity-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get(`scopes.${e}.disabled`)&&(!this.getMetadata().get(["scopes",e,"stream"])||this.getMetadata().get(["entityDefs",e,"fields","assignedUsers"])))return this.getMetadata().get(`scopes.${e}.notifications`)&&this.getMetadata().get(`scopes.${e}.entity`)}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),super.setup()}}e.default=i}),define("views/settings/fields/assignment-email-notifications-entity-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if("Email"!==e&&!this.getMetadata().get(`scopes.${e}.disabled`))return this.getMetadata().get(`scopes.${e}.notifications`)&&this.getMetadata().get(`scopes.${e}.entity`)}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),super.setup()}}e.default=i}),define("views/settings/fields/address-preview",["exports","views/fields/address"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup();const e=this.model,t=e.clone();t.entityType=e.entityType,t.name=e.name,t.set({addressPreviewStreet:"Street",addressPreviewPostalCode:"PostalCode",addressPreviewCity:"City",addressPreviewState:"State",addressPreviewCountry:"Country"}),this.listenTo(e,"change:addressFormat",()=>{t.set("addressFormat",e.get("addressFormat")),this.reRender()}),this.model=t}getAddressFormat(){return this.model.get("addressFormat")||1}}e.default=i}),define("views/settings/fields/activities-entity-list",["exports","views/fields/entity-type-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.params.options=this.params.options.filter(e=>{if("Email"!==e&&!this.getMetadata().get(`scopes.${e}.disabled`)&&this.getMetadata().get(`scopes.${e}.object`)&&this.getMetadata().get(`scopes.${e}.activity`))return!0})}}e.default=i}),define("views/preferences/edit",["exports","views/edit"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{userName="";setup(){super.setup(),this.userName=this.model.get("name")}getHeader(){return this.buildHeaderHtml([$("<span>").text(this.translate("Preferences")),$("<span>").text(this.userName)])}updatePageTitle(){let e=this.getLanguage().translate(this.scope,"scopeNames");this.model.id!==this.getUser().id&&this.userName&&(e+=" Â· "+this.userName),this.setPageTitle(e)}}e.default=i}),define("views/preferences/record/edit",["exports","views/record/edit"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{sideView=null;saveAndContinueEditingAction=!1;buttonList=[{name:"save",label:"Save",style:"primary"},{name:"cancel",label:"Cancel"}];dynamicLogicDefs={fields:{tabList:{visible:{conditionGroup:[{type:"isTrue",attribute:"useCustomTabList"}]}},addCustomTabs:{visible:{conditionGroup:[{type:"isTrue",attribute:"useCustomTabList"}]}}}};setup(){super.setup();const e=this.model,t=(this.addDropdownItem({name:"reset",text:this.getLanguage().translate("Reset to Default","labels","Admin"),style:"danger"}),this.getAcl().getScopeForbiddenFieldList("Preferences","edit"));if(t.includes("dashboardLayout")||e.isPortal()||this.addDropdownItem({name:"resetDashboard",text:this.getLanguage().translate("Reset Dashboard to Default","labels","Preferences")}),e.isPortal()&&(this.layoutName="detailPortal"),this.model.id===this.getUser().id){const i=this.getPreferences();this.on("save",(e,t)=>{const s=this.model.getClonedAttributes();delete s.smtpPassword,i.set(s),i.trigger("update",t)})}this.getUser().isAdmin()&&!e.isPortal()||(this.hidePanel("dashboard"),this.hideField("dashboardLayout")),this.controlFollowCreatedEntityListVisibility(),this.listenTo(this.model,"change:followCreatedEntities",this.controlFollowCreatedEntityListVisibility),this.controlColorsField(),this.listenTo(this.model,"change:scopeColorsDisabled",this.controlColorsField,this);let s=!0;!this.getConfig().get("assignmentEmailNotifications")||e.isPortal()?(this.hideField("receiveAssignmentEmailNotifications"),this.hideField("assignmentEmailNotificationsIgnoreEntityTypeList")):(s=!1,this.controlAssignmentEmailNotificationsVisibility(),this.listenTo(this.model,"change:receiveAssignmentEmailNotifications",()=>{this.controlAssignmentEmailNotificationsVisibility()})),0===(this.getConfig().get("assignmentEmailNotificationsEntityList")||[]).length&&this.hideField("assignmentEmailNotificationsIgnoreEntityTypeList"),0===(this.getConfig().get("assignmentNotificationsEntityList")||[]).length||e.isPortal()?this.hideField("assignmentNotificationsIgnoreEntityTypeList"):s=!1,this.getConfig().get("emailForceUseExternalClient")&&this.hideField("emailUseExternalClient"),!this.getConfig().get("mentionEmailNotifications")||e.isPortal()?this.hideField("receiveMentionEmailNotifications"):s=!1,!this.getConfig().get("streamEmailNotifications")&&!e.isPortal()||!this.getConfig().get("portalStreamEmailNotifications")&&e.isPortal()?this.hideField("receiveStreamEmailNotifications"):s=!1,s&&this.hidePanel("notifications"),this.getConfig().get("userThemesDisabled")&&this.hideField("theme"),this.on("save",e=>{this.model.get("language")===e.language&&this.model.get("theme")===e.theme&&(this.model.get("themeParams")||{}).navbar===(e.themeParams||{}).navbar||(this.setConfirmLeaveOut(!1),window.location.reload())})}controlFollowCreatedEntityListVisibility(){this.model.get("followCreatedEntities")?this.hideField("followCreatedEntityTypeList"):this.showField("followCreatedEntityTypeList")}controlColorsField(){this.model.get("scopeColorsDisabled")?this.hideField("tabColorsDisabled"):this.showField("tabColorsDisabled")}controlAssignmentEmailNotificationsVisibility(){this.model.get("receiveAssignmentEmailNotifications")?this.showField("assignmentEmailNotificationsIgnoreEntityTypeList"):this.hideField("assignmentEmailNotificationsIgnoreEntityTypeList")}actionReset(){this.confirm(this.translate("resetPreferencesConfirmation","messages"),()=>{Espo.Ajax.deleteRequest("Preferences/"+this.model.id).then(e=>{Espo.Ui.success(this.translate("resetPreferencesDone","messages")),this.model.set(e);for(const t in e)this.setInitialAttributeValue(t,e[t]);this.getPreferences().set(this.model.getClonedAttributes()),this.getPreferences().trigger("update"),this.setIsNotChanged()})})}actionResetDashboard(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest("Preferences/action/resetDashboard",{id:this.model.id}).then(e=>{Espo.Ui.success(this.translate("Done")),this.model.set(e);for(const t in e)this.setInitialAttributeValue(t,e[t]);this.getPreferences().set(this.model.getClonedAttributes()),this.getPreferences().trigger("update")})})}exit(e){if("cancel"===e){let e="#User/view/"+this.model.id;this.getAcl().checkModel(this.getUser())||(e="#"),this.getRouter().navigate(e,{trigger:!0})}}handleShortcutKeyCtrlS(e){this.handleShortcutKeyCtrlEnter(e)}}e.default=i}),define("views/preferences/fields/week-start",["exports","views/fields/enum-int"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Espo.Utils.clone(this.params.options),this.params.options.unshift(-1),this.translatedOptions={};const e=this.getLanguage().get("Global","lists","dayNames")||[];e.forEach((e,t)=>this.translatedOptions[t]=e);var t=this.getConfig().get("weekStart");this.translatedOptions[-1]=`${this.translate("Default")} (${e[t]})`}}e.default=i}),define("views/preferences/fields/time-zone",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Espo.Utils.clone(this.getHelper().getAppParam("timeZoneList"))||[],this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=`${this.translate("Default")} (${this.getConfig().get("timeZone")})`}}e.default=i}),define("views/preferences/fields/time-format",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","dateTime","timeFormatList"])||[]),this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=`${this.translate("Default")} (${this.getConfig().get("timeFormat")})`}}e.default=i}),define("views/preferences/fields/theme",["exports","views/settings/fields/theme"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Object.keys(this.getMetadata().get("themes")||{}).sort((e,t)=>"EspoRtl"===t?-1:this.translate(e,"themes").localeCompare(this.translate(t,"themes"))),this.params.options.unshift("")}setupTranslation(){super.setupTranslation(),this.translatedOptions=this.translatedOptions||{};var e=this.getConfig().get("theme"),e=this.translatedOptions[e]||e;this.translatedOptions[""]=this.translate("Default")+` (${e})`}afterRenderDetail(){var e=this.getNavbarValue()||this.getDefaultNavbar();e&&this.$el.append(" ").append($("<span>").addClass("text-muted chevron-right")).append(" ").append($("<span>").text(this.translate(e,"themeNavbars")))}}e.default=i}),define("views/preferences/fields/tab-list",["exports","views/settings/fields/tab-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.params.options=this.params.options.filter(e=>{if("_delimiter_"===e||"Home"===e)return!0;var t=this.getMetadata().get(["scopes",e]);if(t&&!t.disabled)return t.acl?this.getAcl().check(e):!t.tabAclPermission||(e=this.getAcl().getPermissionLevel(t.tabAclPermission))&&"no"!==e})}}e.default=i}),define("views/preferences/fields/signature",["exports","views/fields/wysiwyg"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{fetchEmptyValueAsNull=!0;setupToolbar(){super.setupToolbar();var e=this.getConfig().get("wysiwygCodeEditorDisabled")?"codeview":"aceCodeview";this.toolbar=[["style",["bold","italic","underline","clear"]],["color",["color"]],["height",["height"]],["table",["espoLink"]],["misc",[e,"fullscreen"]]]}}e.default=i}),define("views/preferences/fields/language",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","language","list"])||[]).sort((e,t)=>this.getLanguage().translateOption(e,"language").localeCompare(this.getLanguage().translateOption(t,"language"))),this.params.options.unshift(""),this.translatedOptions=Espo.Utils.clone(this.getLanguage().translate("language","options")||{});var e=this.translatedOptions[this.getConfig().get("language")]||this.getConfig().get("language");this.translatedOptions[""]=this.translate("Default")+` (${e})`}}e.default=i}),define("views/preferences/fields/default-currency",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Espo.Utils.clone(this.getConfig().get("currencyList")||[]),this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=`${this.translate("Default")} (${this.getConfig().get("defaultCurrency")})`}}e.default=i}),define("views/preferences/fields/date-format",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){this.params.options=Espo.Utils.clone(this.getMetadata().get(["app","dateTime","dateFormatList"])||[]),this.params.options.unshift(""),this.translatedOptions=this.translatedOptions||{},this.translatedOptions[""]=`${this.translate("Default")} (${this.getConfig().get("dateFormat")})`}}e.default=i}),define("views/preferences/fields/dashboard-tab-list",["exports","views/fields/array"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{maxItemLength=36;setup(){super.setup(),this.translatedOptions={};const e=this.model.get(this.name)||[];e.forEach(e=>{this.translatedOptions[e]=e}),this.validations.push("uniqueLabel")}getItemHtml(e){e=e.toString();var t=this.translatedOptions[e]||e;return $("<div>").addClass("list-group-item link-with-role form-inline").attr("data-value",e).append($("<div>").addClass("pull-left").css("width","92%").css("display","inline-block").append($("<input>").attr("maxLength",this.maxItemLength).attr("data-name","translatedValue").attr("data-value",e).addClass("role form-control input-sm").attr("value",t).css("width","65%"))).append($("<div>").css("width","8%").css("display","inline-block").css("vertical-align","top").append($("<a>").attr("role","button").attr("tabindex","0").addClass("pull-right").attr("data-value",e).attr("data-action","removeValue").append($("<span>").addClass("fas fa-times")))).append($("<br>").css("clear","both")).get(0).outerHTML}validateUniqueLabel(){var e=this.model.get(this.name)||[],t=this.model.get("translatedOptions")||{};const s=[];for(const a of e){var i=t[a];if(!i)return!0;if(-1!==s.indexOf(i))return!0;s.push(i)}return!1}fetch(){const s=super.fetch();return s.translatedOptions={},(s[this.name]||[]).forEach(e=>{var t=e.replace(/"/g,'\\"');s.translatedOptions[e]=this.$el.find(`input[data-name="translatedValue"][data-value="${t}"]`).val()||e}),s}}e.default=i}),define("views/preferences/fields/calendar-slot-duration",["exports","views/fields/enum-int"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.translatedOptions={},this.translatedOptions[""]=this.translate("Default")}}e.default=i}),define("views/preferences/fields/calendar-scroll-hour",["exports","views/fields/enum-int","moment"],function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),a=s(a);class i extends t.default{setupOptions(){super.setupOptions(),this.translatedOptions={},this.translatedOptions[""]=this.translate("Default");const s=this.getDateTime().getTimeFormat(),i=this.getDateTime().getToday();this.params.options.forEach(e=>{var t;""!==e&&(t=i+" "+e.toString().padStart(2,"0")+":00",this.translatedOptions[e]=a.default.utc(t).format(s))})}}e.default=i}),define("views/preferences/fields/auto-follow-entity-type-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){this.params.options=Object.keys(this.getMetadata().get("scopes")).filter(e=>{if(!this.getMetadata().get(`scopes.${e}.disabled`))return this.getMetadata().get(`scopes.${e}.entity`)&&this.getMetadata().get(`scopes.${e}.stream`)}).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),super.setup()}}e.default=i}),define("views/preferences/fields/assignment-notifications-ignore-entity-type-list",["exports","views/fields/checklist"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{isInversed=!0;setupOptions(){this.params.options=Espo.Utils.clone(this.getConfig().get("assignmentNotificationsEntityList"))||[]}}e.default=i}),define("views/preferences/fields/assignment-email-notifications-ignore-entity-type-list",["exports","views/fields/checklist"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{isInversed=!0;setupOptions(){this.params.options=Espo.Utils.clone(this.getConfig().get("assignmentEmailNotificationsEntityList"))||[]}}e.default=i}),define("views/portal-user/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{defaultOrderBy="createdAt";defaultOrder="desc";actionCreate(){this.createView("modal","crm:views/contact/modals/select-for-portal-user",{scope:"Contact",primaryFilterName:"notPortalUsers",createButton:!1,mandatorySelectAttributeList:["salutationName","firstName","lastName","accountName","accountId","emailAddress","emailAddressData","phoneNumber","phoneNumberData"]},e=>{e.render(),this.listenToOnce(e,"select",e=>{const t={};if(t.contactId=e.id,t.contactName=e.get("name"),e.get("accountId")){const i={};i[e.get("accountId")]=e.get("accountName"),t.accountsIds=[e.get("accountId")],t.accountsNames=i}t.firstName=e.get("firstName"),t.lastName=e.get("lastName"),t.salutationName=e.get("salutationName"),t.emailAddress=e.get("emailAddress"),t.emailAddressData=e.get("emailAddressData"),t.phoneNumber=e.get("phoneNumber"),t.phoneNumberData=e.get("phoneNumberData"),t.userName=t.emailAddress,t.userName&&(t.userName=t.userName.toLowerCase()),t.type="portal";const s=this.getRouter();e=`#${this.scope}/create`;s.dispatch(this.scope,"create",{attributes:t}),s.navigate(e,{trigger:!1})}),this.listenToOnce(e,"skip",()=>{const e=this.getRouter();var t=`#${this.scope}/create`;e.dispatch(this.scope,"create",{attributes:{type:"portal"}}),e.navigate(t,{trigger:!1})})})}}e.default=i}),define("views/portal/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{massActionList=["remove"]}e.default=i}),define("views/portal/fields/tab-list",["exports","views/settings/fields/tab-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{noGroups=!0;setupOptions(){super.setupOptions(),this.params.options=this.params.options.filter(e=>"_delimiter_"===e||!!this.getMetadata().get(`scopes.${e}.aclPortal`))}}e.default=i}),define("views/portal/fields/quick-create-list",["exports","views/settings/fields/quick-create-list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.params.options=this.params.options.filter(e=>!!this.getMetadata().get(`scopes.${e}.aclPortal`))}}e.default=i}),define("views/portal/fields/custom-id",["exports","views/fields/varchar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.listenTo(this,"change",()=>{let e=this.model.get("customId");e&&""!==e&&(e=e.replace(/ /i,"-").toLowerCase(),e=encodeURIComponent(e),this.model.set("customId",e))})}}e.default=i}),define("views/personal-data/record/record",["exports","views/record/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="personal-data/record/record";additionalEvents={"click .checkbox":function(e){var t=$(e.currentTarget).data("name");e.currentTarget.checked?(~this.checkedFieldList.indexOf(t)||this.checkedFieldList.push(t),this.checkedFieldList.length===this.fieldList.length?this.$el.find(".checkbox-all").prop("checked",!0):this.$el.find(".checkbox-all").prop("checked",!1)):(~(e=this.checkedFieldList.indexOf(t))&&this.checkedFieldList.splice(e,1),this.$el.find(".checkbox-all").prop("checked",!1)),this.trigger("check",this.checkedFieldList)},"click .checkbox-all":function(e){e.currentTarget.checked?(this.checkedFieldList=Espo.Utils.clone(this.fieldList),this.$el.find(".checkbox").prop("checked",!0)):(this.checkedFieldList=[],this.$el.find(".checkbox").prop("checked",!1)),this.trigger("check",this.checkedFieldList)}};checkedFieldList;data(){const e={};return e.fieldDataList=this.getFieldDataList(),e.scope=this.scope,e.editAccess=this.editAccess,e}setup(){super.setup(),this.events={...this.additionalEvents,...this.events},this.scope=this.model.entityType,this.fieldList=[],this.checkedFieldList=[],this.editAccess=this.getAcl().check(this.model,"edit");const a=this.getMetadata().get(["entityDefs",this.scope,"fields"])||{},e=[];for(const t in a)a[t].isPersonalData&&e.push(t);e.forEach(e=>{var t=a[e].type;const s=this.getFieldManager().getActualAttributeList(t,e);let i=!1;s.forEach(e=>{e=this.model.get(e);e&&("[object Array]"===Object.prototype.toString.call(e)&&e.length||(i=!0))});t=!this.getAcl().getScopeForbiddenFieldList(this.scope).includes(e);i&&t&&this.fieldList.push(e)}),this.fieldList=this.fieldList.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.fieldList.forEach(e=>{this.createField(e,null,null,"detail",!0)})}getFieldDataList(){const t=this.getAcl().getScopeForbiddenFieldList(this.scope,"edit"),s=[];return this.fieldList.forEach(e=>{s.push({name:e,key:e+"Field",editAccess:this.editAccess&&!~t.indexOf(e)})}),s}}e.default=i}),define("views/personal-data/modals/personal-data",["exports","views/modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="personal-data/modals/personal-data";className="dialog dialog-record";backdrop=!0;setup(){super.setup(),this.buttonList=[{name:"cancel",label:"Close"}],this.headerText=this.getLanguage().translate("Personal Data"),this.headerText+=": "+this.model.get("name"),this.getAcl().check(this.model,"edit")&&this.buttonList.unshift({name:"erase",label:"Erase",style:"danger",disabled:!0,onClick:()=>this.actionErase()}),this.fieldList=[],this.scope=this.model.entityType,this.createView("record","views/personal-data/record/record",{selector:".record",model:this.model},e=>{this.listenTo(e,"check",e=>{(this.fieldList=e).length?this.enableButton("erase"):this.disableButton("erase")}),e.fieldList.length||this.disableButton("export")})}actionErase(){this.confirm({message:this.translate("erasePersonalDataConfirmation","messages"),confirmText:this.translate("Erase")},()=>{this.disableButton("erase"),Espo.Ajax.postRequest("DataPrivacy/action/erase",{fieldList:this.fieldList,entityType:this.scope,id:this.model.id}).then(()=>{Espo.Ui.success(this.translate("Done")),this.trigger("erase")}).catch(()=>{this.enableButton("erase")})})}}e.default=i}),define("views/outbound-email/modals/test-send",["exports","views/modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{cssName="test-send";templateContent=`
        <label class="control-label">{{translate 'Email Address' scope='Email'}}</label>
        <input type="text" name="emailAddress" value="{{emailAddress}}" class="form-control">
    `;data(){return{emailAddress:this.options.emailAddress}}setup(){this.buttonList=[{name:"send",text:this.translate("Send","labels","Email"),style:"primary",onClick:()=>{var e=this.$el.find("input").val();""!==e&&this.trigger("send",e)}},{name:"cancel",label:"Cancel",onClick:e=>{e.close()}}]}}e.default=i}),define("views/notification/record/list",["exports","views/record/list-expanded"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.listenTo(this.collection,"sync",(e,t,s)=>{if(s.fetchNew){s=s.lengthBeforeFetch||0;if(0!==s){const a=this.$el.find(this.listContainerEl);for(let e=this.collection.length-s-1;0<=e;e--){var i=this.collection.at(e);a.prepend($(this.getRowContainerHtml(i.id))),this.buildRow(e,i,e=>{e.render()})}}else this.reRender()}}),this.events["auxclick a[href][data-scope][data-id]"]=e=>{if(1===e.button&&(e.ctrlKey||e.metaKey)){const i=$(e.currentTarget);var t=i.attr("data-id"),s=i.attr("data-scope");e.preventDefault(),e.stopPropagation(),this.actionQuickView({id:t,scope:s})}}}showNewRecords(){return this.collection.fetchNew()}}e.default=i}),define("views/notification/items/system",["exports","views/notification/items/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="notification/items/system";data(){return{...super.data(),message:this.model.get("message")}}setup(){var e=this.model.get("data")||{};this.userId=e.userId}}e.default=i}),define("views/notification/items/message",["exports","views/notification/items/base","marked","dompurify"],function(e,t,s,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i);class o extends t.default{template="notification/items/message";data(){return{...super.data(),style:this.style}}setup(){var e=this.model.get("data")||{},t=this.model.get("message")||e.message||"",t=s.marked.parse(t);this.messageTemplate=i.default.sanitize(t,{}).toString(),this.userId=e.userId,this.style=e.style||"text-muted",this.messageData.entityType=this.translateEntityType(e.entityType),this.messageData.user=$("<a>").attr("href","#User/view/"+e.userId).attr("data-id",e.userId).attr("data-scope","User").text(e.userName),this.messageData.entity=$("<a>").attr("href","#"+e.entityType+"/view/"+e.entityId).attr("data-id",e.entityId).attr("data-scope",e.entityType).text(e.entityName),this.createMessage()}}e.default=o}),define("views/notification/items/entity-removed",["exports","views/notification/items/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{messageName="entityRemoved";template="notification/items/entity-removed";setup(){var e=this.model.get("data")||{};this.userId=e.userId,this.messageData.entityType=this.translateEntityType(e.entityType),this.messageData.user=$("<a>").attr("href","#User/view/"+e.userId).attr("data-id",e.userId).attr("data-scope","User").text(e.userName),this.messageData.entity=$("<a>").attr("href","#"+e.entityType+"/view/"+e.entityId).attr("data-id",e.entityId).attr("data-scope",e.entityType).text(e.entityName),this.createMessage()}}e.default=i}),define("views/notification/items/email-received",["exports","views/notification/items/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{messageName="emailReceived";template="notification/items/email-received";data(){return{...super.data(),emailId:this.emailId,emailName:this.emailName}}setup(){var e,t=this.model.get("data")||{};this.userId=t.userId,this.messageData.entityType=this.translateEntityType(t.entityType),t.personEntityId?this.messageData.from=$("<a>").attr("href","#"+t.personEntityType+"/view/"+t.personEntityId).attr("data-id",t.personEntityId).attr("data-scope",t.personEntityType).text(t.personEntityName):(e=t.fromString||this.translate("empty address"),this.messageData.from=$("<span>").text(e)),this.emailId=t.emailId,this.emailName=t.emailName,this.createMessage()}}e.default=i}),define("views/notification/items/assign",["exports","views/notification/items/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{messageName="assign";template="notification/items/assign";setup(){var e=this.model.get("data")||{};this.userId=e.userId,this.messageData.entityType=this.translateEntityType(e.entityType),this.messageData.entity=$("<a>").attr("href","#"+e.entityType+"/view/"+e.entityId).attr("data-id",e.entityId).attr("data-scope",e.entityType).text(e.entityName),this.messageData.user=$("<a>").attr("href","#User/view/"+e.userId).attr("data-id",e.userId).attr("data-scope","User").text(e.userName),this.createMessage()}}e.default=i}),define("views/notification/fields/read",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{type="read";listTemplate="notification/fields/read";detailTemplate="notification/fields/read";data(){return{isRead:this.model.get("read")}}}e.default=i}),define("views/notification/fields/read-with-menu",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{type="read";listTemplate="notification/fields/read-with-menu";detailTemplate="notification/fields/read-with-menu";data(){return{isRead:this.model.get("read")}}}e.default=i}),define("views/notification/fields/container",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{type="notification";listTemplate="notification/fields/container";detailTemplate="notification/fields/container";types=["Assign","EmailReceived","EntityRemoved","Message","System"];setup(){switch(this.model.get("type")){case"Note":this.processNote(this.model.get("noteData"));break;case"MentionInPost":this.processMentionInPost(this.model.get("noteData"));break;default:this.process()}}process(){let t=this.model.get("type");if(t){t=Espo.Utils.upperCaseFirst(t.replace(/ /g,""));let e=this.getMetadata().get("clientDefs.Notification.itemViews."+t);if(!e){if(!this.types.includes(t))return;e="views/notification/items/"+Espo.Utils.camelCaseToHyphen(t)}this.createView("notification",e,{model:this.model,fullSelector:this.options.containerSelector+' li[data-id="'+this.model.id+'"]'})}}processNote(s){s&&(this.wait(!0),this.getModelFactory().create("Note",e=>{e.set(s);let t=this.getMetadata().get("clientDefs.Note.itemViews."+s.type);t=t||"views/stream/notes/"+Espo.Utils.camelCaseToHyphen(s.type),this.createView("notification",t,{model:e,isUserStream:!0,fullSelector:`${this.options.containerSelector} li[data-id="${this.model.id}"] .cell[data-name="data"]`,onlyContent:!0,isNotification:!0}),this.wait(!1)}))}processMentionInPost(t){t&&(this.wait(!0),this.getModelFactory().create("Note",e=>{e.set(t);this.createView("notification","views/stream/notes/mention-in-post",{model:e,userId:this.model.get("userId"),isUserStream:!0,fullSelector:this.options.containerSelector+' li[data-id="'+this.model.id+'"]',onlyContent:!0,isNotification:!0}),this.wait(!1)}))}}e.default=i}),define("views/last-viewed/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{searchPanel=!1;createButton=!1;setup(){super.setup(),this.collection.url="LastViewed"}}e.default=i}),define("views/last-viewed/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{layoutName="listForLastViewed";rowActionsDisabled=!0;massActionsDisabled=!0;headerDisabled=!0}e.default=i}),define("views/import-error/fields/validation-failures",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{detailTemplateContent=`
        {{#if itemList.length}}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th style="width: 50%;">{{translate 'Field'}}</th>
                    <th>{{translateOption 'Validation' scope='ImportError' field='type'}}</th>
                </tr>
            </thead>
            <tbody>
                {{#each itemList}}
                <tr>
                    <td>{{translate field category='fields' scope=entityType}}</td>
                    <td>
                        {{translate type category='fieldValidations'}}
                        {{#if popoverText}}
                        <a
                            role="button"
                            tabindex="-1"
                            class="text-danger popover-anchor"
                            data-text="{{popoverText}}"
                        ><span class="fas fa-info-circle"></span></a>
                        {{/if}}
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>
        {{else}}
        <span class="none-value">{{translate 'None'}}</span>
        {{/if}}
    `;data(){const e=super.data();return e.itemList=this.getDataList(),e}afterRenderDetail(){this.$el.find(".popover-anchor").each((e,t)=>{var s=this.getHelper().transformMarkdownText(t.dataset.text).toString();Espo.Ui.popover($(t),{content:s},this)})}getDataList(){const e=Espo.Utils.cloneDeep(this.model.get(this.name))||[],a=this.model.get("entityType");return Array.isArray(e)&&e.forEach(e=>{const t=this.getFieldManager(),s=this.getLanguage();var i=t.getEntityTypeFieldParam(a,e.field,"type");if(i)return i=i+"_"+e.type,s.has(i,"fieldValidationExplanations","Global")?void(e.popoverText=s.translate(i,"fieldValidationExplanations")):s.has(e.type,"fieldValidationExplanations","Global")?void(e.popoverText=s.translate(e.type,"fieldValidationExplanations")):void 0}),e}}e.default=i}),define("views/import-error/fields/line-number",["exports","views/fields/int"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{disableFormatting=!0;data(){const e=super.data();return e.valueIsSet=this.model.has(this.sourceName),e.isNotEmpty=this.model.has(this.sourceName),e}setup(){super.setup(),this.sourceName="exportLineNumber"===this.name?"exportRowIndex":"rowIndex"}getAttributeList(){return[this.sourceName]}getValueForDisplay(){var e=this.model.get(this.sourceName);return this.formatNumber(++e)}}e.default=i}),define("views/import/step2",["exports","view"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="import/step-2";allowedFieldList=["createdAt","createdBy"];events={'click button[data-action="back"]':function(){this.back()},'click button[data-action="next"]':function(){this.next()},'click a[data-action="addField"]':function(e){e=$(e.currentTarget).data("name");this.addField(e)},'click a[data-action="removeField"]':function(e){var e=$(e.currentTarget).data("name"),t=(this.$el.find('a[data-action="addField"]').parent().removeClass("hidden"),this.additionalFields.indexOf(e));~t&&this.additionalFields.splice(t,1),this.$el.find('.field[data-name="'+e+'"]').parent().remove()},"keyup input.add-field-quick-search-input":function(e){this.processFieldFilterQuickSearch(e.currentTarget.value)}};data(){return{scope:this.scope,fieldList:this.getFieldList()}}setup(){this.formData=this.options.formData,this.scope=this.formData.entityType;const i=[];if(this.additionalFields=[],this.formData.previewArray){let e=0;this.formData.headerRow&&(e=1),this.formData.previewArray.length>e&&this.formData.previewArray[e].forEach((e,t)=>{const s={value:e};this.formData.headerRow&&(s.name=this.formData.previewArray[0][t]),i.push(s)})}this.wait(!0),this.getModelFactory().create(this.scope,e=>{this.model=e,this.formData.defaultValues&&this.model.set(this.formData.defaultValues),this.wait(!1)}),this.mapping=i,this.fieldList=this.getFieldList(),this.fieldTranslations=this.fieldList.reduce((e,t)=>(e[t]=this.translate(t,"fields",this.scope),e),{})}afterRender(){const e=$("#mapping-container");var t=$("<table>").addClass("table").addClass("table-bordered").css("table-layout","fixed");const d=$("<tbody>").appendTo(t);let n=$("<tr>");if(this.formData.headerRow){const r=$("<th>").attr("width","25%").text(this.translate("Header Row Value","labels","Import"));n.append(r)}let r=$("<th>").attr("width","25%").text(this.translate("Field","labels","Import"));n.append(r),r=$("<th>").text(this.translate("First Row Value","labels","Import")),n.append(r),~["update","createAndUpdate"].indexOf(this.formData.action)&&(r=$("<th>").text(this.translate("Update by","labels","Import")),n.append(r)),d.append(n),this.mapping.forEach((e,t)=>{n=$("<tr>"),this.formData.headerRow&&(r=$("<td>").text(e.name),n.append(r));let s=e.name;this.formData.attributeList&&(s=this.formData.attributeList[t]||null);var i=this.getFieldDropdown(t,s);r=$("<td>").append(i),n.append(r);let a=e.value||"";if(200<a.length&&(a=a.substring(0,200)+"..."),r=$("<td>").css("overflow","hidden").text(a),n.append(r),~["update","createAndUpdate"].indexOf(this.formData.action)){const o=$("<input>").attr("type","checkbox").addClass("form-checkbox").attr("id","update-by-"+t.toString()),l=o.get(0);this.formData.updateBy?~this.formData.updateBy.indexOf(t)&&(l.checked=!0):"id"===e.name&&(l.checked=!0),r=$("<td>").append(l),n.append(r)}d.append(n)}),e.empty(),e.append(t),this.getDefaultFieldList().forEach(e=>{this.addField(e)}),this.$addFieldButton=this.$el.find("button.add-field"),this.$defaultFieldList=this.$el.find("ul.default-field-list"),this.$fieldQuickSearch=this.$el.find("input.add-field-quick-search-input"),this.initQuickSearchUi()}resetFieldFilterQuickSearch(){this.$fieldQuickSearch.val(""),this.$defaultFieldList.find("li.item").removeClass("hidden")}initQuickSearchUi(){this.$addFieldButton.parent().on("show.bs.dropdown",()=>{setTimeout(()=>{this.$fieldQuickSearch.focus();var e=this.$fieldQuickSearch.outerWidth();this.$fieldQuickSearch.css("minWidth",e)},1)}),this.$addFieldButton.parent().on("hide.bs.dropdown",()=>{this.resetFieldFilterQuickSearch(),this.$fieldQuickSearch.css("minWidth","")})}processFieldFilterQuickSearch(a){a=(a=a.trim()).toLowerCase(),console.log(a);const o=this.$defaultFieldList.find("li.item");""!==a?(o.addClass("hidden"),this.fieldList.forEach(e=>{let t=this.fieldTranslations[e]||e;const s=(t=t.toLowerCase()).split(" ");let i=0===t.indexOf(a);(i=i||0<s.filter(e=>3<e.length&&0===e.indexOf(a)).length)&&o.filter(`[data-name="${e}"]`).removeClass("hidden")})):o.removeClass("hidden")}getDefaultFieldList(){if(this.formData.defaultFieldList)return this.formData.defaultFieldList;if(!this.formData.defaultValues)return[];const s=Object.keys(this.formData.defaultValues);return this.getFieldManager().getEntityTypeFieldList(this.scope).filter(e=>{const t=this.getFieldManager().getEntityTypeFieldActualAttributeList(this.scope,e);return-1!==t.findIndex(e=>s.includes(e))})}getFieldList(){var e,t=this.getMetadata().get("entityDefs."+this.scope+".fields");const s=this.getAcl().getScopeForbiddenFieldList(this.scope,"edit");let i=[];for(const a in t)~s.indexOf(a)||(e=t[a],!~this.allowedFieldList.indexOf(a)&&(e.disabled||e.importDisabled)||i.push(a));return i=i.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope)))}getAttributeList(){var e=this.getMetadata().get(["entityDefs",this.scope,"fields"])||{};const t=this.getAcl().getScopeForbiddenFieldList(this.scope,"edit");let s=[];s.push("id");for(const a in e)if(!~t.indexOf(a)){var i=e[a];if(this.allowedFieldList.includes(a)||!(i.disabled&&!i.importNotDisabled||i.importDisabled))if("phone"!==i.type){if("email"===i.type&&(s.push(a+"2"),s.push(a+"3"),s.push(a+"4")),"link"===i.type&&(s.push(a+"Name"),s.push(a+"Id")),"foreign"!==i.type||i.relateOnImport){"personName"===i.type&&s.push(a);i=i.type;let e=this.getFieldManager().getActualAttributeList(i,a);(e=e.length?e:[a]).forEach(e=>{-1===s.indexOf(e)&&s.push(e)})}}else s.push(a),(this.getMetadata().get(`entityDefs.${this.scope}.fields.${a}.typeList`)||[]).map(e=>e.replace(/\s/g,"_")).forEach(e=>{s.push(a+Espo.Utils.upperCaseFirst(e))})}return s=s.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope)))}getFieldDropdown(e,a){a=a||!1;const t=this.getAttributeList(),o=$("<select>").addClass("form-control").attr("id","column-"+e.toString());let l=$("<option>").val("").text("-"+this.translate("Skip","labels","Import")+"-");const d=this.formData.entityType;return o.append(l),t.forEach(e=>{let t="";if(this.getLanguage().has(e,"fields",d)||this.getLanguage().has(e,"fields","Global"))t=this.translate(e,"fields",d);else if(e.indexOf("Id")===e.length-2){var s=e.substr(0,e.length-2);this.getMetadata().get(["entityDefs",d,"fields",s])&&(t=this.translate(s,"fields",d)+" ("+this.translate("id","fields")+")")}else if(e.indexOf("Name")===e.length-4){s=e.substr(0,e.length-4);this.getMetadata().get(["entityDefs",d,"fields",s])&&(t=this.translate(s,"fields",d)+" ("+this.translate("name","fields")+")")}else if(e.indexOf("Type")===e.length-4){s=e.substr(0,e.length-4);this.getMetadata().get(["entityDefs",d,"fields",s])&&(t=this.translate(s,"fields",d)+" ("+this.translate("type","fields")+")")}else if(0===e.indexOf("phoneNumber")){s=e.substr(11),s=this.getLanguage().translateOption(s,"phoneNumber",d);t=this.translate("phoneNumber","fields",d)+" ("+s+")"}else if(0===e.indexOf("emailAddress")&&parseInt(e.substr(12)).toString()===e.substr(12)){const i=e.substr(12);t=this.translate("emailAddress","fields",d)+" "+i.toString()}else e.indexOf("Ids")===e.length-3&&(s=e.substr(0,e.length-3),this.getMetadata().get(["entityDefs",d,"fields",s])&&(t=this.translate(s,"fields",d)+" ("+this.translate("ids","fields")+")"));t=t||e,l=$("<option>").val(e).text(t),!a||e!==a&&a.toLowerCase().replace(/_/g,"")!==e.toLowerCase()||l.prop("selected",!0),o.append(l)}),o}addField(t){this.$el.find('[data-action="addField"][data-name="'+t+'"]').parent().addClass("hidden"),$(this.containerSelector+' button[data-name="update"]').removeClass("disabled"),Espo.Ui.notify(" ... ");var e=this.translate(t,"fields",this.scope),e=this.getHelper().escapeString(e),e='<div class="cell form-group">'+('<a role="button" class="pull-right" data-action="removeField" data-name="'+t+'"><span class="fas fa-times"></span></a>')+'<label class="control-label">'+e+'</label><div class="field" data-name="'+t+'"/></div>',e=($("#default-values-container").append(e),Espo.Utils.upperCaseFirst(this.model.getFieldParam(t,"type"))),e=this.getMetadata().get(["entityDefs",this.scope,"fields",t,"view"])||this.getFieldManager().getViewName(e);this.createView(t,e,{model:this.model,fullSelector:this.getSelector()+' .field[data-name="'+t+'"]',defs:{name:t},mode:"edit",readOnlyDisabled:!0},e=>{this.additionalFields.push(t),e.render(),e.notify(!1)}),this.resetFieldFilterQuickSearch()}disableButtons(){this.$el.find('button[data-action="next"]').addClass("disabled").attr("disabled","disabled"),this.$el.find('button[data-action="back"]').addClass("disabled").attr("disabled","disabled")}enableButtons(){this.$el.find('button[data-action="next"]').removeClass("disabled").removeAttr("disabled"),this.$el.find('button[data-action="back"]').removeClass("disabled").removeAttr("disabled")}getFieldView(e){return this.getView(e)}fetch(e){const s={};this.additionalFields.forEach(e=>{const t=this.getFieldView(e);_.extend(s,t.fetch())}),this.model.set(s);let i=!1;if(this.additionalFields.forEach(e=>{const t=this.getFieldView(e);i=t.validate()||i}),i||(this.formData.defaultValues=s),i&&!e)return!1;this.formData.defaultFieldList=Espo.Utils.clone(this.additionalFields);const a=[];if(this.mapping.forEach((e,t)=>{a.push($("#column-"+t).val())}),this.formData.attributeList=a,~["update","createAndUpdate"].indexOf(this.formData.action)){const o=[];this.mapping.forEach((e,t)=>{$("#update-by-"+t).get(0).checked&&o.push(t)}),this.formData.updateBy=o}return this.getParentIndexView().formData=this.formData,this.getParentIndexView().trigger("change"),!0}getParentIndexView(){return this.getParentView()}back(){this.fetch(!0),this.getParentIndexView().changeStep(1)}next(){this.fetch()&&(this.disableButtons(),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Import/file",null,{timeout:0,contentType:"text/csv",data:this.getParentIndexView().fileContents}).then(e=>{e.attachmentId?this.runImport(e.attachmentId):Espo.Ui.error(this.translate("Bad response"))}))}runImport(e){this.formData.attachmentId=e,this.getRouter().confirmLeaveOut=!1,Espo.Ui.notify(this.translate("importRunning","messages","Import")),Espo.Ajax.postRequest("Import",this.formData,{timeout:0}).then(e=>{const t=e.id;return this.getParentIndexView().trigger("done"),t?(this.formData.manualMode?this.createView("dialog","views/modal",{templateContent:"{{complexText viewObject.options.msg}}",headerText:" ",backdrop:"static",msg:this.translate("commandToRun","strings","Import")+":\n\n```php command.php import --id="+t+"```",buttonList:[{name:"close",label:this.translate("Close")}]},e=>{e.render(),this.listenToOnce(e,"close",()=>{this.getRouter().navigate("#Import/view/"+t,{trigger:!0})})}):this.getRouter().navigate("#Import/view/"+t,{trigger:!0}),void Espo.Ui.notify(!1)):(Espo.Ui.error(this.translate("Error"),!0),void this.enableButtons())}).catch(()=>this.enableButtons())}}e.default=i}),define("views/import/step1",["exports","view","model","intl-tel-input-globals"],function(e,t,c,u){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),c=s(c),u=s(u);class i extends t.default{template="import/step-1";events={"change #import-file":function(e){e=e.currentTarget.files;e.length&&this.loadFile(e[0])},'click button[data-action="next"]':function(){this.next()},'click button[data-action="saveAsDefault"]':function(){this.saveAsDefault()}};getEntityList(){const e=[];var t=this.getMetadata().get("scopes");for(const s in t)t[s].importable&&this.getAcl().checkScope(s,"create")&&e.push(s);return e.sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),e}data(){return{entityList:this.getEntityList()}}setup(){this.attributeList=["entityType","action"],this.paramList=["headerRow","decimalMark","personNameFormat","delimiter","dateFormat","timeFormat","currency","timezone","textQualifier","silentMode","idleMode","skipDuplicateChecking","manualMode","phoneNumberCountry"],this.paramList.forEach(e=>{this.attributeList.push(e)}),this.formData=this.options.formData||{entityType:this.options.entityType||null,create:"create",headerRow:!0,delimiter:",",textQualifier:'"',dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss",currency:this.getConfig().get("defaultCurrency"),timezone:"UTC",decimalMark:".",personNameFormat:"f l",idleMode:!1,skipDuplicateChecking:!1,silentMode:!0,manualMode:!1};var e=Espo.Utils.cloneDeep((this.getPreferences().get("importParams")||{}).default||{});if(!this.options.formData)for(const r in e)this.formData[r]=e[r];const t=this.model=new c.default,s=(this.attributeList.forEach(e=>{t.set(e,this.formData[e])}),this.attributeList.forEach(i=>{this.listenTo(t,"change:"+i,(e,t,s)=>{s.ui&&(this.formData[i]=this.model.get(i),this.preview())})}),["f l","l f","l, f"]),i=this.getConfig().get("personNameFormat")||"firstLast",a=(~i.toString().toLowerCase().indexOf("middle")&&(s.push("f m l"),s.push("l f m")),this.getDateFormatDataList()),h=this.getTimeFormatDataList(),o=[],l={},d=(a.forEach(e=>{o.push(e.key),l[e.key]=e.label}),[]),n={};h.forEach(e=>{d.push(e.key),n[e.key]=e.label}),this.createView("actionField","views/fields/enum",{selector:'.field[data-name="action"]',model:this.model,name:"action",mode:"edit",params:{options:["create","createAndUpdate","update"],translatedOptions:{create:this.translate("Create Only","labels","Import"),createAndUpdate:this.translate("Create and Update","labels","Import"),update:this.translate("Update Only","labels","Import")}}}),this.createView("entityTypeField","views/fields/enum",{selector:'.field[data-name="entityType"]',model:this.model,name:"entityType",mode:"edit",params:{options:[""].concat(this.getEntityList()),translation:"Global.scopeNamesPlural",required:!0},labelText:this.translate("Entity Type","labels","Import")}),this.createView("decimalMarkField","views/fields/varchar",{selector:'.field[data-name="decimalMark"]',model:this.model,name:"decimalMark",mode:"edit",params:{options:[".",","],maxLength:1,required:!0},labelText:this.translate("Decimal Mark","labels","Import")}),this.createView("personNameFormatField","views/fields/enum",{selector:'.field[data-name="personNameFormat"]',model:this.model,name:"personNameFormat",mode:"edit",params:{options:s,translation:"Import.options.personNameFormat"}}),this.createView("delimiterField","views/fields/enum",{selector:'.field[data-name="delimiter"]',model:this.model,name:"delimiter",mode:"edit",params:{options:[",",";","\\t","|"]}}),this.createView("textQualifierField","views/fields/enum",{selector:'.field[data-name="textQualifier"]',model:this.model,name:"textQualifier",mode:"edit",params:{options:['"',"'"],translatedOptions:{'"':this.translate("Double Quote","labels","Import"),"'":this.translate("Single Quote","labels","Import")}}}),this.createView("dateFormatField","views/fields/enum",{selector:'.field[data-name="dateFormat"]',model:this.model,name:"dateFormat",mode:"edit",params:{options:o,translatedOptions:l}}),this.createView("timeFormatField","views/fields/enum",{selector:'.field[data-name="timeFormat"]',model:this.model,name:"timeFormat",mode:"edit",params:{options:d,translatedOptions:n}}),this.createView("currencyField","views/fields/enum",{selector:'.field[data-name="currency"]',model:this.model,name:"currency",mode:"edit",params:{options:this.getConfig().get("currencyList")}}),this.createView("timezoneField","views/fields/enum",{selector:'.field[data-name="timezone"]',model:this.model,name:"timezone",mode:"edit",params:{options:this.getMetadata().get(["entityDefs","Settings","fields","timeZone","options"])}}),this.createView("headerRowField","views/fields/bool",{selector:'.field[data-name="headerRow"]',model:this.model,name:"headerRow",mode:"edit"}),this.createView("silentModeField","views/fields/bool",{selector:'.field[data-name="silentMode"]',model:this.model,name:"silentMode",mode:"edit",tooltip:!0,tooltipText:this.translate("silentMode","tooltips","Import")}),this.createView("idleModeField","views/fields/bool",{selector:'.field[data-name="idleMode"]',model:this.model,name:"idleMode",mode:"edit"}),this.createView("skipDuplicateCheckingField","views/fields/bool",{selector:'.field[data-name="skipDuplicateChecking"]',model:this.model,name:"skipDuplicateChecking",mode:"edit"}),this.createView("manualModeField","views/fields/bool",{selector:'.field[data-name="manualMode"]',model:this.model,name:"manualMode",mode:"edit",tooltip:!0,tooltipText:this.translate("manualMode","tooltips","Import")}),this.createView("phoneNumberCountryField","views/fields/enum",{selector:'.field[data-name="phoneNumberCountry"]',model:this.model,name:"phoneNumberCountry",mode:"edit",params:{options:["",...u.default.getCountryData().map(e=>e.iso2)]},translatedOptions:u.default.getCountryData().reduce((e,t)=>(e[t.iso2]=t.iso2.toUpperCase()+" +"+t.dialCode,e),{})}),this.listenTo(this.model,"change",(s,e)=>{if(e.ui){let t=!1;this.paramList.forEach(e=>{s.hasChanged(e)&&(t=!0)}),t&&this.showSaveAsDefaultButton()}}),this.listenTo(this.model,"change",()=>{this.isRendered()&&this.controlFieldVisibility()}),this.listenTo(this.model,"change:entityType",()=>{delete this.formData.defaultFieldList,delete this.formData.defaultValues,delete this.formData.attributeList,delete this.formData.updateBy}),this.listenTo(this.model,"change:action",()=>{delete this.formData.updateBy}),this.listenTo(this.model,"change",(e,t)=>{t.ui&&(this.getRouter().confirmLeaveOut=!0)})}afterRender(){this.setupFormData(),this.getParentIndexView()&&this.getParentIndexView().fileContents&&(this.setFileIsLoaded(),this.preview()),this.controlFieldVisibility()}getParentIndexView(){return this.getParentView()}showSaveAsDefaultButton(){this.$el.find('[data-action="saveAsDefault"]').removeClass("hidden")}hideSaveAsDefaultButton(){this.$el.find('[data-action="saveAsDefault"]').addClass("hidden")}getFieldView(e){return this.getView(e+"Field")}next(){this.attributeList.forEach(e=>{this.getFieldView(e).fetchToModel(),this.formData[e]=this.model.get(e)});let t=!1;this.attributeList.forEach(e=>{t|=this.getFieldView(e).validate()}),t?Espo.Ui.error(this.translate("Not valid")):(this.getParentIndexView().formData=this.formData,this.getParentIndexView().trigger("change"),this.getParentIndexView().changeStep(2))}setupFormData(){this.attributeList.forEach(e=>{this.model.set(e,this.formData[e])})}loadFile(t){var e=t.slice(0,524288);const s=new FileReader,i=(s.onloadend=e=>{e.target.readyState===FileReader.DONE&&(this.formData.previewString=e.target.result,this.preview())},s.readAsText(e),new FileReader);i.onloadend=e=>{e.target.readyState===FileReader.DONE&&(this.getParentIndexView().fileContents=e.target.result,this.setFileIsLoaded(),this.getRouter().confirmLeaveOut=!0,this.setFileName(t.name))},i.readAsText(t)}setFileName(e){this.$el.find(".import-file-name").text(e),this.$el.find(".import-file-info").text("")}setFileIsLoaded(){this.$el.find('button[data-action="next"]').removeClass("hidden")}preview(){if(this.formData.previewString){const t=this.csvToArray(this.formData.previewString,this.formData.delimiter,this.formData.textQualifier);this.formData.previewArray=t;var e=$("<table>").addClass("table").addClass("table-bordered");const i=$("<tbody>").appendTo(e),s=(t.forEach((e,t)=>{if(!(3<=t)){const s=$("<tr>");e.forEach(e=>{e=$("<td>").html(this.getHelper().sanitizeHtml(e));s.append(e)}),i.append(s)}}),$("#import-preview"));s.empty().append(e)}}csvToArray(e,t,s){s=s||'"',t=(t=t||",").replace(/\\t/,"\t");const i=new RegExp("(\\"+t+"|\\r?\\n|\\r|^)(?:"+s+"([^"+s+"]*(?:"+s+s+"[^"+s+"]*)*)"+s+"|([^"+s+"\\"+t+"\\r\\n]*))","gi"),a=[[]];let o=null;for(;o=i.exec(e);){var l=o[1];l.length&&l!==t&&a.push([]),l=o[2]?o[2].replace(new RegExp('""',"g"),'"'):o[3],a[a.length-1].push(l)}return a}saveAsDefault(){const e=this.getPreferences(),t=Espo.Utils.cloneDeep(e.get("importParams")||{}),s={};this.paramList.forEach(e=>{s[e]=this.model.get(e)}),t.default=s,e.save({importParams:t}).then(()=>{Espo.Ui.success(this.translate("Saved"))}),this.hideSaveAsDefaultButton()}controlFieldVisibility(){this.model.get("idleMode")?this.hideField("manualMode"):this.showField("manualMode"),this.model.get("manualMode")?this.hideField("idleMode"):this.showField("idleMode")}hideField(e){this.$el.find('.field[data-name="'+e+'"]').parent().addClass("hidden-cell")}showField(e){this.$el.find('.field[data-name="'+e+'"]').parent().removeClass("hidden-cell")}convertFormatToLabel(e){var t={YYYY:"2021",DD:"27",MM:"12",HH:"23",mm:"00",hh:"11",ss:"00",a:"pm",A:"PM"};let s=e;for(const a in t){var i=t[a];s=s.replace(new RegExp(a,"g"),i)}return e+" Â· "+s}getDateFormatDataList(){const e=this.getMetadata().get(["clientDefs","Import","dateFormatList"])||[];return e.map(e=>({key:e,label:this.convertFormatToLabel(e)}))}getTimeFormatDataList(){const e=this.getMetadata().get(["clientDefs","Import","timeFormatList"])||[];return e.map(e=>({key:e,label:this.convertFormatToLabel(e)}))}}e.default=i}),define("views/import/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{createButton=!1;setup(){super.setup(),this.menu.buttons.unshift({iconHtml:'<span class="fas fa-plus fa-sm"></span>',text:this.translate("New Import","labels","Import"),link:"#Import",acl:"edit"})}}e.default=i}),define("views/import/index",["exports","view"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="import/index";formData=null;fileContents=null;data(){return{fromAdmin:this.options.fromAdmin}}setup(){this.entityType=this.options.entityType||null,this.startFromStep=1,(this.options.formData||this.options.fileContents)&&(this.formData=this.options.formData||{},this.fileContents=this.options.fileContents||null,this.entityType=this.formData.entityType||null,this.options.step&&(this.startFromStep=this.options.step))}changeStep(e,t){1<(this.step=e)&&this.setConfirmLeaveOut(!0),this.createView("step","views/import/step"+e.toString(),{selector:"> .import-container",entityType:this.entityType,formData:this.formData,result:t},e=>{e.render()});let s="#Import";this.options.fromAdmin&&1===this.step&&(s="#Admin/import"),1<this.step&&(s+="/index/step="+this.step),this.getRouter().navigate(s,{trigger:!1})}afterRender(){this.changeStep(this.startFromStep)}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Import","labels","Admin"))}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}}e.default=i}),define("views/import/detail",["exports","views/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getHeader(){var e=this.getDateTime().toDisplay(this.model.get("createdAt"));return this.buildHeaderHtml([$("<a>").attr("href","#"+this.model.entityType+"/list").text(this.getLanguage().translate(this.model.entityType,"scopeNamesPlural")),$("<span>").text(e)])}setup(){super.setup(),this.setupMenu(),this.listenTo(this.model,"change",()=>{this.setupMenu(),this.isRendered()&&this.getView("header").reRender()}),this.listenTo(this.model,"sync",e=>{this.controlButtons(e)})}setupMenu(){this.addMenuItem("buttons",{label:"Remove Import Log",action:"removeImportLog",name:"removeImportLog",style:"default",acl:"delete",title:this.translate("removeImportLog","messages","Import")},!0),this.addMenuItem("buttons",{label:"Revert Import",name:"revert",action:"revert",style:"danger",acl:"edit",title:this.translate("revert","messages","Import"),hidden:!this.model.get("importedCount")},!0),this.addMenuItem("buttons",{label:"Remove Duplicates",name:"removeDuplicates",action:"removeDuplicates",style:"default",acl:"edit",title:this.translate("removeDuplicates","messages","Import"),hidden:!this.model.get("duplicateCount")},!0),this.addMenuItem("dropdown",{label:"New import with same params",name:"createWithSameParams",action:"createWithSameParams"})}controlButtons(e){e&&!e.hasChanged("importedCount")||(this.model.get("importedCount")?this.showHeaderActionItem("revert"):this.hideHeaderActionItem("revert")),e&&!e.hasChanged("duplicateCount")||(this.model.get("duplicateCount")?this.showHeaderActionItem("removeDuplicates"):this.hideHeaderActionItem("removeDuplicates"))}actionRemoveImportLog(){this.confirm(this.translate("confirmRemoveImportLog","messages","Import"),()=>{this.disableMenuItem("removeImportLog"),Espo.Ui.notify(this.translate("pleaseWait","messages")),this.model.destroy({wait:!0}).then(()=>{Espo.Ui.notify(!1);var e=this.model.collection;e&&0<e.total&&e.total--,this.getRouter().navigate("#Import/list",{trigger:!0}),this.removeMenuItem("removeImportLog",!0)})})}actionRevert(){this.confirm(this.translate("confirmRevert","messages","Import"),()=>{this.disableMenuItem("revert"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(`Import/${this.model.id}/revert`).then(()=>{this.getRouter().navigate("#Import/list",{trigger:!0})})})}actionRemoveDuplicates(){this.confirm(this.translate("confirmRemoveDuplicates","messages","Import"),()=>{this.disableMenuItem("removeDuplicates"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(`Import/${this.model.id}/removeDuplicates`).then(()=>{this.removeMenuItem("removeDuplicates",!0),this.model.fetch(),this.model.trigger("update-all"),Espo.Ui.success(this.translate("duplicatesRemoved","messages","Import"))})})}actionCreateWithSameParams(){let e=this.model.get("params")||{};e.entityType=this.model.get("entityType"),e.attributeList=this.model.get("attributeList")||[],e=Espo.Utils.cloneDeep(e),this.getRouter().navigate("#Import",{trigger:!1}),this.getRouter().dispatch("Import","index",{formData:e})}}e.default=i}),define("views/import/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{quickDetailDisabled=!0;quickEditDisabled=!0;checkAllResultDisabled=!0;massActionList=["remove"];rowActionsView="views/record/row-actions/remove-only"}e.default=i}),define("views/import/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{readOnly=!0;returnUrl="#Import/list";checkInterval=5;resultPanelFetchLimit=10;duplicateAction=!1;setup(){super.setup(),this.fetchCounter=0,this.setupChecking(),this.hideActionItem("delete")}setupChecking(){this.model.has("status")?~["In Process","Pending","Standby"].indexOf(this.model.get("status"))&&(setTimeout(this.runChecking.bind(this),1e3*this.checkInterval),this.on("remove",()=>{this.stopChecking=!0})):this.listenToOnce(this.model,"sync",this.setupChecking.bind(this))}runChecking(){this.stopChecking||(this.model.fetch().then(()=>{var e=!~["In Process","Pending","Standby"].indexOf(this.model.get("status"));this.fetchCounter<this.resultPanelFetchLimit&&!e&&this.fetchResultPanels(),e?this.fetchResultPanels():setTimeout(this.runChecking.bind(this),1e3*this.checkInterval)}),this.fetchCounter++)}fetchResultPanels(){const e=this.getView("bottom");if(e){const t=e.getView("imported"),s=(t&&t.collection&&t.collection.fetch(),e.getView("duplicates")),i=(s&&s.collection&&s.collection.fetch(),e.getView("updated"));i&&i.collection&&i.collection.fetch()}}}e.default=i}),define("views/import/record/row-actions/duplicates",["exports","views/record/row-actions/default"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getActionList(){const e=super.getActionList();return e.push({action:"unmarkAsDuplicate",label:"Set as Not Duplicate",data:{id:this.model.id,type:this.model.entityType}}),e}}e.default=i}),define("views/import/record/panels/updated",["exports","views/import/record/panels/imported"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{link="updated";rowActionsView="views/record/row-actions/relationship-view-and-edit";setup(){this.title=this.title||this.translate("Updated","labels","Import"),super.setup()}}e.default=i}),define("views/import/record/panels/duplicates",["exports","views/import/record/panels/imported"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{link="duplicates";setup(){this.title=this.title||this.translate("Duplicates","labels","Import"),super.setup()}actionUnmarkAsDuplicate(e){const t=e.id,s=e.type;this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest(`Import/${this.model.id}/unmarkDuplicates`,{entityId:t,entityType:s}).then(()=>{this.collection.fetch()})})}}e.default=i}),define("views/group-email-folder/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{quickCreate=!0;setup(){super.setup(),this.options.params.fromAdmin&&this.hideHeaderActionItem("emails")}}e.default=i}),define("views/group-email-folder/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{rowActionsView="views/email-folder/record/row-actions/default";async actionMoveUp(e){e=this.collection.get(e.id);e&&0!==this.collection.indexOf(e)&&(Espo.Ui.notify(" ... "),await Espo.Ajax.postRequest("GroupEmailFolder/action/moveUp",{id:e.id}),await this.collection.fetch(),Espo.Ui.notify(!1))}async actionMoveDown(e){e=this.collection.get(e.id);e&&(this.collection.indexOf(e)===this.collection.length-1&&this.collection.length===this.collection.total||(Espo.Ui.notify(" ... "),await Espo.Ajax.postRequest("GroupEmailFolder/action/moveDown",{id:e.id}),await this.collection.fetch(),Espo.Ui.notify(!1)))}}e.default=i}),define("views/group-email-folder/record/edit-small",["exports","views/record/edit"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{afterSave(){this.getBaseController().clearScopeStoredMainView("Email"),super.afterSave()}}e.default=i}),define("views/group-email-folder/record/row-actions/default",["exports","views/record/row-actions/default"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getActionList(){const e=super.getActionList();return this.options.acl.edit&&(e.unshift({action:"moveDown",label:"Move Down",data:{id:this.model.id}}),e.unshift({action:"moveUp",label:"Move Up",data:{id:this.model.id}})),e}}e.default=i}),define("views/external-account/oauth2",["exports","view","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{template="external-account/oauth2";data(){return{integration:this.integration,helpText:this.helpText,isConnected:this.isConnected}}isConnected=!1;setup(){this.addActionHandler("connect",()=>this.connect()),this.addActionHandler("save",()=>this.save()),this.addActionHandler("cancel",()=>this.getRouter().navigate("#ExternalAccount",{trigger:!0})),this.integration=this.options.integration,this.id=this.options.id,this.helpText=!1,this.getLanguage().has(this.integration,"help","ExternalAccount")&&(this.helpText=this.translate(this.integration,"help","ExternalAccount")),this.fieldList=[],this.dataFieldList=[],this.model=new s.default,this.model.id=this.id,this.model.entityType=this.model.name="ExternalAccount",this.model.urlRoot="ExternalAccount",this.model.defs={fields:{enabled:{required:!0,type:"bool"}}},this.wait(!0),this.model.populateDefaults(),this.listenToOnce(this.model,"sync",()=>{this.createFieldView("bool","enabled"),Espo.Ajax.getRequest("ExternalAccount/action/getOAuth2Info?id="+this.id).then(e=>{this.clientId=e.clientId,this.redirectUri=e.redirectUri,e.isConnected&&(this.isConnected=!0),this.wait(!1)})}),this.model.fetch()}hideField(e){this.$el.find(`label[data-name="${e}"]`).addClass("hide"),this.$el.find(`div.field[data-name="${e}"]`).addClass("hide");const t=this.getView(e);t&&(t.disabled=!0)}showField(e){this.$el.find(`label[data-name="${e}"]`).removeClass("hide"),this.$el.find(`div.field[data-name="${e}"]`).removeClass("hide");const t=this.getView(e);t&&(t.disabled=!1)}afterRender(){this.model.get("enabled")||this.$el.find(".data-panel").addClass("hidden"),this.listenTo(this.model,"change:enabled",()=>{this.model.get("enabled")?this.$el.find(".data-panel").removeClass("hidden"):this.$el.find(".data-panel").addClass("hidden")})}createFieldView(e,t,s,i){this.createView(t,this.getFieldManager().getViewName(e),{model:this.model,selector:'.field[data-name="'+t+'"]',defs:{name:t,params:i},mode:s?"detail":"edit",readOnly:s}),this.fieldList.push(t)}save(){this.fieldList.forEach(e=>{const t=this.getView(e);t.readOnly||t.fetchToModel()});let s=!1;this.fieldList.forEach(e=>{const t=this.getView(e);s=t.validate()||s}),s?Espo.Ui.error(this.translate("Not valid")):(this.listenToOnce(this.model,"sync",()=>{Espo.Ui.success(this.translate("Saved")),this.model.get("enabled")||this.setNotConnected()}),Espo.Ui.notify(this.translate("saving","messages")),this.model.save())}popup(e,t){e.windowName=e.windowName||"ConnectWithOAuth",e.windowOptions=e.windowOptions||"location=0,status=0,width=800,height=400",e.callback=e.callback||function(){window.location.reload()};const s=this;var i=e.path;const a=[];var o=e.params||{};for(const n in o)o[n]&&a.push(n+"="+encodeURI(o[n]));i+="?"+a.join("&");const l=window.open(i,e.windowName,e.windowOptions);let d;d=window.setInterval(()=>{var e;l.closed?window.clearInterval(d):(e=(e=>{let s=null,i=null;return(e=e.substr(e.indexOf("?")+1,e.length)).split("&").forEach(e=>{var e=e.split("="),t=decodeURI(e[0]),e=decodeURI(e[1]||"");"code"===t&&(s=e),"error"===t&&(i=e)}),s?{code:s}:i?{error:i}:void 0})(l.location.href.toString()))&&(t.call(s,e),l.close(),window.clearInterval(d))},500)}connect(){this.popup({path:this.getMetadata().get(`integrations.${this.integration}.params.endpoint`),params:{client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.getMetadata().get(`integrations.${this.integration}.params.scope`),response_type:"code",access_type:"offline",approval_prompt:"force"}},e=>{e.error?Espo.Ui.notify(!1):e.code?(this.$el.find('[data-action="connect"]').addClass("disabled"),Espo.Ajax.postRequest("ExternalAccount/action/authorizationCode",{id:this.id,code:e.code}).then(e=>{Espo.Ui.notify(!1),!0===e?this.setConnected():this.setNotConnected(),this.$el.find('[data-action="connect"]').removeClass("disabled")}).catch(()=>{this.$el.find('[data-action="connect"]').removeClass("disabled")})):Espo.Ui.error(this.translate("Error occurred"))})}setConnected(){this.isConnected=!0,this.$el.find('[data-action="connect"]').addClass("hidden"),this.$el.find(".connected-label").removeClass("hidden")}setNotConnected(){this.isConnected=!1,this.$el.find('[data-action="connect"]').removeClass("hidden"),this.$el.find(".connected-label").addClass("hidden")}}e.default=a}),define("views/external-account/index",["exports","view"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="external-account/index";data(){return{externalAccountList:this.externalAccountList,id:this.id,externalAccountListCount:this.externalAccountList.length}}setup(){this.addHandler("click","#external-account-menu a.external-account-link",(e,t)=>{t=t.dataset.id+"__"+this.userId;this.openExternalAccount(t)}),this.externalAccountList=this.collection.models.map(e=>e.getClonedAttributes()),this.userId=this.getUser().id,this.id=this.options.id||null,this.id&&(this.userId=this.id.split("__")[1]),this.on("after:render",()=>{this.renderHeader(),this.id?this.openExternalAccount(this.id):this.renderDefaultPage()})}openExternalAccount(e){this.id=e;var t=this.integration=e.split("__")[0],s=(this.userId=e.split("__")[1],this.getRouter().navigate("#ExternalAccount/edit/"+e,{trigger:!1}),this.getMetadata().get(["integrations",t,"authMethod"])),s=this.getMetadata().get(["integrations",t,"userView"])||"views/external-account/"+Espo.Utils.camelCaseToHyphen(s);Espo.Ui.notify(" ... "),this.createView("content",s,{fullSelector:"#external-account-content",id:e,integration:t},e=>{this.renderHeader(),e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})}renderDefaultPage(){$("#external-account-header").html("").hide(),$("#external-account-content").html("")}renderHeader(){const e=$("#external-account-header");this.id?e.show().text(this.integration):e.html("")}updatePageTitle(){this.setPageTitle(this.translate("ExternalAccount","scopeNamesPlural"))}}e.default=i}),define("views/extension/record/row-actions",["exports","views/record/row-actions/default"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getActionList(){return this.options.acl.edit?this.model.get("isInstalled")?[{action:"uninstall",label:"Uninstall",data:{id:this.model.id}}]:[{action:"install",label:"Install",data:{id:this.model.id}},{action:"quickRemove",label:"Remove",data:{id:this.model.id}}]:[]}}e.default=i}),define("views/extension/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{rowActionsView="views/extension/record/row-actions";checkboxes=!1;quickDetailDisabled=!0;quickEditDisabled=!0;massActionList=[]}e.default=i}),define("views/export/record/record",["exports","views/record/edit-for-modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{formatList=null;customParams=null;setupBeforeFinal(){this.formatList=this.options.formatList,this.scope=this.options.scope;var e=this.getExportFieldsData();this.setupExportFieldDefs(e),this.setupExportLayout(e),this.setupExportDynamicLogic(),this.controlFormatField(),this.listenTo(this.model,"change:format",()=>this.controlFormatField()),this.controlAllFields(),this.listenTo(this.model,"change:exportAllFields",()=>this.controlAllFields()),super.setupBeforeFinal()}setupExportFieldDefs(e){const a={format:{type:"enum",options:this.formatList},fieldList:{type:"multiEnum",options:e.list,required:!0},exportAllFields:{type:"bool"}};this.customParams={},this.formatList.forEach(e=>{var t=this.getFormatParamsDefs(e).fields||{};this.customParams[e]=[];for(const i in t){var s=this.modifyParamName(e,i);this.customParams[e].push(i),a[s]=Espo.Utils.cloneDeep(t[i])}}),this.model.setDefs({fields:a})}setupExportLayout(e){e={rows:[[{name:"format"},!(this.detailLayout=[])],[{name:"exportAllFields"},!1],[{name:"fieldList",options:{translatedOptions:e.translations}}]]};this.detailLayout.push(e),this.formatList.forEach(t=>{const e=this.getFormatParamsDefs(t).layout||[];e.forEach(e=>{e.forEach(e=>{e.name=this.modifyParamName(t,e.name)})}),this.detailLayout.push({name:t,rows:e})})}setupExportDynamicLogic(){this.dynamicLogicDefs={fields:{}},this.formatList.forEach(s=>{const i=this.getFormatParamsDefs(s).dynamicLogic||{};this.customParams[s].forEach(e=>{const t=i[e]||{};t.visible||(t.visible={}),t.visible.conditionGroup||(t.visible.conditionGroup=[]),t.visible.conditionGroup.push({type:"equals",attribute:"format",value:s});e=this.modifyParamName(s,e);this.dynamicLogicDefs.fields[e]=t})})}getFormatParamList(e){return Object.keys(this.getFormatParamsDefs(e).fields||{})}getFormatParamsDefs(e){e=this.getMetadata().get(["app","export","formatDefs",e])||{};return Espo.Utils.cloneDeep(e.params||{})}modifyParamName(e,t){return e+Espo.Utils.upperCaseFirst(t)}getExportFieldsData(){let i=this.getFieldManager().getEntityTypeFieldList(this.scope);const t=this.getAcl().getScopeForbiddenFieldList(this.scope),a=(i=(i=i.filter(e=>!~t.indexOf(e))).filter(e=>{e=this.getMetadata().get(["entityDefs",this.scope,"fields",e])||{};return!(e.disabled||e.exportDisabled||"map"===e.type||e.utility)}),this.getLanguage().sortFieldList(this.scope,i),i.unshift("id"),{}),e=(i.forEach(e=>{a[e]=this.getLanguage().translate(e,"fields",this.scope)}),this.model.get("fieldList")||[]);return e.forEach(e=>{var t,s;~i.indexOf(e)||~e.indexOf("_")&&(t=e.split("_"),i.push(e),(s=this.getMetadata().get(["entityDefs",this.scope,"links",t[0],"entity"]))&&(a[e]=this.getLanguage().translate(t[0],"links",this.scope)+"."+this.getLanguage().translate(t[1],"fields",s)))}),{list:i,translations:a}}controlAllFields(){this.model.get("exportAllFields")?this.hideField("fieldList"):this.showField("fieldList")}controlFormatField(){const t=this.model.get("format");this.formatList.filter(e=>e!==t).forEach(e=>{this.hidePanel(e)}),this.formatList.filter(e=>e===t).forEach(e=>{this.customParams[e].length?this.showPanel(e):this.hidePanel(e)})}}e.default=i}),define("views/export/modals/idle",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{template="export/modals/idle";className="dialog dialog-record";checkInterval=4e3;data(){return{infoText:this.translate("infoText","messages","Export")}}setup(){this.addActionHandler("download",()=>this.actionDownload()),this.action=this.options.action,this.id=this.options.id,this.status="Pending",this.headerText=this.translate("Export"),this.model=new s.default,this.model.name="Export",this.model.setDefs({fields:{status:{type:"enum",readOnly:!0,options:["Pending","Running","Success","Failed"],style:{Success:"success",Failed:"danger"}},attachmentId:{type:"varchar"}}}),this.model.set({status:this.status,processedCount:null}),this.createView("record","views/record/edit-for-modal",{scope:"None",model:this.model,selector:".record",detailLayout:[{rows:[[{name:"status",labelText:this.translate("status","fields","Export")}]]}]}),this.on("close",()=>{var e=this.model.get("status");"Pending"!==e&&"Running"!==e||Espo.Ajax.postRequest(`Export/${this.id}/subscribe`)}),this.checkStatus()}checkStatus(){Espo.Ajax.getRequest(`Export/${this.id}/status`).then(e=>{var t=e.status;this.model.set("status",t),"Pending"!==t&&"Running"!==t?(this.model.set({attachmentId:e.attachmentId}),"Success"===t&&(this.trigger("success",{attachmentId:e.attachmentId}),this.showDownload()),this.$el&&this.$el.find(".info-text").addClass("hidden")):setTimeout(()=>this.checkStatus(),this.checkInterval)})}showDownload(){this.$el.find(".download-container").removeClass("hidden");const e=this.$el.find('[data-action="download"]');e.removeClass("hidden")}actionDownload(){this.trigger("download",this.model.get("attachmentId")),this.close()}}e.default=a}),define("views/export/modals/export",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{cssName="export-modal";className="dialog dialog-record";template="export/modals/export";shortcutKeys={"Control+Enter":"export"};setup(){this.buttonList=[{name:"export",label:"Export",style:"danger",title:"Ctrl+Enter"},{name:"cancel",label:"Cancel"}],this.model=new s.default,this.model.name="Export",this.scope=this.options.scope,this.options.fieldList?(e=this.options.fieldList.filter(e=>{e=this.getMetadata().get(`entityDefs.${this.scope}.fields.`+e)||{};return!e.exportDisabled&&!e.utility}),this.model.set("fieldList",e),this.model.set("exportAllFields",!1)):this.model.set("exportAllFields",!0);var e=this.getMetadata().get(["scopes",this.scope,"exportFormatList"])||this.getMetadata().get("app.export.formatList");this.model.set("format",e[0]),this.createView("record","views/export/record/record",{scope:this.scope,model:this.model,selector:".record",formatList:e})}getRecordView(){return this.getView("record")}actionExport(){const s=this.getRecordView(),i=s.fetch();if(this.model.set(i),!s.validate()){const a={exportAllFields:i.exportAllFields,format:i.format};if(!i.exportAllFields){const o=[];i.fieldList.forEach(e=>{var t;"id"!==e?((t=this.getMetadata().get(["entityDefs",this.scope,"fields",e,"type"]))&&this.getFieldManager().getAttributeList(t,e).forEach(e=>{o.push(e)}),~e.indexOf("_")&&o.push(e)):o.push("id")}),a.attributeList=o,a.fieldList=i.fieldList}a.params={},s.getFormatParamList(i.format).forEach(e=>{var t=s.modifyParamName(i.format,e),t=s.getFieldView(t);t&&!t.disabled&&this.getFieldManager().getActualAttributeList(t.type,e).forEach(e=>{var t=s.modifyParamName(i.format,e);a.params[e]=i[t]})}),this.trigger("proceed",a),this.close()}}}e.default=a}),define("views/event/fields/name-for-history",["exports","views/fields/varchar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{listLinkTemplate="event/fields/name-for-history/list-link";data(){const e=super.data();var t=this.model.get("status");const s=this.getMetadata().get(["scopes",this.model.entityType,"canceledStatusList"])||[];return e.strikethrough=s.includes(t),e}}e.default=i}),define("views/email-template/list",["exports","views/list-with-categories"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{quickCreate=!1}e.default=i}),define("views/email-template/record/edit",["exports","views/record/edit","views/email-template/record/detail"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{saveAndContinueEditingAction=!0;setup(){super.setup(),s.default.prototype.listenToInsertField.call(this)}}e.default=a}),define("views/email-template/record/edit-quick",["exports","views/record/edit","views/email-template/record/detail"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{isWide=!0;sideView=!1;setup(){super.setup(),s.default.prototype.listenToInsertField.call(this)}}e.default=a}),define("views/email-template/record/panels/information",["exports","views/record/panels/side"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{templateContent="{{{infoText}}}";data(){var e=this.getMetadata().get(["clientDefs","EmailTemplate","placeholderList"])||[];const s=this.getMetadata().get("app.emailTemplate.placeholders")||{},t=[...Object.keys(s).sort((e,t)=>{return(s[e].order||0)-(s[t].order||0)}),...e];if(!t.length)return{infoText:""};var e=$("<h4>").text(this.translate("Available placeholders","labels","EmailTemplate")+":"),i=t.map(e=>$("<li>").append($("<code>").text("{"+e+"}")," &#8211; ",$("<span>").text(this.translate(e,"placeholderTexts","EmailTemplate")))),i=$("<ul>").append(i);return{infoText:$("<span>").addClass("complex-text").append(e,i)[0].outerHTML}}}e.default=i}),define("views/email-template/fields/insert-field",["exports","views/fields/base","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{inlineEditDisabled=!0;detailTemplate="email-template/fields/insert-field/detail";editTemplate="email-template/fields/insert-field/edit";data(){return{}}setup(){if(this.addActionHandler("insert",()=>{var e=this.$entityType.val(),t=this.$field.val();t&&this.insert(e,t)}),this.mode!==this.MODE_LIST){const t=this.getMetadata().get("scopes"),e=Object.keys(t).filter(e=>{if("Email"!==e&&this.getAcl().checkScope(e))return t[e].entity&&t[e].object}),o=(this.translatedOptions={},{});e.forEach(i=>{this.translatedOptions[i]={},o[i]=this.getScopeAttributeList(i),o[i].forEach(e=>{this.translatedOptions[i][e]=this.translatePlaceholder(i,e)});const a=this.getMetadata().get(`entityDefs.${i}.links`)||{},e=Object.keys(a).sort((e,t)=>this.translate(e,"links",i).localeCompare(this.translate(t,"links",i)));e.forEach(t=>{if("belongsTo"===a[t].type){var e=a[t].entity;if(e&&!a[t].disabled&&!a[t].utility&&!(this.getMetadata().get(["entityAcl",i,"links",t,"onlyAdmin"])||this.getMetadata().get(["entityAcl",i,"links",t,"forbidden"])||this.getMetadata().get(["entityAcl",i,"links",t,"internal"]))){const s=this.getScopeAttributeList(e);s.forEach(e=>{o[i].push(t+"."+e),this.translatedOptions[i][t+"."+e]=this.translatePlaceholder(i,t+"."+e)})}}})}),o.Person=["name","firstName","lastName","salutationName","emailAddress","assignedUserName"],this.translatedOptions.Person={},this.entityList=e,this.entityFields=o}}getScopeAttributeList(o){let e=this.getFieldManager().getEntityTypeFieldList(o),l=[];(e=e.sort((e,t)=>this.translate(e,"fields",o).localeCompare(this.translate(t,"fields",o)))).forEach(e=>{var t=this.getMetadata().get(["entityDefs",o,"fields",e,"type"]),s=this.getMetadata().get(["entityAcl",o,"fields",e])||{},i=this.getMetadata().get(["entityDefs",o,"fields",e])||{};if(s.onlyAdmin||s.forbidden||s.internal||i.disabled||i.utility||i.directAccessDisabled||i.templatePlaceholderDisabled)return!1;if("map"!==t&&"linkMultiple"!==t&&"attachmentMultiple"!==t&&!(this.getMetadata().get(["entityAcl",o,"fields",e,"onlyAdmin"])||this.getMetadata().get(["entityAcl",o,"fields",e,"forbidden"])||this.getMetadata().get(["entityAcl",o,"fields",e,"internal"]))){const a=this.getFieldManager().getAttributeList(t,e);a.forEach(e=>{l.includes(e)||l.push(e)})}});const t=this.getAcl().getScopeForbiddenAttributeList(o);return(l=l.filter(e=>{if(!~t.indexOf(e))return!0})).push("id"),"personName"===this.getMetadata().get("entityDefs."+o+".fields.name.type")&&l.unshift("name"),l}translatePlaceholder(e,t){let s=t,i=e,a=!1,o,l=(t.includes(".")&&(a=!0,s=t.split(".")[1],o=t.split(".")[0],i=this.getMetadata().get(`entityDefs.${e}.links.${o}.entity`)),this.translate(s,"fields",i));return s.indexOf("Id")===s.length-2?(t=s.substr(0,s.length-2),this.getMetadata().get(["entityDefs",i,"fields",t])&&(l=this.translate(t,"fields",i)+" ("+this.translate("id","fields")+")")):s.indexOf("Name")===s.length-4?(t=s.substr(0,s.length-4),this.getMetadata().get(["entityDefs",i,"fields",t])&&(l=this.translate(t,"fields",i)+" ("+this.translate("name","fields")+")")):s.indexOf("Type")===s.length-4&&(t=s.substr(0,s.length-4),this.getMetadata().get(["entityDefs",i,"fields",t])&&(l=this.translate(t,"fields",i)+" ("+this.translate("type","fields")+")")),s.indexOf("Ids")===s.length-3?(t=s.substr(0,s.length-3),this.getMetadata().get(["entityDefs",i,"fields",t])&&(l=this.translate(t,"fields",i)+" ("+this.translate("ids","fields")+")")):s.indexOf("Names")===s.length-5?(t=s.substr(0,s.length-5),this.getMetadata().get(["entityDefs",i,"fields",t])&&(l=this.translate(t,"fields",i)+" ("+this.translate("names","fields")+")")):s.indexOf("Types")===s.length-5&&(t=s.substr(0,s.length-5),this.getMetadata().get(["entityDefs",i,"fields",t])&&(l=this.translate(t,"fields",i)+" ("+this.translate("types","fields")+")")),l=a?this.translate(o,"links",e)+"."+l:l}afterRender(){if(super.afterRender(),this.mode===this.MODE_EDIT){const t={},s=(this.entityList.forEach(e=>{t[e]=this.translate(e,"scopeNames")}),this.entityList.sort((e,t)=>e.localeCompare(t)),this.$entityType=this.$el.find('[data-name="entityType"]'));this.$field=this.$el.find('[data-name="field"]'),s.on("change",()=>{this.changeEntityType()}),s.append($("<option>").val("Person").text(this.translate("Person"))),this.entityList.forEach(e=>{s.append($("<option>").val(e).text(t[e]))}),i.default.init(this.$field),this.changeEntityType(),i.default.init(this.$entityType)}}changeEntityType(){const t=this.$entityType.val(),e=this.entityFields[t];i.default.setValue(this.$field,""),i.default.setOptions(this.$field,e.map(e=>({value:e,label:this.translateItem(t,e)})))}translateItem(e,t){return this.translatedOptions[e][t]||this.translate(t,"fields")}insert(e,t){this.model.trigger("insert-field",{entityType:e,field:t})}}e.default=a}),define("views/email-template/fields/body",["exports","views/fields/wysiwyg"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{hasBodyPlainField=!0}e.default=i}),define("views/email-folder/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{quickCreate=!0;setup(){super.setup(),this.collection.data={boolFilterList:["onlyMy"]}}}e.default=i}),define("views/email-folder/list-side",["exports","view"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="email-folder/list-side";FOLDER_ALL="all";FOLDER_INBOX="inbox";FOLDER_DRAFTS="drafts";data(){const e={};return e.selectedFolderId=this.selectedFolderId,e.showEditLink=this.options.showEditLink,e.scope=this.scope,e}actionSelectFolder(e){this.$el.find("li.selected").removeClass("selected"),this.selectFolder(e),this.$el.find(`li[data-id="${e}"]`).addClass("selected")}setup(){this.addActionHandler("selectFolder",(e,t)=>{e.preventDefault(),this.actionSelectFolder(t.dataset.id)}),this.scope="EmailFolder",this.selectedFolderId=this.options.selectedFolderId||this.FOLDER_ALL,this.emailCollection=this.options.emailCollection,this.loadNotReadCounts(),this.listenTo(this.emailCollection,"sync",this.loadNotReadCounts),this.listenTo(this.emailCollection,"folders-update",this.loadNotReadCounts),this.listenTo(this.emailCollection,"all-marked-read",()=>{this.countsData=this.countsData||{};for(const e in this.countsData)e!==this.FOLDER_DRAFTS&&(this.countsData[e]=0);this.renderCounts()}),this.listenTo(this.emailCollection,"draft-sent",()=>{this.decreaseNotReadCount(this.FOLDER_DRAFTS),this.renderCounts()}),this.listenTo(this.emailCollection,"change:isRead",e=>{this.countsIsBeingLoaded||this.manageCountsDataAfterModelChanged(e)}),this.listenTo(this.emailCollection,"model-removing",e=>{e=this.emailCollection.get(e);e&&(this.countsIsBeingLoaded||this.manageModelRemoving(e))}),this.listenTo(this.emailCollection,"moving-to-trash",(e,t)=>{(t=this.emailCollection.get(e)||t)&&(this.countsIsBeingLoaded||this.manageModelRemoving(t))}),this.listenTo(this.emailCollection,"retrieving-from-trash",(e,t)=>{(t=this.emailCollection.get(e)||t)&&(this.countsIsBeingLoaded||this.manageModelRetrieving(t))})}manageModelRemoving(e){if("Draft"===e.get("status"))return this.decreaseNotReadCount(this.FOLDER_DRAFTS),void this.renderCounts();e.get("isUsers")&&(e.get("isRead")||(e=e.get("groupFolderId")?"group:"+e.get("groupFolderId"):e.get("folderId")||this.FOLDER_INBOX,this.decreaseNotReadCount(e),this.renderCounts()))}manageModelRetrieving(e){e.get("isUsers")&&(e.get("isRead")||(e=e.get("groupFolderId")?"group:"+e.get("groupFolderId"):e.get("folderId")||this.FOLDER_INBOX,this.increaseNotReadCount(e),this.renderCounts()))}manageCountsDataAfterModelChanged(e){var t;e.get("isUsers")&&(t=e.get("groupFolderId")?"group:"+e.get("groupFolderId"):e.get("folderId")||this.FOLDER_INBOX,e.get("isRead")?this.decreaseNotReadCount(t):this.increaseNotReadCount(t),this.renderCounts())}increaseNotReadCount(e){this.countsData=this.countsData||{},this.countsData[e]=this.countsData[e]||0,this.countsData[e]++}decreaseNotReadCount(e){this.countsData=this.countsData||{},this.countsData[e]=this.countsData[e]||0,this.countsData[e]&&this.countsData[e]--}selectFolder(e){this.emailCollection.reset(),this.emailCollection.abortLastFetch(),this.selectedFolderId=e,this.trigger("select",e)}afterRender(){this.countsData&&this.renderCounts()}loadNotReadCounts(){this.countsIsBeingLoaded||(this.countsIsBeingLoaded=!0,Espo.Ajax.getRequest("Email/inbox/notReadCounts").then(e=>{if(this.countsData=e,this.isRendered())return this.renderCounts(),void(this.countsIsBeingLoaded=!1);this.once("after:render",()=>{this.renderCounts(),this.countsIsBeingLoaded=!1})}))}renderCounts(){const t=this.countsData;for(const s in t){let e="";t[s]&&(e=t[s].toString()),this.$el.find(`li a.count[data-id="${s}"]`).text(e)}}}e.default=i}),define("views/email-folder/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{massUpdateDisabled=!0;mergeDisabled=!0;exportDisabled=!0;removeDisabled=!0;rowActionsView="views/email-folder/record/row-actions/default";actionMoveUp(e){e=this.collection.get(e.id);e&&0!==this.collection.indexOf(e)&&Espo.Ajax.postRequest("EmailFolder/action/moveUp",{id:e.id}).then(()=>{this.collection.fetch()})}actionMoveDown(e){e=this.collection.get(e.id);e&&(this.collection.indexOf(e)===this.collection.length-1&&this.collection.length===this.collection.total||Espo.Ajax.postRequest("EmailFolder/action/moveDown",{id:e.id}).then(()=>{this.collection.fetch()}))}}e.default=i}),define("views/email-folder/record/edit-small",["exports","views/record/edit"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{afterSave(){this.getBaseController().clearScopeStoredMainView("Email"),super.afterSave()}}e.default=i}),define("views/email-folder/record/row-actions/default",["exports","views/record/row-actions/default"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getActionList(){const e=super.getActionList();return this.options.acl.edit&&(e.unshift({action:"moveDown",label:"Move Down",data:{id:this.model.id}}),e.unshift({action:"moveUp",label:"Move Up",data:{id:this.model.id}})),e}}e.default=i}),define("views/email-folder/modals/select-folder",["exports","views/modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{template="email-folder/modals/select-folder";cssName="select-folder";fitHeight=!0;backdrop=!0;data(){return{folderDataList:this.folderDataList}}setup(){this.addActionHandler("selectFolder",(e,t)=>{var s=t.dataset.id,t=t.dataset.name;this.trigger("select",s,t),this.close()}),this.headerText=this.options.headerText||"",""===this.headerText&&this.buttonList.push({name:"cancel",label:"Cancel"}),Espo.Ui.notify(" ... "),this.wait(Espo.Ajax.getRequest("EmailFolder/action/listAll").then(e=>{Espo.Ui.notify(!1),this.folderDataList=e.list.filter(e=>-1===["inbox","important","sent","drafts","trash","archive"].indexOf(e.id)).map(e=>({id:e.id,name:e.name,isGroup:0===e.id.indexOf("group:")})),this.folderDataList.unshift({id:"inbox",name:this.translate("inbox","presetFilters","Email")}),this.folderDataList.push({id:"archive",name:this.translate("archive","presetFilters","Email")})}))}}e.default=i}),define("views/email-filter/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{massActionList=["remove","export"]}e.default=i}),define("views/email-filter/modals/edit",["exports","views/modals/edit"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{fullFormDisabled=!0}e.default=i}),define("views/email-filter/fields/parent",["exports","views/fields/link-parent"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getSelectPrimaryFilterName(){if(this.foreignScope)return{User:"active"}[this.foreignScope]}}e.default=i}),define("views/email-filter/fields/email-folder",["exports","views/fields/link"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{createDisabled=!0;autocompleteDisabled=!0;getSelectFilters(){if(this.getUser().isAdmin()&&"User"===this.model.get("parentType")&&this.model.get("parentId"))return{assignedUser:{type:"equals",attribute:"assignedUserId",value:this.model.get("parentId"),data:{nameValue:this.model.get("parentName")}}}}}e.default=i}),define("views/email-account/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{keepCurrentRootUrl=!0;setup(){this.options.params=this.options.params||{};var e=this.options.params||{};this.userId=e.userId,super.setup(),this.userId&&(this.collection.where=[{type:"equals",field:"assignedUserId",value:e.userId}])}setupSearchPanel(){if(this.userId||!this.getUser().isAdmin())return this.searchPanel=!1,void this.searchManager.reset();super.setupSearchPanel()}getCreateAttributes(){const e={};return this.options.params.userId&&(e.assignedUserId=this.options.params.userId,e.assignedUserName=this.options.params.userName||this.options.params.userId),e}}e.default=i}),define("views/email-account/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{quickDetailDisabled=!0;quickEditDisabled=!0;checkAllResultDisabled=!0;massActionList=["remove","massUpdate"]}e.default=i}),define("views/email-account/record/edit",["exports","views/record/edit","views/email-account/record/detail"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{setup(){super.setup(),s.default.prototype.setupFieldsBehaviour.call(this),s.default.prototype.initSslFieldListening.call(this),s.default.prototype.initSmtpFieldsControl.call(this),this.getUser().isAdmin()?this.setFieldNotReadOnly("assignedUser"):this.setFieldReadOnly("assignedUser")}modifyDetailLayout(e){s.default.prototype.modifyDetailLayout.call(this,e)}setupFieldsBehaviour(){s.default.prototype.setupFieldsBehaviour.call(this)}controlStatusField(){s.default.prototype.controlStatusField.call(this)}controlSmtpFields(){s.default.prototype.controlSmtpFields.call(this)}controlSmtpAuthField(){s.default.prototype.controlSmtpAuthField.call(this)}wasFetched(){s.default.prototype.wasFetched.call(this)}}e.default=a}),define("views/email-account/modals/select-folder",["exports","views/modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{cssName="select-folder-modal";template="email-account/modals/select-folder";data(){return{folders:this.options.folders}}setup(){this.headerText=this.translate("Select"),this.addActionHandler("select",(e,t)=>{t=t.dataset.value;this.trigger("select",t)})}}e.default=i}),define("views/email-account/fields/email-folder",["exports","views/fields/link"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{createDisabled=!0;autocompleteDisabled=!0;getSelectFilters(){if(this.getUser().isAdmin()&&this.model.get("assignedUserId"))return{assignedUser:{type:"equals",attribute:"assignedUserId",value:this.model.get("assignedUserId"),data:{type:"is",nameValue:this.model.get("assignedUserName")}}}}setup(){super.setup(),this.listenTo(this.model,"change:assignedUserId",(e,t,s)=>{s.ui&&this.model.set({emailFolderId:null,emailFolderName:null})})}}e.default=i}),define("views/email-account/fields/email-address",["exports","views/fields/email-address"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.on("change",()=>{var e=this.model.get("emailAddress");this.model.set("name",e)});var e=this.model.get("assignedUserId");this.getUser().isAdmin()&&e!==this.getUser().id&&Espo.Ajax.getRequest("User/"+e).then(t=>{const s=[];t.emailAddress&&(s.push(t.emailAddress),this.params.options=s,t.emailAddressData&&t.emailAddressData.forEach(e=>{e.emailAddress!==t.emailAddress&&s.push(e.emailAddress)}),this.reRender())})}setupOptions(){this.model.get("assignedUserId")===this.getUser().id&&(this.params.options=this.getUser().get("userEmailAddressList"))}}e.default=i}),define("views/email/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{createButton=!1;template="email/list";folderId=null;folderScope="EmailFolder";selectedFolderId=null;defaultFolderId="inbox";keepCurrentRootUrl=!0;stickableTop=null;FOLDER_ALL="all";FOLDER_INBOX="inbox";FOLDER_IMPORTANT="important";FOLDER_SENT="sent";FOLDER_DRAFTS="drafts";FOLDER_TRASH="trash";FOLDER_ARCHIVE="archive";noDropFolderIdList=["sent","drafts"];createListRecordView(e){return super.createListRecordView(e).then(e=>{this.listenTo(e,"after:render",()=>this.initDraggable(null)),this.listenTo(e,"after:show-more",e=>this.initDraggable(e))})}initDroppable(){this.$el.find(".folders-container .folder-list > .droppable").droppable({accept:".list-row",tolerance:"pointer",over:e=>{if(this.isDroppable(e)){const t=$(e.target);t.removeClass("success"),t.addClass("active"),t.find("a").css("pointer-events","none")}},out:e=>{if(this.isDroppable(e)){const t=$(e.target);t.removeClass("active"),t.find("a").css("pointer-events","")}},drop:(t,s)=>{if(this.isDroppable(t)){const i=$(t.target),a=$(s.helper);i.find("a").css("pointer-events","");t=i.attr("data-id");let e=a.attr("data-id");e=""===e||e,this.onDrop(t,e),i.removeClass("active"),i.addClass("success"),setTimeout(()=>{i.removeClass("success")},1e3)}}})}initDraggable(e){if(e=e||0,!("ontouchstart"in window||0<navigator.maxTouchPoints)){const t=this.$el.find(".list-container > .list"),i=this.getEmailRecordView();this.collection.models.slice(e).forEach(s=>{const e=t.find(`.list-row[data-id="${s.id}"]`).first();e.draggable({cancel:"input,textarea,button,select,option,.dropdown-menu",helper:()=>{let e=this.translate("Moving to Folder","labels","Email"),t=(i.isIdChecked(s.id)&&!i.allResultIsChecked&&1<i.checkedList.length&&(e+=" Â· "+i.checkedList.length),s.id);return i.isIdChecked(s.id)&&!i.allResultIsChecked&&(t=""),$("<div>").attr("data-id",t).css("cursor","grabbing").addClass("draggable-helper").text(e)},distance:8,containment:this.$el,appendTo:"body",cursor:"grabbing",cursorAt:{top:0,left:0},start:e=>{const t=$(e.target);t.closest("tr").addClass("active")},stop:()=>{i.isIdChecked(s.id)||t.find(`.list-row[data-id="${s.id}"]`).first().removeClass("active")}})})}}isDroppable(e){const t=$(e.target),s=t.attr("data-id");return this.selectedFolderId!==this.FOLDER_DRAFTS&&((this.selectedFolderId!==this.FOLDER_SENT||s!==this.FOLDER_INBOX)&&(this.selectedFolderId===this.FOLDER_ALL?0===s.indexOf("group:"):s===this.FOLDER_ALL?0===this.selectedFolderId.indexOf("group:"):this.selectedFolderId!==this.FOLDER_DRAFTS||(0===s.indexOf("group:")||s!==this.FOLDER_TRASH&&s!==this.FOLDER_ARCHIVE)))}setup(){super.setup(),this.addMenuItem("dropdown",!1),this.getAcl().checkScope("EmailAccountScope")&&this.addMenuItem("dropdown",{name:"reply",label:"Email Accounts",link:"#EmailAccount/list/userId="+this.getUser().id+"&userName="+encodeURIComponent(this.getUser().get("name"))}),this.getAcl().checkScope("Import")||this.hideHeaderActionItem("archiveEmail"),this.getUser().isAdmin()&&this.addMenuItem("dropdown",{link:"#InboundEmail",label:"Inbound Emails"}),this.foldersDisabled=this.foldersDisabled||this.getConfig().get("emailFoldersDisabled")||this.getMetadata().get(["scopes",this.folderScope,"disabled"])||!this.getAcl().checkScope(this.folderScope);var e=this.options.params||{};this.selectedFolderId=e.folder||this.defaultFolderId,this.foldersDisabled&&(this.selectedFolderId=null),this.applyFolder(),this.initEmailShortcuts(),this.on("remove",()=>{$(window).off("resize.email-folders"),$(window).off("scroll.email-folders")})}data(){const e={};return e.foldersDisabled=this.foldersDisabled,e}createSearchView(){const e=super.createSearchView();return e.then(e=>{this.listenTo(e,"update-ui",()=>{this.stickableTop=null,setTimeout(()=>{$(window).trigger("scroll"),this.stickableTop=null},100)})}),e}initEmailShortcuts(){this.shortcutKeys["Control+Delete"]=e=>{this.hasSelectedRecords()&&(e.preventDefault(),e.stopPropagation(),this.getEmailRecordView().massActionMoveToTrash())},this.shortcutKeys["Control+Backspace"]=e=>{this.hasSelectedRecords()&&(e.preventDefault(),e.stopPropagation(),this.getEmailRecordView().massActionMoveToArchive())},this.shortcutKeys["Control+KeyI"]=e=>{this.hasSelectedRecords()&&(e.preventDefault(),e.stopPropagation(),this.getEmailRecordView().toggleMassMarkAsImportant())},this.shortcutKeys["Control+KeyM"]=e=>{this.hasSelectedRecords()&&(e.preventDefault(),e.stopPropagation(),this.getEmailRecordView().massActionMoveToFolder())}}hasSelectedRecords(){var e=this.getEmailRecordView();return e.checkedList&&e.checkedList.length&&!e.allResultIsChecked}setupReuse(e){this.applyRoutingParams(e),this.initDroppable(),this.initStickableFolders();const t=this.getRecordView();t.removeQueuedRecord()}actionComposeEmail(e){e=e||{},Espo.Ui.notify(" ... ");var t=this.getMetadata().get("clientDefs.Email.modalViews.compose")||"views/modals/compose-email",e={attributes:{status:"Draft"},focusForCreate:e.focusForCreate};this.createView("quickCreate",t,e,e=>{e.render(),e.notify(!1),this.listenToOnce(e,"after:save",()=>{this.collection.fetch()})})}afterRender(){super.afterRender(),this.foldersDisabled||this.hasView("folders")||this.loadFolders()}getFolderCollection(t){this.getCollectionFactory().create(this.folderScope,e=>{e.url="EmailFolder/action/listAll",e.maxSize=200,this.listenToOnce(e,"sync",()=>{t.call(this,e)}),e.fetch()})}loadFolders(){let t=null;const s=[this.FOLDER_TRASH,this.FOLDER_DRAFTS,this.FOLDER_ALL,this.FOLDER_INBOX,this.FOLDER_IMPORTANT,this.FOLDER_SENT,this.FOLDER_ARCHIVE];this.getFolderCollection(e=>{e.forEach(e=>{-1===this.noDropFolderIdList.indexOf(e.id)&&(e.droppable=!0),0===e.id.indexOf("group:")?e.title=this.translate("groupFolder","fields","Email"):-1===s.indexOf(e.id)&&(e.title=this.translate("folder","fields","Email"))}),this.createView("folders","views/email-folder/list-side",{collection:e,emailCollection:this.collection,selector:".folders-container",showEditLink:this.getAcl().check(this.folderScope,"edit"),selectedFolderId:this.selectedFolderId},e=>{e.render().then(()=>this.initDroppable()).then(()=>this.initStickableFolders()),this.listenTo(e,"select",e=>{this.selectedFolderId=e,this.applyFolder(),t&&t.readyState<4&&t.abort(),Espo.Ui.notify(" ... "),this.collection.offset=0,t=this.collection.fetch().then(()=>Espo.Ui.notify(!1)),e!==this.defaultFolderId?this.getRouter().navigate("#Email/list/folder="+e):this.getRouter().navigate("#Email"),this.updateLastUrl()})})})}applyFolder(){this.collection.selectedFolderId=this.selectedFolderId,this.collection.trigger("select-folder"),this.selectedFolderId?this.collection.whereFunction=()=>[{type:"inFolder",attribute:"folderId",value:this.selectedFolderId}]:this.collection.whereFunction=null}getFoldersView(){return this.getView("folders")}applyRoutingParams(e){let t;if("folder"in e&&(t=e.folder||"inbox",!e.isReturnThroughLink&&t!==this.selectedFolderId)){const s=this.getFoldersView();s&&(s.actionSelectFolder(t),s.reRender(),$(window).scrollTop(0))}}onDrop(e,t){const s=this.getEmailRecordView();if(e!==this.FOLDER_IMPORTANT)return this.selectedFolderId===this.FOLDER_TRASH?e===this.FOLDER_TRASH?void 0:void(!0===t?s.massRetrieveFromTrashMoveToFolder(e):s.actionRetrieveFromTrashMoveToFolder({id:t,folderId:e})):void(e!==this.FOLDER_TRASH?(0===this.selectedFolderId.indexOf("group:")&&e===this.FOLDER_ALL&&(e=this.FOLDER_INBOX),!0===t?s.massMoveToFolder(e):s.actionMoveToFolder({id:t,folderId:e})):!0===t?s.massActionMoveToTrash():s.actionMoveToTrash({id:t}));setTimeout(()=>{!0===t?s.massActionMarkAsImportant():s.actionMarkAsImportant({id:t})},10)}getEmailRecordView(){return this.getRecordView()}initStickableFolders(){const s=$(window),i=this.$el.find(".list-container"),a=this.$el.find(".folders-container"),o=this.$el.find(".left-container").first();var e=this.getThemeManager().getParam("screenWidthXs");const l=$(window.document).width()<e,d=this.getThemeManager().getParam("navbarHeight")+(this.getThemeManager().getParam("buttonsContainerHeight")||47),n=parseInt(window.getComputedStyle($("#content").get(0)).paddingBottom,10),r=e=>{let t=e.get(0),s=0;for(;t;)s+=isNaN(t.offsetTop)?0:t.offsetTop,t=t.offsetParent;return l?s:s-d},t=(this.stickableTop=r(i),()=>{let e=this.stickableTop;null===e&&(e=this.stickableTop=r(i));var t=s.scrollTop();if(t<=e||l)return a.removeClass("sticked").width("").scrollTop(0),void a.css({maxHeight:""});t>e&&(t=s.scrollTop()-e,a.addClass("sticked").width(o.outerWidth(!0)).scrollTop(t),t=parseInt(window.getComputedStyle(a.get(0)).top),t=s.height()-t-n,a.css({maxHeight:t}))});s.on("resize.email-folders",()=>t()),s.on("scroll.email-folders",()=>t())}handleShortcutKeyCtrlSpace(e){"TEXTAREA"!==e.target.tagName&&"INPUT"!==e.target.tagName&&this.getAcl().checkScope(this.scope,"create")&&(e.preventDefault(),e.stopPropagation(),this.actionComposeEmail({focusForCreate:!0}))}}e.default=i}),define("views/email/record/list-related",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{massActionList=["remove","massUpdate"]}e.default=i}),define("views/email/record/list-expanded",["exports","views/record/list-expanded","views/email/record/list"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{actionMarkAsImportant(e){s.default.prototype.actionMarkAsImportant.call(this,e)}actionMarkAsNotImportant(e){s.default.prototype.actionMarkAsNotImportant.call(this,e)}actionMoveToTrash(e){s.default.prototype.actionMoveToTrash.call(this,e)}}e.default=a}),define("views/email/record/edit-quick",["exports","views/email/record/edit"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{isWide=!0;sideView=!1}e.default=i}),define("views/email/record/detail-side",["exports","views/record/detail-side"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{}e.default=i}),define("views/email/record/detail-quick",["exports","views/email/record/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{isWide=!0;sideView=!1}e.default=i}),define("views/email/record/compose",["exports","views/record/edit","views/email/record/detail"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{isWide=!0;sideView=!1;setupBeforeFinal(){if(super.setupBeforeFinal(),this.initialBody=null,this.initialIsHtml=null,!this.model.get("isHtml")&&this.getPreferences().get("emailReplyForceHtml")&&(t=(this.model.get("body")||"").replace(/\n/g,"<br>"),this.model.set("body",t,{silent:!0}),this.model.set("isHtml",!0,{silent:!0})),this.model.get("body")&&(this.initialBody=this.model.get("body"),this.initialIsHtml=this.model.get("isHtml")),!this.options.signatureDisabled&&this.hasSignature()){let e="prependSignature";var t=this[e=this.options.appendSignature?"appendSignature":e](this.model.get("body")||"",this.model.get("isHtml"));this.model.set("body",t,{silent:!0})}}setup(){super.setup(),this.isBodyChanged=!1,this.listenTo(this.model,"change:body",()=>{this.isBodyChanged=!0}),this.options.removeAttachmentsOnSelectTemplate||(this.initialAttachmentsIds=this.model.get("attachmentsIds")||[],this.initialAttachmentsNames=this.model.get("attachmentsNames")||{}),this.initInsertTemplate(),this.options.selectTemplateDisabled&&this.hideField("selectTemplate")}initInsertTemplate(){this.listenTo(this.model,"insert-template",e=>{const t=this.model.get("body")||"";let s=t.replace(/<br\s*\/?>/gm,"");s=(s=(s=s.replace(/<\/p\s*\/?>/gm,"")).replace(/ /g,"")).replace(/\n/g,"");const i=$("<div>").html(s);""!==(s=i.text())&&this.isBodyChanged?this.confirm({message:this.translate("confirmInsertTemplate","messages","Email"),confirmText:this.translate("Yes")}).then(()=>this.insertTemplate(e)):this.insertTemplate(e)})}insertTemplate(t){let s=t.body;if(this.hasSignature()&&(s=this.appendSignature(s||"",t.isHtml)),this.initialBody&&!this.isBodyChanged){let e=this.initialBody;t.isHtml!==this.initialIsHtml&&(e=t.isHtml?this.plainToHtml(e):this.htmlToPlain(e)),s+=e}this.model.set("isHtml",t.isHtml),t.subject&&this.model.set("name",t.subject),this.model.set("body",""),this.model.set("body",s),this.options.removeAttachmentsOnSelectTemplate||this.initialAttachmentsIds.forEach(e=>{t.attachmentsIds&&t.attachmentsIds.push(e),t.attachmentsNames&&(t.attachmentsNames[e]=this.initialAttachmentsNames[e]||e)}),this.model.set({attachmentsIds:t.attachmentsIds,attachmentsNames:t.attachmentsNames}),this.isBodyChanged=!1}prependSignature(t,e){if(e){let e=this.getSignature();return t&&(e+=""),"<p><br></p>"+e+t}let s=this.getPlainTextSignature();return t&&(s+="\n"),"\n\n"+s+t}appendSignature(e,t){if(t){const s=this.getSignature();return e+""+s}const s=this.getPlainTextSignature();return e+"\n\n"+s}hasSignature(){return!!this.getPreferences().get("signature")}getSignature(){return this.getPreferences().get("signature")||""}getPlainTextSignature(){var e=this.getSignature().replace(/<br\s*\/?>/gm,"\n");return $("<div>").html(e).text()}afterSave(){super.afterSave(),this.isSending&&"Sent"===this.model.get("status")&&Espo.Ui.success(this.translate("emailSent","messages","Email"))}send(){s.default.prototype.send.call(this)}saveDraft(e){const t=this.model,s=(t.set("status","Draft"),this.getFieldView("subject"));return s&&(s.fetchToModel(),t.get("name")||t.set("name",this.translate("No Subject","labels","Email"))),this.save(e)}htmlToPlain(e){let t=(e=e||"").replace(/<br\s*\/?>/gm,"\n");t=t.replace(/<\/p\s*\/?>/gm,"\n\n");const s=$("<div>").html(t);return s.find("style").remove(),s.find('link[ref="stylesheet"]').remove(),t=s.text()}plainToHtml(e){return(e=e||"").replace(/\n/g,"<br>")}errorHandlerSendingFail(e){s.default.prototype.errorHandlerSendingFail.call(this,e)}focusForCreate(){if(this.model.get("to"))if(this.model.get("subject")){if(this.model.get("isHtml")){const e=this.$el.find('.field[data-name="body"] .note-editable');return e.length?void e.focus():void 0}this.$el.find('.field[data-name="body"] textarea').prop("selectionEnd",0).focus()}else this.$el.find('.field[data-name="subject"] input').focus();else this.$el.find('.field[data-name="to"] input').focus()}}e.default=a}),define("views/email/record/row-actions/default",["exports","views/record/row-actions/default"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.listenTo(this.model,"change",e=>{(e.hasChanged("isImportant")||e.hasChanged("inTrash"))&&setTimeout(()=>{this.reRender()},10)})}getActionList(){let e=[{action:"quickView",label:"View",data:{id:this.model.id},groupIndex:0}];return this.model.get("createdById")!==this.getUser().id||"Draft"!==this.model.get("status")||this.model.get("inTrash")||e.push({action:"send",label:"Send",data:{id:this.model.id}}),this.options.acl.edit&&(e=e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id},groupIndex:0}])),this.model.get("isUsers")&&(this.model.get("isImportant")?e.push({action:"markAsNotImportant",label:"Unmark Importance",data:{id:this.model.id},groupIndex:1}):this.model.get("inTrash")||e.push({action:"markAsImportant",label:"Mark as Important",data:{id:this.model.id},groupIndex:1})),this.model.get("isUsers")&&!this.model.get("isRead")&&e.push({action:"markAsRead",label:"Mark Read",data:{id:this.model.id},groupIndex:1}),this.model.get("isUsers")&&"Draft"!==this.model.get("status")&&(this.model.get("inTrash")?e.push({action:"retrieveFromTrash",label:"Retrieve from Trash",data:{id:this.model.id},groupIndex:2}):e.push({action:"moveToTrash",label:"Move to Trash",data:{id:this.model.id},groupIndex:2}),this.model.attributes.inArchive||e.push({action:"moveToArchive",text:this.getLanguage().translatePath("Email.actions.moveToArchive"),data:{id:this.model.id},groupIndex:2})),this.model.get("isUsers")&&"Draft"!==this.model.get("status")&&e.push({action:"moveToFolder",label:"Move to Folder",data:{id:this.model.id},groupIndex:2}),this.options.acl.delete&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id},groupIndex:0}),e}}e.default=i}),define("views/email/record/row-actions/dashlet",["exports","views/record/row-actions/default"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setup(){super.setup(),this.listenTo(this.model,"change:isImportant",()=>{setTimeout(()=>this.reRender(),10)})}getActionList(){let e=[{action:"quickView",label:"View",data:{id:this.model.id},groupIndex:0}];return this.options.acl.edit&&(e=e.concat([{action:"quickEdit",label:"Edit",data:{id:this.model.id},groupIndex:0}])),this.model.get("isUsers")&&"Draft"!==this.model.get("status")&&(this.model.get("inTrash")?e.push({action:"retrieveFromTrash",label:"Retrieve from Trash",data:{id:this.model.id},groupIndex:1}):e.push({action:"moveToTrash",label:"Move to Trash",data:{id:this.model.id},groupIndex:1})),this.getAcl().checkModel(this.model,"delete")&&e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id},groupIndex:0}),this.model.get("isUsers")&&(this.model.get("isImportant")?e.push({action:"markAsNotImportant",label:"Unmark Importance",data:{id:this.model.id},groupIndex:1}):e.push({action:"markAsImportant",label:"Mark as Important",data:{id:this.model.id},groupIndex:1})),e}}e.default=i}),define("views/email/record/panels/event",["exports","views/record/panels/side"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupFields(){super.setupFields(),this.fieldList.push({name:"icsEventDateStart",readOnly:!0,labelText:this.translate("dateStart","fields","Meeting")}),this.fieldList.push({name:"createdEvent",readOnly:!0}),this.fieldList.push({name:"createEvent",readOnly:!0,noLabel:!0}),this.controlEventField(),this.listenTo(this.model,"change:icsEventData",this.controlEventField,this),this.listenTo(this.model,"change:createdEventId",this.controlEventField,this)}controlEventField(){return!this.model.get("icsEventData")||this.model.get("icsEventData").createdEvent||this.model.get("createdEventId")?(this.recordViewObject.hideField("createEvent"),void this.recordViewObject.showField("createdEvent")):(this.recordViewObject.hideField("createdEvent"),void this.recordViewObject.showField("createEvent"))}}e.default=i}),define("views/email/record/panels/default-side",["exports","views/record/panels/default-side"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupFields(){super.setupFields(),this.fieldList.push({name:"hasAttachment",view:"views/email/fields/has-attachment",noLabel:!0}),this.controlHasAttachmentField(),this.listenTo(this.model,"change:hasAttachment",()=>this.controlHasAttachmentField())}controlHasAttachmentField(){this.model.get("hasAttachment")?this.recordViewObject.showField("hasAttachment"):this.recordViewObject.hideField("hasAttachment")}}e.default=i}),define("views/email/modals/insert-field",["exports","views/modal","helpers/misc/field-language"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{backdrop=!0;templateContent=`
        {{#each viewObject.dataList}}
            <div class="margin-bottom">
            <h5>{{label}}: {{translate entityType category='scopeNames'}}</h5>
            </div>
            <ul class="list-group no-side-margin">
                {{#each dataList}}
                    <li class="list-group-item clearfix">
                        <a role="button"
                            data-action="insert" class="text-bold" data-name="{{name}}" data-type="{{../type}}">
                            {{label}}
                        </a>

                        <div class="pull-right"
                            style="width: 50%; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                            {{valuePreview}}
                        </div>
                    </li>
                {{/each}}
            </ul>
        {{/each}}

        {{#unless viewObject.dataList.length}}
            {{translate 'No Data'}}
        {{/unless}}
    `;setup(){super.setup(),this.headerText=this.translate("Insert Field","labels","Email"),this.fieldLanguage=new s.default(this.getMetadata(),this.getLanguage()),this.wait(Espo.Ajax.getRequest("Email/insertFieldData",{parentId:this.options.parentId,parentType:this.options.parentType,to:this.options.to}).then(e=>{this.fetchedData=e,this.prepareData()})),this.addActionHandler("insert",(e,t)=>{var s=t.dataset.name,t=t.dataset.type;this.insert(t,s)})}prepareData(){this.dataList=[];const o=this.fetchedData;["parent","to"].forEach(e=>{if(o[e]){var t=o[e].entityType,s=o[e].id;for(const a of this.dataList)if(a.id===s&&a.entityType===t)return;var i=this.prepareDisplayValueList(o[e].entityType,o[e].values);i.length&&this.dataList.push({type:e,entityType:t,id:s,name:o[e].name,dataList:i,label:this.translate(e,"fields","Email")})}})}prepareDisplayValueList(s,a){const o=[];let e=Object.keys(a);const l={},d=(e.forEach(e=>{l[e]=this.fieldLanguage.translateAttribute(s,e)}),e=e.sort((e,t)=>l[e].localeCompare(l[t])),["id","modifiedAt","modifiedByName"]),t=this.getFieldManager();return t.getEntityTypeFieldList(s).forEach(e=>{var t=this.getMetadata().get(["entityDefs",s,"fields",e,"type"]);["link","linkOne","image","filed","linkParent"].includes(t)&&d.push(e+"Id"),"linkParent"===t&&d.push(e+"Type")}),e.forEach(t=>{if(!~d.indexOf(t)){let e=a[t];if(null!==e&&""!==e&&"boolean"!=typeof e){if(Array.isArray(e)){for(const i in e)if("string"!=typeof i)return;e=e.split(", ")}var s=(e=this.getHelper().sanitizeHtml(e)).replace(/<br( \/)?>/gm," ");e=(e=e.replace(/(?:\r\n|\r|\n)/g,"")).replace(/<br( \/)?>/gm,"\n"),o.push({name:t,label:l[t],value:e,valuePreview:s})}}}),o}insert(e,t){for(const s of this.dataList)if(s.type===e){for(const i of s.dataList)if(i.name===t){this.trigger("insert",i.value);break}break}this.close()}}e.default=a}),define("views/email/modals/detail",["exports","views/modals/detail","views/email/detail"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{setup(){super.setup(),this.addButton({name:"reply",label:"Reply",hidden:this.model&&"Draft"===this.model.get("status"),style:"danger",position:"right"},!0),this.model&&this.listenToOnce(this.model,"sync",()=>{setTimeout(()=>{this.model.set("isRead",!0)},50)})}controlRecordButtonsVisibility(){super.controlRecordButtonsVisibility(),"Draft"!==this.model.get("status")&&this.getAcl().check("Email","create")?this.showActionItem("reply"):this.hideActionItem("reply")}actionReply(e,t){s.default.prototype.actionReply.call(this,{},t,this.getPreferences().get("emailReplyToAllByDefault"))}}e.default=a}),define("views/email/modals/body-plain",["exports","views/modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{backdrop=!0;templateContent='<div class="field" data-name="body-plain">{{{bodyPlain}}}</div>';setup(){super.setup(),this.buttonList.push({name:"cancel",label:"Close"}),this.headerText=this.model.get("name"),this.createView("bodyPlain","views/fields/text",{selector:'.field[data-name="bodyPlain"]',model:this.model,defs:{name:"bodyPlain",params:{readOnly:!0,inlineEditDisabled:!0}}})}}e.default=i}),define("views/email/modals/attachments",["exports","views/modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{backdrop=!0;templateContent='<div class="record no-side-margin">{{{record}}}</div>';setup(){super.setup(),this.headerText=this.translate("attachments","fields","Email"),this.createView("record","views/record/detail",{model:this.model,selector:".record",readOnly:!0,sideView:null,buttonsDisabled:!0,detailLayout:[{rows:[[{name:"attachments",noLabel:!0},!1]]}]}),this.model.has("attachmentsIds")||this.wait(this.model.fetch())}}e.default=i}),define("views/email/fields/subject",["exports","views/fields/varchar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{listLinkTemplate="email/fields/subject/list-link";data(){const e=super.data();return e.isRead=this.model.get("sentById")===this.getUser().id||this.model.get("isRead"),e.isImportant=this.model.has("isImportant")&&this.model.get("isImportant"),e.hasAttachment=this.model.has("hasAttachment")&&this.model.get("hasAttachment"),e.isReplied=this.model.has("isReplied")&&this.model.get("isReplied"),e.inTrash=this.model.has("inTrash")&&this.model.get("inTrash"),e.isRead||this.model.has("isRead")||(e.isRead=!0),e.isNotEmpty||null!==this.model.get("name")&&""!==this.model.get("name")&&this.model.has("name")&&(e.isNotEmpty=!0),e}getValueForDisplay(){return this.model.get("name")}getAttributeList(){return["name","subject","isRead","isImportant","hasAttachment","inTrash"]}setup(){super.setup(),this.events['click [data-action="showAttachments"]']=e=>{e.stopPropagation(),this.showAttachments()},this.listenTo(this.model,"change",()=>{this.mode!==this.MODE_LIST&&this.mode!==this.MODE_LIST_LINK||(this.model.hasChanged("isRead")||this.model.hasChanged("isImportant"))&&this.reRender()})}fetch(){const e=super.fetch();return e.name=e.subject,e}showAttachments(){Espo.Ui.notify(" ... "),this.createView("dialog","views/email/modals/attachments",{model:this.model}).then(e=>{e.render(),Espo.Ui.notify(!1)})}}e.default=i}),define("views/email/fields/select-template",["exports","views/fields/link"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{editTemplate="email/fields/select-template/edit";foreignScope="EmailTemplate";setup(){super.setup(),this.on("change",()=>{var e=this.model.get(this.idName);e&&this.loadTemplate(e)})}getSelectPrimaryFilterName(){return"actual"}loadTemplate(e){let t=this.model.get("to")||"",s=null;(t=t.trim())&&(s=t.split(";")[0].trim()),Espo.Ajax.postRequest(`EmailTemplate/${e}/prepare`,{emailAddress:s,parentType:this.model.get("parentType"),parentId:this.model.get("parentId"),relatedType:this.model.get("relatedType"),relatedId:this.model.get("relatedId")}).then(e=>{this.model.trigger("insert-template",e),this.emptyField()}).catch(()=>{this.emptyField()})}emptyField(){this.model.set(this.idName,null),this.model.set(this.nameName,null)}}e.default=i}),define("views/email/fields/replies",["exports","views/fields/link-multiple"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getAttributeList(){const e=super.getAttributeList();return e.push(this.name+"Columns"),e}getDetailLinkHtml(e){var t=super.getDetailLinkHtml(e),e=((this.model.get(this.name+"Columns")||{})[e]||{}).status;return $("<div>").append($("<span>").addClass("fas fa-arrow-right fa-sm link-multiple-item-icon").addClass("Draft"===e?"text-warning":"text-success")).append(t).html()}}e.default=i}),define("views/email/fields/replied",["exports","views/fields/link"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{afterRender(){if(super.afterRender(),this.mode===this.MODE_DETAIL){const e=this.$el.find("a");e.get(0)&&$('<span class="fas fa-arrow-left fa-sm link-field-icon text-soft"></span>').insertBefore(e)}}}e.default=i}),define("views/email/fields/person-string-data-for-expanded",["exports","views/email/fields/person-string-data"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{listTemplate="email/fields/person-string-data/list-for-expanded"}e.default=i}),define("views/email/fields/icon",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{listTemplate="email/fields/icon/detail";detailTemplate="email/fields/icon/detail"}e.default=i}),define("views/email/fields/has-attachment",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{listTemplate="email/fields/has-attachment/detail";detailTemplate="email/fields/has-attachment/detail";data(){const e=super.data();return e.isSmall=this.mode===this.MODE_LIST,e}setup(){super.setup(),this.addActionHandler("show",e=>{e.stopPropagation(),this.show()})}show(){Espo.Ui.notify(" ... "),this.createView("dialog","views/email/modals/attachments",{model:this.model}).then(e=>{e.render(),Espo.Ui.notify(!1)})}}e.default=i}),define("views/email/fields/from-email-address",["exports","views/fields/link"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{listTemplate="email/fields/from-email-address/detail";detailTemplate="email/fields/from-email-address/detail"}e.default=i}),define("views/email/fields/folder-string",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{detailTemplateContent=`
        {{#if valueIsSet}}
            {{#if value}}
                {{value}}
            {{else}}
                <span class="none-value">{{translate 'None'}}</span>
            {{/if}}
        {{else}}
            <span class="loading-value"></span>
        {{/if}}
    `;data(){return this.model.has("folderId")?{valueIsSet:!0,value:this.getFolderString()}:{valueIsSet:!1}}getAttributeList(){return["folderId","folderName","groupFolderId","groupFolderName","inArchive","inTrash","isUsersSent"]}getFolderString(){return this.model.get("inTrash")?this.translate("trash","presetFilters","Email"):this.model.get("isUsersSent")?this.translate("sent","presetFilters","Email"):this.model.get("inArchive")?this.translate("archive","presetFilters","Email"):this.model.get("folderName")?this.model.get("folderName"):this.model.get("groupFolderName")?this.model.get("groupFolderName"):this.model.get("isUsers")?this.translate("inbox","presetFilters","Email"):void 0}}e.default=i}),define("views/email/fields/email-address-varchar",["exports","views/fields/base","views/email/fields/from-address-varchar","views/email/fields/email-address","ui/autocomplete"],function(e,t,o,s,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),o=a(o),s=a(s),i=a(i);class l extends t.default{detailTemplate="email/fields/email-address-varchar/detail";editTemplate="email/fields/email-address-varchar/edit";emailAddressRegExp=new RegExp(/^[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+(?:\.[-!#$%&'*+/=?^_`{|}~A-Za-z0-9]+)*/.source+/@([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])?\.)+[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9]/.source);data(){const e=super.data();return e.valueIsSet=this.model.has(this.name),e.maxLength=254,e.hasSelectAddress=this.hasSelectAddress,e}events={'click a[data-action="clearAddress"]':function(e){e=$(e.currentTarget).data("address").toString();this.deleteAddress(e)},"keyup input":function(e){if(this.isEditMode()){var t=Espo.Utils.getKeyFromKeyEvent(e);if("Comma"===t||"Semicolon"===t||"Enter"===t){const s=$(e.currentTarget);t=this.obtainEmailAddressFromString(s.val());t&&(this.addAddress(t,""),s.val(""))}}},"change input":function(e){if(this.isEditMode()){const t=$(e.currentTarget);e=this.obtainEmailAddressFromString(t.val());e&&(this.addAddress(e,""),t.val(""))}},'click [data-action="createContact"]':function(e){e=$(e.currentTarget).data("address");o.default.prototype.createPerson.call(this,"Contact",e)},'click [data-action="createLead"]':function(e){e=$(e.currentTarget).data("address");o.default.prototype.createPerson.call(this,"Lead",e)},'click [data-action="addToContact"]':function(e){e=$(e.currentTarget).data("address");o.default.prototype.addToPerson.call(this,"Contact",e)},'click [data-action="addToLead"]':function(e){e=$(e.currentTarget).data("address");o.default.prototype.addToPerson.call(this,"Lead",e)},"auxclick a[href][data-scope][data-id]":function(e){if(1===e.button&&(e.ctrlKey||e.metaKey)){const i=$(e.currentTarget);var t=i.attr("data-id"),s=i.attr("data-scope");e.preventDefault(),e.stopPropagation(),o.default.prototype.quickView.call(this,{id:t,scope:s})}}};obtainEmailAddressFromString(e){e=(e=e.replace(",","").replace(";","").trim()).split(" ").find(e=>e.includes("@"));if(e&&this.checkEmailAddressInString(e))return e}getAutocompleteMaxCount(){return this.autocompleteMaxCount||this.getConfig().get("recordsPerPage")}getAttributeList(){const e=super.getAttributeList();return e.push("nameHash"),e.push("typeHash"),e.push("idHash"),e.push("accountId"),e.push(this.name+"EmailAddressesNames"),e.push(this.name+"EmailAddressesIds"),e}setup(){this.setupSelectAddress(),this.on("render",()=>this.initAddressList())}setupSelectAddress(){const e=this.getConfig().get("emailAddressSelectEntityTypeList")||[];this.selectAddressEntityTypeList=e.filter(e=>this.getAcl().checkScope(e)),this.hasSelectAddress=0!==this.selectAddressEntityTypeList.length,this.addActionHandler("selectAddress",()=>{var e=this.selectAddressEntityTypeList[0];this.processSelectEntityType(e)})}processSelectEntityType(s){var e,t,i=this.getMetadata().get(["clientDefs",s,"modalViews","select"])||"views/modals/select-records",a=this.translate("Select")+" Â· "+this.translate(this.name,"fields","Email");const o={emailAddress:{type:"isNotNull",data:{type:"isNotEmpty"}},emailAddressIsInvalid:{type:"isFalse",data:{type:"isFalse"}}};"Contact"===s&&(this.model.attributes.parentId&&"Account"===this.model.attributes.parentType||this.model.attributes.accountId)&&(e=this.model.attributes.accountId||this.model.attributes.parentId,t=this.model.attributes.accountId?this.model.attributes.accountName:this.model.attributes.parentName,o.accounts={field:"accounts",type:"linkedWith",value:[e],data:{nameHash:{[e]:t}}}),this.createView("dialog",i,{scope:s,multiple:!0,createButton:!1,mandatorySelectAttributeList:["emailAddress"],headerText:a,filters:o}).then(t=>{this.selectAddressEntityTypeList.forEach(e=>{t.addButton({name:"selectEntityType"+e,style:"text",position:"right",label:this.translate(e,"scopeNamesPlural"),className:e===s?"active btn-xs-wide":"btn-xs-wide",disabled:e===s,onClick:()=>{this.clearView("dialog"),this.processSelectEntityType(e)}},!1,!0)}),t.render(),this.listenToOnce(t,"select",e=>{e.filter(e=>e.attributes.emailAddress).forEach(e=>{var t=e.attributes.emailAddress;this.addressList.includes(t)||(this.addressList.push(t),this.nameHash[t]=e.attributes.name,this.idHash[t]=e.id,this.typeHash[t]=e.entityType,this.addAddressHtml(t,e.attributes.name))}),this.trigger("change")})})}initAddressList(){this.nameHash={},this.addressList=(this.model.get(this.name)||"").split(";").filter(e=>""!==e).map(e=>e.trim()),this.idHash=this.idHash||{},this.typeHash=this.typeHash||{},this.nameHash=this.nameHash||{},_.extend(this.typeHash,this.model.get("typeHash")||{}),_.extend(this.nameHash,this.model.get("nameHash")||{}),_.extend(this.idHash,this.model.get("idHash")||{}),this.nameHash=_.clone(this.nameHash),this.typeHash=_.clone(this.typeHash),this.idHash=_.clone(this.idHash)}afterRender(){if(super.afterRender(),this.isEditMode()){this.$input=this.$element=this.$el.find("input"),this.addressList.forEach(e=>{this.addAddressHtml(e,this.nameHash[e]||"")});let t;const e=new i.default(this.$input.get(0),{name:this.name,autoSelectFirst:!0,triggerSelectOnValidInput:!1,focusOnSelect:!0,minChars:1,forceHide:!0,onSelect:e=>{this.addAddress(e.emailAddress,e.entityName,e.entityType,e.entityId),this.$input.val("")},formatResult:e=>this.getHelper().escapeString(e.name)+" &#60;"+this.getHelper().escapeString(e.id)+"&#62;",lookupFunction:e=>(t&&t.getReadyState()<4&&t.abort(),(t=Espo.Ajax.getRequest("EmailAddress/search",{q:e,maxSize:this.getAutocompleteMaxCount(),onlyActual:!0})).then(e=>e.map(e=>({id:e.emailAddress,name:e.entityName,emailAddress:e.emailAddress,entityId:e.entityId,entityName:e.entityName,entityType:e.entityType,data:e.emailAddress,value:e.emailAddress}))))});this.once("render remove",()=>e.dispose())}"search"===this.mode&&this.getAcl().check("Email","create")&&s.default.prototype.initSearchAutocomplete.call(this),"search"===this.mode&&this.$input.on("input",()=>{this.trigger("change")})}checkEmailAddressInString(e){e=e.match(this.emailAddressRegExp);if(e&&e.length)return!0}addAddress(e,t,s,i){if(this.justAddedAddress&&this.deleteAddress(this.justAddedAddress),this.justAddedAddress=e,setTimeout(()=>{this.justAddedAddress=null},100),e=e.trim(),!s){var a=e.match(this.emailAddressRegExp);if(!a||!a.length)return;e=a[0]}~this.addressList.indexOf(e)||(this.addressList.push(e),this.nameHash[e]=t,s&&(this.typeHash[e]=s),i&&(this.idHash[e]=i),this.addAddressHtml(e,t),this.trigger("change"))}addAddressHtml(e,t){const s=this.$el.find(".link-container"),i=$("<span>");t&&i.append($("<span>").text(t)," ",$("<span>").addClass("text-muted middle-dot")," "),i.append($("<span>").text(e));t=$("<div>").attr("data-address",e).addClass("list-group-item").append($("<a>").attr("data-address",e).attr("role","button").attr("tabindex","0").attr("data-action","clearAddress").addClass("pull-right").append($("<span>").addClass("fas fa-times")),i);s.append(t)}deleteAddress(e){this.deleteAddressHtml(e);var t=this.addressList.indexOf(e);-1<t&&this.addressList.splice(t,1),delete this.nameHash[e],this.trigger("change")}deleteAddressHtml(e){this.$el.find('.list-group-item[data-address="'+e+'"]').remove()}fetch(){const e={};return e[this.name]=this.addressList.join(";"),e}fetchSearch(){var e=this.$element.val().trim();return e?{type:"equals",value:e}:null}getValueForDisplay(){if(this.isDetailMode()){const t=[];return this.addressList.forEach(e=>{t.push(this.getDetailAddressHtml(e))}),t.join("")}}getDetailAddressHtml(e){if(!e)return"";var t=this.nameHash[e]||null,s=this.typeHash[e]||null,i=this.idHash[e]||null;if(i)return $("<div>").append($("<a>").attr("href","#"+s+"/view/"+i).attr("data-scope",s).attr("data-id",i).text(t),' <span class="text-muted middle-dot"></span> ',$("<span>").text(e)).get(0).outerHTML;const a=$("<div>");return t?a.append($("<span>").addClass("email-address-line").text(t).append(' <span class="text-muted middle-dot"></span> ').append($("<span>").text(e))):a.append($("<span>").addClass("email-address-line").text(e)),(this.getAcl().check("Contact","create")||this.getAcl().check("Lead","create"))&&a.prepend(o.default.prototype.getCreateHtml.call(this,e)),a.get(0).outerHTML}validateRequired(){return"Draft"!==this.model.get("status")&&super.validateRequired()}}e.default=l}),define("views/email/fields/created-event",["exports","views/fields/link-parent"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{data(){const e=super.data();var t=this.model.get("icsEventData")||{};return this.isReadMode()&&!e.idValue&&t.createdEvent&&(e.idValue=t.createdEvent.id,e.typeValue=t.createdEvent.entityType,e.nameValue=t.createdEvent.name),e}getAttributeList(){const e=super.getAttributeList();return e.push("icsEventData"),e}}e.default=i}),define("views/email/fields/create-event",["exports","views/fields/base"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{detailTemplate="email/fields/create-event/detail";eventEntityType="Meeting";getAttributeList(){return["icsEventData","createdEventId"]}setup(){super.setup(),this.addActionHandler("createEvent",()=>this.createEvent())}createEvent(){var e=this.getMetadata().get(["clientDefs",this.eventEntityType,"modalViews","edit"])||"views/modals/edit",t=this.model.get("icsEventData")||{};const s=Espo.Utils.cloneDeep(t.valueMap||{});s.parentId=this.model.get("parentId"),s.parentType=this.model.get("parentType"),s.parentName=this.model.get("parentName"),this.addFromAddressToAttributes(s),this.createView("dialog",e,{attributes:s,scope:this.eventEntityType}).then(e=>{e.render(),this.listenToOnce(e,"after:save",()=>{this.model.fetch().then(()=>Espo.Ui.success(this.translate("Done")))})})}addFromAddressToAttributes(e){var t=this.model.get("from"),s=this.model.get("idHash")||{},i=this.model.get("typeHash")||{},a=this.model.get("nameHash")||{},o=null,l=null,d=null;t&&(o=s[t]||null,l=i[t]||null,d=a[t]||null,(s=this.getAttendeeLink(l))&&(e[s+"Ids"]=e[s+"Ids"]||[],e[s+"Names"]=e[s+"Names"]||{},~e[s+"Ids"].indexOf(o)||(e[s+"Ids"].push(o),e[s+"Names"][o]=d)))}getAttendeeLink(e){return"User"===e?"users":"Contact"===e?"contacts":"Lead"===e?"leads":null}}e.default=i}),define("views/email/fields/compose-from-address",["exports","views/fields/base","ui/select"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{detailTemplate="email/fields/email-address-varchar/detail";editTemplate="email/fields/compose-from-address/edit";data(){let e=this.translate("noSmtpSetup","messages","Email");var t=$("<a>").attr("href","#EmailAccount").text(this.translate("EmailAccount","scopeNamesPlural")).get(0).outerHTML;return e=e.replace("{link}",t),{list:this.list,noSmtpMessage:e,...super.data()}}setup(){super.setup(),this.nameHash={...this.model.get("nameHash")||{}},this.typeHash=this.model.get("typeHash")||{},this.idHash=this.model.get("idHash")||{},this.list=this.getUser().get("emailAddressList")||[]}afterRenderEdit(){this.$element.length&&s.default.init(this.$element)}getValueForDisplay(){var e;return this.isDetailMode()?(e=this.model.get(this.name),this.getDetailAddressHtml(e)):super.getValueForDisplay()}getDetailAddressHtml(e){if(!e)return"";var t=this.nameHash[e]||null,s=this.typeHash[e]||null,i=this.idHash[e]||null;if(i&&t)return $("<div>").append($("<a>").attr("href",`#${s}/view/`+i).attr("data-scope",s).attr("data-id",i).text(t)," ",$("<span>").addClass("text-muted chevron-right")," ",$("<span>").text(e)).get(0).outerHTML;const a=$("<div>");return t?a.append($("<span>").addClass("email-address-line").text(t).append(" ",$("<span>").addClass("text-muted chevron-right")," ",$("<span>").text(e))):a.append($("<span>").addClass("email-address-line").text(e)),a.get(0).outerHTML}}e.default=a}),define("views/email/fields/body",["exports","views/fields/wysiwyg"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{useIframe=!0;hasBodyPlainField=!0;toShowQuotePart=!1;replyPart;getAttributeList(){return["body","bodyPlain"]}setupToolbar(){super.setupToolbar();const e=this.toolbar.find(e=>"attachment"===e[0]);e?e[1].push("insert-field"):this.toolbar.push(["insert-field",["insert-field"]]),this.buttons["insert-field"]=()=>{const e=$.summernote.ui,t=e.button({contents:'<i class="fas fa-plus"></i>',tooltip:this.translate("Insert Field","labels","Email"),click:()=>{this.showInsertFieldModal()}});return t.render()},this.listenTo(this.model,"change",e=>{this.isRendered()&&(e.hasChanged("parentId")||e.hasChanged("to"))&&this.controlInsertFieldButton()})}onEditModeSet(){return this.toShowQuotePart=!1,super.onEditModeSet()}afterRender(){super.afterRender(),this.controlInsertFieldButton(),this.isReadMode()&&this.replyPart&&this.element.appendChild(this.createShowQuotePartButton())}controlInsertFieldButton(){const e=this.$el.find(".note-insert-field > button");this.model.get("to")&&this.model.get("to").length||this.model.get("parentId")?e.removeAttr("disabled").removeClass("disabled"):e.attr("disabled","disabled").addClass("disabled")}showInsertFieldModal(){let e=this.model.get("to");e=e&&e.split(";")[0].trim();var t=this.model.get("parentId"),s=this.model.get("parentType");Espo.Ui.notify(" ... "),this.createView("insertFieldDialog","views/email/modals/insert-field",{parentId:t,parentType:s,to:e},e=>{e.render(),Espo.Ui.notify(),this.listenToOnce(e,"insert",e=>{this.$summernote&&(e.includes("\n")?(e=e.replace(/\r\n|\r|\n/g,"<br>"),this.$summernote.summernote("editor.pasteHTML","<p>"+e+"</p>")):this.$summernote.summernote("editor.insertText",e)),this.clearView("insertFieldDialog")})})}getValueForIframe(){let e=super.getValueForIframe();return this.toShowQuotePart?(this.replyPart=void 0,e):(this.replyPart=void 0,e=this.processQuotePart(e),this.replyPart,e)}getValueForEdit(){this.replyPart=void 0;var e=super.getValueForEdit();return this.processQuotePart(e,!0)}processQuotePart(e,t){const s=document.createElement("div");s.innerHTML=e;let i=':scope > [data-quote-start="true"]',a=(t||(i+=", :scope > blockquote:last-child, :scope > div:last-child > blockquote:last-child"),s.querySelector(i));if(!a)return e;s.querySelectorAll('style, link[ref="stylesheet"]').forEach(e=>{e.parentElement.removeChild(e)}),this.replyPart="";const o=[];for(;a;)this.replyPart+=a.outerHTML,o.push(a),a=a.nextElementSibling;return o.forEach(e=>e.parentElement.removeChild(e)),t&&this.element.appendChild(this.createShowQuotePartButton()),s.innerHTML}createShowQuotePartButton(){const e=this.showQuoteButtonElement=document.createElement("a");return e.setAttribute("role","button"),e.innerHTML="...",e.classList.add("show-quote-button","btn","btn-default","btn-sm"),e.addEventListener("click",()=>this.showQuotePart()),e}showQuotePart(){if(this.isReadMode())return this.toShowQuotePart=!0,void this.reRender();var e=this.$summernote.summernote("code")+this.replyPart;this.replyPart=void 0,this.showQuoteButtonElement.parentElement.removeChild(this.showQuoteButtonElement),this.$summernote.summernote("code",e)}fetch(){const e=super.fetch();return this.model.attributes.isHtml&&this.replyPart&&(null==e[this.name]&&(e[this.name]=""),e[this.name]+=this.replyPart),e}}e.default=i}),define("views/dashboard-template/detail",["exports","views/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{actionDeployToUsers(){this.createView("dialog","views/dashboard-template/modals/deploy-to-users",{model:this.model},e=>{e.render()})}actionDeployToTeam(){this.createView("dialog","views/dashboard-template/modals/deploy-to-team",{model:this.model},e=>{e.render()})}}e.default=i}),define("views/dashboard-template/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{massActionList=["remove","export"]}e.default=i}),define("views/dashboard-template/modals/deploy-to-users",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{className="dialog dialog-record";templateContent='<div class="record">{{{record}}}</div>';setup(){this.buttonList=[{name:"deploy",text:this.translate("Deploy for Users","labels","DashboardTemplate"),style:"danger",onClick:()=>this.actionDeploy()},{name:"cancel",label:"Cancel"}],this.headerText=this.model.get("name"),this.formModel=new s.default,this.formModel.name="None",this.formModel.setDefs({fields:{users:{type:"linkMultiple",view:"views/fields/users",entity:"User",required:!0},append:{type:"bool"}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",model:this.formModel,selector:".record",detailLayout:[{rows:[[{name:"users",labelText:this.translate("users","links")},{name:"append",labelText:this.translate("append","fields","DashboardTemplate")}]]}]})}getRecordView(){return this.getView("record")}actionDeploy(){this.getRecordView().processFetch()&&Espo.Ajax.postRequest("DashboardTemplate/action/deployToUsers",{id:this.model.id,userIdList:this.formModel.get("usersIds"),append:this.formModel.get("append")}).then(()=>{Espo.Ui.success(this.translate("Done")),this.close()})}}e.default=a}),define("views/dashboard-template/modals/deploy-to-team",["exports","views/modal","model"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{className="dialog dialog-record";templateContent='<div class="record">{{{record}}}</div>';setup(){this.buttonList=[{name:"deploy",text:this.translate("Deploy for Team","labels","DashboardTemplate"),style:"danger",onClick:()=>this.actionDeploy()},{name:"cancel",label:"Cancel"}],this.headerText=this.model.get("name"),this.formModel=new s.default,this.formModel.name="None",this.formModel.setDefs({fields:{team:{type:"link",entity:"Team",required:!0},append:{type:"bool"}}}),this.createView("record","views/record/edit-for-modal",{scope:"None",model:this.formModel,selector:".record",detailLayout:[{rows:[[{name:"team",labelText:this.translate("team","links")},{name:"append",labelText:this.translate("append","fields","DashboardTemplate")}]]}]})}getRecordView(){return this.getView("record")}actionDeploy(){this.getRecordView().processFetch()&&Espo.Ajax.postRequest("DashboardTemplate/action/deployToTeam",{id:this.model.id,teamId:this.formModel.get("teamId"),append:this.formModel.get("append")}).then(()=>{Espo.Ui.success(this.translate("Done")),this.close()})}}e.default=a}),define("views/attachment/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{rowActionsView="views/record/row-actions/view-and-remove";massActionList=["remove"]}e.default=i}),define("views/attachment/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{readOnly=!0}e.default=i}),define("views/attachment/modals/select-one",["exports","views/modal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{backdrop=!0;templateContent=`<ul class="list-group no-side-margin">
            {{#each viewObject.options.dataList}}
                <li class="list-group-item"
                ><a
                    role="button"
                    class="action"
                    data-action="select"
                    data-id="{{id}}"
                >{{name}}</a></li>
            {{/each}}
            </ul>
        `;setup(){this.headerText=this.translate("Select"),this.options.fieldLabel&&(this.headerText+=": "+this.options.fieldLabel)}actionSelect(e){this.trigger("select",e.id),this.remove()}}e.default=i}),define("views/attachment/modals/detail",["exports","views/modals/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{editDisabled=!0}e.default=i}),define("views/attachment/fields/parent",["exports","views/fields/link-parent"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{ignoreScopeList=["Preferences","ExternalAccount","Notification","Note","ArrayValue","Attachment"];displayEntityType=!0;setup(){super.setup(),this.foreignScopeList=this.getMetadata().getScopeEntityList().filter(e=>!(!this.getUser().isAdmin()&&!this.getAcl().checkScopeHasAcl(e))&&(!this.ignoreScopeList.includes(e)&&!!this.getAcl().checkScope(e))),this.getLanguage().sortEntityList(this.foreignScopeList),this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0]}}e.default=i}),define("views/attachment/fields/name",["exports","views/fields/varchar"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{detailTemplate="attachment/fields/name/detail";data(){const e=super.data();let t=this.getBasePath()+"?entryPoint=download&id="+this.model.id;return this.getUser().get("portalId")&&(t+="&portalId="+this.getUser().get("portalId")),e.url=t,e}}e.default=i}),define("views/api-user/list",["exports","views/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getCreateAttributes(){return{type:"api"}}}e.default=i}),define("views/address-map/view",["exports","views/main"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{templateContent=`
        <div class="header page-header">{{{header}}}</div>
        <div class="map-container">{{{map}}}</div>
    `;setup(){this.scope=this.model.entityType,this.createView("header","views/header",{model:this.model,fullSelector:"#main > .header",scope:this.model.entityType,fontSizeFlexible:!0})}afterRender(){var e=this.options.field,t=this.model.getFieldParam(e+"Map","view")||this.getFieldManager().getViewName("map");this.createView("map",t,{model:this.model,name:e+"Map",selector:".map-container",height:this.getHelper().calculateContentContainerHeight(this.$el.find(".map-container"))},e=>{e.render()})}getHeader(){let e=this.model.get("name");e=e||this.model.id;var t=`#${this.model.entityType}/view/`+this.model.id,s=this.getLanguage().translate(this.model.entityType,"scopeNamesPlural"),i=this.translate(this.options.field,"fields",this.model.entityType),a=this.options.rootUrl||this.options.params.rootUrl||"#"+this.model.entityType;const o=$("<a>").attr("href",t).append($("<span>").addClass("font-size-flexible title").text(e)),l=(this.model.get("deleted")&&o.css("text-decoration","line-through"),$("<span>").append($("<a>").attr("href",a).addClass("action").attr("data-action","navigateToRoot").text(s)));t=this.getHeaderIconHtml(),t&&l.prepend(t),a=$("<span>").text(i);return this.buildHeaderHtml([l,o,a])}}e.default=i}),define("views/action-history-record/record/list",["exports","views/record/list"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{rowActionsView="views/record/row-actions/view-and-remove";massActionList=["remove","export"]}e.default=i}),define("views/action-history-record/modals/detail",["exports","views/modals/detail"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{fullFormDisabled=!0;editDisabled=!0;sideDisabled=!0}e.default=i}),define("views/action-history-record/fields/target",["exports","views/fields/link-parent"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{displayScopeColorInListMode=!0;ignoreScopeList=["Preferences","ExternalAccount","Notification","Note","ArrayValue"];setup(){super.setup(),this.foreignScopeList=this.getMetadata().getScopeEntityList().filter(e=>!(!this.getUser().isAdmin()&&!this.getAcl().checkScopeHasAcl(e))&&(!this.ignoreScopeList.includes(e)&&!!this.getAcl().checkScope(e))),this.getLanguage().sortEntityList(this.foreignScopeList),this.foreignScope=this.model.get(this.typeName)||this.foreignScopeList[0]}}e.default=i}),define("views/action-history-record/fields/target-type",["exports","views/fields/enum"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{setupOptions(){super.setupOptions(),this.params.options=this.getMetadata().getScopeEntityList()}}e.default=i}),define("helpers/misc/list-select-attributes",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e,t,s){this.scope=e,this.storage=t,this.key="textSearches",this.maxCount=s||100,this.list=null}match(e,t){e=e.toLowerCase().trim();const s=[];for(const i of this.get())if(i.toLowerCase().startsWith(e)&&s.push(i),void 0!==t&&s.length===t)break;return s}get(){return null===this.list&&(this.list=this.getFromStorage()),this.list}getFromStorage(){return this.storage.get(this.key,this.scope)||[]}store(e){e=e.trim();let t=this.getFromStorage();var s=t.indexOf(e);-1!==s&&t.splice(s,1),t.unshift(e),t.length>this.maxCount&&(t=t.slice(0,this.maxCount)),this.list=t,this.storage.set(this.key,this.scope,t)}remove(e){e=e.trim();const t=this.getFromStorage();e=t.indexOf(e);-1!==e&&(t.splice(e,1),this.list=t,this.storage.set(this.key,this.scope,t))}}}),define("handlers/working-time-range",["exports","bullbone"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s{constructor(e){this.view=e}process(){this.listenTo(this.view.model,"change:dateStart",(e,t,s)=>{s.ui&&!e.get("dateEnd")&&setTimeout(()=>e.set("dateEnd",t),50)})}}Object.assign(s.prototype,t.Events),e.default=s}),define("handlers/navbar-menu",["exports","action-handler"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{logout(){this.view.getRouter().logout()}lastViewed(){Espo.Ui.notify(" ... "),this.view.createView("dialog","views/modals/last-viewed",{},e=>{e.render(),Espo.Ui.notify(!1)})}}e.default=i}),define("handlers/import",["exports","action-handler"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{actionErrorExport(){Espo.Ajax.postRequest(`Import/${this.view.model.id}/exportErrors`).then(e=>{var t;if(!e.attachmentId)return t=this.view.translate("noErrors","messages","Import"),void Espo.Ui.warning(t);window.location=this.view.getBasePath()+"?entryPoint=download&id="+e.attachmentId})}}e.default=i}),define("handlers/email-filter",["exports","dynamic-handler"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{init(){this.model.isNew()&&(this.recordView.getUser().isAdmin()||this.recordView.hideField("isGlobal")),this.model.isNew()||this.recordView.getUser().isAdmin()||this.model.get("isGlobal")||this.recordView.hideField("isGlobal"),this.model.isNew()&&!this.model.get("parentId")?(this.model.set("parentType","User"),this.model.set("parentId",this.recordView.getUser().id),this.model.set("parentName",this.recordView.getUser().get("name")),this.recordView.getUser().isAdmin()||this.recordView.setFieldReadOnly("parent")):this.model.get("parentType")&&!this.recordView.options.duplicateSourceId&&(this.recordView.setFieldReadOnly("parent"),this.recordView.setFieldReadOnly("isGlobal")),this.recordView.listenTo(this.model,"change:isGlobal",(e,t,s)=>{s.ui&&t&&this.model.set({action:"Skip",parentName:null,parentType:null,parentId:null,emailFolderId:null,groupEmailFolderId:null,markAsRead:!1})}),this.recordView.listenTo(this.model,"change:parentType",(e,t,s)=>{s.ui&&setTimeout(()=>("User"!==t&&this.model.set("markAsRead",!1),"EmailAccount"===t?(this.model.set("action","Skip"),this.model.set("emailFolderId",null),this.model.set("groupEmailFolderId",null),void this.model.set("markAsRead",!1)):"InboundEmail"!==t?("Move to Group Folder"===this.model.get("action")&&this.model.set("action","Skip"),void this.model.set("groupEmailFolderId",null)):void("User"!==t&&("Move to Folder"===this.model.get("action")&&this.model.set("action","Skip"),this.model.set("groupFolderId",null)))),40)})}}e.default=i}),define("handlers/user/change-team-position-row-action",["exports","handlers/row-action","views/user/modals/select-position"],function(e,t,l){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),l=s(l);class i extends t.default{async process(t,e){if(t.collection&&t.collection.parentModel){const a=t.collection.parentModel;var s=a.attributes.positionList||[],i=t.attributes.teamRole;const o=new l.default({position:i,positionList:s,name:t.attributes.name,onApply:e=>{this.savePosition(a.id,t,e)}});await this.view.assignView("dialog",o),await o.render()}else console.error("Team model cannot be obtained.")}isAvailable(e,t){return!(!e.collection||!e.collection.parentModel)&&(!!this.view.getAcl().checkModel(e,"edit")&&!!this.view.getUser().isAdmin())}async savePosition(e,t,s){Espo.Ui.notify(" ... "),await Espo.Ajax.putRequest(`Team/${e}/userPosition`,{id:t.id,position:s}),t.setMultiple({teamRole:s}),Espo.Ui.success(this.view.translate("Saved"))}}e.default=i}),define("handlers/select-related/same-account",["exports","handlers/select-related"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getFilters(e){const t={};let s=null,i=null;return e.get("accountId")&&(s=e.get("accountId"),i=e.get("accountName")),!s&&"Account"===e.get("parentType")&&e.get("parentId")&&(s=e.get("parentId"),i=e.get("parentName")),s&&(t.account={attribute:"accountId",type:"equals",value:s,data:{type:"is",nameValue:i}}),Promise.resolve({advanced:t})}}e.default=i}),define("handlers/select-related/same-account-many",["exports","handlers/select-related"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{getFilters(e){const t={};let s=null,i=null;if(e.get("accountId")&&(s=e.get("accountId"),i=e.get("accountName")),!s&&"Account"===e.get("parentType")&&e.get("parentId")&&(s=e.get("parentId"),i=e.get("parentName")),s){const a={};a[s]=i,t.accounts={field:"accounts",type:"linkedWith",value:[s],data:{nameHash:a}}}return Promise.resolve({advanced:t})}}e.default=i}),define("handlers/record/view-audit-log",["exports","views/stream/modals/view-audit-log"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=(s=t)&&s.__esModule?s:{default:s};e.default=class{constructor(e){this.view=e,this.metadata=e.getMetadata(),this.entityType=this.view.entityType,this.model=this.view.model,this.hasAudited=this.metadata.get(`scopes.${this.entityType}.stream`)&&this.metadata.get(`scopes.${this.entityType}.statusField`)||void 0!==this.model.getFieldList().find(e=>this.model.getFieldParam(e,"audited")),"User"!==this.entityType||this.view.getUser().isAdmin()||(this.hasAudited=!1),this.view.getUser().isPortal()&&(this.hasAudited=!1),"yes"!==this.view.getAcl().getPermissionLevel("audit")&&(this.hasAudited=!1)}isAvailable(){return this.hasAudited}show(){const e=new t.default({model:this.model});this.view.assignView("dialog",e).then(()=>{e.render()})}}}),define("handlers/map/google-maps-renderer",["exports","handlers/map/renderer"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{render(t){if("google"in window&&window.google.maps)this.initMapGoogle(t);else if("function"!=typeof window.mapapiloaded){window.mapapiloaded=()=>this.initMapGoogle(t);let e="https://maps.googleapis.com/maps/api/js?callback=mapapiloaded";var s=this.view.getConfig().get("googleMapsApiKey");s&&(e+="&key="+s);const i=document.createElement("script");i.setAttribute("async","async"),i.src=e,document.head.appendChild(i)}else{const e=window.mapapiloaded;void(window.mapapiloaded=()=>{this.initMapGoogle(t),e()})}}initMapGoogle(e){const t=new google.maps.Geocoder;let s;try{s=new google.maps.Map(this.view.$el.find(".map").get(0),{zoom:15,center:{lat:0,lng:0},scrollwheel:!1})}catch(e){return void console.error(e.message)}let i="";e.street&&(i+=e.street),e.city&&(""!==i&&(i+=", "),i+=e.city),e.state&&(""!==i&&(i+=", "),i+=e.state),e.postalCode&&(e.state||e.city?i+=" ":i&&(i+=", "),i+=e.postalCode),e.country&&(""!==i&&(i+=", "),i+=e.country),t.geocode({address:i},(e,t)=>{t===google.maps.GeocoderStatus.OK&&(s.setCenter(e[0].geometry.location),new google.maps.Marker({map:s,position:e[0].geometry.location}))})}}e.default=i}),define("handlers/login/oidc",["exports","handlers/login","js-base64"],function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),a=s(a);class i extends t.default{process(){const i=window.open("about:blank","ConnectWithOAuth","location=0,status=0,width=800,height=800");return Espo.Ui.notify(" ... "),new Promise((s,t)=>{Espo.Ajax.getRequest("Oidc/authorizationData").then(e=>{Espo.Ui.notify(!1),this.processWithData(e,i).then(e=>{var t=e.code,e=e.nonce,t=a.default.encode("**oidc:"+t);s({"Espo-Authorization":t,Authorization:"Basic "+t,"X-Oidc-Authorization-Nonce":e})}).catch(()=>{i.close(),t()})}).catch(()=>{Espo.Ui.notify(!1),i.close(),t()})})}processWithData(e,t){var s=(Math.random()+1).toString(36).substring(4),i=(Math.random()+1).toString(36).substring(4);const a={client_id:e.clientId,redirect_uri:e.redirectUri,response_type:"code",scope:e.scopes.join(" "),state:s,nonce:i,prompt:e.prompt},o=(!e.maxAge&&0!==e.maxAge||(a.max_age=e.maxAge),e.claims&&(a.claims=e.claims),Object.entries(a).map(([e,t])=>e+"="+encodeURIComponent(t)));e=e.endpoint+"?"+o.join("&");return this.processWindow(e,s,i,t)}processWindow(e,o,l,d){return d.location.href=e,new Promise((s,e)=>{const i=()=>{window.clearInterval(a),d.closed||d.close(),e()},a=window.setInterval(()=>{if(d.closed)i();else{let e;try{e=d.location.href}catch(e){return}var t;if(e)return(t=this.parseWindowUrl(e))?(t.error||t.code)&&t.state!==o?(i(),void Espo.Ui.error("State mismatch",!0)):t.error?(i(),void Espo.Ui.error(t.errorDescription||this.loginView.translate("Error"),!0)):void(t.code&&(window.clearInterval(a),d.close(),s({code:t.code,nonce:l}))):(i(),void Espo.Ui.error("Could not parse URL",!0))}},300)})}parseWindowUrl(e){try{const t=new URL(e).searchParams;return{code:t.get("code"),state:t.get("state"),error:t.get("error"),errorDescription:t.get("errorDescription")}}catch(e){return null}}}e.default=i}),define("handlers/email/list-actions",["exports","action-handler","views/email/modals/import-eml"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),s=i(s);class a extends t.default{async importEml(){const e=new s.default;await this.view.assignView("dialog",e),await e.render()}checkImportEml(){const e=this.view.getAcl();return e.checkScope("Email","create")&&e.checkScope("Import")}}e.default=a}),define("handlers/admin/address-country/populate-defaults",["exports","action-handler"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{async populate(){var e=this.view.translate("confirmPopulateDefaults","messages","AddressCountry");await this.view.confirm(e),Espo.Ui.notify(" ... "),await Espo.Ajax.postRequest("AddressCountry/action/populateDefaults"),await this.view.collection.fetch(),Espo.Ui.success(this.view.translate("Done"))}}e.default=i}),define("acl-portal/preferences",["exports","acl-portal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{checkIsOwner(e){return this.getUser().id===e.id}}e.default=i}),define("acl-portal/notification",["exports","acl-portal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{checkIsOwner(e){return this.getUser().id===e.get("userId")}}e.default=i}),define("acl-portal/email",["exports","acl-portal"],function(e,t){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class i extends(t=(s=t)&&s.__esModule?s:{default:s}).default{checkModelRead(e,t,s){var i=this.checkModel(e,t,"read",s);if(i)return!0;if(!1===t)return!1;if("no"===(t||{}).read)return!1;if(e.has("usersIds")){if(~(e.get("usersIds")||[]).indexOf(this.getUser().id))return!0}else if(s)return null;return i}}e.default=i});
//# sourceMappingURL=espo-extra.js.map