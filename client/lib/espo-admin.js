/*! espocrm 2024-10-10 */
define("views/admin/layouts/base",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope;type;events={'click button[data-action="save"]':function(){this.actionSave()},'click button[data-action="cancel"]':function(){this.cancel()},'click button[data-action="resetToDefault"]':function(){this.confirm(this.translate("confirmation","messages"),()=>{this.resetToDefault()})},'click button[data-action="remove"]':function(){this.actionDelete()}};buttonList=[{name:"save",label:"Save",style:"primary"},{name:"cancel",label:"Cancel"}];dataAttributes=null;dataAttributesDefs=null;dataAttributesDynamicLogicDefs=null;setup(){this.buttonList=_.clone(this.buttonList),this.events=_.clone(this.events),this.scope=this.options.scope,this.type=this.options.type,this.realType=this.options.realType,this.setId=this.options.setId,this.em=this.options.em;var e=this.getMetadata().get(["clientDefs",this.scope,"additionalLayouts",this.type])??{};this.typeDefs=e,this.dataAttributeList=Espo.Utils.clone(e.dataAttributeList||this.dataAttributeList),this.isCustom=!!e.isCustom,this.isCustom&&this.em&&this.buttonList.push({name:"remove",label:"Remove"}),this.isCustom||this.buttonList.push({name:"resetToDefault",label:"Reset to Default"})}actionSave(){this.disableButtons(),Espo.Ui.notify(this.translate("saving","messages")),this.save(this.enableButtons.bind(this))}disableButtons(){this.$el.find(".button-container button").attr("disabled","disabled")}enableButtons(){this.$el.find(".button-container button").removeAttr("disabled")}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}setIsChanged(){this.isChanged=!0,this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.setConfirmLeaveOut(!1)}save(e){var t=this.fetch();if(!this.validate(t))return this.enableButtons(),!1;this.getHelper().layoutManager.set(this.scope,this.type,t,()=>{Espo.Ui.success(this.translate("Saved")),this.setIsNotChanged(),"function"==typeof e&&e(),this.getHelper().broadcastChannel.postMessage("update:layout")},this.setId).catch(()=>this.enableButtons())}resetToDefault(){this.getHelper().layoutManager.resetToDefault(this.scope,this.type,()=>{this.loadLayout(()=>{this.setIsNotChanged(),this.prepareLayout().then(()=>this.reRender())})},this.options.setId)}prepareLayout(){return Promise.resolve()}reset(){this.render()}fetch(){}unescape(e){if(null===e)return"";const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"};var i=new RegExp("("+_.keys(t).join("|")+")","g");return(""+e).replace(i,e=>t[e])}getEditAttributesModalViewOptions(e){return{name:e.name,scope:this.scope,attributeList:this.dataAttributeList,attributeDefs:this.dataAttributesDefs,dynamicLogicDefs:this.dataAttributesDynamicLogicDefs,attributes:e,languageCategory:this.languageCategory,headerText:" "}}openEditDialog(e){const a=e.name;e=this.getEditAttributesModalViewOptions(e);this.createView("editModal","views/admin/layouts/modals/edit-attributes",e,s=>{s.render(),this.listenToOnce(s,"after:save",e=>{this.trigger("update-item",a,e);const t=$("#layout ul > li[data-name='"+a+"']");for(const i in e)t.attr("data-"+i,e[i]),t.data(i,e[i]),t.find("."+i+"-value").text(e[i]);s.close(),this.setIsChanged()})})}cancel(){this.loadLayout(()=>{this.setIsNotChanged(),this.em?this.trigger("cancel"):this.prepareLayout().then(()=>this.reRender())})}validate(e){return!0}actionDelete(){this.confirm(this.translate("confirmation","messages")).then(()=>{this.disableButtons(),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Layout/action/delete",{scope:this.scope,name:this.type}).then(()=>{Espo.Ui.success(this.translate("Removed"),{suppress:!0}),this.trigger("after-delete")}).catch(()=>{this.enableButtons()})})}}e.default=s}),define("views/admin/layouts/rows",["exports","views/admin/layouts/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/layouts/rows";dataAttributeList=null;dataAttributesDefs={};editable=!1;data(){return{scope:this.scope,type:this.type,buttonList:this.buttonList,enabledFields:this.enabledFields,disabledFields:this.disabledFields,layout:this.rowLayout,dataAttributeList:this.dataAttributeList,dataAttributesDefs:this.dataAttributesDefs,editable:this.editable}}setup(){this.itemsData={},super.setup(),this.events['click a[data-action="editItem"]']=e=>{e=$(e.target).closest("li").data("name");this.editRow(e)},this.on("update-item",(e,t)=>{this.itemsData[e]=Espo.Utils.cloneDeep(t)}),Espo.loader.require("res!client/css/misc/layout-manager-rows.css",e=>{this.$style=$("<style>").html(e).appendTo($("body"))})}onRemove(){this.$style&&this.$style.remove()}editRow(e){const t=Espo.Utils.cloneDeep(this.itemsData[e]||{});t.name=e,this.openEditDialog(t)}afterRender(){$("#layout ul.enabled, #layout ul.disabled").sortable({connectWith:"#layout ul.connected",update:e=>{$(e.target).hasClass("disabled")||(this.onDrop(e),this.setIsChanged())}}),this.$el.find(".enabled-well").focus()}onDrop(e){}fetch(){const a=[];return $("#layout ul.enabled > li").each((e,t)=>{const i={};t=$(t).data("name");const s=this.itemsData[t]||{};s.name=t,this.dataAttributeList.forEach(e=>{var t;(this.dataAttributesDefs[e]||{}).notStorable||(t=s[e]||null)&&(i[e]=t)}),a.push(i)}),a}validate(e){return 0!==e.length||(Espo.Ui.error(this.translate("cantBeEmpty","messages","LayoutManager")),!1)}}e.default=s}),define("views/admin/layouts/side-panels-detail",["exports","views/admin/layouts/rows"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataAttributeList=["name","dynamicLogicVisible","style","dynamicLogicStyled","sticked"];dataAttributesDefs={dynamicLogicVisible:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicVisible"},style:{type:"enum",options:["default","success","danger","warning","info"],style:{info:"info",success:"success",danger:"danger",warning:"warning"},default:"default",translation:"LayoutManager.options.style",tooltip:"panelStyle"},dynamicLogicStyled:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicStyled"},sticked:{type:"bool",tooltip:"sticked"},name:{readOnly:!0}};dataAttributesDynamicLogicDefs={fields:{dynamicLogicStyled:{visible:{conditionGroup:[{type:"and",value:[{attribute:"style",type:"notEquals",value:"default"},{attribute:"style",type:"isNotEmpty"}]}]}}}};editable=!0;ignoreList=[];viewType="detail";setup(){super.setup(),this.dataAttributesDefs=Espo.Utils.cloneDeep(this.dataAttributesDefs),this.dataAttributesDefs.dynamicLogicVisible.scope=this.scope,this.dataAttributesDefs.dynamicLogicStyled.scope=this.scope,this.wait(!0),this.loadLayout(()=>{this.wait(!1)})}loadLayout(t){this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{this.readDataFromLayout(e),t&&t()})}readDataFromLayout(l){const t=[],d={},r={};l=Espo.Utils.cloneDeep(l),!1===this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanel",this.viewType])||this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelDisabled"])||(t.push("default"),d.default="Default"),(this.getMetadata().get(["clientDefs",this.scope,"sidePanels",this.viewType])||[]).forEach(e=>{e.name&&(t.push(e.name),e.label&&(d[e.name]=e.label),r[e.name]=e)}),this.disabledFields=[],l=l||{},this.rowLayout=[],t.push("_delimiter_"),l._delimiter_||(l._delimiter_={disabled:!0}),t.forEach((e,t)=>{let i=!1;var s=l[e]||{};s.disabled&&(i=!0),l[e]||(r[e]||{}).disabled&&(i=!0);let a;if(a=d[e]?this.getLanguage().translate(d[e],"labels",this.scope):this.getLanguage().translate(e,"panels",this.scope),i){const n={name:e,labelText:a};return"_"===n.name[0]&&(n.notEditable=!0,"_delimiter_"===n.name&&(n.labelText=". . .")),void this.disabledFields.push(n)}const n={name:e,labelText:a};"_"===n.name[0]&&(n.notEditable=!0,"_delimiter_"===n.name&&(n.labelText=". . .")),n.name in r&&this.dataAttributeList.forEach(e=>{var t;"name"===e||e in(t=r[n.name]||{})&&(n[e]=t[e])});for(const o in s)n[o]=s[o];n.index="index"in s?s.index:t,this.rowLayout.push(n),this.itemsData[n.name]=Espo.Utils.cloneDeep(n)}),this.rowLayout.sort((e,t)=>e.index-t.index)}fetch(){const n={};return $("#layout ul.disabled > li").each((e,t)=>{t=$(t).attr("data-name");n[t]={disabled:!0}}),$("#layout ul.enabled > li").each((e,t)=>{const i=$(t),s={};t=i.attr("data-name");const a=this.itemsData[t]||{};a.name=t,this.dataAttributeList.forEach(e=>{"name"!==e&&e in a&&(s[e]=a[e])}),s.index=e,n[t]=s}),n}}e.default=s}),define("views/admin/dynamic-logic/conditions-string/item-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",data:function(){return{valueViewKey:this.getValueViewKey(),scope:this.scope,operator:this.operator,operatorString:this.operatorString,field:this.field,leftString:this.getLeftPartString()}},setup:function(){this.itemData=this.options.itemData,this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.operatorString=this.options.operatorString||this.operatorString,this.additionalData=this.itemData.data||{},this.field=(this.itemData.data||{}).field||this.itemData.attribute,this.wait(!0),this.isCurrentUser=this.itemData.attribute&&this.itemData.attribute.startsWith("$user."),this.isCurrentUser&&(this.scope="User"),this.getModelFactory().create(this.scope,e=>{this.model=e,this.populateValues(),this.createValueFieldView(),this.wait(!1)})},getLeftPartString:function(){if("$user.id"===this.itemData.attribute)return"$"+this.translate("User","scopeNames");let e=this.translate(this.field,"fields",this.scope);return e=this.isCurrentUser?"$"+this.translate("User","scopeNames")+"."+e:e},populateValues:function(){this.itemData.attribute&&this.model.set(this.itemData.attribute,this.itemData.value),this.model.set(this.additionalData.values||{})},getValueViewKey:function(){return"view-"+this.level.toString()+"-"+this.number.toString()+"-0"},getFieldValueView:function(){if("$user.id"===this.itemData.attribute)return"views/admin/dynamic-logic/fields/user-id";var e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base";return this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e)},createValueFieldView:function(){var e=this.getValueViewKey(),t=this.getFieldValueView();this.createView("value",t,{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]'})}})}),define("views/admin/layouts/grid",["exports","views/admin/layouts/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/layouts/grid";dataAttributeList=null;panels=null;columnCount=2;panelDataAttributeList=["panelName","style"];panelDataAttributesDefs={};panelDynamicLogicDefs=null;data(){return{scope:this.scope,type:this.type,buttonList:this.buttonList,enabledFields:this.enabledFields,disabledFields:this.disabledFields,panels:this.panels,columnCount:this.columnCount,panelDataList:this.getPanelDataList()}}additionalEvents={'click #layout a[data-action="addPanel"]':function(){this.addPanel(),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="removePanel"]':function(e){$(e.target).closest("ul.panels > li").find("ul.cells > li").each((e,t)=>{$(t).attr("data-name")&&$(t).appendTo($("#layout ul.disabled"))}),$(e.target).closest("ul.panels > li").remove();const i=$(e.currentTarget).data("number");this.clearView("panels-"+i);let s=-1;this.panels.forEach((e,t)=>{e.number===i&&(s=t)}),~s&&this.panels.splice(s,1),this.normalizeDisabledItemList(),this.setIsChanged()},'click #layout a[data-action="addRow"]':function(e){var t=this.unescape($("#layout-row-tpl").html()),t=_.template(t);$(e.target).closest("ul.panels > li").find("ul.rows").append(t),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="removeRow"]':function(e){$(e.target).closest("ul.rows > li").find("ul.cells > li").each((e,t)=>{$(t).attr("data-name")&&$(t).appendTo($("#layout ul.disabled"))}),$(e.target).closest("ul.rows > li").remove(),this.normalizeDisabledItemList(),this.setIsChanged()},'click #layout a[data-action="removeField"]':function(e){const t=$(e.target).closest("li");e=t.index();const i=t.parent(),s=(t.appendTo($("ul.disabled")),$($("#empty-cell-tpl").html()));if(1===parseInt(i.attr("data-cell-count")))for(let e=0;e<this.columnCount;e++)i.append(s.clone());else 0===e?i.prepend(s):s.insertAfter(i.children(":nth-child("+e+")"));const a=i.children().length;i.attr("data-cell-count",a.toString()),i.closest("li").attr("data-cell-count",a.toString()),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="minusCell"]':function(e){if(!(this.columnCount<2)){const t=$(e.currentTarget).closest("li"),i=t.parent(),s=(t.remove(),i.children().length||2);this.setIsChanged(),this.makeDraggable(),i.attr("data-cell-count",s.toString()),i.closest("li").attr("data-cell-count",s.toString())}},'click #layout a[data-action="plusCell"]':function(e){const t=$(e.currentTarget).closest("li"),i=t.find("ul");e=$($("#empty-cell-tpl").html());i.append(e);const s=i.children().length;i.attr("data-cell-count",s.toString()),i.closest("li").attr("data-cell-count",s.toString()),this.setIsChanged(),this.makeDraggable()},'click #layout a[data-action="edit-panel-label"]':function(e){const t=$(e.target).closest("header"),i=t.children("label");e=i.text();const s=t.closest("li"),a=s.data("number").toString(),n={panelName:e};this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(n[e]=this.panelsData[a][e])});var e=this.panelDataAttributeList,o=this.panelDataAttributesDefs;this.createView("dialog","views/admin/layouts/modals/panel-attributes",{attributeList:e,attributeDefs:o,attributes:n,dynamicLogicDefs:this.panelDynamicLogicDefs},e=>{e.render(),this.listenTo(e,"after:save",t=>{i.text(t.panelName),i.attr("data-is-custom","true"),this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(this.panelsData[a][e]=t[e])}),s.attr("data-tab-break",!!t.tabBreak&&"true"),e.close(),this.$el.find(".well").focus(),this.setIsChanged()})})}};normalizeDisabledItemList(){}setup(){super.setup(),this.events={...this.additionalEvents,...this.events},this.panelsData={},Espo.loader.require("res!client/css/misc/layout-manager-grid.css",e=>{this.$style=$("<style>").html(e).appendTo($("body"))})}onRemove(){this.$style&&this.$style.remove()}addPanel(){this.lastPanelNumber++;const e=this.lastPanelNumber;var t={customLabel:null,rows:[[]],number:e};this.panels.push(t);const i={};for(const n in this.panelDataAttributesDefs){var s=this.panelDataAttributesDefs[n];"default"in s&&(i[n]=s.default)}this.panelsData[e.toString()]=i;const a=$('<li class="panel-layout"></li>');a.attr("data-number",e),this.$el.find("ul.panels").append(a),this.createPanelView(t,!0,e=>{e.render()})}getPanelDataList(){const i=[];return this.panels.forEach(e=>{const t={};t.viewKey="panel-"+e.number,t.number=e.number,t.tabBreak=!!e.tabBreak,i.push(t)}),i}prepareLayout(){return new Promise(e=>{let t=0;this.setupPanels(()=>{++t===this.panels.length&&e()})})}setupPanels(i){this.lastPanelNumber=-1,this.panels=Espo.Utils.cloneDeep(this.panels),this.panels.forEach((e,t)=>{e.number=t,this.lastPanelNumber++,this.createPanelView(e,!1,i),this.panelsData[t.toString()]=e})}createPanelView(e,s,t){e.label=e.label||"",e.isCustomLabel=!1,e.customLabel?(e.labelTranslated=e.customLabel,e.isCustomLabel=!0):e.labelTranslated=this.translate(e.label,"labels",this.scope),e.style=e.style||null,e.rows.forEach(t=>{var i=this.columnCount-t.length;if(s)for(let e=0;e<i;e++)t.push(!1);for(const e in t)!1!==t[e]&&(t[e].label=this.getLanguage().translate(t[e].name,"fields",this.scope),"customLabel"in t[e]&&(t[e].hasCustomLabel=!0))}),this.createView("panel-"+e.number,"view",{selector:'li.panel-layout[data-number="'+e.number+'"]',template:"admin/layouts/grid-panel",data:()=>{const t=Espo.Utils.clone(e);return t.dataAttributeList=[],this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&t.dataAttributeList.push(e)}),t}},t)}makeDraggable(){const a=this,e=$("#layout ul.panels"),t=$("#layout ul.rows"),i=(e.sortable({distance:4,update:()=>{this.setIsChanged()}}),e.disableSelection(),t.sortable({distance:4,connectWith:".rows",update:()=>{this.setIsChanged()}}),t.disableSelection(),$("#layout ul.cells > li"));i.draggable({revert:"invalid",revertDuration:200,zIndex:10}).css("cursor","pointer"),i.droppable().droppable("destroy"),$("#layout ul.cells:not(.disabled) > li").droppable({accept:".cell",zIndex:10,hoverClass:"ui-state-hover",drop:function(e,t){var i=t.draggable.index();const s=t.draggable.parent();s.get(0)===$(this).parent().get(0)?$(this).index()<t.draggable.index()?$(this).before(t.draggable):$(this).after(t.draggable):(t.draggable.insertAfter($(this)),0===i?$(this).prependTo(s):$(this).insertAfter(s.children(":nth-child("+i+")"))),t.draggable.css({top:0,left:0}),$(this).parent().hasClass("disabled")&&!$(this).data("name")&&$(this).remove(),a.makeDraggable(),a.setIsChanged()}})}afterRender(){this.makeDraggable();const e=this.$el.find(".enabled-well").get(0);e.focus({preventScroll:!0})}fetch(){const o=[];return $("#layout ul.panels > li").each((e,t)=>{const i=$(t).find("header label"),s=$(t).data("number").toString(),n={rows:[]};this.panelDataAttributeList.forEach(e=>{"panelName"!==e&&(n[e]=this.panelsData[s][e])}),n.style=n.style||"default";var a=$(t).find("header").data("name");a&&(n.name=a),i.attr("data-is-custom")?n.customLabel=i.text():n.label=i.data("label"),$(t).find("ul.rows > li").each((e,t)=>{const a=[];$(t).find("ul.cells > li").each((e,i)=>{let s=!1;$(i).hasClass("empty")||(s={},this.dataAttributeList.forEach(e=>{var t;(this.dataAttributesDefs[e]||{}).notStorable||("customLabel"!==e?(t=$(i).data(Espo.Utils.toDom(e))||null)&&(s[e]=t):$(i).get(0).hasAttribute("data-custom-label")&&(s[e]=$(i).attr("data-custom-label")))})),a.push(s)}),n.rows.push(a)}),o.push(n)}),o}validate(e){let t=0;return e.forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{!1!==e&&null!==e&&t++})})}),0!==t||(Espo.Ui.error(this.translate("cantBeEmpty","messages","LayoutManager")),!1)}}e.default=s}),define("views/admin/layouts/default-page",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent=`
        <div class="margin-bottom">{{translate 'selectLayout' category='messages' scope='Admin'}}</div>
        <div class="button-container">
            <button data-action="createLayout" class="btn btn-link">{{translate 'Create'}}</button>
        </div>
    `}e.default=s}),define("views/admin/layouts/bottom-panels-detail",["exports","views/admin/layouts/side-panels-detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{hasStream=!0;hasRelationships=!0;TAB_BREAK_KEY="_tabBreak_{n}";setup(){super.setup(),this.on("update-item",(e,t)=>{if(this.isTabName(e)){const i=$("#layout ul > li[data-name='"+e+"']");i.find(".left > span").text(this.composeTabBreakLabel(t))}})}composeTabBreakLabel(e){let t=". . . "+this.translate("tabBreak","fields","LayoutManager");return e.tabLabel&&(t+=" : "+e.tabLabel),t}readDataFromLayout(l){let t=[];const d={},r={};l=Espo.Utils.cloneDeep(l),this.hasStream&&(this.getMetadata().get(["scopes",this.scope,"stream"])||"User"===this.scope)&&(t.push("stream"),d.stream=this.translate("Stream"),r.stream={name:"stream",sticked:!0,index:2}),(this.getMetadata().get(["clientDefs",this.scope,"bottomPanels",this.viewType])||[]).forEach(e=>{e.name&&(t.push(e.name),e.labelText&&(d[e.name]=e.labelText),e.label&&(d[e.name]=e.label),r[e.name]=Espo.Utils.clone(e),"order"in e&&(r[e.name].index=e.order))});for(const i in l){var e=l[i];e.tabBreak&&(t.push(i),d[i]=this.composeTabBreakLabel(e),r[i]={name:e.name,index:e.index,tabBreak:!0,tabLabel:e.tabLabel||null})}if(this.links={},this.hasRelationships){const s=this.getMetadata().get(["entityDefs",this.scope,"links"])||{};Object.keys(s).forEach(e=>{if(!(s[e].disabled||s[e].utility||s[e].layoutRelationshipsDisabled)&&~["hasMany","hasChildren"].indexOf(s[e].type)){t.push(e),d[e]=this.translate(e,"links",this.scope);const i={name:e,index:5};this.dataAttributeList.forEach(e=>{var t;e in i||null!==(t=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",i.name,e]))&&(i[e]=t)}),this.links[e]=!0,r[i.name]=i}})}this.disabledFields=[],l=l||{},this.rowLayout=[],(t=t.sort((e,t)=>r[e].index-r[t].index)).push("_delimiter_"),l._delimiter_||(l._delimiter_={disabled:!0}),d[this.TAB_BREAK_KEY]=". . . "+this.translate("tabBreak","fields","LayoutManager"),t.push(this.TAB_BREAK_KEY),t.forEach((e,t)=>{let i=!1;var s=l[e]||{};s.disabled&&(i=!0),l[e]||(r[e]||{}).disabled&&(i=!0),this.links[e]&&(l[e]||(i=!0)),e===this.TAB_BREAK_KEY&&(i=!0);let a;if(a=d[e]?this.getLanguage().translate(d[e],"labels",this.scope):this.getLanguage().translate(e,"panels",this.scope),i){const n={name:e,labelText:a};return"_"===n.name[0]&&"_delimiter_"===n.name&&(n.notEditable=!0,n.labelText=". . ."),void this.disabledFields.push(n)}const n={name:e,labelText:a};"_"===n.name[0]&&"_delimiter_"===n.name&&(n.notEditable=!0,n.labelText=". . ."),n.name in r&&this.dataAttributeList.forEach(e=>{var t;"name"===e||e in(t=r[n.name]||{})&&(n[e]=t[e])});for(const o in s)n[o]=s[o];n.index="index"in s?s.index:t,this.rowLayout.push(n),this.itemsData[n.name]=Espo.Utils.cloneDeep(n)}),this.rowLayout.sort((e,t)=>(e.index||0)-(t.index||0))}onDrop(){let a=-1,s=null;this.$el.find("ul.enabled").children().each((e,t)=>{const i=$(t),s=i.attr("data-name");this.isTabName(s)&&(s===this.TAB_BREAK_KEY||(t=parseInt(s.split("_")[2]))>a&&(a=t))}),a++,this.$el.find("ul.enabled").children().each((e,t)=>{const i=$(t);var t=i.attr("data-name");this.isTabName(t)&&t===this.TAB_BREAK_KEY&&(s=i.clone(),t=this.TAB_BREAK_KEY.slice(0,-3)+a,i.attr("data-name",t),delete this.itemsData[t])}),s||this.$el.find("ul.disabled").children().each((e,t)=>{const i=$(t);t=i.attr("data-name");this.isTabName(t)&&t!==this.TAB_BREAK_KEY&&i.remove()}),s&&s.appendTo(this.$el.find("ul.disabled"))}isTabName(e){return e.substring(0,this.TAB_BREAK_KEY.length-3)===this.TAB_BREAK_KEY.slice(0,-3)}getEditAttributesModalViewOptions(e){const t=super.getEditAttributesModalViewOptions(e);return this.isTabName(e.name)&&(t.attributeList=["tabLabel"],t.attributeDefs={tabLabel:{type:"varchar"}}),t}fetch(){var e,t=super.fetch();const i={};for(const s in t)t[s].disabled&&this.links[s]||(i[s]=t[s],this.isTabName(s)&&s!==this.TAB_BREAK_KEY?(e=this.itemsData[s]||{},i[s].tabBreak=!0,i[s].tabLabel=e.tabLabel):(delete i[s].tabBreak,delete i[s].tabLabel));return delete i[this.TAB_BREAK_KEY],i}}e.default=s}),define("views/admin/layouts/modals/create",["exports","views/modal","views/record/edit-for-modal","model","views/fields/enum","views/fields/varchar"],function(e,t,i,s,a,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=o(t),i=o(i),s=o(s),a=o(a),n=o(n);class l extends t.default{templateContent=`
        <div class="complex-text-container">{{complexText info}}</div>
        <div class="record no-side-margin">{{{record}}}</div>
    `;className="dialog dialog-record";constructor(e){super(),this.scope=e.scope}data(){return{info:this.translate("createInfo","messages","LayoutManager")}}setup(){this.headerText=this.translate("Create"),this.buttonList=[{name:"create",style:"danger",label:"Create",onClick:()=>this.actionCreate()},{name:"cancel",label:"Cancel"}],this.model=new s.default({type:"list",name:"listForMyEntityType",label:"List (for MyEntityType)"}),this.recordView=new i.default({model:this.model,detailLayout:[{columns:[[{view:new a.default({name:"type",params:{readOnly:!0,translation:"Admin.layouts",options:["list"]},labelText:this.translate("type","fields","Admin")})},{view:new n.default({name:"name",params:{required:!0,noSpellCheck:!0,pattern:"$latinLetters"},labelText:this.translate("name","fields")})},{view:new n.default({name:"label",params:{required:!0,pattern:"$noBadCharacters"},labelText:this.translate("label","fields","Admin")})}],[]]}]}),this.assignView("record",this.recordView,".record")}actionCreate(){this.recordView.fetch(),this.recordView.validate()||(this.disableButton("create"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("Layout/action/create",{scope:this.scope,type:this.model.get("type"),name:this.model.get("name"),label:this.model.get("label")}).then(()=>{this.reRender(),Espo.Ui.success("Created",{suppress:!0}),this.trigger("done"),this.close()}).catch(()=>{this.enableButton("create")}))}}e.default=l}),define("views/admin/dynamic-logic/conditions-string/item-operator-only-base",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-operator-only-base",createValueFieldView:function(){}})}),define("views/admin/dynamic-logic/conditions/field-types/base",["exports","view","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="admin/dynamic-logic/conditions/field-types/base";events={'click > div > div > [data-action="remove"]':function(e){e.stopPropagation(),this.trigger("remove-item")}};data(){return{type:this.type,field:this.field,scope:this.scope,typeList:this.typeList,leftString:this.translateLeftString()}}translateLeftString(){return this.translate(this.field,"fields",this.scope)}setup(){this.type=this.options.type,this.field=this.options.field,this.scope=this.options.scope,this.fieldType=this.options.fieldType,this.itemData=this.options.itemData,this.additionalData=this.itemData.data||{},this.typeList=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",this.fieldType,"typeList"]),this.wait(!0),this.createModel().then(e=>{this.model=e,this.populateValues(),this.manageValue(),this.wait(!1)})}createModel(){return this.getModelFactory().create(this.scope)}afterRender(){this.$type=this.$el.find('select[data-name="type"]'),i.default.init(this.$type.get(0)),this.$type.on("change",()=>{this.type=this.$type.val(),this.manageValue()})}populateValues(){this.itemData.attribute&&this.model.set(this.itemData.attribute,this.itemData.value),this.model.set(this.additionalData.values||{})}getValueViewName(){var e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base";return this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e)}getValueFieldName(){return this.field}manageValue(){var e,t,i=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",this.fieldType,"conditionTypes",this.type,"valueType"])||this.getMetadata().get(["clientDefs","DynamicLogic","conditionTypes",this.type,"valueType"]);"field"===i?(e=this.getValueViewName(),t=this.getValueFieldName(),this.createView("value",e,{model:this.model,name:t,selector:".value-container",mode:"edit",readOnlyDisabled:!0},e=>{this.isRendered()&&e.render()})):"custom"===i?(this.clearView("value"),this["createValueView"+Espo.Utils.upperCaseFirst(this.type)]()):"varchar"===i?this.createView("value","views/fields/varchar",{model:this.model,name:this.getValueFieldName(),selector:".value-container",mode:"edit",readOnlyDisabled:!0},e=>{this.isRendered()&&e.render()}):this.clearView("value")}fetch(){const e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t}}e.default=a}),define("views/outbound-email/fields/test-send",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{templateContent='<button class="btn btn-default hidden" data-action="sendTestEmail">'+"{{translate 'Send Test Email' scope='Email'}}</button>";setup(){super.setup(),this.addActionHandler("sendTestEmail",()=>this.send())}fetch(){return{}}checkAvailability(){this.model.get("smtpServer")?this.$el.find("button").removeClass("hidden"):this.$el.find("button").addClass("hidden")}afterRender(){this.checkAvailability(),this.stopListening(this.model,"change:smtpServer"),this.listenTo(this.model,"change:smtpServer",()=>{this.checkAvailability()})}getSmtpData(){return{server:this.model.get("smtpServer"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,fromName:this.model.get("outboundEmailFromName"),fromAddress:this.model.get("outboundEmailFromAddress"),type:"outboundEmail"}}enableButton(){this.$el.find("button").removeClass("disabled").removeAttr("disabled")}disabledButton(){this.$el.find("button").addClass("disabled").attr("disabled","disabled")}send(){const i=this.getSmtpData();this.createView("popup","views/outbound-email/modals/test-send",{emailAddress:this.getUser().get("emailAddress")},t=>{t.render(),this.listenToOnce(t,"send",e=>{this.disabledButton(),i.emailAddress=e,this.notify("Sending..."),t.close(),Espo.Ajax.postRequest("Email/sendTest",i).then(()=>{this.enableButton(),Espo.Ui.success(this.translate("testEmailSent","messages","Email"))}).catch(e=>{let t=e.getResponseHeader("X-Status-Reason")||"",i=(t=t.replace(/ $/,"").replace(/,$/,""),this.translate("Error"));if(200!==e.status&&(i+=" "+e.status),e.responseText)try{var s=JSON.parse(e.responseText);if(s.messageTranslation)return void this.enableButton();t=s.message||t}catch(e){return this.enableButton(),void console.error("Could not parse error response body.")}t&&(i+=": "+t),Espo.Ui.error(i,!0),console.error(i),e.errorIsHandled=!0,this.enableButton()})})})}}e.default=s}),define("views/role/record/table",["exports","view","ui/select"],function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),o=i(o);class s extends t.default{template="role/table";scopeList;type="acl";mode="detail";lowestLevelByDefault=!1;actionList=["create","read","edit","delete","stream"];accessList=["not-set","enabled","disabled"];fieldLevelList=["yes","no"];fieldActionList=["read","edit"];levelList=["yes","all","team","own","no"];booleanLevelList=["yes","no"];booleanActionList=["create"];levelListMap={recordAllTeamOwnNo:["all","team","own","no"],recordAllTeamNo:["all","team","no"],recordAllOwnNo:["all","own","no"],recordAllNo:["all","no"],record:["all","team","own","no"]};defaultLevels={delete:"no"};styleMap={yes:"success",all:"success",account:"info",contact:"info",team:"info",own:"warning",no:"danger",enabled:"success",disabled:"danger","not-set":"muted"};scopeLevelMemory;data(){const e={};e.styleMap=this.styleMap,e.editMode="edit"===this.mode,e.actionList=this.actionList,e.accessList=this.accessList,e.fieldActionList=this.fieldActionList,e.fieldLevelList=this.fieldLevelList,e.tableDataList=this.getTableDataList(),e.fieldTableDataList=this.fieldTableDataList;let t=!1;return this.fieldTableDataList.forEach(e=>{e.list.length&&(t=!0)}),e.hasFieldLevelData=t,e}events={'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)},'click .action[data-action="addField"]':function(e){e=$(e.currentTarget).data().scope;this.showAddFieldModal(e)},'click .action[data-action="removeField"]':function(e){var t=$(e.currentTarget).data().scope,e=$(e.currentTarget).data().field;this.removeField(t,e)},'change select[data-type="access"]':function(e){const t=$(e.currentTarget);var e=t.attr("name"),i=t.val();this.onSelectAccess(e,i)}};getTableDataList(){const o=this.acl.data,t=[];let i=null;return this.scopeList.forEach(s=>{var e=this.getMetadata().get(`scopes.${s}.module`);i!==e&&(i=e,t.push(!1));let a="not-set";this.final&&(a="enabled"),s in o&&(a=!1===o[s]?"disabled":"enabled");const n=[];e=this.aclTypeMap[s];"boolean"!==this.aclTypeMap[s]&&this.actionList.forEach(t=>{const e=this.getMetadata().get(["scopes",s,this.type+"ActionList"]);if(!e||e.includes(t))if("stream"!==t||this.getMetadata().get(`scopes.${s}.stream`)){let e=null;var i=this.getLevelList(s,t);s in o&&("enabled"===a?!0!==o[s]&&null===(e=t in o[s]?o[s][t]:e)&&(e=i[i.length-1]):e="no"),n.push({level:e,name:s+"-"+t,action:t,levelList:i})}else n.push({action:"stream",levelList:!1,level:null});else n.push({action:t,levelList:!1,level:null})}),t.push({list:n,access:a,name:s,type:e})}),t}getLevelList(e,t){if(this.booleanActionList.includes(t))return this.booleanLevelList;var i=this.aclTypeMap[e];return this.getMetadata().get(["scopes",e,this.type+"ActionLevelListMap",t])||this.getMetadata().get(["scopes",e,this.type+"LevelList"])||this.levelListMap[i]||[]}setup(){this.mode=this.options.mode||"detail",this.final=this.options.final||!1,this.scopeLevelMemory={},this.setupData(),this.listenTo(this.model,"change",()=>{(this.model.hasChanged("data")||this.model.hasChanged("fieldData"))&&this.setupData()}),this.listenTo(this.model,"sync",()=>{this.setupData(),this.isRendered()&&this.reRenderPreserveSearch()}),this.template="role/table","edit"===this.mode&&(this.template="role/table-edit"),this.once("remove",()=>{$(window).off("scroll.scope-"+this.cid),$(window).off("resize.scope-"+this.cid),$(window).off("scroll.field-"+this.cid),$(window).off("resize.field-"+this.cid)})}setupData(){this.acl={},this.options.acl?this.acl.data=this.options.acl.data:this.acl.data=Espo.Utils.cloneDeep(this.model.get("data")||{}),this.options.acl?this.acl.fieldData=this.options.acl.fieldData:this.acl.fieldData=Espo.Utils.cloneDeep(this.model.get("fieldData")||{}),this.setupScopeList(),this.setupFieldTableDataList()}getSortedScopeList(){const a=[null,"Crm"],n=this.getMetadata().get("scopes");return Object.keys(n).forEach(e=>{e=n[e].module;e&&"Custom"!==e&&!a.includes(e)&&a.push(e)}),a.push("Custom"),Object.keys(n).sort((e,t)=>{const i=n[e].module||null,s=n[t].module||null;return i===s?this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural")):a.findIndex(e=>e===i)-a.findIndex(e=>e===s)})}setupScopeList(){this.aclTypeMap={},this.scopeList=[],this.getSortedScopeList().forEach(e=>{var t;this.getMetadata().get(`scopes.${e}.disabled`)||(t=this.getMetadata().get(`scopes.${e}.acl`))&&(this.scopeList.push(e),!0===(this.aclTypeMap[e]=t)&&(this.aclTypeMap[e]="record"))})}setupFieldTableDataList(){this.fieldTableDataList=[],this.scopeList.forEach(e=>{var t=this.getMetadata().get("scopes."+e)||{};if(t.entity&&!t.aclFieldLevelDisabled&&!this.isAclFieldLevelDisabledForScope(e)){if(!(e in this.acl.fieldData))return"edit"===this.mode?void this.fieldTableDataList.push({name:e,list:[]}):void 0;const s=this.acl.fieldData[e],i=this.getFieldManager().getEntityTypeFieldList(e),a=(this.getLanguage().sortFieldList(e,i),[]);i.forEach(t=>{if(t in s){const i=[];this.fieldActionList.forEach(e=>{i.push({name:e,value:s[t][e]||"yes"})}),"detail"===this.mode&&!i.length||a.push({name:t,list:i})}}),this.fieldTableDataList.push({name:e,list:a})}})}isAclFieldLevelDisabledForScope(e){return!!this.getMetadata().get(`scopes.${e}.aclFieldLevelDisabled`)}fetchScopeData(e){const t={};var i=this.scopeList,s=this.actionList,h=this.aclTypeMap;const c=this.$el.find("table.scope-level");for(const d in i){var a=i[d];if(!e||a===e){const r=c.find(`tr[data-name="${a}"]`);var n=r.find(`select[name="${a}"]`).val();if(e||"not-set"!==n)if(e||"disabled"!==n){let e=!0;if("boolean"!==h[a]){e={};for(const f in s){var o=s[f],l=r.find(`select[name="${a}-${o}"]`).val();void 0!==l&&(e[o]=l)}}t[a]=e}else t[a]=!1}}return t}fetchFieldData(){const i={};return this.fieldTableDataList.forEach(e=>{const t={},a=e.name,n=this.$el.find(`table.field-level tr[data-name="${a}"]`);e.list.forEach(e=>{const i=e.name,s={};this.fieldActionList.forEach(e=>{const t=n.find(`select[data-scope="${a}"][data-field="${i}"][data-action="${e}"]`);t.length&&(s[e]=t.val())}),t[i]=s}),i[a]=t}),i}afterRender(){this.$quickSearch=this.$el.find('input[data-name="quick-search"]'),"edit"===this.mode&&(this.$el.find("select").each((e,t)=>{o.default.init(t)}),this.scopeList.forEach(t=>{const i=this.$el.find(`select[name="${t}-read"]`),s=(i.on("change",()=>{var e=i.val();this.controlSelect(t,"edit",e),this.controlSelect(t,"delete",e),this.controlSelect(t,"stream",e)}),this.$el.find(`select[name="${t}-edit"]`));s.on("change",()=>{var e=s.val();this.controlSelect(t,"delete",e)}),setTimeout(()=>{this.controlSelect(t,"edit",i.val(),!0),this.controlSelect(t,"stream",i.val(),!0),this.controlSelect(t,"delete",s.val(),!0)},10)}),this.fieldTableDataList.forEach(e=>{const s=e.name;e.list.forEach(e=>{const t=e.name,i=this.$el.find('select[data-scope="'+s+'"][data-field="'+t+'"][data-action="read"]');i.on("change",()=>{var e=i.val();this.controlFieldEditSelect(s,t,e)}),this.controlFieldEditSelect(s,t,i.val(),!0)})})),"edit"!==this.mode&&"detail"!==this.mode||(this.initStickyHeader("scope"),this.initStickyHeader("field"))}controlFieldEditSelect(t,e,i,s){const a=this.$el.find(`select[data-scope="${t}"][data-field="${e}"][data-action="edit"]`);if(a.length){let e=a.val();!s&&this.levelList.indexOf(e)<this.levelList.indexOf(i)&&(e=i);t=this.fieldLevelList.filter(e=>this.levelList.indexOf(e)>=this.levelList.indexOf(i)).map(e=>({value:e,text:this.getLanguage().translateOption(e,"levelList","Role")}));s||(o.default.destroy(a),o.default.init(a)),o.default.setValue(a,""),o.default.setOptions(a,t),o.default.setValue(a,e)}}controlSelect(t,i,s,a){const n=this.$el.find(`select[name="${t}-${i}"]`);if(n.length){let e=n.val();!a&&this.levelList.indexOf(e)<this.levelList.indexOf(s)&&(e=s);t=this.getLevelList(t,i).filter(e=>this.levelList.indexOf(e)>=this.levelList.indexOf(s)).map(e=>({value:e,text:this.getLanguage().translateOption(e,"levelList","Role")}));a||(o.default.destroy(n),o.default.init(n)),o.default.setValue(n,""),o.default.setOptions(n,t),o.default.setValue(n,e)}}showAddFieldModal(t){this.trigger("change");var e=Object.keys(this.acl.fieldData[t]||{});this.createView("dialog","views/role/modals/add-field",{scope:t,ignoreFieldList:e,type:this.type},e=>{e.render(),this.listenTo(e,"add-fields",e=>{this.clearView("dialog");const i=this.fieldTableDataList.find(e=>e.name===t);i&&(e.filter(t=>!i.list.find(e=>e.name===t)).forEach(e=>{i.list.unshift({name:e,list:[{name:"read",value:"no"},{name:"edit",value:"no"}]})}),this.reRenderPreserveSearch())})})}removeField(t,s){this.trigger("change"),this.fieldTableDataList.forEach(e=>{if(e.name===t){let i=-1;e.list.forEach((e,t)=>{e.name===s&&(i=t)}),~i&&(e.list.splice(i,1),this.reRenderPreserveSearch())}})}reRenderPreserveSearch(){const e=this.$quickSearch.val();this.reRender().then(()=>{this.$quickSearch.val(e),this.processQuickSearch(e)})}initStickyHeader(e){const n=this.$el.find(".sticky-header-"+e),o=$(window),l=this.getThemeManager().getParam("screenWidthXs"),d=$(".detail-button-container"),r=this.$el.find("table."+e+"-level");var t;r.length&&d.length&&(t=()=>{var e,t,i,s,a;$(window.document).width()<l?n.addClass("hidden"):(e=d.get(0).getBoundingClientRect().top+d.outerHeight(),t=r.position().top,i=(t=(t=(t-=d.height())+r.find("tr > th").height())-this.getThemeManager().getParam("navbarHeight"))+r.outerHeight(!0)-d.height(),s=o.scrollTop(),a=r.width(),t<s&&s<i?(n.css({position:"fixed",marginTop:e+"px",top:0,width:a+"px",marginLeft:"1px"}),n.removeClass("hidden")):n.addClass("hidden"))},o.off("scroll."+e+"-"+this.cid),o.on("scroll."+e+"-"+this.cid,t),o.off("resize."+e+"-"+this.cid),o.on("resize."+e+"-"+this.cid,t))}onSelectAccess(a,e){const t=this.$el.find(`.scope-level select[data-scope="${a}"]`);if("enabled"!==e)return e=this.fetchScopeData(a),t.attr("disabled","disabled"),t.addClass("hidden"),t.parent().find(".selectize-control").addClass("hidden"),delete this.scopeLevelMemory[a],void(a in e&&(this.scopeLevelMemory[a]=e[a]||{}));t.removeAttr("disabled"),t.removeClass("hidden"),t.parent().find(".selectize-control").removeClass("hidden"),this.actionList.forEach(t=>{const i=this.$el.find(`select[name="${a}-${t}"]`);if(i.length){var s=(this.scopeLevelMemory[a]||{})[t];let e=s||this.defaultLevels[t];e=e||this.getLevelList(a,t)[0],!s&&this.lowestLevelByDefault&&(e=[...this.getLevelList(a,t)].pop()),o.default.setValue(i,e),i.trigger("change")}})}processQuickSearch(e){if(e=e.trim()){const a=[],n=e.toLowerCase();this.scopeList.forEach(e=>{let t=!1;const i=this.getLanguage().translate(e,"scopeNamesPlural");if(!(t=0!==i.toLowerCase().indexOf(n)&&0!==e.toLowerCase().indexOf(n)?t:!0)){const s=i.split(" ").concat(i.split(" "));s.forEach(e=>{0===e.toLowerCase().indexOf(n)&&(t=!0)})}t&&a.push(e)}),0!==a.length?(this.$el.find('table tr.item-row[data-name="_"]').addClass("hidden"),this.scopeList.forEach(e=>{const t=this.$el.find(`table tr.item-row[data-name="${e}"]`);a.includes(e)?t.removeClass("hidden"):t.addClass("hidden")})):this.$el.find("table tr.item-row").addClass("hidden")}else this.$el.find("table tr.item-row").removeClass("hidden")}}e.default=s}),define("views/role/record/list",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{quickDetailDisabled=!0;quickEditDisabled=!0;massActionList=["remove","export"];checkAllResultDisabled=!0}e.default=s}),define("views/role/record/edit",["exports","views/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{tableView="views/role/record/table";sideView=!1;isWide=!0;stickButtonsContainerAllTheWay=!0;fetch(){const t=super.fetch();t.data={};var e=this.getTableView().scopeList,i=this.getTableView().actionList,s=this.getTableView().aclTypeMap;for(const o in e){var a=e[o];if("not-set"!==this.$el.find('select[name="'+a+'"]').val())if("disabled"!==this.$el.find('select[name="'+a+'"]').val()){let e=!0;if("boolean"!==s[a]){e={};for(const l in i){var n=i[l];e[n]=this.$el.find('select[name="'+a+"-"+n+'"]').val()}}t.data[a]=e}else t.data[a]=!1}return t.data=this.getTableView().fetchScopeData(),t.fieldData=this.getTableView().fetchFieldData(),t}setup(){super.setup(),this.createView("extra",this.tableView,{mode:"edit",selector:".extra",model:this.model},e=>{this.listenTo(e,"change",()=>{var e=this.fetch();this.model.set(e)})})}getTableView(){return this.getView("extra")}}e.default=s}),define("views/role/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{tableView="views/role/record/table";sideView=!1;isWide=!0;editModeDisabled=!0;stickButtonsContainerAllTheWay=!0;setup(){super.setup(),this.createView("extra",this.tableView,{selector:".extra",model:this.model})}}e.default=s}),define("views/inbound-email/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.setupFieldsBehaviour(),this.initSslFieldListening()}modifyDetailLayout(e){e.filter(e=>"$label:SMTP"===e.tabLabel).forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{const t=this.translate(e.name,"fields","InboundEmail");t&&0===t.indexOf("SMTP ")&&(e.labelText=Espo.Utils.upperCaseFirst(t.substring(5)))})})})}wasFetched(){return!this.model.isNew()&&!!(this.model.get("fetchData")||{}).lastUID}initSmtpFieldsControl(){this.controlSmtpFields(),this.controlSentFolderField(),this.listenTo(this.model,"change:useSmtp",this.controlSmtpFields,this),this.listenTo(this.model,"change:smtpAuth",this.controlSmtpFields,this),this.listenTo(this.model,"change:storeSentEmails",this.controlSentFolderField,this)}controlSmtpFields(){if(this.model.get("useSmtp"))return this.showField("smtpHost"),this.showField("smtpPort"),this.showField("smtpAuth"),this.showField("smtpSecurity"),this.showField("smtpTestSend"),this.showField("fromName"),this.showField("smtpIsShared"),this.showField("smtpIsForMassEmail"),this.showField("storeSentEmails"),this.setFieldRequired("smtpHost"),this.setFieldRequired("smtpPort"),void this.controlSmtpAuthField();this.hideField("smtpHost"),this.hideField("smtpPort"),this.hideField("smtpAuth"),this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.hideField("smtpSecurity"),this.hideField("smtpTestSend"),this.hideField("fromName"),this.hideField("smtpIsShared"),this.hideField("smtpIsForMassEmail"),this.hideField("storeSentEmails"),this.hideField("sentFolder"),this.setFieldNotRequired("smtpHost"),this.setFieldNotRequired("smtpPort"),this.setFieldNotRequired("smtpUsername")}controlSentFolderField(){if(this.model.get("useSmtp")&&this.model.get("storeSentEmails"))return this.showField("sentFolder"),void this.setFieldRequired("sentFolder");this.hideField("sentFolder"),this.setFieldNotRequired("sentFolder")}controlSmtpAuthField(){if(this.model.get("smtpAuth"))return this.showField("smtpUsername"),this.showField("smtpPassword"),this.showField("smtpAuthMechanism"),void this.setFieldRequired("smtpUsername");this.hideField("smtpUsername"),this.hideField("smtpPassword"),this.hideField("smtpAuthMechanism"),this.setFieldNotRequired("smtpUsername")}controlStatusField(){const e=["username","port","host","monitoredFolders"];"Active"===this.model.get("status")&&this.model.get("useImap")?e.forEach(e=>{this.setFieldRequired(e)}):e.forEach(e=>{this.setFieldNotRequired(e)})}setupFieldsBehaviour(){this.controlStatusField(),this.listenTo(this.model,"change:status",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.listenTo(this.model,"change:useImap",(e,t,i)=>{i.ui&&this.controlStatusField()}),this.wasFetched()?this.setFieldReadOnly("fetchSince"):this.setFieldNotReadOnly("fetchSince"),this.initSmtpFieldsControl();const s=e=>{e.get("createCase")?this.showField("caseDistribution"):this.hideField("caseDistribution"),e.get("createCase")&&-1!==["Round-Robin","Least-Busy"].indexOf(e.get("caseDistribution"))?(this.setFieldRequired("team"),this.showField("targetUserPosition")):(this.setFieldNotRequired("team"),this.hideField("targetUserPosition")),e.get("createCase")&&"Direct-Assignment"===e.get("caseDistribution")?(this.setFieldRequired("assignToUser"),this.showField("assignToUser")):(this.setFieldNotRequired("assignToUser"),this.hideField("assignToUser")),e.get("createCase")&&""!==e.get("createCase")?this.showField("team"):this.hideField("team")};this.listenTo(this.model,"change:createCase",(e,t,i)=>{s(e),i.ui&&(e.get("createCase")||this.model.set({caseDistribution:"",teamId:null,teamName:null,assignToUserId:null,assignToUserName:null,targetUserPosition:""}))}),s(this.model),this.listenTo(this.model,"change:caseDistribution",(e,t,i)=>{s(e),i.ui&&setTimeout(()=>{this.model.get("caseDistribution")?("Direct-Assignment"===this.model.get("caseDistribution")&&this.model.set({targetUserPosition:""}),this.model.set({assignToUserId:null,assignToUserName:null})):this.model.set({assignToUserId:null,assignToUserName:null,targetUserPosition:""})},10)})}initSslFieldListening(){this.listenTo(this.model,"change:security",(e,t,i)=>{i.ui&&(t?this.model.set("port",993):this.model.set("port",143))}),this.listenTo(this.model,"change:smtpSecurity",(e,t,i)=>{i.ui&&("SSL"===t?this.model.set("smtpPort",465):"TLS"===t?this.model.set("smtpPort",587):this.model.set("smtpPort",25))})}}e.default=s}),define("views/admin/index",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/index";events={"click [data-action]":function(e){Espo.Utils.handleAction(this,e.originalEvent,e.currentTarget)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};data(){return{panelDataList:this.panelDataList,iframeUrl:this.iframeUrl,iframeHeight:this.getConfig().get("adminPanelIframeHeight")||1330,iframeDisabled:this.getConfig().get("adminPanelIframeDisabled")||!1}}afterRender(){const e=this.$el.find('input[data-name="quick-search"]');this.quickSearchText&&(e.val(this.quickSearchText),this.processQuickSearch(this.quickSearchText)),e.get(0).focus({preventScroll:!0})}setup(){this.panelDataList=[];var e=this.getMetadata().get("app.adminPanel")||{};for(const i in e){const s=Espo.Utils.cloneDeep(e[i]);s.name=i,s.itemList=s.itemList||[],s.label=this.translate(s.label,"labels","Admin"),s.itemList&&s.itemList.forEach(e=>{e.label=this.translate(e.label,"labels","Admin"),e.description?(e.keywords=(this.getLanguage().get("Admin","keywords",e.description)||"").split(","),e.keywords=e.keywords.map(e=>e.trim().toLowerCase())):e.keywords=[]}),s.items&&s.items.forEach(e=>{e.label=this.translate(e.label,"labels","Admin"),s.itemList.push(e),e.keywords=[]}),this.panelDataList.push(s)}this.panelDataList.sort((e,t)=>("order"in e||!("order"in t))&&"order"in t?e.order-t.order:0);const t=["version="+encodeURIComponent(this.getConfig().get("version")),"css="+encodeURIComponent(this.getConfig().get("siteUrl")+"/"+this.getThemeManager().getStylesheet())];this.iframeUrl=this.getConfig().get("adminPanelIframeUrl")||"https://s.espocrm.com/",~this.iframeUrl.indexOf("?")?this.iframeUrl+="&"+t.join("&"):this.iframeUrl+="?"+t.join("&"),this.getConfig().get("adminNotificationsDisabled")||this.createView("notificationsPanel","views/admin/panels/notifications",{selector:".notifications-panel-container"})}processQuickSearch(l){l=l.trim(),this.quickSearchText=l;const e=this.$noData||this.$el.find(".no-data");if(e.addClass("hidden"),!l)return this.$el.find(".admin-content-section").removeClass("hidden"),void this.$el.find(".admin-content-row").removeClass("hidden");l=l.toLowerCase(),this.$el.find(".admin-content-section").addClass("hidden"),this.$el.find(".admin-content-row").addClass("hidden");let d=!1;this.panelDataList.forEach((e,a)=>{let n=!1,o=!1;e.label&&0===e.label.toLowerCase().indexOf(l)&&(n=!0,o=!0),e.itemList.forEach((e,i)=>{if(e.label){let t=!1;if(!(t=(t=o?!0:t)||0===e.label.toLowerCase().indexOf(l))){const s=e.label.split(" ");s.forEach(e=>{0===e.toLowerCase().indexOf(l)&&(t=!0)}),(t=t||~e.keywords.indexOf(l))||3<l.length&&e.keywords.forEach(e=>{0===e.indexOf(l)&&(t=!0)})}t&&(n=!0,this.$el.find('.admin-content-section[data-index="'+a.toString()+'"] .admin-content-row[data-index="'+i.toString()+'"]').removeClass("hidden"),d=!0)}}),n&&(this.$el.find('.admin-content-section[data-index="'+a.toString()+'"]').removeClass("hidden"),d=!0)}),d||e.removeClass("hidden")}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Administration"))}actionClearCache(){this.trigger("clear-cache")}actionRebuild(){this.trigger("rebuild")}}e.default=s}),define("views/admin/link-manager/index",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/link-manager/index";scope=null;data(){return{linkDataList:this.linkDataList,scope:this.scope,isCreatable:this.isCustomizable}}events={'click a[data-action="editLink"]':function(e){e=$(e.currentTarget).data("link");this.editLink(e)},'click button[data-action="createLink"]':function(){this.createLink()},'click [data-action="removeLink"]':function(e){const t=$(e.currentTarget).data("link");e=this.translate("confirmRemoveLink","messages","EntityManager").replace("{link}",t);this.confirm(e,()=>{this.removeLink(t)})},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};computeRelationshipType(e,t){if("hasMany"===e)return"hasMany"===t?"manyToMany":"belongsTo"===t?"oneToMany":void 0;if("belongsTo"===e)return"hasMany"===t?"manyToOne":"hasOne"===t?"oneToOneRight":void 0;if("belongsToParent"===e){if("hasChildren"===t)return"childrenToParent"}else if("hasChildren"===e){if("belongsToParent"===t)return"parentToChildren"}else if("hasOne"===e&&"belongsTo"===t)return"oneToOneLeft"}setupLinkData(){this.linkDataList=[],this.isCustomizable=!!this.getMetadata().get(`scopes.${this.scope}.customizable`)&&!1!==this.getMetadata().get(`scopes.${this.scope}.entityManager.relationships`);const n=this.getMetadata().get("entityDefs."+this.scope+".links"),e=Object.keys(n).sort((e,t)=>e.localeCompare(t));e.forEach(e=>{var t=n[e];let i;var s=t.foreign;if("belongsToParent"===t.type)i="childrenToParent";else{if(!t.entity)return;if(!s)return;var a=this.getMetadata().get("entityDefs."+t.entity+".links."+t.foreign+".type");i=this.computeRelationshipType(t.type,a)}i&&this.linkDataList.push({link:e,isCustom:t.isCustom,isRemovable:t.isCustom,customizable:t.customizable,isEditable:this.isCustomizable,type:i,entityForeign:t.entity,entity:this.scope,labelEntityForeign:this.getLanguage().translate(t.entity,"scopeNames"),linkForeign:s,label:this.getLanguage().translate(e,"links",this.scope),labelForeign:this.getLanguage().translate(t.foreign,"links",t.entity)})})}setup(){this.scope=this.options.scope||null,this.setupLinkData(),this.on("after:render",()=>{this.renderHeader()})}afterRender(){this.$noData=this.$el.find(".no-data"),this.$el.find('input[data-name="quick-search"]').focus()}createLink(){this.createView("edit","views/admin/link-manager/modals/edit",{scope:this.scope},e=>{e.render(),this.listenTo(e,"after:save",()=>{this.clearView("edit"),this.setupLinkData(),this.render()}),this.listenTo(e,"close",()=>{this.clearView("edit")})})}editLink(e){this.createView("edit","views/admin/link-manager/modals/edit",{scope:this.scope,link:e},e=>{e.render(),this.listenTo(e,"after:save",()=>{this.clearView("edit"),this.setupLinkData(),this.render()}),this.listenTo(e,"close",()=>{this.clearView("edit")})})}removeLink(e){Espo.Ajax.postRequest("EntityManager/action/removeLink",{entity:this.scope,link:e}).then(()=>{this.$el.find('table tr[data-link="'+e+'"]').remove(),this.getMetadata().loadSkipCache().then(()=>{this.setupLinkData(),Espo.Ui.success(this.translate("Removed"),{suppress:!0}),this.reRender()})})}renderHeader(){const e=$("#scope-header");this.scope?e.show().html(this.getLanguage().translate(this.scope,"scopeNames")):e.html("")}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Entity Manager","labels","Admin"))}processQuickSearch(e){e=e.trim();const t=this.$noData;if(t.addClass("hidden"),e){const l=[],d=e.toLowerCase();if(this.linkDataList.forEach(e=>{let t=!1;const i=e.label||"",s=e.link||"",a=e.entityForeign||"",n=e.labelEntityForeign||"";if(!(t=0!==i.toLowerCase().indexOf(d)&&0!==s.toLowerCase().indexOf(d)&&0!==a.toLowerCase().indexOf(d)&&0!==n.toLowerCase().indexOf(d)?t:!0)){const o=s.split(" ").concat(i.split(" ")).concat(a.split(" ")).concat(n.split(" "));o.forEach(e=>{0===e.toLowerCase().indexOf(d)&&(t=!0)})}t&&l.push(s)}),0===l.length)return this.$el.find("table tr.link-row").addClass("hidden"),void t.removeClass("hidden");this.linkDataList.map(e=>e.link).forEach(e=>{~l.indexOf(e)?this.$el.find('table tr.link-row[data-link="'+e+'"]').removeClass("hidden"):this.$el.find('table tr.link-row[data-link="'+e+'"]').addClass("hidden")})}else this.$el.find("table tr.link-row").removeClass("hidden")}}e.default=s}),define("views/admin/layouts/list",["exports","views/admin/layouts/rows"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataAttributeList=["name","widthComplex","width","widthPx","link","notSortable","noLabel","align","view","customLabel","label","hidden"];dataAttributesDefs={widthComplex:{label:"width",type:"base",view:"views/admin/layouts/fields/width-complex",tooltip:"width",notStorable:!0},link:{type:"bool",tooltip:!0},width:{type:"float",min:0,max:100,hidden:!0},widthPx:{type:"int",min:0,max:720,hidden:!0},notSortable:{type:"bool",tooltip:!0},align:{type:"enum",options:["left","right"]},view:{type:"varchar",readOnly:!0},noLabel:{type:"bool",tooltip:!0},customLabel:{type:"varchar",readOnly:!0},name:{type:"varchar",readOnly:!0},label:{type:"varchar",readOnly:!0},hidden:{type:"bool"}};dataAttributesDynamicLogicDefs={fields:{widthPx:{visible:{conditionGroup:[{attribute:"width",type:"isEmpty"}]}}}};editable=!0;languageCategory="fields";ignoreList=[];ignoreTypeList=[];setup(){super.setup(),this.wait(!0),this.loadLayout(()=>{this.wait(!1)})}loadLayout(i){this.getModelFactory().create(Espo.Utils.hyphenToUpperCamelCase(this.scope),t=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{this.readDataFromLayout(t,e),i&&i()})})}readDataFromLayout(e,h){const c=[];for(const o in e.defs.fields)this.checkFieldType(e.getFieldParam(o,"type"))&&this.isFieldEnabled(e,o)&&c.push(o);c.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[];const t=[],i=[];for(const l of h){var s=this.getLanguage().translate(l.name,"fields",this.scope);t.includes(s)&&i.push(s),t.push(s),this.enabledFields.push({name:l.name,labelText:s}),this.enabledFieldsList.push(l.name)}for(const d of c)if(!this.enabledFieldsList.includes(d)){var a=this.getLanguage().translate(d,"fields",this.scope),n=(t.includes(a)&&i.push(a),t.push(a),d);const f={name:n,labelText:a};a=this.getMetadata().get(["entityDefs",this.scope,"fields",n,"type"]);a&&this.getMetadata().get(["fields",a,"notSortable"])&&(f.notSortable=!0,this.itemsData[n]=this.itemsData[n]||{},this.itemsData[n].notSortable=!0),this.disabledFields.push(f)}this.enabledFields.forEach(e=>{i.includes(e.labelText)&&(e.labelText+=" ("+e.name+")")}),this.disabledFields.forEach(e=>{i.includes(e.labelText)&&(e.labelText+=" ("+e.name+")")}),this.rowLayout=h;for(const r of this.rowLayout){let t=this.getLanguage().translate(r.name,"fields",this.scope);this.enabledFields.forEach(e=>{r.name===e.name&&(t=e.labelText)}),r.labelText=t,this.itemsData[r.name]=Espo.Utils.cloneDeep(r)}}checkFieldType(e){return!0}isFieldEnabled(e,t){if(-1!==this.ignoreList.indexOf(t))return!1;if(-1!==this.ignoreTypeList.indexOf(e.getFieldParam(t,"type")))return!1;const i=e.getFieldParam(t,"layoutAvailabilityList");let s=this.realType;if("listSmall"===s&&(s="list"),i&&!i.includes(this.type)&&!i.includes(s))return!1;const a=e.getFieldParam(t,"layoutIgnoreList")||[];return!a.includes(s)&&(!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&!e.getFieldParam(t,"layoutListDisabled"))}}e.default=s}),define("views/admin/layouts/index",["exports","view","views/admin/layouts/default-page","views/admin/layouts/modals/create"],function(e,t,i,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),s=a(s);class n extends t.default{template="admin/layouts/index";scopeList=null;baseUrl="#Admin/layouts";typeList=["list","detail","listSmall","detailSmall","bottomPanelsDetail","filters","massUpdate","sidePanelsDetail","sidePanelsEdit","sidePanelsDetailSmall","sidePanelsEditSmall"];scope=null;type=null;data(){return{scopeList:this.scopeList,typeList:this.typeList,scope:this.scope,layoutScopeDataList:this.getLayoutScopeDataList(),headerHtml:this.getHeaderHtml(),em:this.em}}setup(){this.addHandler("click","#layouts-menu a.layout-link","onLayoutLinkClick"),this.addHandler("click","a.accordion-toggle","onItemHeaderClick"),this.addHandler("keydown.shortcuts","","onKeyDown"),this.addActionHandler("createLayout",()=>this.actionCreateLayout()),this.em=this.options.em||!1,this.scope=this.options.scope||null,this.type=this.options.type||null,this.scopeList=[];const e=this.getMetadata().getScopeList().sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural")));e.forEach(e=>{this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".layouts")&&this.scopeList.push(e)}),this.em&&this.scope&&(this.scopeList.includes(this.scope)?this.scopeList=[this.scope]:this.scopeList=[]),this.on("after:render",()=>{$("#layouts-menu a[data-scope='"+this.options.scope+"'][data-type='"+this.options.type+"']").addClass("disabled"),this.renderLayoutHeader(),this.options.scope&&this.options.type||(this.checkLayout(),this.renderDefaultPage()),this.scope&&this.options.type&&(this.checkLayout(),this.openLayout(this.options.scope,this.options.type))})}checkLayout(){const t=this.options.scope;var e=this.options.type;if(t){const i=this.getLayoutScopeDataList().find(e=>e.scope===t);if(!i)throw new Espo.Exceptions.NotFound("Layouts not available for entity type.");if(e&&!i.typeList.includes(e))throw new Espo.Exceptions.NotFound("The layout type is not available for the entity type.")}}afterRender(){this.controlActiveButton()}controlActiveButton(){if(this.scope){const e=this.$el.find(`.accordion-toggle[data-scope="${this.scope}"]`);this.undisableLinks(),this.em&&this.scope&&!this.type?e.addClass("disabled"):(e.removeClass("disabled"),this.$el.find(`a.layout-link[data-scope="${this.scope}"][data-type="${this.type}"]`).addClass("disabled"))}}onLayoutLinkClick(e){e.preventDefault();const t=$(e.target).data("scope"),i=$(e.target).data("type");this.getContentView()&&this.scope===t&&this.type===i||this.getRouter().checkConfirmLeaveOut(()=>{this.openLayout(t,i),this.controlActiveButton()})}openDefaultPage(){this.clearView("content"),this.type=null,this.renderDefaultPage(),this.controlActiveButton(),this.navigate(this.scope)}onItemHeaderClick(e){if(e.preventDefault(),this.em)return this.getContentView()?void this.getRouter().checkConfirmLeaveOut(()=>{this.openDefaultPage()}):void 0;const t=$(e.target);e=t.data("scope");const i=$('.collapse[data-scope="'+e+'"]');i.hasClass("in")?i.collapse("hide"):i.collapse("show")}onKeyDown(e){var t=Espo.Utils.getKeyFromKeyEvent(e);this.hasView("content")&&("Control+Enter"!==t&&"Control+KeyS"!==t||(e.stopPropagation(),e.preventDefault(),this.getContentView().actionSave()))}undisableLinks(){$("#layouts-menu a.layout-link").removeClass("disabled")}getContentView(){return this.getView("content")}openLayout(e,t){this.scope=e,this.type=t,this.navigate(e,t),Espo.Ui.notify(" ... ");var i=this.getMetadata().get("clientDefs."+e+".additionalLayouts."+t+".type")||t;this.createView("content","views/admin/layouts/"+Espo.Utils.camelCaseToHyphen(i),{fullSelector:"#layout-content",scope:e,type:t,realType:i,setId:this.setId,em:this.em},e=>{this.renderLayoutHeader(),e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0),this.em&&(this.listenToOnce(e,"cancel",()=>{this.openDefaultPage()}),this.listenToOnce(e,"after-delete",()=>{this.openDefaultPage(),Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.reRender()})}))})}navigate(e,t){let i="#Admin/layouts/scope="+e;t&&(i+="&type="+t),this.em&&(i+="&em=true"),this.getRouter().navigate(i,{trigger:!1})}renderDefaultPage(){$("#layout-header").html("").hide(),this.em?this.assignView("default",new i.default,"#layout-content").then(e=>{e.render()}):(this.clearView("default"),$("#layout-content").html(this.translate("selectLayout","messages","Admin")))}renderLayoutHeader(){const e=$("#layout-header");if(this.scope){const i=[];this.em||i.push($("<span>").text(this.translate(this.scope,"scopeNames"))),i.push($("<span>").text(this.translateLayoutName(this.type,this.scope)));var t=i.map(e=>e.get(0).outerHTML).join(' <span class="breadcrumb-separator"><span class="chevron-right"></span></span> ');e.show().html(t)}else e.html("")}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Layout Manager","labels","Admin"))}getHeaderHtml(){const e=[];var t=$("<a>").attr("href","#Admin").text(this.translate("Administration"));return e.push(t),this.em?(e.push($("<a>").attr("href","#Admin/entityManager").text(this.translate("Entity Manager","labels","Admin"))),this.scope&&(e.push($("<a>").attr("href","#Admin/entityManager/scope="+this.scope).text(this.translate(this.scope,"scopeNames"))),e.push($("<span>").text(this.translate("Layouts","labels","EntityManager"))))):e.push($("<span>").text(this.translate("Layout Manager","labels","Admin"))),e.map(e=>e.get(0).outerHTML).join(' <span class="breadcrumb-separator"><span class="chevron-right"></span></span> ')}translateLayoutName(e,t){return this.getLanguage().get(t,"layouts",e)?this.getLanguage().translate(e,"layouts",t):this.getLanguage().translate(e,"layouts","Admin")}getLayoutScopeDataList(){const n=[];return this.scopeList.forEach(i=>{const e={};let t=Espo.Utils.clone(this.typeList);e.scope=i,e.url=this.baseUrl+"/scope="+i,this.em&&(e.url+="&em=true"),this.getMetadata().get(["clientDefs",i,"bottomPanels","edit"])&&t.push("bottomPanelsEdit"),this.getMetadata().get(["clientDefs",i,"defaultSidePanelDisabled"])||this.getMetadata().get(["clientDefs",i,"defaultSidePanelFieldList"])||t.push("defaultSidePanel"),this.getMetadata().get(["clientDefs",i,"kanbanViewMode"])&&t.push("kanban");for(const a in this.getMetadata().get(["clientDefs",i,"additionalLayouts"])||{})t.push(a);t=t.filter(e=>!this.getMetadata().get(["clientDefs",i,"layout"+Espo.Utils.upperCaseFirst(e)+"Disabled"]));const s=[];t.forEach(e=>{let t=this.baseUrl+"/scope="+i+"&type="+e;this.em&&(t+="&em=true"),s.push({type:e,url:t,label:this.translateLayoutName(e,i)})}),e.typeList=t,e.typeDataList=s,n.push(e)}),n}actionCreateLayout(){var e=new s.default({scope:this.scope});this.assignView("dialog",e).then(e=>{e.render(),this.listenToOnce(e,"done",()=>{Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.reRender()})})})}}e.default=n}),define("views/admin/layouts/detail",["exports","views/admin/layouts/grid"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataAttributeList=["name","fullWidth","customLabel","noLabel"];panelDataAttributeList=["panelName","dynamicLogicVisible","style","dynamicLogicStyled","tabBreak","tabLabel","hidden","noteText","noteStyle"];dataAttributesDefs={fullWidth:{type:"bool"},name:{readOnly:!0},label:{type:"varchar",readOnly:!0},customLabel:{type:"varchar",readOnly:!0},noLabel:{type:"bool",readOnly:!0}};panelDataAttributesDefs={panelName:{type:"varchar"},style:{type:"enum",options:["default","success","danger","warning","info"],style:{info:"info",success:"success",danger:"danger",warning:"warning"},default:"default",translation:"LayoutManager.options.style",tooltip:"panelStyle"},dynamicLogicVisible:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions"},dynamicLogicStyled:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicStyled"},hidden:{type:"bool",tooltip:"hiddenPanel"},tabBreak:{type:"bool",tooltip:"tabBreak"},tabLabel:{type:"varchar"},noteText:{type:"text",tooltip:"noteText"},noteStyle:{type:"enum",options:["info","success","danger","warning"],style:{info:"info",success:"success",danger:"danger",warning:"warning"},default:"info",translation:"LayoutManager.options.style"}};defaultPanelFieldList=["modifiedAt","createdAt","modifiedBy","createdBy"];panelDynamicLogicDefs={fields:{tabLabel:{visible:{conditionGroup:[{attribute:"tabBreak",type:"isTrue"}]}},dynamicLogicStyled:{visible:{conditionGroup:[{attribute:"style",type:"notEquals",value:"default"}]}},noteStyle:{visible:{conditionGroup:[{attribute:"noteText",type:"isNotEmpty"}]}}}};setup(){super.setup(),this.panelDataAttributesDefs=Espo.Utils.cloneDeep(this.panelDataAttributesDefs),this.panelDataAttributesDefs.dynamicLogicVisible.scope=this.scope,this.panelDataAttributesDefs.dynamicLogicStyled.scope=this.scope,this.wait(!0),this.loadLayout(()=>{this.setupPanels(),this.wait(!1)})}loadLayout(e){let s,a;const t=[];t.push(new Promise(i=>{this.getModelFactory().create(this.scope,t=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{s=e,a=t,i()})})})),["detail","detailSmall"].includes(this.type)&&t.push(new Promise(t=>{this.getHelper().layoutManager.getOriginal(this.scope,"sidePanels"+Espo.Utils.upperCaseFirst(this.type),this.setId,e=>{this.sidePanelsLayout=e,t()})})),t.push(new Promise(t=>{this.getMetadata().get(["clientDefs",this.scope,"layoutDefaultSidePanelDisabled"])||this.typeDefs.allFields?t():this.getHelper().layoutManager.getOriginal(this.scope,"defaultSidePanel",this.setId,e=>{this.defaultPanelFieldList=Espo.Utils.clone(this.defaultPanelFieldList),e.forEach(e=>{let t=e.name;t&&(":assignedUser"===t&&(t="assignedUser"),this.defaultPanelFieldList.includes(t)||this.defaultPanelFieldList.push(t))}),t()})})),Promise.all(t).then(()=>{this.readDataFromLayout(a,s),e&&e()})}readDataFromLayout(e,t){const i=[];for(const s in e.defs.fields)this.isFieldEnabled(e,s)&&i.push(s);this.enabledFields=[],this.disabledFields=[],(this.panels=t).forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{this.enabledFields.push(e.name)})})}),i.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope)));for(const a in i)_.contains(this.enabledFields,i[a])||this.disabledFields.push(i[a])}isFieldEnabled(e,t){if(this.hasDefaultPanel()&&this.defaultPanelFieldList.includes(t))return!1;const i=e.getFieldParam(t,"layoutAvailabilityList");let s=this.realType;if("detailSmall"===s&&(s="detail"),i&&!i.includes(this.type)&&!i.includes(s))return!1;const a=e.getFieldParam(t,"layoutIgnoreList")||[];return!a.includes(s)&&(!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&!e.getFieldParam(t,"layoutDetailDisabled"))}hasDefaultPanel(){if(!1===this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanel",this.viewType]))return!1;if(this.getMetadata().get(["clientDefs",this.scope,"defaultSidePanelDisabled"]))return!1;if(this.sidePanelsLayout)for(const e in this.sidePanelsLayout)if("default"===e&&this.sidePanelsLayout[e].disabled)return!1;return!0}validate(e){if(!super.validate(e))return!1;const s=[];e.forEach(e=>{e.rows.forEach(e=>{e.forEach(e=>{!1!==e&&null!==e&&e.name&&s.push(e.name)})})});let a=[],n=!1;return s.forEach(t=>{if(!n){const i=(this.getMetadata().get(["entityDefs",this.scope,"fields",t])||{}).detailLayoutIncompatibleFieldList||[];i.forEach(e=>{n||~s.indexOf(e)&&(n=!0,a=[t].concat(i))})}}),!n||(Espo.Ui.error(this.translate("fieldsIncompatible","messages","LayoutManager").replace("{fields}",a.map(e=>this.translate(e,"fields",this.scope)).join(", "))),!1)}}e.default=s}),define("views/admin/layouts/bottom-panels-edit",["exports","views/admin/layouts/bottom-panels-detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{hasStream=!1;hasRelationships=!1;viewType="edit"}e.default=s}),define("views/admin/integrations/edit",["view","model"],function(e,t){return e.extend({template:"admin/integrations/edit",data:function(){return{integration:this.integration,dataFieldList:this.dataFieldList,helpText:this.helpText}},events:{'click button[data-action="cancel"]':function(){this.getRouter().navigate("#Admin/integrations",{trigger:!0})},'click button[data-action="save"]':function(){this.save()}},setup:function(){this.integration=this.options.integration,this.helpText=!1,this.getLanguage().has(this.integration,"help","Integration")&&(this.helpText=this.translate(this.integration,"help","Integration")),this.fieldList=[],this.dataFieldList=[],this.model=new t,this.model.id=this.integration,this.model.name="Integration",this.model.urlRoot="Integration",this.model.defs={fields:{enabled:{required:!0,type:"bool"}}},this.wait(!0),this.fields=this.getMetadata().get("integrations."+this.integration+".fields"),Object.keys(this.fields).forEach(e=>{this.model.defs.fields[e]=this.fields[e],this.dataFieldList.push(e)}),this.model.populateDefaults(),this.listenToOnce(this.model,"sync",()=>{this.createFieldView("bool","enabled"),Object.keys(this.fields).forEach(e=>{this.createFieldView(this.fields[e].type,e,null,this.fields[e])}),this.wait(!1)}),this.model.fetch()},hideField:function(e){this.$el.find('label[data-name="'+e+'"]').addClass("hide"),this.$el.find('div.field[data-name="'+e+'"]').addClass("hide");e=this.getView(e);e&&(e.disabled=!0)},showField:function(e){this.$el.find('label[data-name="'+e+'"]').removeClass("hide"),this.$el.find('div.field[data-name="'+e+'"]').removeClass("hide");e=this.getView(e);e&&(e.disabled=!1)},afterRender:function(){this.model.get("enabled")||this.dataFieldList.forEach(e=>{this.hideField(e)}),this.listenTo(this.model,"change:enabled",()=>{this.model.get("enabled")?this.dataFieldList.forEach(e=>{this.showField(e)}):this.dataFieldList.forEach(e=>{this.hideField(e)})})},createFieldView:function(e,t,i,s){e=this.model.getFieldParam(t,"view")||this.getFieldManager().getViewName(e);this.createView(t,e,{model:this.model,selector:'.field[data-name="'+t+'"]',defs:{name:t,params:s},mode:i?"detail":"edit",readOnly:i}),this.fieldList.push(t)},save:function(){this.fieldList.forEach(e=>{e=this.getView(e);e.readOnly||e.fetchToModel()});var t=!1;this.fieldList.forEach(e=>{e=this.getView(e);e&&!e.disabled&&(t=e.validate()||t)}),t?this.notify("Not valid","error"):(this.listenToOnce(this.model,"sync",()=>{this.notify("Saved","success")}),Espo.Ui.notify(this.translate("saving","messages")),this.model.save())}})}),define("views/admin/field-manager/fields/options",["views/fields/array"],function(t){return t.extend({maxItemLength:100,setup:function(){t.prototype.setup.call(this),this.translatedOptions={};let e=this.model.get(this.name)||[];e.forEach(e=>{this.translatedOptions[e]=this.getLanguage().translateOption(e,this.options.field,this.options.scope)}),this.model.fetchedAttributes.translatedOptions=this.translatedOptions},getItemHtml:function(e){var t=this.translatedOptions[e]||e;let i=$("<div>").addClass("list-group-item link-with-role form-inline").attr("data-value",e).append($("<div>").addClass("pull-left item-content").css("width","92%").css("display","inline-block").append($("<input>").attr("type","text").attr("data-name","translatedValue").attr("data-value",e).addClass("role form-control input-sm pull-right").attr("value",t).css("width","auto")).append($("<div>").addClass("item-text").text(e))).append($("<div>").css("width","8%").css("display","inline-block").css("vertical-align","top").append($("<a>").attr("role","button").attr("tabindex","0").addClass("pull-right").attr("data-value",e).attr("data-action","removeValue").append($("<span>").addClass("fas fa-times")))).append($("<br>").css("clear","both"));return i.get(0).outerHTML},fetch:function(){let s=t.prototype.fetch.call(this);return s[this.name].length?(s.translatedOptions={},(s[this.name]||[]).forEach(e=>{var t=e.replace(/"/g,'\\"');let i=this.$el.find('input[data-name="translatedValue"][data-value="'+t+'"]').val()||e;s.translatedOptions[e]=i.toString()})):(s[this.name]=null,s.translatedOptions={}),s}})}),define("views/admin/entity-manager/record/edit-formula",["exports","views/record/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/entity-manager/record/edit-formula";data(){return{field:this.field,fieldKey:this.field+"Field"}}setup(){super.setup(),this.field=this.options.type;let e=null;"beforeSaveApiScript"===this.options.type&&(e=this.getRecordServiceFunctionDataList()),this.createField(this.field,"views/fields/formula",{targetEntityType:this.options.targetEntityType,height:500},"edit",!1,{additionalFunctionDataList:e})}getRecordServiceFunctionDataList(){return[{name:"recordService\\skipDuplicateCheck",insertText:"recordService\\skipDuplicateCheck()",returnType:"bool"},{name:"recordService\\throwDuplicateConflict",insertText:"recordService\\throwDuplicateConflict(RECORD_ID)"},{name:"recordService\\throwBadRequest",insertText:"recordService\\throwBadRequest(MESSAGE)"},{name:"recordService\\throwForbidden",insertText:"recordService\\throwForbidden(MESSAGE)"},{name:"recordService\\throwConflict",insertText:"recordService\\throwConflict(MESSAGE)"}]}}e.default=s}),define("views/admin/entity-manager/modals/export",["exports","views/modal","model","views/record/edit-for-modal","views/fields/varchar"],function(e,t,i,s,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),s=n(s),a=n(a);class o extends t.default{templateContent=`
        <div class="record-container no-side-margin">{{{record}}}</div>
    `;setup(){this.headerText=this.translate("Export"),this.buttonList=[{name:"export",label:"Export",style:"danger",onClick:()=>this.export()},{name:"cancel",label:"Cancel"}];var e=this.getConfig().get("customExportManifest")||{};this.model=new i.default({name:e.name??null,module:e.module??null,version:e.version??"0.0.1",author:e.author??null,description:e.description??null}),this.recordView=new s.default({model:this.model,detailLayout:[{rows:[[{view:new a.default({name:"name",labelText:this.translate("name","fields"),params:{pattern:"$latinLettersDigitsWhitespace",required:!0}})},{view:new a.default({name:"module",labelText:this.translate("module","fields","EntityManager"),params:{pattern:"[A-Z][a-z][A-Za-z]+",required:!0}})}],[{view:new a.default({name:"version",labelText:this.translate("version","fields","EntityManager"),params:{pattern:"[0-9]+\\.[0-9]+\\.[0-9]+",required:!0}})},!1],[{view:new a.default({name:"author",labelText:this.translate("author","fields","EntityManager"),params:{required:!0}})},{view:new a.default({name:"description",labelText:this.translate("description","fields"),params:{}})}]]}]}),this.assignView("record",this.recordView)}export(){const t=this.recordView.fetch();this.recordView.validate()||(this.disableButton("export"),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("EntityManager/action/exportCustom",t).then(e=>{this.close(),this.getConfig().set("customExportManifest",t),Espo.Ui.success(this.translate("Done")),window.location=this.getBasePath()+"?entryPoint=download&id="+e.id}).catch(()=>this.enableButton("create")))}}e.default=o}),define("views/admin/entity-manager/fields/primary-filters",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{detailTemplateContent=`
        {{#unless isEmpty}}
            <table class="table table-bordered">
                <tbody>
                    {{#each dateList}}
                        <tr>
                            <td style="width: 42%">{{name}}</td>
                            <td style="width: 42%">{{label}}</td>
                            <td style="width: 16%; text-align: center;">
                                <a
                                    role="button"
                                    data-action="copyToClipboard"
                                    data-name="{{name}}"
                                    class="text-soft"
                                    title="{{translate 'Copy to Clipboard'}}"
                                ><span class="far fa-copy"></span></a>
                            </td>
                        </tr>
                    {{/each}}
                </tbody>
            </table>
        {{else}}
            {{#if valueIsSet}}
                <span class="none-value">{{translate 'None'}}</span>
            {{else}}
                <span class="loading-value"></span>
            {{/if}}
        {{/unless}}
    `;data(){return{...super.data(),dateList:this.getValuesItems()}}constructor(e){super(e),this.targetEntityType=e.targetEntityType}getValuesItems(){return(this.model.get(this.name)||[]).map(e=>({name:e,label:this.translate(e,"presetFilters",this.targetEntityType)}))}setup(){super.setup(),this.addActionHandler("copyToClipboard",(e,t)=>this.copyToClipboard(t.dataset.name))}copyToClipboard(t){var e=`#${this.targetEntityType}/list/primaryFilter=`+t;navigator.clipboard.writeText(e).then(()=>{var e=this.translate("urlHashCopiedToClipboard","messages","EntityManager").replace("{name}",t);Espo.Ui.notify(e,"success",void 0,{closeButton:!0})})}}e.default=s}),define("views/admin/dynamic-logic/conditions-string/item-operator-only-date",["views/admin/dynamic-logic/conditions-string/item-operator-only-base"],function(t){return t.extend({template:"admin/dynamic-logic/conditions-string/item-operator-only-date",data:function(){var e=t.prototype.data.call(this);return e.dateValue=this.dateValue,e}})}),define("views/admin/dynamic-logic/conditions-string/group-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/group-base",data:function(){return this.conditionList.length?{viewDataList:this.viewDataList,operator:this.operator,level:this.level}:{isEmpty:!0}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.itemData=this.options.itemData||{},this.viewList=[];const s=this.conditionList=this.itemData.value||[];this.viewDataList=[],s.forEach((e,t)=>{var i="view-"+this.level.toString()+"-"+this.number.toString()+"-"+t.toString();this.createItemView(t,i,e),this.viewDataList.push({key:i,isEnd:t===s.length-1})})},getFieldType:function(e){return this.getMetadata().get(["entityDefs",this.scope,"fields",e.attribute,"type"])||"base"},createItemView:function(t,i,s){this.viewList.push(i);var a=((s=s||{}).data||{}).type||s.type||"equals",n=this.getFieldType(s),n=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",n,"conditionTypes",a,"itemView"])||this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",a,"view"]);if(n){var o=this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",a,"operator"]);let e=this.getMetadata().get(["clientDefs","DynamicLogic","itemTypes",a,"operatorString"]);e=e||'<i class="small">'+(e=this.getLanguage().translateOption(a,"operators","DynamicLogic").toLowerCase())+"</i>",this.createView(i,n,{itemData:s,scope:this.scope,level:this.level+1,selector:'[data-view-key="'+i+'"]',number:t,operator:o,operatorString:e})}}})}),define("views/admin/dynamic-logic/conditions/group-base",["view"],function(e){return e.extend({template:"admin/dynamic-logic/conditions/group-base",data:function(){return{viewDataList:this.viewDataList,operator:this.operator,level:this.level,groupOperator:this.getGroupOperator()}},events:{'click > div.group-head > [data-action="remove"]':function(e){e.stopPropagation(),this.trigger("remove-item")},'click > div.group-bottom [data-action="addField"]':function(){this.actionAddField()},'click > div.group-bottom [data-action="addAnd"]':function(){this.actionAddGroup("and")},'click > div.group-bottom [data-action="addOr"]':function(){this.actionAddGroup("or")},'click > div.group-bottom [data-action="addNot"]':function(){this.actionAddGroup("not")},'click > div.group-bottom [data-action="addCurrentUser"]':function(){this.addCurrentUser()},'click > div.group-bottom [data-action="addCurrentUserTeams"]':function(){this.addCurrentUserTeams()}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.itemData=this.options.itemData||{},this.viewList=[];const e=this.conditionList=this.itemData.value||[];this.viewDataList=[],e.forEach((e,t)=>{var i=this.getKey(t);this.createItemView(t,i,e),this.addViewDataListItem(t,i)})},getGroupOperator:function(){return"or"===this.operator?"or":"and"},getKey:function(e){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+e.toString()},createItemView:function(t,e,i){this.viewList.push(e),this.isCurrentUser=i.attribute&&i.attribute.startsWith("$user.");var s=this.isCurrentUser?"User":this.scope,a=(i=i||{}).data||{},n=a.type||i.type||"equals",a=a.field||i.attribute;let o,l;["and","or","not"].includes(n)?o="views/admin/dynamic-logic/conditions/"+n:(l=this.getMetadata().get(["entityDefs",s,"fields",a,"type"]),"id"===a&&(l="id"),"$user.id"===i.attribute&&(l="currentUser"),(l="$user.teamsIds"===i.attribute?"currentUserTeams":l)&&(o=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",l,"view"]))),o&&this.createView(e,o,{itemData:i,scope:s,level:this.level+1,selector:'[data-view-key="'+e+'"]',number:t,type:n,field:a,fieldType:l},e=>{this.isRendered()&&e.render(),this.controlAddItemVisibility(),this.listenToOnce(e,"remove-item",()=>{this.removeItem(t)})})},fetch:function(){const i=[];return this.viewDataList.forEach(e=>{const t=this.getView(e.key);i.push(t.fetch())}),{type:this.operator,value:i}},removeItem:function(i){var e=this.getKey(i);this.clearView(e),this.$el.find('[data-view-key="'+e+'"]').remove(),this.$el.find('[data-view-ref-key="'+e+'"]').remove();let s=-1;this.viewDataList.forEach((e,t)=>{e.index===i&&(s=t)}),~s&&this.viewDataList.splice(s,1),this.controlAddItemVisibility()},actionAddField:function(){this.createView("modal","views/admin/dynamic-logic/modals/add-field",{scope:this.scope},t=>{t.render(),this.listenToOnce(t,"add-field",e=>{this.addField(e),t.close()})})},addCurrentUser:function(){var e=this.getIndexForNewItem(),t=this.getKey(e);this.addItemContainer(e),this.addViewDataListItem(e,t),this.createItemView(e,t,{attribute:"$user.id",data:{type:"equals"}})},addCurrentUserTeams:function(){var e=this.getIndexForNewItem(),t=this.getKey(e);this.addItemContainer(e),this.addViewDataListItem(e,t),this.createItemView(e,t,{attribute:"$user.teamsIds",data:{type:"contains",field:"teams"}})},addField:function(e){let t=this.getMetadata().get(["entityDefs",this.scope,"fields",e,"type"]);if(t||"id"!==e||(t="id"),!this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t]))throw new Error;var i=this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t,"typeList"])[0],s=this.getIndexForNewItem(),a=this.getKey(s);this.addItemContainer(s),this.addViewDataListItem(s,a),this.createItemView(s,a,{data:{field:e,type:i}})},getIndexForNewItem:function(){return this.viewDataList.length?this.viewDataList[this.viewDataList.length-1].index+1:0},addViewDataListItem:function(e,t){this.viewDataList.push({index:e,key:t})},addItemContainer:function(e){var t=$('<div data-view-key="'+this.getKey(e)+'"></div>'),t=(this.$el.find("> .item-list").append(t),this.translate(this.getGroupOperator(),"logicalOperators","Admin")),e=$('<div class="group-operator" data-view-ref-key="'+this.getKey(e)+'">'+t+"</div>");this.$el.find("> .item-list").append(e)},actionAddGroup:function(e){var t=this.getIndexForNewItem(),i=this.getKey(t);this.addItemContainer(t),this.addViewDataListItem(t,i),this.createItemView(t,i,{type:e,value:[]})},afterRender:function(){this.controlAddItemVisibility()},controlAddItemVisibility:function(){}})}),define("views/admin/dynamic-logic/conditions/field-types/link-multiple",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({getValueFieldName:function(){return this.name},getValueViewName:function(){return"views/fields/link"},createValueViewContains:function(){this.createLinkValueField()},createValueViewNotContains:function(){this.createLinkValueField()},createLinkValueField:function(){this.createView("value","views/fields/link",{model:this.model,name:"link",selector:".value-container",mode:"edit",readOnlyDisabled:!0,foreignScope:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"entity"])||this.getMetadata().get(["entityDefs",this.scope,"links",this.field,"entity"])},e=>{this.isRendered()&&e.render()})},fetch:function(){const e=this.getView("value"),t={type:this.type,attribute:this.field+"Ids",data:{field:this.field}};if(e){e.fetchToModel(),t.value=this.model.get("linkId");const i={};i.linkName=this.model.get("linkName"),i.linkId=this.model.get("linkId"),t.data.values=i}return t}})}),define("views/email-account/fields/test-send",["exports","views/outbound-email/fields/test-send"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAvailability(){this.model.get("smtpHost")?this.$el.find("button").removeClass("hidden"):this.$el.find("button").addClass("hidden")}afterRender(){this.checkAvailability(),this.stopListening(this.model,"change:smtpHost"),this.listenTo(this.model,"change:smtpHost",()=>{this.checkAvailability()})}getSmtpData(){return{server:this.model.get("smtpHost"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,authMechanism:this.model.get("smtpAuthMechanism"),fromName:this.getUser().get("name"),fromAddress:this.model.get("emailAddress"),type:"emailAccount",id:this.model.id,userId:this.model.get("assignedUserId")}}}e.default=s}),define("views/email-account/fields/test-connection",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{readOnly=!0;templateContent=`
        <button class="btn btn-default disabled" data-action="testConnection"
        >{{translate 'Test Connection' scope='EmailAccount'}}</button>
    `;url="EmailAccount/action/testConnection";setup(){super.setup(),this.addActionHandler("testConnection",()=>this.test())}fetch(){return{}}checkAvailability(){this.model.get("host")?this.$el.find("button").removeClass("disabled").removeAttr("disabled"):this.$el.find("button").addClass("disabled").attr("disabled","disabled")}afterRender(){this.checkAvailability(),this.stopListening(this.model,"change:host"),this.listenTo(this.model,"change:host",()=>{this.checkAvailability()})}getData(){return{host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),password:this.model.get("password")||null,id:this.model.id,emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")}}test(){var e=this.getData();const s=this.$el.find("button");s.addClass("disabled"),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(this.url,e).then(()=>{s.removeClass("disabled"),Espo.Ui.success(this.translate("connectionIsOk","messages","EmailAccount"))}).catch(e=>{let t=e.getResponseHeader("X-Status-Reason")||"",i=(t=(t=t.replace(/ $/,"")).replace(/,$/,""),this.translate("Error"));200!==parseInt(e.status)&&(i+=" "+e.status),t&&(i+=": "+t),Espo.Ui.error(i,!0),console.error(i),e.errorIsHandled=!0,s.removeClass("disabled")})}}e.default=s}),define("views/email-account/fields/folders",["exports","views/fields/array"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getFoldersUrl="EmailAccount/action/getFolders";setupOptions(){this.params.options=["INBOX"]}fetchFolders(){return new Promise(t=>{const e={host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")};this.model.has("password")&&(e.password=this.model.get("password")),this.model.isNew()||(e.id=this.model.id),Espo.Ajax.postRequest(this.getFoldersUrl,e).then(e=>{t(e)}).catch(e=>{Espo.Ui.error(this.translate("couldNotConnectToImap","messages","EmailAccount")),e.errorIsHandled=!0,t(["INBOX"])})})}actionAddItem(){Espo.Ui.notify(" ... "),this.fetchFolders().then(e=>{Espo.Ui.notify(!1),this.createView("addModal",this.addItemModalView,{options:e}).then(t=>{t.render(),t.once("add",e=>{this.addValue(e),t.close()}),t.once("add-mass",e=>{e.forEach(e=>{this.addValue(e)}),t.close()})})})}}e.default=s}),define("views/email-account/fields/folder",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{editTemplate="email-account/fields/folder/edit";getFoldersUrl="EmailAccount/action/getFolders";setup(){super.setup(),this.addActionHandler("selectFolder",()=>{Espo.Ui.notify(this.translate("pleaseWait","messages"));const e={host:this.model.get("host"),port:this.model.get("port"),security:this.model.get("security"),username:this.model.get("username"),emailAddress:this.model.get("emailAddress"),userId:this.model.get("assignedUserId")};this.model.has("password")&&(e.password=this.model.get("password")),this.model.isNew()||(e.id=this.model.id),Espo.Ajax.postRequest(this.getFoldersUrl,e).then(e=>{this.createView("modal","views/email-account/modals/select-folder",{folders:e},t=>{Espo.Ui.notify(!1),t.render(),this.listenToOnce(t,"select",e=>{t.close(),this.addFolder(e)})})}).catch(e=>{Espo.Ui.error(this.translate("couldNotConnectToImap","messages","EmailAccount")),e.errorIsHandled=!0})})}addFolder(e){this.$element.val(e)}}e.default=s}),define("helpers/misc/authentication-provider",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(e){this.view=e,this.metadata=e.getMetadata(),this.model=e.model;const t=e.getMetadata().get(["authenticationMethods"])||{};this.methodList=Object.keys(t).filter(e=>{return(t[e].provider||{}).isAvailable}),this.authFields={},this.dynamicLogicDefs={fields:{},panels:{}}}setupPanelsVisibility(e){this.handlePanelsVisibility(e),this.view.listenTo(this.model,"change:method",()=>this.handlePanelsVisibility(e))}getFromMetadata(e,t){return this.metadata.get(["authenticationMethods",e,"provider",t])||this.metadata.get(["authenticationMethods",e,"settings",t])}setupMethods(){return this.methodList.forEach(e=>this.setupMethod(e)),this.dynamicLogicDefs}setupMethod(e){let t=this.getFromMetadata(e,"fieldList")||[];t=t.filter(e=>this.model.hasField(e)),this.authFields[e]=t;var i,s=(this.getFromMetadata(e,"dynamicLogic")||{}).fields||{};for(const a in s)t.includes(a)&&(i=this.modifyDynamicLogic(s[a]),this.dynamicLogicDefs.fields[a]=Espo.Utils.cloneDeep(i))}modifyDynamicLogic(t){if(t=Espo.Utils.clone(t),Array.isArray(t))return t.map(e=>this.modifyDynamicLogic(e));if("object"!=typeof t)return t;{const i={};for(const s in t){let e=t[s];"attribute"===s&&"authenticationMethod"===e&&(e="method"),i[s]=this.modifyDynamicLogic(e)}return i}}modifyDetailLayout(i){this.methodList.forEach(e=>{let t=this.getFromMetadata(e,"layout");t&&((t=Espo.Utils.cloneDeep(t)).name=e,this.prepareLayout(t,e),i.push(t))})}prepareLayout(e,i){e.rows.forEach(e=>{e.filter(e=>!e.noLabel&&!e.labelText&&e.name).forEach(e=>{if(null!==e){const t=this.view.translate(e.name,"fields","Settings");e.options=e.options||{},t&&0===t.toLowerCase().indexOf(i.toLowerCase()+" ")&&(e.labelText=t.substring(i.length+1)),e.options.tooltipText=this.view.translate(e.name,"tooltips","Settings")}})}),e.rows=e.rows.map(e=>e=e.map(e=>!(e&&e.name&&!this.model.hasField(e.name))&&e))}handlePanelsVisibility(i){const s=this.model.get("method");this.methodList.forEach(e=>{const t=this.authFields[e]||[];if(e!==s)return this.view.hidePanel(e),void t.forEach(e=>{this.view.hideField(e)});this.view.showPanel(e),t.forEach(e=>this.view.showField(e)),i()})}}}),define("views/settings/record/edit",["exports","views/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{saveAndContinueEditingAction=!1;sideView=null;layoutName="settings";setup(){super.setup(),this.listenTo(this.model,"after:save",()=>{this.getConfig().set(this.model.getClonedAttributes())})}exit(e){"cancel"===e&&this.getRouter().navigate("#Admin",{trigger:!0})}}e.default=s}),define("views/settings/edit",["exports","views/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{scope="Settings";setupHeader(){this.createView("header",this.headerView,{model:this.model,fullSelector:"#main > .header",template:this.options.headerTemplate,label:this.options.label})}}e.default=s}),define("views/templates/event/record/detail",["views/record/detail"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.getAcl().checkModel(this.model,"edit")&&-1===["Held","Not Held"].indexOf(this.model.get("status"))&&(this.dropdownItemList.push({html:this.translate("Set Held","labels",this.scope),name:"setHeld"}),this.dropdownItemList.push({html:this.translate("Set Not Held","labels",this.scope),name:"setNotHeld"}))},actionSetHeld:function(){this.model.save({status:"Held"},{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Saved","labels","Meeting")),this.removeButton("setHeld"),this.removeButton("setNotHeld")})},actionSetNotHeld:function(){this.model.save({status:"Not Held"},{patch:!0}).then(()=>{Espo.Ui.success(this.translate("Saved","labels","Meeting")),this.removeButton("setHeld"),this.removeButton("setNotHeld")})}})}),define("views/scheduled-job/list",["exports","views/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchPanel=!1;setup(){super.setup(),this.addMenuItem("buttons",{link:"#Admin/jobs",text:this.translate("Jobs","labels","Admin")}),this.createView("search","views/base",{fullSelector:"#main > .search-container",template:"scheduled-job/cronjob"})}afterRender(){super.afterRender(),Espo.Ajax.getRequest("Admin/action/cronMessage").then(e=>{this.$el.find(".cronjob .message").html(e.message),this.$el.find(".cronjob .command").html("<strong>"+e.command+"</strong>")})}getHeader(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration","labels","Admin")),this.getLanguage().translate(this.scope,"scopeNamesPlural")])}}e.default=s}),define("views/scheduled-job/record/list",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{quickDetailDisabled=!0;quickEditDisabled=!0;massActionList=["remove","massUpdate"]}e.default=s}),define("views/scheduled-job/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{duplicateAction=!1}e.default=s}),define("views/scheduled-job/record/panels/log",["exports","views/record/panels/relationship"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupListLayout(){const e=this.getMetadata().get(["clientDefs","ScheduledJob","jobWithTargetList"])||[];~e.indexOf(this.model.get("job"))&&(this.listLayoutName="listSmallWithTarget")}}e.default=s}),define("views/scheduled-job/fields/scheduling",["exports","views/fields/varchar"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),(this.isEditMode()||this.isDetailMode())&&this.wait(Espo.loader.requirePromise("lib!cronstrue").then(e=>{this.Cronstrue=e,this.listenTo(this.model,"change:"+this.name,()=>this.showText())}))}afterRender(){var e;super.afterRender(),(this.isEditMode()||this.isDetailMode())&&(e=this.$text=$('<div class="small text-success"/>'),this.$el.append(e),this.showText())}showText(){let t;if(this.$text&&this.$text.length&&this.Cronstrue){var i=this.model.get(this.name);if(i)if("* * * * *"!==i){let e="en";const s=Object.keys(this.Cronstrue.default.locales),a=this.getLanguage().name;~s.indexOf(a)?e=a:~s.indexOf(a.split("_")[0])&&(e=a.split("_")[0]);try{t=this.Cronstrue.toString(i,{use24HourTimeFormat:!this.getDateTime().hasMeridian(),locale:e})}catch(e){t=this.translate("Not valid")}this.$text.text(t)}else this.$text.text(this.translate("As often as possible","labels","ScheduledJob"));else this.$text.text("")}}}e.default=s}),define("views/scheduled-job/fields/job",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),(this.isEditMode()||this.isDetailMode())&&(this.wait(!0),Espo.Ajax.getRequest("Admin/jobs").then(e=>{this.params.options=e.filter(e=>!this.getMetadata().get(["entityDefs","ScheduledJob","jobs",e,"isSystem"])),this.params.options.unshift(""),this.wait(!1)})),this.model.isNew()&&this.on("change",()=>{var e,t=this.model.get("job");if(t)return e=this.getLanguage().translateOption(t,"job","ScheduledJob"),t=this.getMetadata().get("entityDefs.ScheduledJob.jobSchedulingMap."+t)||"*/10 * * * *",this.model.set("name",e),void this.model.set("scheduling",t);this.model.set("name",""),this.model.set("scheduling","")})}}e.default=s}),define("views/role/list",["exports","views/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchPanel=!1}e.default=s}),define("views/role/record/detail-side",["exports","views/record/detail-side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{panelList=[{name:"default",label:!1,view:"views/role/record/panels/side"}]}e.default=s}),define("views/role/record/panels/side",["exports","views/record/panels/side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="role/record/panels/side"}e.default=s}),define("views/role/modals/add-field",["exports","views/modal"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="role/modals/add-field";backdrop=!0;events={'click a[data-action="addField"]':function(e){this.trigger("add-fields",[$(e.currentTarget).data().name])}};data(){return{dataList:this.dataList,scope:this.scope}}setup(){this.addHandler("keyup",'input[data-name="quick-search"]',(e,t)=>{this.processQuickSearch(t.value)}),this.addHandler("click",'input[type="checkbox"]',(e,t)=>{var i=t.dataset.name;t.checked?this.checkedList.push(i):-1!==(t=this.checkedList.indexOf(i))&&this.checkedList.splice(t,1),this.checkedList.length?this.enableButton("select"):this.disableButton("select")}),this.buttonList=[{name:"select",label:"Select",style:"danger",disabled:!0,onClick:()=>{this.trigger("add-fields",this.checkedList)}},{name:"cancel",label:"Cancel",onClick:()=>this.actionCancel()}],this.checkedList=[];const t=this.scope=this.options.scope;this.headerText=this.translate(t,"scopeNamesPlural")+" · "+this.translate("Add Field");var e=this.getMetadata().get(`entityDefs.${t}.fields`)||{};const i=[],s=this.options.ignoreFieldList||[];Object.keys(e).filter(e=>!s.includes(e)).forEach(e=>{this.getFieldManager().isEntityTypeFieldAvailable(t,e)&&null==this.getMetadata().get(["app",this.options.type,"mandatory","scopeFieldLevel",this.scope,e])&&i.push(e)}),this.fieldList=this.getLanguage().sortFieldList(t,i),this.dataList=this.fieldList.map(e=>({name:e,label:this.translate(e,"fields",this.scope)}))}afterRender(){this.$table=this.$el.find("table.fields-table"),setTimeout(()=>{this.element.querySelector('input[data-name="quick-search"]').focus()},0)}processQuickSearch(e){if(e=e.trim()){const n=[],o=e.toLowerCase();this.dataList.forEach(e=>{let t=!1;const i=e.name,s=e.label;if(!(t=0!==s.indexOf(o)&&0!==i.toLowerCase().indexOf(o)?t:!0)){const a=s.split(" ").concat(s.split(" "));a.forEach(e=>{0===e.toLowerCase().indexOf(o)&&(t=!0)})}t&&n.push(e)}),0!==n.length?this.dataList.forEach(e=>{const t=this.$table.find(`tr[data-name="${e.name}"]`);n.includes(e)?t.removeClass("hidden"):t.addClass("hidden")}):this.$table.find("tr").addClass("hidden")}else this.$table.find("tr").removeClass("hidden")}}e.default=s}),define("views/role/fields/permission",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){this.params.style={yes:"success",all:"success",account:"info",contact:"info",team:"info",own:"warning",no:"danger",enabled:"success",disabled:"danger","not-set":"default"},super.setup()}}e.default=s}),define("views/portal-role/list",["exports","views/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{searchPanel=!1}e.default=s}),define("views/portal-role/record/table",["exports","views/role/record/table"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{levelListMap={recordAllAccountContactOwnNo:["all","account","contact","own","no"],recordAllAccountOwnNo:["all","account","own","no"],recordAllContactOwnNo:["all","contact","own","no"],recordAllAccountNo:["all","account","no"],recordAllContactNo:["all","contact","no"],recordAllAccountContactNo:["all","account","contact","no"],recordAllOwnNo:["all","own","no"],recordAllNo:["all","no"],record:["all","own","no"]};levelList=["all","account","contact","own","no"];type="aclPortal";lowestLevelByDefault=!0;setupScopeList(){this.aclTypeMap={},this.scopeList=[];const e=this.getSortedScopeList();e.forEach(e=>{var t;this.getMetadata().get(`scopes.${e}.disabled`)||this.getMetadata().get(`scopes.${e}.disabledPortal`)||(t=this.getMetadata().get(`scopes.${e}.aclPortal`))&&(this.scopeList.push(e),!0===(this.aclTypeMap[e]=t)&&(this.aclTypeMap[e]="record"))})}isAclFieldLevelDisabledForScope(e){return!!this.getMetadata().get(`scopes.${e}.aclPortalFieldLevelDisabled`)}}e.default=s}),define("views/portal-role/record/list",["exports","views/role/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{}e.default=s}),define("views/portal-role/record/edit",["exports","views/role/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{tableView="views/portal-role/record/table";stickButtonsContainerAllTheWay=!0}e.default=s}),define("views/portal-role/record/detail",["exports","views/role/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{tableView="views/portal-role/record/table";stickButtonsContainerAllTheWay=!0}e.default=s}),define("views/lead-capture-log-record/modals/detail",["exports","views/modals/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{editDisabled=!0;fullFormDisabled=!0}e.default=s}),define("views/lead-capture/opt-in-confirmation-success",["exports","view","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="lead-capture/opt-in-confirmation-success";setup(){const e=new i.default;this.resultData=this.options.resultData,this.resultData.message&&(e.set("message",this.resultData.message),this.createView("messageField","views/fields/text",{selector:'.field[data-name="message"]',mode:"detail",inlineEditDisabled:!0,model:e,name:"message"}))}data(){return{resultData:this.options.resultData,defaultMessage:this.getLanguage().translate("optInIsConfirmed","messages","LeadCapture")}}}e.default=a}),define("views/lead-capture/opt-in-confirmation-expired",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="lead-capture/opt-in-confirmation-expired";setup(){this.resultData=this.options.resultData}data(){return{defaultMessage:this.getLanguage().translate("optInConfirmationExpired","messages","LeadCapture")}}}e.default=s}),define("views/lead-capture/record/list",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{massActionList=["remove","massUpdate","export"]}e.default=s}),define("views/lead-capture/record/detail",["exports","views/record/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupActionItems(){super.setupActionItems(),this.addDropdownItem({label:"Generate New API Key",name:"generateNewApiKey",onClick:()=>this.actionGenerateNewApiKey()})}actionGenerateNewApiKey(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ajax.postRequest("LeadCapture/action/generateNewApiKey",{id:this.model.id}).then(e=>{this.model.set(e)})})}}e.default=s}),define("views/lead-capture/record/panels/request",["exports","views/record/panels/side"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{fieldList=["exampleRequestUrl","exampleRequestMethod","exampleRequestHeaders","exampleRequestPayload"]}e.default=s}),define("views/lead-capture/fields/smtp-account",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataUrl="LeadCapture/action/smtpAccountDataList";getAttributeList(){return[this.name,"inboundEmailId"]}data(){const e=super.data();return e.valueIsSet=!0,e.isNotEmpty=!0,e}setupOptions(){var e;super.setupOptions(),this.params.options=[],this.translatedOptions={},this.params.options.push("system"),this.loadedOptionList?this.loadedOptionList.forEach(e=>{this.params.options.push(e),this.translatedOptions[e]=(this.loadedOptionTranslations[e]||e)+" ("+this.translate("group","labels","MassEmail")+")"}):this.model.get("inboundEmailId")&&(e="inboundEmail:"+this.model.get("inboundEmailId"),this.params.options.push(e),this.translatedOptions[e]=(this.model.get("inboundEmailName")||this.model.get("inboundEmailId"))+" ("+this.translate("group","labels","MassEmail")+")"),this.translatedOptions.system=this.getConfig().get("outboundEmailFromAddress")+" ("+this.translate("system","labels","MassEmail")+")"}getValueForDisplay(){return!this.model.has(this.name)&&this.isReadMode()?this.model.has("inboundEmailId")?this.model.get("inboundEmailId")?"inboundEmail:"+this.model.get("inboundEmailId"):"system":"...":this.model.get(this.name)}setup(){super.setup(),(this.getAcl().checkScope("MassEmail","create")||this.getAcl().checkScope("MassEmail","edit"))&&Espo.Ajax.getRequest(this.dataUrl).then(e=>{e.length&&(this.loadedOptionList=[],this.loadedOptionTranslations={},this.loadedOptionAddresses={},this.loadedOptionFromNames={},e.forEach(e=>{this.loadedOptionList.push(e.key),this.loadedOptionTranslations[e.key]=e.emailAddress,this.loadedOptionAddresses[e.key]=e.emailAddress,this.loadedOptionFromNames[e.key]=e.fromName||""}),this.setupOptions(),this.reRender())})}fetch(){const e={},t=this.$element.val();var i;return(e[this.name]=t)&&"system"!==t?1<(i=t.split(":")).length&&(e.inboundEmailId=i[1],e.inboundEmailName=this.translatedOptions[e.inboundEmailId]||e.inboundEmailId):(e.inboundEmailId=null,e.inboundEmailName=null),e}}e.default=s}),define("views/lead-capture/fields/phone-number-country",["exports","views/fields/enum","intl-tel-input-globals"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{setupOptions(){this.params.options=["",...i.default.getCountryData().map(e=>e.iso2)],this.translatedOptions=i.default.getCountryData().reduce((e,t)=>(e[t.iso2]=t.iso2.toUpperCase()+" +"+t.dialCode,e),{})}}e.default=a}),define("views/lead-capture/fields/field-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){this.params.options=[],this.translatedOptions={};var e=this.getMetadata().get(["entityDefs","Lead","fields"])||{};const t=this.getMetadata().get(["entityDefs","LeadCapture","fields","fieldList","ignoreFieldList"])||[];for(const s in e){var i=e[s];i.disabled||i.readOnly||t.includes(s)||(this.params.options.push(s),this.translatedOptions[s]=this.translate(s,"fields","Lead"))}}}e.default=s}),define("views/layout-set/layouts",["exports","views/admin/layouts/index"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){const t=this.setId=this.options.layoutSetId;this.baseUrl="#LayoutSet/editLayouts/id="+t,super.setup(),this.wait(this.getModelFactory().create("LayoutSet").then(e=>((this.sModel=e).id=t,e.fetch())))}getLayoutScopeDataList(){const e=[],a=this.sModel.get("layoutList")||[],t=[];return a.forEach(e=>{e=e.split(".")[0];t.includes(e)||t.push(e)}),t.forEach(t=>{const i={},s=(i.scope=t,i.url=this.baseUrl+"&scope="+t,i.typeDataList=[],[]);a.forEach(e=>{var[e,t]=e.split(".");e===i.scope&&s.push(t)}),s.forEach(e=>{i.typeDataList.push({type:e,url:this.baseUrl+`&scope=${t}&type=`+e,label:this.translateLayoutName(e,t)})}),i.typeList=s,e.push(i)}),e}getHeaderHtml(){var e=' <span class="breadcrumb-separator"><span class="chevron-right"></span></span> ';return $("<span>").append($("<a>").attr("href","#LayoutSet").text(this.translate("LayoutSet","scopeNamesPlural")),e,$("<a>").attr("href","#LayoutSet/view/"+this.sModel.id).text(this.sModel.get("name")),e,$("<span>").text(this.translate("Edit Layouts","labels","LayoutSet"))).get(0).outerHTML}navigate(e,t){e="#LayoutSet/editLayouts/id="+this.setId+"&scope="+e+"&type="+t;this.getRouter().navigate(e,{trigger:!1})}}e.default=s}),define("views/layout-set/record/list",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{massActionList=["remove","export"]}e.default=s}),define("views/layout-set/fields/layout-list",["exports","views/fields/multi-enum","views/admin/layouts/index"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{typeList=["list","detail","listSmall","detailSmall","bottomPanelsDetail","filters","massUpdate","sidePanelsDetail","sidePanelsEdit","sidePanelsDetailSmall","sidePanelsEditSmall"];setupOptions(){this.params.options=[],this.translatedOptions={},this.scopeList=Object.keys(this.getMetadata().get("scopes")).filter(e=>this.getMetadata().get(["scopes",e,"layouts"])).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames")));const e=i.default.prototype.getLayoutScopeDataList.call(this);e.forEach(i=>{i.typeList.forEach(e=>{var t=i.scope+"."+e;"Portal"!==e.substr(-6)&&(this.params.options.push(t),this.translatedOptions[t]=this.translate(i.scope,"scopeNames")+" . "+this.translate(e,"layouts","Admin"))})})}translateLayoutName(e,t){return i.default.prototype.translateLayoutName.call(this,e,t)}}e.default=a}),define("views/layout-set/fields/edit",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{detailTemplateContent=`<a
            class="btn btn-default"
            href="#LayoutSet/editLayouts/id={{model.id}}"
        >{{translate 'Edit Layouts' scope='LayoutSet'}}</a>`;editTemplateContent=""}e.default=s}),define("views/inbound-email/record/list",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{quickDetailDisabled=!0;quickEditDisabled=!0;massActionList=["remove","massUpdate"];checkAllResultDisabled=!0}e.default=s}),define("views/inbound-email/record/edit",["exports","views/record/edit","views/inbound-email/record/detail"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{setup(){super.setup(),i.default.prototype.setupFieldsBehaviour.call(this),i.default.prototype.initSslFieldListening.call(this),i.default.prototype.wasFetched.call(this)&&this.setFieldReadOnly("fetchSince")}modifyDetailLayout(e){i.default.prototype.modifyDetailLayout.call(this,e)}controlStatusField(){i.default.prototype.controlStatusField.call(this)}initSmtpFieldsControl(){i.default.prototype.initSmtpFieldsControl.call(this)}controlSmtpFields(){i.default.prototype.controlSmtpFields.call(this)}controlSentFolderField(){i.default.prototype.controlSentFolderField.call(this)}controlSmtpAuthField(){i.default.prototype.controlSmtpAuthField.call(this)}wasFetched(){i.default.prototype.wasFetched.call(this)}}e.default=a}),define("views/inbound-email/fields/test-send",["exports","views/email-account/fields/test-send"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getSmtpData(){return{server:this.model.get("smtpHost"),port:this.model.get("smtpPort"),auth:this.model.get("smtpAuth"),security:this.model.get("smtpSecurity"),username:this.model.get("smtpUsername"),password:this.model.get("smtpPassword")||null,authMechanism:this.model.get("smtpAuthMechanism"),fromName:this.model.get("fromName"),fromAddress:this.model.get("emailAddress"),type:"inboundEmail",id:this.model.id}}}e.default=s}),define("views/inbound-email/fields/test-connection",["exports","views/email-account/fields/test-connection"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{url="InboundEmail/action/testConnection"}e.default=s}),define("views/inbound-email/fields/target-user-position",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.translatedOptions={"":`--${this.translate("All")}--`},this.params.options=[""],this.model.get("targetUserPosition")&&this.model.get("teamId")&&this.params.options.push(this.model.get("targetUserPosition")),this.loadRoleList(()=>{this.mode===this.MODE_EDIT&&this.isRendered()&&this.render()}),this.listenTo(this.model,"change:teamId",()=>{this.loadRoleList(()=>this.render())})}loadRoleList(t){const i=this.model.attributes.teamId;i||(this.params.options=[""]),this.getModelFactory().create("Team",e=>{e.id=i,e.fetch().then(()=>{this.params.options=e.get("positionList")||[],this.params.options.unshift(""),t.call(this)})})}}e.default=s}),define("views/inbound-email/fields/folders",["exports","views/email-account/fields/folders"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getFoldersUrl="InboundEmail/action/getFolders"}e.default=s}),define("views/inbound-email/fields/folder",["exports","views/email-account/fields/folder"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{getFoldersUrl="InboundEmail/action/getFolders"}e.default=s}),define("views/inbound-email/fields/email-address",["exports","views/fields/email-address"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.on("change",()=>{var e=this.model.get("emailAddress");this.model.set("name",e),!this.model.isNew()&&this.model.get("replyToAddress")||this.model.set("replyToAddress",e)})}}e.default=s}),define("views/authentication-provider/record/edit",["exports","helpers/misc/authentication-provider","views/record/edit"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t);class a extends(i=s(i)).default{saveAndNewAction=!1;helper;setup(){this.helper=new t.default(this),super.setup()}setupBeforeFinal(){this.dynamicLogicDefs=this.helper.setupMethods(),super.setupBeforeFinal(),this.helper.setupPanelsVisibility(()=>{this.processDynamicLogic()})}modifyDetailLayout(e){this.helper.modifyDetailLayout(e)}}e.default=a}),define("views/authentication-provider/record/detail",["exports","views/record/detail","helpers/misc/authentication-provider"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{editModeDisabled=!0;helper;setup(){this.helper=new i.default(this),super.setup()}setupBeforeFinal(){this.dynamicLogicDefs=this.helper.setupMethods(),super.setupBeforeFinal(),this.helper.setupPanelsVisibility(()=>{this.processDynamicLogic()})}modifyDetailLayout(e){this.helper.modifyDetailLayout(e)}}e.default=a}),define("views/authentication-provider/fields/method",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){const t=this.getMetadata().get(["authenticationMethods"])||{},e=Object.keys(t).filter(e=>{return(t[e].provider||{}).isAvailable});e.unshift(""),this.params.options=e}}e.default=s}),define("views/admin/user-interface",["views/settings/record/edit"],function(e){return e.extend({layoutName:"userInterface",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.controlColorsField(),this.listenTo(this.model,"change:scopeColorsDisabled",this.controlColorsField,this),this.on("save",e=>{this.model.get("theme")===e.theme&&(this.model.get("themeParams").navbar||{})===e.themeParams.navbar||(this.setConfirmLeaveOut(!1),window.location.reload())})},controlColorsField:function(){this.model.get("scopeColorsDisabled")?this.hideField("tabColorsDisabled"):this.showField("tabColorsDisabled")}})}),define("views/admin/sms",["views/settings/record/edit"],function(e){return e.extend({layoutName:"sms"})}),define("views/admin/settings",["exports","views/settings/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{layoutName="settings";saveAndContinueEditingAction=!1;dynamicLogicDefs={fields:{phoneNumberPreferredCountryList:{visible:{conditionGroup:[{attribute:"phoneNumberInternational",type:"isTrue"}]}},phoneNumberExtensions:{visible:{conditionGroup:[{attribute:"phoneNumberInternational",type:"isTrue"}]}}}};setup(){super.setup(),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()&&(this.hideField("cronDisabled"),this.hideField("maintenanceMode"),this.setFieldReadOnly("useWebSocket"),this.setFieldReadOnly("siteUrl"))}}e.default=s}),define("views/admin/outbound-emails",["views/settings/record/edit"],function(e){return e.extend({layoutName:"outboundEmails",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{smtpUsername:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]},required:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]}},smtpPassword:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"},{type:"isTrue",attribute:"smtpAuth"}]}},smtpPort:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]},required:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}},smtpSecurity:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}},smtpAuth:{visible:{conditionGroup:[{type:"isNotEmpty",attribute:"smtpServer"}]}}}},setup:function(){e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this);const t=this.getFieldView("smtpSecurity");this.listenTo(t,"change",()=>{var e=t.fetch().smtpSecurity;"SSL"===e?this.model.set("smtpPort",465):"TLS"===e?this.model.set("smtpPort",587):this.model.set("smtpPort",25)})}})}),define("views/admin/notifications",["views/settings/record/edit"],function(e){return e.extend({layoutName:"notifications",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{assignmentEmailNotificationsEntityList:{visible:{conditionGroup:[{type:"isTrue",attribute:"assignmentEmailNotifications"}]}},adminNotificationsNewVersion:{visible:{conditionGroup:[{type:"isTrue",attribute:"adminNotifications"}]}},adminNotificationsNewExtensionVersion:{visible:{conditionGroup:[{type:"isTrue",attribute:"adminNotifications"}]}}}},setup:function(){e.prototype.setup.call(this),this.controlStreamEmailNotificationsEntityList(),this.listenTo(this.model,"change",function(e){(e.hasChanged("streamEmailNotifications")||e.hasChanged("portalStreamEmailNotifications"))&&this.controlStreamEmailNotificationsEntityList()},this)},controlStreamEmailNotificationsEntityList:function(){this.model.get("streamEmailNotifications")||this.model.get("portalStreamEmailNotifications")?(this.showField("streamEmailNotificationsEntityList"),this.showField("streamEmailNotificationsTypeList")):(this.hideField("streamEmailNotificationsEntityList"),this.hideField("streamEmailNotificationsTypeList"))}})}),define("views/admin/jobs-settings",["views/settings/record/edit"],function(e){return e.extend({layoutName:"jobsSettings",saveAndContinueEditingAction:!1,dynamicLogicDefs:{fields:{jobPoolConcurrencyNumber:{visible:{conditionGroup:[{type:"isTrue",attribute:"jobRunInParallel"}]}}}},setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()&&(this.setFieldReadOnly("jobRunInParallel"),this.setFieldReadOnly("jobMaxPortion"),this.setFieldReadOnly("jobPoolConcurrencyNumber"),this.setFieldReadOnly("daemonInterval"),this.setFieldReadOnly("daemonMaxProcessNumber"),this.setFieldReadOnly("daemonProcessTimeout"))}})}),define("views/admin/inbound-emails",["views/settings/record/edit"],function(e){return e.extend({layoutName:"inboundEmails",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this)}})}),define("views/admin/currency",["views/settings/record/edit"],function(e){return e.extend({layoutName:"currency",saveAndContinueEditingAction:!1,setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:currencyList",function(e,t,i){i.ui&&(i=Espo.Utils.clone(e.get("currencyList")),this.setFieldOptionList("defaultCurrency",i),this.setFieldOptionList("baseCurrency",i),this.controlCurrencyRatesVisibility())},this),this.listenTo(this.model,"change",function(e,t){t.ui&&(!e.hasChanged("currencyList")&&!e.hasChanged("baseCurrency")||(t=this.getFieldView("currencyRates"))&&t.reRender())},this),this.controlCurrencyRatesVisibility()},controlCurrencyRatesVisibility:function(){this.model.get("currencyList").length<2?this.hideField("currencyRates"):this.showField("currencyRates")}})}),define("views/admin/authentication",["exports","views/settings/record/edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{layoutName="authentication";saveAndContinueEditingAction=!1;dynamicLogicDefs={fields:{authIpAddressWhitelist:{visible:{conditionGroup:[{attribute:"authIpAddressCheck",type:"isTrue"}]},required:{conditionGroup:[{attribute:"authIpAddressCheck",type:"isTrue"}]}},authIpAddressCheckExcludedUsers:{visible:{conditionGroup:[{attribute:"authIpAddressCheck",type:"isTrue"}]}}},panels:{}};setup(){this.methodList=[];var e=this.getMetadata().get(["authenticationMethods"])||{};for(const t in e)e[t].settings&&e[t].settings.isAvailable&&this.methodList.push(t);this.authFields={},super.setup(),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()&&(this.setFieldReadOnly("authIpAddressCheck",!0),this.setFieldReadOnly("authIpAddressWhitelist",!0),this.setFieldReadOnly("authIpAddressCheckExcludedUsers",!0)),this.handlePanelsVisibility(),this.listenTo(this.model,"change:authenticationMethod",()=>{this.handlePanelsVisibility()}),this.manage2FAFields(),this.listenTo(this.model,"change:auth2FA",()=>{this.manage2FAFields()}),this.managePasswordRecoveryFields(),this.listenTo(this.model,"change:passwordRecoveryDisabled",()=>{this.managePasswordRecoveryFields()})}setupBeforeFinal(){this.dynamicLogicDefs=Espo.Utils.cloneDeep(this.dynamicLogicDefs),this.methodList.forEach(e=>{var t=this.getMetadata().get(["authenticationMethods",e,"settings","fieldList"]),i=(t&&(this.authFields[e]=t),this.getMetadata().get(["authenticationMethods",e,"settings","dynamicLogic","fields"]));if(i)for(const s in i)this.dynamicLogicDefs.fields[s]=Espo.Utils.cloneDeep(i[s])}),super.setupBeforeFinal()}modifyDetailLayout(i){this.methodList.forEach(e=>{let t=this.getMetadata().get(["authenticationMethods",e,"settings","layout"]);t&&((t=Espo.Utils.cloneDeep(t)).name=e,t.tabBreak=!0,t.tabLabel=t.label,t.label=null,this.prepareLayout(t,e),i.push(t))})}prepareLayout(e,i){e.rows.forEach(e=>{e.filter(e=>!e.noLabel&&!e.labelText&&e.name).forEach(e=>{const t=this.translate(e.name,"fields","Settings");t&&0===t.toLowerCase().indexOf(i.toLowerCase()+" ")&&(e.labelText=t.substring(i.length+1))})})}handlePanelsVisibility(){const i=this.model.get("authenticationMethod");this.methodList.forEach(e=>{const t=this.authFields[e]||[];if(e!==i)return this.hidePanel(e),void t.forEach(e=>{this.hideField(e)});this.showPanel(e),t.forEach(e=>{this.showField(e)}),this.processDynamicLogic()})}manage2FAFields(){if(this.model.get("auth2FA"))return this.showField("auth2FAForced"),this.showField("auth2FAMethodList"),this.showField("auth2FAInPortal"),void this.setFieldRequired("auth2FAMethodList");this.hideField("auth2FAForced"),this.hideField("auth2FAMethodList"),this.hideField("auth2FAInPortal"),this.setFieldNotRequired("auth2FAMethodList")}managePasswordRecoveryFields(){if(!this.model.get("passwordRecoveryDisabled"))return this.showField("passwordRecoveryForAdminDisabled"),this.showField("passwordRecoveryForInternalUsersDisabled"),void this.showField("passwordRecoveryNoExposure");this.hideField("passwordRecoveryForAdminDisabled"),this.hideField("passwordRecoveryForInternalUsersDisabled"),this.hideField("passwordRecoveryNoExposure")}}e.default=s}),define("views/admin/upgrade/ready",["views/modal"],function(e){return e.extend({cssName:"ready-modal",header:!1,template:"admin/upgrade/ready",createButton:!0,data:function(){return{version:this.upgradeData.version,text:this.translate("upgradeVersion","messages","Admin").replace("{version}",this.upgradeData.version)}},setup:function(){this.buttonList=[{name:"run",label:this.translate("Run Upgrade","labels","Admin"),style:"danger"},{name:"cancel",label:"Cancel"}],this.upgradeData=this.options.upgradeData,this.header=this.getLanguage().translate("Ready for upgrade","labels","Admin")},actionRun:function(){this.trigger("run"),this.remove()}})}),define("views/admin/upgrade/index",["view"],function(e){return e.extend({template:"admin/upgrade/index",packageContents:null,data:function(){return{versionMsg:this.translate("Current version")+": "+this.getConfig().get("version"),infoMsg:this.translate("upgradeInfo","messages","Admin").replace("{url}","https://www.espocrm.com/documentation/administration/upgrading/"),backupsMsg:this.translate("upgradeBackup","messages","Admin"),upgradeRecommendation:this.translate("upgradeRecommendation","messages","Admin"),downloadMsg:this.translate("downloadUpgradePackage","messages","Admin").replace("{url}","https://www.espocrm.com/download/upgrades")}},afterRender:function(){this.$el.find(".panel-body a").attr("target","_BLANK")},events:{'change input[name="package"]':function(e){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),this.$el.find(".message-container").html("");e=e.currentTarget.files;e.length&&this.selectFile(e[0])},'click button[data-action="upload"]':function(){this.upload()}},setup:function(){},selectFile:function(e){var t=new FileReader;t.onload=e=>{this.packageContents=e.target.result,this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled")},t.readAsDataURL(e)},showError:function(e){e=this.translate(e,"errors","Admin"),this.$el.find(".message-container").html(e)},upload:function(){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),this.notify("Uploading..."),Espo.Ajax.postRequest("Admin/action/uploadUpgradePackage",this.packageContents,{contentType:"application/zip",timeout:0}).then(t=>{t.id?(Espo.Ui.notify(!1),this.createView("popup","views/admin/upgrade/ready",{upgradeData:t},e=>{e.render(),this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled"),e.once("run",()=>{e.close(),this.$el.find(".panel.upload").addClass("hidden"),this.run(t.id,t.version)})})):this.showError(this.translate("Error occurred"))}).catch(e=>{this.showError(e.getResponseHeader("X-Status-Reason")),Espo.Ui.notify(!1)})},textNotification:function(e){this.$el.find(".notify-text").html(e)},run:function(e,t){var i=this.translate("Upgrading...","labels","Admin");Espo.Ui.notify(this.translate("pleaseWait","messages")),this.textNotification(i),Espo.Ajax.postRequest("Admin/action/runUpgrade",{id:e},{timeout:0,bypassAppReload:!0}).then(()=>{let e=this.getCache();e&&e.clear(),this.createView("popup","views/admin/upgrade/done",{version:t},e=>{Espo.Ui.notify(!1),e.render()})}).catch(e=>{this.$el.find(".panel.upload").removeClass("hidden");e=e.getResponseHeader("X-Status-Reason");this.textNotification(this.translate("Error")+": "+e)})}})}),define("views/admin/upgrade/done",["views/modal"],function(e){return e.extend({cssName:"done-modal",header:!1,createButton:!0,template:"admin/upgrade/done",data:function(){return{version:this.options.version,text:this.translate("upgradeDone","messages","Admin").replace("{version}",this.options.version)}},setup:function(){this.on("remove",()=>{window.location.reload()}),this.buttonList=[{name:"close",label:"Close",onClick:e=>{setTimeout(()=>{this.getRouter().navigate("#Admin",{trigger:!0})},500),e.close()}}],this.header=this.getLanguage().translate("Upgraded successfully","labels","Admin")}})}),define("views/admin/template-manager/index",["view"],function(e){return e.extend({template:"admin/template-manager/index",data:function(){return{templateDataList:this.templateDataList}},events:{'click [data-action="selectTemplate"]':function(e){var t=$(e.currentTarget).data("name");this.getRouter().checkConfirmLeaveOut(()=>{this.selectTemplate(t)})}},setup:function(){this.templateDataList=[];var e=Object.keys(this.getMetadata().get(["app","templates"])||{});e.sort((e,t)=>this.translate(e,"templates","Admin").localeCompare(this.translate(t,"templates","Admin"))),e.forEach(t=>{var e=this.getMetadata().get(["app","templates",t]);if(e.scopeListConfigParam||e.scopeList)return(e=Espo.Utils.clone(e.scopeList||this.getConfig().get(e.scopeListConfigParam)||[])).sort((e,t)=>this.translate(e,"scopeNames").localeCompare(this.translate(t,"scopeNames"))),void e.forEach(e=>{e={name:t+"_"+e,text:this.translate(t,"templates","Admin")+" :: "+this.translate(e,"scopeNames")};this.templateDataList.push(e)});e={name:t,text:this.translate(t,"templates","Admin")};this.templateDataList.push(e)}),this.selectedTemplate=this.options.name,this.selectedTemplate&&this.once("after:render",()=>{this.selectTemplate(this.selectedTemplate,!0)})},selectTemplate:function(e){this.selectedTemplate=e,this.getRouter().navigate("#Admin/templateManager/name="+this.selectedTemplate,{trigger:!1}),this.createRecordView(),this.$el.find('[data-action="selectTemplate"]').removeClass("disabled").removeAttr("disabled"),this.$el.find('[data-name="'+e+'"][data-action="selectTemplate"]').addClass("disabled").attr("disabled","disabled")},createRecordView:function(){Espo.Ui.notify(" ... "),this.createView("record","views/admin/template-manager/edit",{selector:".template-record",name:this.selectedTemplate},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Template Manager","labels","Admin"))}})}),define("views/admin/template-manager/edit",["view","model"],function(e,i){return e.extend({template:"admin/template-manager/edit",data:function(){return{title:this.title,hasSubject:this.hasSubject}},events:{'click [data-action="save"]':function(){this.actionSave()},'click [data-action="cancel"]':function(){this.actionCancel()},'click [data-action="resetToDefault"]':function(){this.actionResetToDefault()},"keydown.form":function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Control+KeyS"!==t&&"Control+Enter"!==t||(this.actionSave(),e.preventDefault(),e.stopPropagation())}},setup:function(){this.wait(!0),this.fullName=this.options.name,this.name=this.fullName,this.scope=null;var e=this.fullName.split("_");1<e.length&&(this.scope=e[1],this.name=e[0]),this.hasSubject=!this.getMetadata().get(["app","templates",this.name,"noSubject"]),this.title=this.translate(this.name,"templates","Admin"),this.scope&&(this.title+=" :: "+this.translate(this.scope,"scopeNames")),this.attributes={},Espo.Ajax.getRequest("TemplateManager/action/getTemplate",{name:this.name,scope:this.scope}).then(function(e){var t=this.model=new i;t.name="TemplateManager",t.set("body",e.body),this.attributes.body=e.body,this.hasSubject&&(t.set("subject",e.subject),this.attributes.subject=e.subject),this.listenTo(t,"change",function(){this.setConfirmLeaveOut(!0)},this),this.createView("bodyField","views/admin/template-manager/fields/body",{name:"body",model:t,selector:".body-field",mode:"edit"}),this.hasSubject&&this.createView("subjectField","views/fields/varchar",{name:"subject",model:t,selector:".subject-field",mode:"edit"}),this.wait(!1)}.bind(this))},setConfirmLeaveOut:function(e){this.getRouter().confirmLeaveOut=e},afterRender:function(){this.$save=this.$el.find('button[data-action="save"]'),this.$cancel=this.$el.find('button[data-action="cancel"]'),this.$resetToDefault=this.$el.find('button[data-action="resetToDefault"]')},actionSave:function(){this.$save.addClass("disabled").attr("disabled"),this.$cancel.addClass("disabled").attr("disabled"),this.$resetToDefault.addClass("disabled").attr("disabled"),this.getView("bodyField").fetchToModel();var e={name:this.name,body:this.model.get("body")};this.scope&&(e.scope=this.scope),this.hasSubject&&(this.getView("subjectField").fetchToModel(),e.subject=this.model.get("subject")),Espo.Ui.notify(this.translate("saving","messages")),Espo.Ajax.postRequest("TemplateManager/action/saveTemplate",e).then(()=>{this.setConfirmLeaveOut(!1),this.attributes.body=e.body,this.attributes.subject=e.subject,this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled"),Espo.Ui.success(this.translate("Saved"))}).catch(()=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled")})},actionCancel:function(){this.model.set("subject",this.attributes.subject),this.model.set("body",this.attributes.body),this.setConfirmLeaveOut(!1)},actionResetToDefault:function(){this.confirm(this.translate("confirmation","messages"),()=>{this.$save.addClass("disabled").attr("disabled"),this.$cancel.addClass("disabled").attr("disabled"),this.$resetToDefault.addClass("disabled").attr("disabled");var e={name:this.name,body:this.model.get("body")};this.scope&&(e.scope=this.scope),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("TemplateManager/action/resetTemplate",e).then(e=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled"),this.attributes.body=e.body,this.attributes.subject=e.subject,this.model.set("subject",e.subject),this.model.set("body",e.body),this.setConfirmLeaveOut(!1),Espo.Ui.notify(!1)}).catch(()=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled"),this.$resetToDefault.removeClass("disabled").removeAttr("disabled")})})}})}),define("views/admin/template-manager/fields/body",["exports","views/fields/wysiwyg"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{htmlPurificationForEditDisabled=!0;handlebars=!0}e.default=s}),define("views/admin/system-requirements/index",["view"],function(e){return e.extend({template:"admin/system-requirements/index",data:function(){return{phpRequirementList:this.requirementList.php,databaseRequirementList:this.requirementList.database,permissionRequirementList:this.requirementList.permission}},setup:function(){this.requirementList=[],Espo.Ajax.getRequest("Admin/action/systemRequirementList").then(e=>{this.requirementList=e,(this.isRendered()||this.isBeingRendered())&&this.reRender()})}})}),define("views/admin/panels/notifications",["view"],function(e){return e.extend({template:"admin/panels/notifications",data:function(){return{notificationList:this.notificationList}},setup:function(){this.notificationList=[],Espo.Ajax.getRequest("Admin/action/adminNotificationList").then(e=>{this.notificationList=e,(this.isRendered()||this.isBeingRendered())&&this.reRender()})}})}),define("views/admin/link-manager/modals/edit",["exports","views/modal","model","views/admin/link-manager/index","views/fields/enum"],function(e,t,g,y,b){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=i(t),g=i(g),y=i(y),b=i(b);class s extends t.default{template="admin/link-manager/modals/edit";cssName="edit";className="dialog dialog-record";model;shortcutKeys={"Control+KeyS":function(e){this.save({noClose:!0}),e.preventDefault(),e.stopPropagation()},"Control+Enter":function(e){this.save(),e.preventDefault(),e.stopPropagation()}};setup(){this.buttonList=[{name:"save",label:"Save",style:"danger",onClick:()=>{this.save()}},{name:"cancel",label:"Cancel",onClick:()=>{this.close()}}];var e=this.scope=this.options.scope,i=this.link=this.options.link||!1,s=e,t=this.isNew=!1===i;let h=t?"Create Link":"Edit Link";this.headerText=this.translate(h,"labels","Admin");const a=this.model=new g.default;a.name="EntityManager",this.model.set("entity",e);var n=this.getMetadata().getScopeEntityList().filter(e=>{e=this.getMetadata().get(["scopes",e])||{};return!!e.customizable&&!1!==(e.entityManager||{}).relationships}).sort((e,t)=>{const i=this.translate(e,"scopeNames");e=this.translate(t,"scopeNames");return i.localeCompare(e)});let c=!0,f;if(!t){var o=this.getMetadata().get(`entityDefs.${e}.links.${i}.entity`),l=this.getMetadata().get(`entityDefs.${e}.links.${i}.foreign`),u=this.getLanguage().translate(i,"links",e);let t=this.getLanguage().translate(l,"links",o);var d=this.getMetadata().get(`entityDefs.${s}.links.${i}.type`),r=this.getMetadata().get(`entityDefs.${o}.links.${l}.type`);if("belongsToParent"===d){f="childrenToParent",t=null;let e=this.getMetadata().get(["entityDefs",s,"fields",i,"entityList"])||[];null===this.getMetadata().get(["entityDefs",s,"fields",i,"entityList"])&&(e=n,this.noParentEntityTypeList=!0),this.model.set("parentEntityTypeList",e);n=this.getForeignLinkEntityTypeList(s,i,e);this.model.set("foreignLinkEntityTypeList",n)}else f=y.default.prototype.computeRelationshipType.call(this,d,r);this.model.set("linkType",f),this.model.set("entityForeign",o),this.model.set("link",i),this.model.set("linkForeign",l),this.model.set("label",u),this.model.set("labelForeign",t);n="linkMultiple"===this.getMetadata().get(["entityDefs",e,"fields",i,"type"])&&!this.getMetadata().get(["entityDefs",e,"fields",i,"noLoad"]),d="linkMultiple"===this.getMetadata().get(["entityDefs",o,"fields",l,"type"])&&!this.getMetadata().get(["entityDefs",o,"fields",l,"noLoad"]),u=(this.model.set("linkMultipleField",n),this.model.set("linkMultipleFieldForeign",d),"manyToMany"===f&&(r=this.getMetadata().get(`entityDefs.${s}.links.${i}.relationName`),this.model.set("relationName",r)),this.getMetadata().get(["entityDefs",e,"links",i,"audited"])||!1),n=this.getMetadata().get(["entityDefs",o,"links",l,"audited"])||!1,d=(this.model.set("audited",u),this.model.set("auditedForeign",n),this.getMetadata().get(`clientDefs.${e}.relationshipPanels.${i}.layout`)),r=this.getMetadata().get(`clientDefs.${o}.relationshipPanels.${l}.layout`),u=(this.model.set("layout",d),this.model.set("layoutForeign",r),this.getRelationshipPanelParam(e,i,"selectPrimaryFilterName")),n=this.getRelationshipPanelParam(o,l,"selectPrimaryFilterName");this.model.set("selectFilter",u),this.model.set("selectFilterForeign",n),c=this.getMetadata().get(`entityDefs.${s}.links.${i}.isCustom`)}const p=this.getMetadata().get("scopes")||null,m=(Object.keys(p)||[]).filter(e=>{e=p[e]||{};return!(!e.entity||!e.customizable)&&!1!==(e.entityManager||{}).relationships}).sort((e,t)=>{const i=this.translate(e,"scopeNames");e=this.translate(t,"scopeNames");return i.localeCompare(e)});m.unshift(""),this.createView("entity","views/fields/varchar",{model:a,mode:"edit",selector:'.field[data-name="entity"]',defs:{name:"entity"},readOnly:!0}),this.createView("entityForeign","views/fields/enum",{model:a,mode:"edit",selector:'.field[data-name="entityForeign"]',defs:{name:"entityForeign",params:{required:!0,options:m,translation:"Global.scopeNames"}},readOnly:!t}),this.createView("linkType","views/fields/enum",{model:a,mode:"edit",selector:'.field[data-name="linkType"]',defs:{name:"linkType",params:{required:!0,options:["","oneToMany","manyToOne","manyToMany","oneToOneRight","oneToOneLeft","childrenToParent"]}},readOnly:!t}),this.createView("link","views/fields/varchar",{model:a,mode:"edit",selector:'.field[data-name="link"]',defs:{name:"link",params:{required:!0,trim:!0,maxLength:61,noSpellCheck:!0}},readOnly:!t}),this.createView("linkForeign","views/fields/varchar",{model:a,mode:"edit",selector:'.field[data-name="linkForeign"]',defs:{name:"linkForeign",params:{required:!0,trim:!0,maxLength:61,noSpellCheck:!0}},readOnly:!t}),this.createView("label","views/fields/varchar",{model:a,mode:"edit",selector:'.field[data-name="label"]',defs:{name:"label",params:{required:!0,trim:!0}}}),this.createView("labelForeign","views/fields/varchar",{model:a,mode:"edit",selector:'.field[data-name="labelForeign"]',defs:{name:"labelForeign",params:{required:!0,trim:!0}}}),(t||this.model.get("relationName"))&&this.createView("relationName","views/fields/varchar",{model:a,mode:"edit",selector:'.field[data-name="relationName"]',defs:{name:"relationName",params:{required:!0,trim:!0,maxLength:61,noSpellCheck:!0}},readOnly:!t}),this.createView("linkMultipleField","views/fields/bool",{model:a,mode:"edit",selector:'.field[data-name="linkMultipleField"]',defs:{name:"linkMultipleField"},readOnly:!c,tooltip:!0,tooltipText:this.translate("linkMultipleField","tooltips","EntityManager")}),this.createView("linkMultipleFieldForeign","views/fields/bool",{model:a,mode:"edit",selector:'.field[data-name="linkMultipleFieldForeign"]',defs:{name:"linkMultipleFieldForeign"},readOnly:!c,tooltip:!0,tooltipText:this.translate("linkMultipleField","tooltips","EntityManager")}),this.createView("audited","views/fields/bool",{model:a,mode:"edit",selector:'.field[data-name="audited"]',defs:{name:"audited"},tooltip:!0,tooltipText:this.translate("linkAudited","tooltips","EntityManager")}),this.createView("auditedForeign","views/fields/bool",{model:a,mode:"edit",selector:'.field[data-name="auditedForeign"]',defs:{name:"auditedForeign"},tooltip:!0,tooltipText:this.translate("linkAudited","tooltips","EntityManager")});d=["",...this.getEntityTypeLayouts(this.scope)],r=this.getEntityTypeLayoutsTranslations(this.scope);this.layoutFieldView=new b.default({name:"layout",model:a,mode:"edit",defs:{name:"layout"},params:{options:[""]},translatedOptions:{"":this.translate("Default")}}),this.layoutForeignFieldView=new b.default({name:"layoutForeign",model:a,mode:"edit",defs:{name:"layoutForeign"},params:{options:d},translatedOptions:r}),this.assignView("layout",this.layoutFieldView,'.field[data-name="layout"]'),this.assignView("layoutForeign",this.layoutForeignFieldView,'.field[data-name="layoutForeign"]'),this.selectFilterFieldView=new b.default({name:"selectFilter",model:a,mode:"edit",defs:{name:"selectFilter"},params:{options:[""]},translatedOptions:{"":this.translate("all","presetFilters")},tooltip:!0,tooltipText:this.translate("linkSelectFilter","tooltips","EntityManager")}),this.selectFilterForeignFieldView=new b.default({name:"selectFilterForeign",model:a,mode:"edit",defs:{name:"selectFilterForeign"},params:{options:["",...this.getEntityTypeFilters(this.scope)]},translatedOptions:this.getEntityTypeFiltersTranslations(this.scope),tooltip:!0,tooltipText:this.translate("linkSelectFilter","tooltips","EntityManager")}),this.assignView("selectFilter",this.selectFilterFieldView,'.field[data-name="selectFilter"]'),this.assignView("selectFilterForeign",this.selectFilterForeignFieldView,'.field[data-name="selectFilterForeign"]'),this.createView("parentEntityTypeList","views/fields/entity-type-list",{model:a,mode:"edit",selector:'.field[data-name="parentEntityTypeList"]',defs:{name:"parentEntityTypeList"}}),this.createView("foreignLinkEntityTypeList","views/admin/link-manager/fields/foreign-link-entity-type-list",{model:a,mode:"edit",selector:'.field[data-name="foreignLinkEntityTypeList"]',defs:{name:"foreignLinkEntityTypeList",params:{options:this.model.get("parentEntityTypeList")||[]}}}),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.listenTo(this.model,"change",()=>{if(this.model.hasChanged("parentEntityTypeList")||this.model.hasChanged("linkForeign")||this.model.hasChanged("link")){const e=this.getView("foreignLinkEntityTypeList"),t=(e&&!this.noParentEntityTypeList&&e.setOptionList(this.model.get("parentEntityTypeList")||[]),Espo.Utils.clone(this.model.get("foreignLinkEntityTypeList")||[]));this.getForeignLinkEntityTypeList(this.model.get("entity"),this.model.get("link"),this.model.get("parentEntityTypeList")||[],!0).forEach(e=>{~t.indexOf(e)||t.push(e)}),this.model.set("foreignLinkEntityTypeList",t)}}),this.controlLayoutField(),this.listenTo(this.model,"change:entityForeign",()=>this.controlLayoutField()),this.controlFilterField(),this.listenTo(this.model,"change:entityForeign",()=>this.controlFilterField())}getEntityTypeLayouts(e){const t=this.getMetadata().get(["clientDefs",e,"additionalLayouts"],{});return Object.keys(t).filter(e=>["list","listSmall"].includes(t[e].type))}getEntityTypeLayoutsTranslations(t){const i={};return this.getEntityTypeLayouts(t).forEach(e=>{i[e]=this.getLanguage().has(e,"layouts",t)?this.getLanguage().translate(e,"layouts",t):this.getLanguage().translate(e,"layouts","Admin")}),i[""]=this.translate("Default"),i}getEntityTypeFiltersTranslations(t){const i={};return this.getEntityTypeFilters(t).forEach(e=>{i[e]=this.getLanguage().translate(e,"presetFilters",t)}),i[""]=this.translate("all","presetFilters"),i}getEntityTypeFilters(e){return this.getMetadata().get(`clientDefs.${e}.filterList`,[]).map(e=>"string"==typeof e?e:e.name)}controlLayoutField(){var e=this.model.get("entityForeign"),t=e?["",...this.getEntityTypeLayouts(e)]:[""];this.layoutFieldView.translatedOptions=e?this.getEntityTypeLayoutsTranslations(e):{},this.layoutFieldView.setOptionList(t).then(()=>this.layoutFieldView.reRender())}controlFilterField(){var e=this.model.get("entityForeign"),t=e?["",...this.getEntityTypeFilters(e)]:[""];this.selectFilterFieldView.translatedOptions=e?this.getEntityTypeFiltersTranslations(e):{},this.selectFilterFieldView.setOptionList(t).then(()=>this.selectFilterFieldView.reRender())}toPlural(e){return"y"===e.slice(-1)?e.substr(0,e.length-1)+"ies":"s"===e.slice(-1)?e.substr(0,e.length)+"es":e+"s"}populateFields(){var e=this.model.get("entityForeign"),t=this.model.get("linkType");let i,s;if("childrenToParent"===t)return this.model.set("link","parent"),this.model.set("label","Parent"),s=this.entityTypeToLink(this.scope,!0),this.getMetadata().get(["entityDefs",this.scope,"links","parent"])&&(this.model.set("link","parentAnother"),this.model.set("label","Parent Another"),s+="Another"),this.model.set("linkForeign",s),this.model.set("labelForeign",null),void this.model.set("entityForeign",null);if(!e||!t)return this.model.set("link",null),this.model.set("linkForeign",null),this.model.set("label",null),void this.model.set("labelForeign",null);switch(t){case"oneToMany":s=this.entityTypeToLink(this.scope),i=this.entityTypeToLink(e,!0),e===this.scope&&(s+="Parent");break;case"manyToOne":s=this.entityTypeToLink(this.scope,!0),i=this.entityTypeToLink(e),e===this.scope&&(i+="Parent");break;case"manyToMany":s=this.entityTypeToLink(this.scope,!0),(i=this.entityTypeToLink(e,!0))===s&&(i+="Right",s+="Left");const d=this.stripPrefixFromCustomEntityType(this.scope);var a=this.stripPrefixFromCustomEntityType(e),a=d.localeCompare(a)?Espo.Utils.lowerCaseFirst(d)+a:Espo.Utils.lowerCaseFirst(a)+d;this.model.set("relationName",a);break;case"oneToOneLeft":s=this.entityTypeToLink(this.scope),i=this.entityTypeToLink(e),e===this.scope&&s===Espo.Utils.lowerCaseFirst(this.scope)&&(i+="Parent");break;case"oneToOneRight":s=this.entityTypeToLink(this.scope),i=this.entityTypeToLink(e),e===this.scope&&s===Espo.Utils.lowerCaseFirst(this.scope)&&(s+="Parent")}let n=1;for(;this.getMetadata().get(["entityDefs",this.scope,"links",i]);)i+=n.toString(),n++;for(n=1;this.getMetadata().get(["entityDefs",e,"links",s]);)s+=n.toString(),n++;this.model.set("link",i),this.model.set("linkForeign",s);let o=Espo.Utils.upperCaseFirst(i.replace(/([a-z])([A-Z])/g,"$1 $2")),l=Espo.Utils.upperCaseFirst(s.replace(/([a-z])([A-Z])/g,"$1 $2"));o.startsWith("C ")&&(o=o.substring(2)),l.startsWith("C ")&&(l=l.substring(2)),this.model.set("label",o||null),this.model.set("labelForeign",l||null)}entityTypeToLink(e,t=!1){let i=this.stripPrefixFromCustomEntityType(e);return i=Espo.Utils.lowerCaseFirst(i),i=t?this.toPlural(i):i}stripPrefixFromCustomEntityType(e){let t=e;return t=this.getMetadata().get(`scopes.${e}.isCustom`)&&"C"===e[0]&&/[A-Z]/.test(e[1])?t.substring(1):t}handleLinkChange(e){let t=this.model.get(e);t&&(t=t.replace(/-/g," ").replace(/_/g," ").replace(/[^\w\s]/gi,"").replace(/ (.)/g,(e,t)=>t.toUpperCase()).replace(" ","")).length&&(t=Espo.Utils.lowerCaseFirst(t)),this.model.set(e,t)}hideField(e){const t=this.getView(e);t&&(t.disabled=!0),this.$el.find(".cell[data-name="+e+"]").addClass("hidden-cell")}showField(e){const t=this.getView(e);t&&(t.disabled=!1),this.$el.find(".cell[data-name="+e+"]").removeClass("hidden-cell")}handleLinkTypeChange(){var e=this.model.get("linkType");this.showField("entityForeign"),this.showField("labelForeign"),this.hideField("parentEntityTypeList"),this.hideField("foreignLinkEntityTypeList"),"manyToMany"===e?(this.showField("relationName"),this.showField("linkMultipleField"),this.showField("linkMultipleFieldForeign"),this.showField("audited"),this.showField("auditedForeign"),this.showField("layout"),this.showField("layoutForeign"),this.showField("selectFilter"),this.showField("selectFilterForeign")):(this.hideField("relationName"),"oneToMany"===e?(this.showField("linkMultipleField"),this.hideField("linkMultipleFieldForeign"),this.showField("audited"),this.hideField("auditedForeign"),this.showField("layout"),this.hideField("layoutForeign"),this.showField("selectFilter"),this.showField("selectFilterForeign")):"manyToOne"===e?(this.hideField("linkMultipleField"),this.showField("linkMultipleFieldForeign"),this.hideField("audited"),this.showField("auditedForeign"),this.hideField("layout"),this.showField("layoutForeign"),this.showField("selectFilter"),this.showField("selectFilterForeign")):(this.hideField("linkMultipleField"),this.hideField("linkMultipleFieldForeign"),this.hideField("audited"),this.hideField("auditedForeign"),this.hideField("layout"),this.hideField("layoutForeign"),"parentToChildren"===e?(this.showField("audited"),this.hideField("auditedForeign"),this.showField("layout"),this.hideField("layoutForeign"),this.hideField("selectFilter"),this.hideField("selectFilterForeign")):"childrenToParent"===e?(this.hideField("audited"),this.showField("auditedForeign"),this.hideField("layout"),this.hideField("layoutForeign"),this.hideField("entityForeign"),this.hideField("labelForeign"),this.hideField("selectFilter"),this.hideField("selectFilterForeign"),this.noParentEntityTypeList||this.showField("parentEntityTypeList"),this.model.get("linkForeign")?this.showField("foreignLinkEntityTypeList"):this.hideField("foreignLinkEntityTypeList")):(this.hideField("audited"),this.hideField("auditedForeign"),this.hideField("layout"),this.hideField("layoutForeign"),e?(this.showField("selectFilter"),this.showField("selectFilterForeign")):(this.hideField("selectFilter"),this.hideField("selectFilterForeign"))))),this.getMetadata().get(["scopes",this.scope,"stream"])||this.hideField("audited"),this.getMetadata().get(["scopes",this.model.get("entityForeign"),"stream"])||this.hideField("auditedForeign")}afterRender(){this.handleLinkTypeChange(),this.getView("linkType").on("change",()=>{this.handleLinkTypeChange(),this.populateFields()}),this.getView("entityForeign").on("change",()=>{this.populateFields()}),this.getView("link").on("change",()=>{this.handleLinkChange("link")}),this.getView("linkForeign").on("change",()=>{this.handleLinkChange("linkForeign")})}save(t){t=t||{};const e=["link","linkForeign","label","labelForeign","linkType","entityForeign","relationName","linkMultipleField","linkMultipleFieldForeign","audited","auditedForeign","layout","layoutForeign","selectFilter","selectFilterForeign","parentEntityTypeList","foreignLinkEntityTypeList"];let i=!1;if(e.forEach(e=>{if(this.hasView(e)){const t=this.getView(e);"edit"===t.mode&&t.fetchToModel()}}),e.forEach(e=>{if(this.hasView(e)){const t=this.getView(e);"edit"===t.mode&&(t.disabled||(i=t.validate()||i))}}),!i){this.$el.find('button[data-name="save"]').addClass("disabled").attr("disabled");let e="EntityManager/action/createLink";this.isNew||(e="EntityManager/action/updateLink");var s=this.scope,a=this.model.get("entityForeign"),n=this.model.get("link"),o=this.model.get("linkForeign"),l=this.model.get("label"),h=this.model.get("labelForeign"),c=this.model.get("relationName"),f=this.model.get("linkMultipleField"),u=this.model.get("linkMultipleFieldForeign"),p=this.model.get("audited"),m=this.model.get("auditedForeign"),g=this.model.get("layout"),y=this.model.get("layoutForeign"),d=this.model.get("linkType");const r={entity:s,entityForeign:a,link:n,linkForeign:o,label:l,labelForeign:h,linkType:d,relationName:c,linkMultipleField:f,linkMultipleFieldForeign:u,audited:p,auditedForeign:m,layout:g,layoutForeign:y,selectFilter:this.model.get("selectFilter"),selectFilterForeign:this.model.get("selectFilterForeign")};this.isNew||(r.label===this.model.fetchedAttributes.label&&delete r.label,r.labelForeign===this.model.fetchedAttributes.labelForeign&&delete r.labelForeign),"childrenToParent"===d&&(delete r.entityForeign,delete r.labelForeign,r.parentEntityTypeList=this.model.get("parentEntityTypeList"),r.foreignLinkEntityTypeList=this.model.get("foreignLinkEntityTypeList"),this.noParentEntityTypeList&&(r.parentEntityTypeList=null),delete r.selectFilter,delete r.selectFilterForeign),"parentToChildren"===d&&(delete r.selectFilter,delete r.selectFilterForeign),Espo.Ajax.postRequest(e,r).then(()=>{this.isNew?Espo.Ui.success(this.translate("Created")):Espo.Ui.success(this.translate("Saved")),this.model.fetchedAttributes=this.model.getClonedAttributes(),Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.broadcastUpdate(),this.trigger("after:save"),t.noClose||this.close(),t.noClose&&this.$el.find('button[data-name="save"]').removeClass("disabled").removeAttr("disabled")})}).catch(e=>{var t,i;409===e.status&&(t=this.translate("linkConflict","messages","EntityManager"),(i=e.getResponseHeader("X-Status-Reason"))&&console.error(i),Espo.Ui.error(t),e.errorIsHandled=!0),this.$el.find('button[data-name="save"]').removeClass("disabled").removeAttr("disabled")})}}getForeignLinkEntityTypeList(a,n,e,o){const l=[];return e.forEach(e=>{var t=this.getMetadata().get(["entityDefs",e,"links"])||{};let i=!1;for(const s in t)if(!(t[s].foreign!==n||t[s].entity!==a||"hasChildren"!==t[s].type||o&&t[s].isCustom)){i=!0;break}i&&l.push(e)}),l}getRelationshipPanelParam(e,t,i){return this.getMetadata().get(`clientDefs.${e}.relationshipPanels.${t}.`+i)}broadcastUpdate(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language")}}e.default=s}),define("views/admin/link-manager/fields/foreign-link-entity-type-list",["views/fields/checklist"],function(e){return e.extend({setup:function(){this.params.translation="Global.scopeNames",e.prototype.setup.call(this)},afterRender:function(){e.prototype.afterRender.call(this),this.controlOptionsAvailability()},controlOptionsAvailability:function(){this.params.options.forEach(e=>{var t,i=this.model.get("link"),s=this.model.get("linkForeign"),a=this.model.get("entity"),n=this.getMetadata().get(["entityDefs",e,"links"])||{},o=!1;for(t in n)(n[t].foreign===i&&!n[t].isCustom&&n[t].entity===a||t===s&&"hasChildren"!==n[t].type)&&(o=!0);o&&this.$el.find('input[data-name="checklistItem-foreignLinkEntityTypeList-'+e+'"]').attr("disabled","disabled")})}})}),define("views/admin/layouts/side-panels-edit",["exports","views/admin/layouts/side-panels-detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{viewType="edit"}e.default=s}),define("views/admin/layouts/side-panels-edit-small",["exports","views/admin/layouts/side-panels-detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{viewType="editSmall"}e.default=s}),define("views/admin/layouts/side-panels-detail-small",["exports","views/admin/layouts/side-panels-detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{viewType="detailSmall"}e.default=s}),define("views/admin/layouts/relationships",["views/admin/layouts/rows"],function(e){return e.extend({dataAttributeList:["name","dynamicLogicVisible","style","dynamicLogicStyled"],editable:!0,dataAttributesDefs:{style:{type:"enum",options:["default","success","danger","warning","info"],translation:"LayoutManager.options.style"},dynamicLogicVisible:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicVisible"},dynamicLogicStyled:{type:"base",view:"views/admin/field-manager/fields/dynamic-logic-conditions",tooltip:"dynamicLogicStyled"},name:{readOnly:!0}},languageCategory:"links",setup:function(){e.prototype.setup.call(this),this.dataAttributesDefs=Espo.Utils.cloneDeep(this.dataAttributesDefs),this.dataAttributesDefs.dynamicLogicVisible.scope=this.scope,this.dataAttributesDefs.dynamicLogicStyled.scope=this.scope,this.wait(!0),this.loadLayout(()=>{this.wait(!1)})},loadLayout:function(l){this.getModelFactory().create(this.scope,o=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{let t=[];for(var i in o.defs.links)-1!==["hasMany","hasChildren"].indexOf(o.defs.links[i].type)&&this.isLinkEnabled(o,i)&&t.push(i);for(var s in t.sort((e,t)=>this.translate(e,"links",this.scope).localeCompare(this.translate(t,"links",this.scope))),t.push("_delimiter_"),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[],e){s=e[s];let i;"string"==typeof s||s instanceof String?i={name:s,labelText:this.getLanguage().translate(s,"links",this.scope)}:(i=s).labelText=this.getLanguage().translate(i.name,"links",this.scope),"_"===i.name[0]&&(i.notEditable=!0,"_delimiter_"===i.name&&(i.labelText=". . .")),this.dataAttributeList.forEach(e=>{var t;"name"!==e&&(e in i||null!==(t=this.getMetadata().get(["clientDefs",this.scope,"relationshipPanels",i.name,e]))&&(i[e]=t))}),this.enabledFields.push(i),this.enabledFieldsList.push(i.name)}for(var a in t)if(!_.contains(this.enabledFieldsList,t[a])){a=t[a];let e={name:a,labelText:this.getLanguage().translate(a,"links",this.scope)};"_"===e.name[0]&&(e.notEditable=!0,"_delimiter_"===e.name&&(e.labelText=". . .")),this.disabledFields.push(e)}for(var n in this.rowLayout=this.enabledFields,this.rowLayout){let e=this.rowLayout[n];e.labelText=this.getLanguage().translate(this.rowLayout[n].name,"links",this.scope),"_delimiter_"===e.name&&(e.labelText=". . ."),this.itemsData[this.rowLayout[n].name]=Espo.Utils.cloneDeep(this.rowLayout[n])}l()})})},validate:function(){return!0},isLinkEnabled:function(e,t){return!e.getLinkParam(t,"disabled")&&!e.getLinkParam(t,"utility")&&!e.getLinkParam(t,"layoutRelationshipsDisabled")}})}),define("views/admin/layouts/mass-update",["exports","views/admin/layouts/rows"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataAttributeList=["name"];editable=!1;ignoreList=[];ignoreTypeList=["duration"];dataAttributesDefs={name:{readOnly:!0}};setup(){super.setup(),this.wait(!0),this.loadLayout(()=>{this.wait(!1)})}loadLayout(l){this.getModelFactory().create(this.scope,o=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{const t=[];for(const i in o.defs.fields)o.getFieldParam(i,"massUpdateDisabled")||o.getFieldParam(i,"readOnly")||!this.isFieldEnabled(o,i)||t.push(i);t.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[];for(const s in e)this.enabledFields.push({name:e[s],labelText:this.getLanguage().translate(e[s],"fields",this.scope)}),this.enabledFieldsList.push(e[s]);for(const a in t)_.contains(this.enabledFieldsList,t[a])||this.disabledFields.push({name:t[a],labelText:this.getLanguage().translate(t[a],"fields",this.scope)});this.rowLayout=this.enabledFields;for(const n in this.rowLayout)this.rowLayout[n].labelText=this.getLanguage().translate(this.rowLayout[n].name,"fields",this.scope),this.itemsData[this.rowLayout[n].name]=Espo.Utils.cloneDeep(this.rowLayout[n]);l()})})}fetch(){const i=[];return $("#layout ul.enabled > li").each((e,t)=>{i.push($(t).data("name"))}),i}validate(){return!0}isFieldEnabled(e,t){if(-1!==this.ignoreList.indexOf(t))return!1;if(-1!==this.ignoreTypeList.indexOf(e.getFieldParam(t,"type")))return!1;const i=e.getFieldParam(t,"layoutAvailabilityList");if(!i||i.includes(this.type)){const s=e.getFieldParam(t,"layoutIgnoreList")||[];return!s.includes(this.type)&&!(e.getFieldParam(t,"disabled")||e.getFieldParam(t,"utility")||e.getFieldParam(t,"layoutMassUpdateDisabled")||e.getFieldParam(t,"readOnly"))}}}e.default=s}),define("views/admin/layouts/list-small",["exports","views/admin/layouts/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{}e.default=s}),define("views/admin/layouts/kanban",["exports","views/admin/layouts/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataAttributeList=["name","link","align","view","isLarge","isMuted","hidden"];dataAttributesDefs={link:{type:"bool"},isLarge:{type:"bool"},isMuted:{type:"bool"},width:{type:"float"},align:{type:"enum",options:["left","right"]},view:{type:"varchar",readOnly:!0},name:{type:"varchar",readOnly:!0},hidden:{type:"bool"}};editable=!0;ignoreList=[];ignoreTypeList=[]}e.default=s}),define("views/admin/layouts/filters",["exports","views/admin/layouts/rows"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataAttributeList=["name"];editable=!1;ignoreList=[];setup(){super.setup(),this.wait(!0),this.loadLayout(()=>this.wait(!1))}loadLayout(l){this.getModelFactory().create(this.scope,o=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{const t=[];for(const i in o.defs.fields)this.checkFieldType(o.getFieldParam(i,"type"))&&this.isFieldEnabled(o,i)&&t.push(i);t.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[];for(const s of e)this.enabledFields.push({name:s,labelText:this.getLanguage().translate(s,"fields",this.scope)}),this.enabledFieldsList.push(s);for(const a of t)this.enabledFieldsList.includes(a)||this.disabledFields.push({name:a,labelText:this.getLanguage().translate(a,"fields",this.scope)});this.rowLayout=this.enabledFields;for(const n of this.rowLayout)n.labelText=this.getLanguage().translate(n.name,"fields",this.scope);l()})})}fetch(){const i=[];return $("#layout ul.enabled > li").each((e,t)=>{i.push($(t).data("name"))}),i}checkFieldType(e){return this.getFieldManager().checkFilter(e)}validate(){return!0}isFieldEnabled(e,t){return-1===this.ignoreList.indexOf(t)&&(!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&!e.getFieldParam(t,"layoutFiltersDisabled"))}}e.default=s}),define("views/admin/layouts/detail-small",["exports","views/admin/layouts/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{}e.default=s}),define("views/admin/layouts/detail-convert",["exports","views/admin/layouts/detail"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{}e.default=s}),define("views/admin/layouts/default-side-panel",["exports","views/admin/layouts/rows"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{dataAttributeList=["name","view","customLabel"];dataAttributesDefs={view:{type:"varchar",readOnly:!0},customLabel:{type:"varchar",readOnly:!0},name:{type:"varchar",readOnly:!0}};editable=!1;languageCategory="fields";setup(){super.setup(),this.wait(!0),this.loadLayout(()=>{this.wait(!1)})}validate(){return!0}loadLayout(i){this.getModelFactory().create(Espo.Utils.hyphenToUpperCamelCase(this.scope),t=>{this.getHelper().layoutManager.getOriginal(this.scope,this.type,this.setId,e=>{this.readDataFromLayout(t,e),i&&i()})})}readDataFromLayout(e,a){const s=[];for(const t in e.defs.fields)this.checkFieldType(e.getFieldParam(t,"type"))&&this.isFieldEnabled(e,t)&&s.push(t);s.sort((e,t)=>this.translate(e,"fields",this.scope).localeCompare(this.translate(t,"fields",this.scope))),~s.indexOf("assignedUser")&&s.unshift(":assignedUser"),this.enabledFieldsList=[],this.enabledFields=[],this.disabledFields=[];const n=[],o=[];for(let s=0;s<a.length;s++){let e=a[s],t=(e="object"!=typeof e?{name:e}:e).name,i=(0===t.indexOf(":")&&(t=t.substr(1)),this.getLanguage().translate(t,"fields",this.scope));t!==e.name&&(i+=" *"),~n.indexOf(i)&&o.push(i),n.push(i),this.enabledFields.push({name:e.name,labelText:i}),this.enabledFieldsList.push(e.name)}for(let i=0;i<s.length;i++)if(!_.contains(this.enabledFieldsList,s[i])){let e=this.getLanguage().translate(s[i],"fields",this.scope);~n.indexOf(e)&&o.push(e),n.push(e);var l=s[i];let t=l;0===t.indexOf(":")&&(t=t.substr(1)),e=this.getLanguage().translate(t,"fields",this.scope),t!==l&&(e+=" *");const d={name:l,labelText:e};l=this.getMetadata().get(["entityDefs",this.scope,"fields",l,"type"]);l&&this.getMetadata().get(["fields",l,"notSortable"])&&(d.notSortable=!0),this.disabledFields.push(d)}this.enabledFields.forEach(e=>{~o.indexOf(e.label)&&(e.labelText+=" ("+e.name+")")}),this.disabledFields.forEach(e=>{~o.indexOf(e.label)&&(e.labelText+=" ("+e.name+")")}),this.rowLayout=a;for(const i in this.rowLayout){let t=this.getLanguage().translate(this.rowLayout[i].name,"fields",this.scope);this.enabledFields.forEach(e=>{e.name===this.rowLayout[i].name&&(t=e.labelText)}),this.rowLayout[i].labelText=t,this.itemsData[this.rowLayout[i].name]=Espo.Utils.cloneDeep(this.rowLayout[i])}}checkFieldType(e){return!0}isFieldEnabled(e,t){if(~["modifiedAt","createdAt","modifiedBy","createdBy"].indexOf(t))return!1;const i=e.getFieldParam(t,"layoutAvailabilityList");if(i&&!i.includes(this.type))return!1;const s=e.getFieldParam(t,"layoutIgnoreList")||[];return!s.includes(this.type)&&(!e.getFieldParam(t,"disabled")&&!e.getFieldParam(t,"utility")&&(!e.getFieldParam(t,"layoutDefaultSidePanelDisabled")&&!e.getFieldParam(t,"layoutDetailDisabled")))}}e.default=s}),define("views/admin/layouts/bottom-panels-edit-small",["exports","views/admin/layouts/bottom-panels-edit"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{viewType="editSmall"}e.default=s}),define("views/admin/layouts/record/edit-attributes",["views/record/base"],function(e){return e.extend({template:"admin/layouts/record/edit-attributes",mode:"edit",data:function(){return{attributeDataList:this.getAttributeDataList()}},getAttributeDataList:function(){const s=[];return this.attributeList.forEach(e=>{var t=this.attributeDefs[e]||{},i=t.type,i=!["enum","bool","int","float","varchar"].includes(i)&&"widthComplex"!==e;s.push({name:e,viewKey:e+"Field",isWide:i,label:this.translate(t.label||e,"fields","LayoutManager")})}),s},setup:function(){e.prototype.setup.call(this),this.attributeList=this.options.attributeList||[],this.attributeDefs=this.options.attributeDefs||{},this.attributeList.forEach(e=>{var t=this.attributeDefs[e]||{},i=t.type||"base",i=t.view||this.getFieldManager().getViewName(i);this.createField(e,i,t)})}})}),define("views/admin/layouts/modals/panel-attributes",["views/modal","model"],function(e,s){return e.extend({templateContent:`
            <div class="panel panel-default no-side-margin">
                <div class="panel-body">
                    <div class="edit-container">{{{edit}}}</div>
                </div>
            </div>
        `,className:"dialog dialog-record",shortcutKeys:{"Control+Enter":function(e){this.actionSave(),e.preventDefault(),e.stopPropagation()}},setup:function(){this.buttonList=[{name:"save",text:this.translate("Apply"),style:"primary"},{name:"cancel",label:"Cancel"}];let e=new s;e.name="LayoutManager",e.set(this.options.attributes||{});var t=this.options.attributeList,i=this.options.attributeDefs;this.createView("edit","views/admin/layouts/record/edit-attributes",{selector:".edit-container",attributeList:t,attributeDefs:i,model:e,dynamicLogicDefs:this.options.dynamicLogicDefs})},actionSave:function(){let e=this.getView("edit");var t=e.fetch();if(e.model.set(t,{silent:!0}),!e.validate())return t=e.model.attributes,this.trigger("after:save",t),!0}})}),define("views/admin/layouts/modals/edit-attributes",["views/modal","model"],function(e,s){return e.extend({templateContent:`
            <div class="panel panel-default no-side-margin">
                <div class="panel-body">
                    <div class="edit-container">{{{edit}}}</div>
                </div>
            </div>
        `,className:"dialog dialog-record",shortcutKeys:{"Control+Enter":function(e){this.actionSave(),e.preventDefault(),e.stopPropagation()}},setup:function(){this.buttonList=[{name:"save",text:this.translate("Apply"),style:"primary"},{name:"cancel",text:this.translate("Cancel")}];const e=new s;e.name="LayoutManager",e.set(this.options.attributes||{}),this.headerText=null,this.options.languageCategory&&(this.headerText=this.translate(this.options.name,this.options.languageCategory,this.options.scope));let t=Espo.Utils.clone(this.options.attributeList||[]);const i=[];t.forEach(e=>{var t=this.options.attributeDefs[e]||{};t.readOnly||t.hidden||i.push(e)}),t=i,this.createView("edit","views/admin/layouts/record/edit-attributes",{selector:".edit-container",attributeList:t,attributeDefs:this.options.attributeDefs,dynamicLogicDefs:this.options.dynamicLogicDefs,model:e})},actionSave:function(){const e=this.getView("edit");var t=e.fetch();if(e.model.set(t,{silent:!0}),!e.validate())return t=e.model.attributes,this.trigger("after:save",t),!0}})}),define("views/admin/layouts/fields/width-complex",["exports","views/fields/base","views/fields/enum","model","views/fields/float"],function(e,t,i,s,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),s=n(s),a=n(a);class o extends t.default{editTemplateContent=`
        <div class="row">
            <div data-name="value" class="col-sm-6">{{{value}}}</div>
            <div data-name="unit" class="col-sm-6">{{{unit}}}</div>
        </div>

    `;getAttributeList(){return["width","widthPx"]}setup(){this.auxModel=new s.default,this.syncAuxModel(),this.listenTo(this.model,"change",()=>this.syncAuxModel());var e=new i.default({name:"unit",mode:"edit",model:this.auxModel,params:{options:["%","px"]}}),t=new a.default({name:"value",mode:"edit",model:this.auxModel});this.assignView("unit",e,'[data-name="unit"]'),this.assignView("value",t,'[data-name="value"]'),this.listenTo(this.auxModel,"change",(e,t)=>{t.ui&&this.model.set(this.fetch(),{ui:!0})})}fetch(){return"px"===this.auxModel.get("unit")?{width:null,widthPx:this.auxModel.get("value")}:{width:this.auxModel.get("value"),widthPx:null}}syncAuxModel(){var e=this.model.get("width"),t=this.model.get("widthPx"),i=e||!t?"%":"px";this.auxModel.set({unit:i,value:"px"==i?t:e})}}e.default=o}),define("views/admin/label-manager/index",["exports","view","ui/select"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="admin/label-manager/index";scopeList=null;scope=null;language=null;languageList=null;events={'click [data-action="selectScope"]':function(e){const t=$(e.currentTarget).data("name");this.getRouter().checkConfirmLeaveOut(()=>{this.selectScope(t)})},'change select[data-name="language"]':function(e){const t=$(e.currentTarget).val();this.getRouter().checkConfirmLeaveOut(()=>{this.selectLanguage(t)})}};data(){return{scopeList:this.scopeList,languageList:this.languageList,scope:this.scope,language:this.language}}setup(){this.languageList=this.getMetadata().get(["app","language","list"])||["en_US"],this.languageList.sort((e,t)=>this.getLanguage().translateOption(e,"language").localeCompare(this.getLanguage().translateOption(t,"language"))),this.wait(!0),Espo.Ajax.postRequest("LabelManager/action/getScopeList").then(e=>{this.scopeList=e,this.scopeList.sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural"))),this.scopeList=this.scopeList.filter(e=>{if(!("Global"===e||this.getMetadata().get(["scopes",e])&&this.getMetadata().get(["scopes",e,"disabled"])))return!0}),this.scopeList.unshift("Global"),this.wait(!1)}),this.scope=this.options.scope||"Global",this.language=this.options.language||this.getConfig().get("language"),this.once("after:render",()=>{this.selectScope(this.scope,!0)})}afterRender(){i.default.init(this.element.querySelector('select[data-name="language"]'))}selectLanguage(e){this.language=e,this.scope?this.getRouter().navigate("#Admin/labelManager/scope="+this.scope+"&language="+this.language,{trigger:!1}):this.getRouter().navigate("#Admin/labelManager/language="+this.language,{trigger:!1}),this.createRecordView()}selectScope(e,t){this.scope=e,t||this.getRouter().navigate("#Admin/labelManager/scope="+e+"&language="+this.language,{trigger:!1}),this.$el.find('[data-action="selectScope"]').removeClass("disabled").removeAttr("disabled"),this.$el.find('[data-name="'+e+'"][data-action="selectScope"]').addClass("disabled").attr("disabled","disabled"),this.createRecordView()}createRecordView(){Espo.Ui.notify(" ... "),this.createView("record","views/admin/label-manager/edit",{selector:".language-record",scope:this.scope,language:this.language},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Label Manager","labels","Admin"))}}e.default=a}),define("views/admin/label-manager/edit",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/label-manager/edit";scopeData;events={'click [data-action="toggleCategory"]':function(e){e=$(e.currentTarget).data("name");this.toggleCategory(e)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)},'click [data-action="showCategory"]':function(e){e=$(e.currentTarget).data("name");this.showCategory(e)},'click [data-action="hideCategory"]':function(e){e=$(e.currentTarget).data("name");this.hideCategory(e)},'click [data-action="cancel"]':function(){this.actionCancel()},'click [data-action="save"]':function(){this.actionSave()},"change input.label-value":function(e){var t=$(e.currentTarget).data("name"),e=$(e.currentTarget).val();this.setLabelValue(t,e)}};data(){return{categoryList:this.getCategoryList(),scope:this.scope}}setup(){this.scope=this.options.scope,this.language=this.options.language,this.categoryShownMap={},this.dirtyLabelList=[],this.wait(Espo.Ajax.postRequest("LabelManager/action/getScopeData",{scope:this.scope,language:this.language}).then(e=>{this.scopeData=e,this.scopeDataInitial=Espo.Utils.cloneDeep(this.scopeData),Object.keys(this.scopeData).forEach(e=>{this.createView(e,"views/admin/label-manager/category",{selector:`.panel-body[data-name="${e}"]`,categoryData:this.getCategoryData(e),scope:this.scope,language:this.language})})}))}getCategoryList(){return Object.keys(this.scopeData).sort((e,t)=>e.localeCompare(t))}setLabelValue(e,t){var i=e.split("[.]")[0];t=(t=t.replace(/\\\\n/i,"\n")).trim(),this.scopeData[i][e]=t,this.dirtyLabelList.push(e),this.setConfirmLeaveOut(!0),this.getCategoryView(i)&&(this.getCategoryView(i).categoryData[e]=t)}getCategoryView(e){return this.getView(e)}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}afterRender(){this.$save=this.$el.find('button[data-action="save"]'),this.$cancel=this.$el.find('button[data-action="cancel"]'),this.$panels=this.$el.find(".category-panel"),this.$noData=this.$el.find(".no-data")}actionSave(){this.$save.addClass("disabled").attr("disabled"),this.$cancel.addClass("disabled").attr("disabled");const i={};this.dirtyLabelList.forEach(e=>{var t=e.split("[.]")[0];i[e]=this.scopeData[t][e]}),Espo.Ui.notify(this.translate("saving","messages")),Espo.Ajax.postRequest("LabelManager/action/saveLabels",{scope:this.scope,language:this.language,labels:i}).then(e=>{this.scopeDataInitial=Espo.Utils.cloneDeep(this.scopeData),this.dirtyLabelList=[],this.setConfirmLeaveOut(!1),this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled");for(const i in e){var t=i.split("[.]").splice(1).join("[.]");this.$el.find(`input.label-value[data-name="${t}"]`).val(e[i])}Espo.Ui.success(this.translate("Saved")),this.getHelper().broadcastChannel.postMessage("update:language"),this.getLanguage().loadSkipCache()}).catch(()=>{this.$save.removeClass("disabled").removeAttr("disabled"),this.$cancel.removeClass("disabled").removeAttr("disabled")})}actionCancel(){this.scopeData=Espo.Utils.cloneDeep(this.scopeDataInitial),this.dirtyLabelList=[],this.setConfirmLeaveOut(!1),this.getCategoryList().forEach(e=>{this.getCategoryView(e)&&(this.getCategoryView(e).categoryData=this.scopeData[e],this.getCategoryView(e).reRender())})}toggleCategory(e){this.categoryShownMap[e]?this.hideCategory(e):this.showCategory(e)}showCategory(e){this.$el.find(`a[data-action="showCategory"][data-name="${e}"]`).addClass("hidden"),this.$el.find(`a[data-action="hideCategory"][data-name="${e}"]`).removeClass("hidden"),this.$el.find(`.panel-body[data-name="${e}"]`).removeClass("hidden"),this.categoryShownMap[e]=!0}hideCategory(e){this.$el.find(`.panel-body[data-name="${e}"]`).addClass("hidden"),this.$el.find(`a[data-action="showCategory"][data-name="${e}"]`).removeClass("hidden"),this.$el.find(`a[data-action="hideCategory"][data-name="${e}"]`).addClass("hidden"),this.categoryShownMap[e]=!1}getCategoryData(e){return this.scopeData[e]||{}}processQuickSearch(e){if(!(e=e.trim()))return this.$panels.removeClass("hidden"),this.$panels.find(".row").removeClass("hidden"),void this.$noData.addClass("hidden");const n=[],o={},l=e.toLowerCase();let d=!1;if(Object.keys(this.scopeData).forEach(a=>{o[a]=[],Object.keys(this.scopeData[a]).forEach(e=>{let t=!1;const i=this.scopeData[a][e];if(!(t=0!==i.toLowerCase().indexOf(l)&&0!==e.toLowerCase().indexOf(l)?t:!0))for(const s of i.split(" ").concat(i.split(" ")))if(0===s.toLowerCase().indexOf(l)){t=!0;break}t&&(d=!0,o[a].push(e),n.includes(a)||n.push(a))})}),!d)return this.$panels.addClass("hidden"),this.$panels.find(".row").addClass("hidden"),void this.$noData.removeClass("hidden");this.$noData.addClass("hidden"),Object.keys(this.scopeData).forEach(i=>{const s=this.$panels.filter(`[data-name="${i}"]`);Object.keys(this.scopeData[i]).forEach(e=>{const t=s.find(`.row[data-name="${e}"]`);o[i].includes(e)?t.removeClass("hidden"):t.addClass("hidden")}),n.includes(i)?s.removeClass("hidden"):s.addClass("hidden")})}}e.default=s}),define("views/admin/label-manager/category",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/label-manager/category";events={};data(){return{categoryDataList:this.getCategoryDataList()}}setup(){this.scope=this.options.scope,this.language=this.options.language,this.categoryData=this.options.categoryData}getCategoryDataList(){const e=Object.keys(this.categoryData),a=(e.sort((e,t)=>e.localeCompare(t)),[]);return e.forEach(e=>{let t=this.categoryData[e];const i={name:e,value:t=(t=null===t?"":t).replace?t.replace(/\n/i,"\\n"):t},s=e.split("[.]");i.label=s.slice(1).join(" . "),a.push(i)}),a}}e.default=s}),define("views/admin/job/list",["views/list"],function(e){return e.extend({createButton:!1,setup:function(){e.prototype.setup.call(this),this.getHelper().getAppParam("isRestrictedMode")&&!this.getUser().isSuperAdmin()||this.addMenuItem("buttons",{link:"#Admin/jobsSettings",text:this.translate("Settings","labels","Admin")})},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration")),$("<span>").text(this.getLanguage().translate("Jobs","labels","Admin"))])},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Jobs","labels","Admin"))}})}),define("views/admin/job/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove"],forceSettings:!0})}),define("views/admin/job/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideView:null,isWide:!0})}),define("views/admin/job/modals/detail",["views/modals/detail"],function(e){return e.extend({editDisabled:!0,fullFormDisabled:!0})}),define("views/admin/job/fields/name",["views/fields/varchar"],function(e){return e.extend({getValueForDisplay:function(){if("list"===this.mode||"detail"===this.mode||"listLink"===this.mode)return this.model.get("name")?this.model.get("name"):this.model.get("serviceName")+": "+this.model.get("methodName")}})}),define("views/admin/integrations/oauth2",["views/admin/integrations/edit"],function(t){return t.extend({template:"admin/integrations/oauth2",data:function(){var e=this.redirectUri||this.getConfig().get("siteUrl")+"?entryPoint=oauthCallback";return _.extend({redirectUri:e},t.prototype.data.call(this))}})}),define("views/admin/integrations/index",["view"],function(e){return e.extend({template:"admin/integrations/index",integrationList:null,integration:null,data:function(){return{integrationList:this.integrationList,integration:this.integration}},events:{"click #integrations-menu a.integration-link":function(e){e=$(e.currentTarget).data("name");this.openIntegration(e)}},setup:function(){this.integrationList=Object.keys(this.getMetadata().get("integrations")||{}).sort((e,t)=>this.translate(e,"titles","Integration").localeCompare(this.translate(t,"titles","Integration"))),this.integration=this.options.integration||null,this.on("after:render",()=>{this.renderHeader(),this.integration?this.openIntegration(this.integration):this.renderDefaultPage()})},openIntegration:function(e){this.integration=e,this.getRouter().navigate("#Admin/integrations/name="+e,{trigger:!1});var t=this.getMetadata().get("integrations."+e+".view")||"views/admin/integrations/"+Espo.Utils.camelCaseToHyphen(this.getMetadata().get("integrations."+e+".authMethod"));Espo.Ui.notify(" ... "),this.createView("content",t,{fullSelector:"#integration-content",integration:e},e=>{this.renderHeader(),e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})},renderDefaultPage:function(){$("#integration-header").html("").hide();let e;e=this.integrationList.length?this.translate("selectIntegration","messages","Integration"):'<p class="lead">'+this.translate("noIntegrations","messages","Integration")+"</p>",$("#integration-content").html(e)},renderHeader:function(){this.integration?$("#integration-header").show().html(this.translate(this.integration,"titles","Integration")):$("#integration-header").html("")},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Integrations","labels","Admin"))}})}),define("views/admin/integrations/google-maps",["views/admin/integrations/edit"],function(e){return e.extend({})}),define("views/admin/formula-sandbox/index",["view","model"],function(e,a){return e.extend({template:"admin/formula-sandbox/index",targetEntityType:null,storageKey:"formulaSandbox",data:function(){return{}},setup:function(){var e,t=[""].concat(this.getMetadata().getScopeEntityList().filter(e=>this.getMetadata().get(["scopes",e,"object"])));let i={script:null,targetId:null,targetType:null,output:null},s=(this.getSessionStorage().has(this.storageKey)&&(e=this.getSessionStorage().get(this.storageKey),i.script=e.script||null,i.targetId=e.targetId||null,i.targetName=e.targetName||null,i.targetType=e.targetType||null),this.model=new a);s.name="Formula",s.setDefs({fields:{targetType:{type:"enum",options:t,translation:"Global.scopeNames",view:"views/fields/entity-type"},target:{type:"link",entity:i.targetType},script:{type:"formula",view:"views/fields/formula"},output:{type:"text",readOnly:!0,displayRawText:!0,tooltip:!0},errorMessage:{type:"text",readOnly:!0,displayRawText:!0}}}),s.set(i),this.createRecordView(),this.listenTo(this.model,"change:targetType",(e,t,i)=>{i.ui&&setTimeout(()=>{this.targetEntityType=this.model.get("targetType"),this.model.set({targetId:null,targetName:null},{silent:!0});var e=Espo.Utils.cloneDeep(this.model.attributes);this.clearView("record"),this.model.set(e,{silent:!0}),this.model.defs.fields.target.entity=this.targetEntityType,this.createRecordView().then(e=>e.render())},10)}),this.listenTo(this.model,"run",()=>this.run()),this.listenTo(this.model,"change",(e,t)=>{t.ui&&(t={script:this.model.get("script"),targetType:this.model.get("targetType"),targetId:this.model.get("targetId"),targetName:this.model.get("targetName")},this.getSessionStorage().set(this.storageKey,t))})},createRecordView:function(){return this.createView("record","views/admin/formula-sandbox/record/edit",{selector:".record",model:this.model,targetEntityType:this.targetEntityType,confirmLeaveDisabled:!0,shortcutKeysEnabled:!0})},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Formula Sandbox","labels","Admin"))},run:function(){var e=this.model.get("script");if(this.model.set({output:null,errorMessage:null}),""===e||null===e)return this.model.set("output",null),void Espo.Ui.warning(this.translate("emptyScript","messages","Formula"));Espo.Ajax.postRequest("Formula/action/run",{expression:e,targetId:this.model.get("targetId"),targetType:this.model.get("targetType")}).then(t=>{this.model.set("output",t.output||null);let e=null;if(t.isSuccess||(e=t.message||null),this.model.set("errorMessage",e),t.isSuccess)Espo.Ui.success(this.translate("runSuccess","messages","Formula"));else{if(t.isSyntaxError){let e=this.translate("checkSyntaxError","messages","Formula");return t.message&&(e+=" "+t.message),void Espo.Ui.error(e)}let e=this.translate("runError","messages","Formula");t.message&&(e+=" "+t.message),Espo.Ui.error(e)}})}})}),define("views/admin/formula-sandbox/record/edit",["views/record/edit"],function(e){return e.extend({scriptAreaHeight:400,bottomView:null,sideView:null,buttonList:[{name:"run",label:"Run",style:"danger",title:"Ctrl+Enter"}],dropdownItemList:[],isWide:!0,accessControlDisabled:!0,saveAndContinueEditingAction:!1,saveAndNewAction:!1,shortcutKeyCtrlEnterAction:"run",setup:function(){this.scope="Formula";this.detailLayout=[{rows:[[!1,{name:"targetType",labelText:this.translate("targetType","fields","Formula")},{name:"target",labelText:this.translate("target","fields","Formula")}]]},{rows:[[{name:"script",noLabel:!0,options:{targetEntityType:this.model.get("targetType"),height:this.scriptAreaHeight,additionalFunctionDataList:[{name:"output\\print",insertText:"output\\print(VALUE)"},{name:"output\\printLine",insertText:"output\\printLine(VALUE)"}]}}]]},{name:"output",rows:[[{name:"errorMessage",labelText:this.translate("error","fields","Formula")}],[{name:"output",labelText:this.translate("output","fields","Formula")}]]}],e.prototype.setup.call(this),this.model.get("targetType")?this.showField("target"):this.hideField("target"),this.controlTargetTypeField(),this.listenTo(this.model,"change:targetId",()=>this.controlTargetTypeField()),this.controlOutputField(),this.listenTo(this.model,"change",()=>this.controlOutputField())},controlTargetTypeField:function(){this.model.get("targetId")?this.setFieldReadOnly("targetType"):this.setFieldNotReadOnly("targetType")},controlOutputField:function(){this.model.get("errorMessage")?this.showField("errorMessage"):this.hideField("errorMessage")},actionRun:function(){this.model.trigger("run")}})}),define("views/admin/formula/modals/add-function",["views/modal","model"],function(e,t){return e.extend({template:"admin/formula/modals/add-function",fitHeight:!0,backdrop:!0,events:{'click [data-action="add"]':function(e){this.trigger("add",$(e.currentTarget).data("value"))}},data:function(){var e=this.translate("formulaFunctions","messages","Admin").replace("{documentationUrl}",this.documentationUrl),e=this.getHelper().transformMarkdownText(e,{linksInNewTab:!0}).toString();return{functionDataList:this.functionDataList,text:e}},setup:function(){this.header=this.translate("Function"),this.documentationUrl="https://docs.espocrm.com/administration/formula/",this.functionDataList=this.options.functionDataList||this.getMetadata().get("app.formula.functionList")||[]}})}),define("views/admin/formula/modals/add-attribute",["views/modal","model"],function(e,i){return e.extend({templateContent:'<div class="attribute" data-name="attribute">{{{attribute}}}</div>',backdrop:!0,setup:function(){this.header=this.translate("Attribute"),this.scope=this.options.scope;var t=new i;this.createView("attribute","views/admin/formula/fields/attribute",{selector:'[data-name="attribute"]',model:t,mode:"edit",scope:this.scope,defs:{name:"attribute",params:{}},attributeList:this.options.attributeList},e=>{this.listenTo(e,"change",()=>{var e=t.get("attribute")||[];e.length&&this.trigger("add",e[0])})})}})}),define("views/admin/formula/fields/attribute",["views/fields/multi-enum","ui/multi-select"],function(e,t){return e.extend({setupOptions:function(){if(e.prototype.setupOptions.call(this),this.options.attributeList)this.params.options=this.options.attributeList;else{const s=this.getFieldManager().getEntityTypeAttributeList(this.options.scope).concat(["id"]).sort(),a=this.getMetadata().get(["entityDefs",this.options.scope,"links"])||{},n=[];Object.keys(a).forEach(e=>{var t=a[e].type,i=a[e].entity;t&&i&&(a[e].disabled||a[e].utility||~["belongsToParent","hasOne","belongsTo"].indexOf(t)&&n.push(e))}),n.sort(),n.forEach(t=>{var e=a[t].entity;let i=this.getFieldManager().getEntityTypeAttributeList(e).sort();i.forEach(e=>{s.push(t+"."+e)})}),this.params.options=s}},afterRender:function(){e.prototype.afterRender.call(this),this.$element&&t.focus(this.$element)}})}),define("views/admin/field-manager/list",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/field-manager/list";data(){return{scope:this.scope,fieldDefsArray:this.fieldDefsArray,typeList:this.typeList,hasAddField:this.hasAddField}}events={'click [data-action="removeField"]':function(e){e=$(e.currentTarget).data("name");this.removeField(e)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};setup(){this.scope=this.options.scope,this.isCustomizable=!!this.getMetadata().get(`scopes.${this.scope}.customizable`)&&!1!==this.getMetadata().get(`scopes.${this.scope}.entityManager.fields`),this.hasAddField=!0;var e=this.getMetadata().get(["scopes",this.scope,"entityManager"])||{};"addField"in e&&(this.hasAddField=e.addField),this.wait(this.buildFieldDefs())}afterRender(){this.$noData=this.$el.find(".no-data"),this.$el.find('input[data-name="quick-search"]').focus()}buildFieldDefs(){return this.getModelFactory().create(this.scope).then(e=>{this.fields=e.defs.fields,this.fieldList=Object.keys(this.fields).sort(),this.fieldDefsArray=[],this.fieldList.forEach(e=>{var t=this.fields[e];this.fieldDefsArray.push({name:e,isCustom:t.isCustom||!1,type:t.type,label:this.translate(e,"fields",this.scope),isEditable:!t.customizationDisabled&&this.isCustomizable})})})}removeField(e){var t=this.translate("confirmRemove","messages","FieldManager").replace("{field}",e);this.confirm(t,()=>{Espo.Ui.notify(" ... "),Espo.Ajax.deleteRequest("Admin/fieldManager/"+this.scope+"/"+e).then(()=>{Espo.Ui.success(this.translate("Removed")),this.$el.find(`tr[data-name="${e}"]`).remove(),this.getMetadata().loadSkipCache().then(()=>{this.buildFieldDefs().then(()=>(this.broadcastUpdate(),this.reRender())).then(()=>Espo.Ui.success(this.translate("Removed")))})})})}broadcastUpdate(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language")}processQuickSearch(e){e=e.trim();const t=this.$noData;if(t.addClass("hidden"),e){const s=[],a=e.toLowerCase();if(this.fieldDefsArray.forEach(e=>{let t=!1;if(!(t=0!==e.label.toLowerCase().indexOf(a)&&0!==e.name.toLowerCase().indexOf(a)?t:!0)){const i=e.label.split(" ").concat(e.label.split(" "));i.forEach(e=>{0===e.toLowerCase().indexOf(a)&&(t=!0)})}t&&s.push(e.name)}),0===s.length)return this.$el.find("table tr.field-row").addClass("hidden"),void t.removeClass("hidden");this.fieldDefsArray.map(e=>e.name).forEach(e=>{const t=this.$el.find(`table tr.field-row[data-name="${e}"]`);~s.indexOf(e)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("table tr.field-row").removeClass("hidden")}}e.default=s}),define("views/admin/field-manager/index",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/field-manager/index";scopeList=null;scope=null;type=null;data(){return{scopeList:this.scopeList,scope:this.scope}}events={"click #scopes-menu a.scope-link":function(e){e=$(e.currentTarget).data("scope");this.openScope(e)},"click #fields-content a.field-link":function(e){e.preventDefault();var t=$(e.currentTarget).data("scope"),e=$(e.currentTarget).data("field");this.openField(t,e)},'click [data-action="addField"]':function(){this.createView("dialog","views/admin/field-manager/modals/add-field",{},e=>{e.render(),this.listenToOnce(e,"add-field",e=>{this.createField(this.scope,e)})})}};setup(){this.scopeList=[];const e=Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>this.translate(e,"scopeNamesPlural").localeCompare(this.translate(t,"scopeNamesPlural")));e.forEach(e=>{this.getMetadata().get("scopes."+e+".entity")&&this.getMetadata().get("scopes."+e+".customizable")&&this.scopeList.push(e)}),this.scope=this.options.scope||null,this.field=this.options.field||null,this.on("after:render",()=>{this.scope?this.field?this.openField(this.scope,this.field):this.openScope(this.scope):this.renderDefaultPage()}),this.createView("header","views/admin/field-manager/header",{selector:"> .page-header",scope:this.scope,field:this.field})}openScope(e){this.scope=e,this.field=null,this.getHeaderView().setField(null),this.getRouter().navigate("#Admin/fieldManager/scope="+e,{trigger:!1}),Espo.Ui.notify(" ... "),this.createView("content","views/admin/field-manager/list",{fullSelector:"#fields-content",scope:e},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0)})}getHeaderView(){return this.getView("header")}openField(e,t){this.scope=e,this.field=t,this.getHeaderView().setField(t),this.getRouter().navigate("#Admin/fieldManager/scope="+e+"&field="+t,{trigger:!1}),Espo.Ui.notify(" ... "),this.createView("content","views/admin/field-manager/edit",{fullSelector:"#fields-content",scope:e,field:t},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0),this.listenTo(e,"after:save",()=>{Espo.Ui.success(this.translate("Saved"))})})}createField(e,t){this.scope=e,this.type=t,this.getRouter().navigate("#Admin/fieldManager/scope="+e+"&type="+t+"&create=true",{trigger:!1}),Espo.Ui.notify(" ... "),this.createView("content","views/admin/field-manager/edit",{fullSelector:"#fields-content",scope:e,type:t},e=>{e.render(),Espo.Ui.notify(!1),$(window).scrollTop(0),e.once("after:save",()=>{this.openScope(this.scope),Espo.Ui.success(this.translate("Created"))})})}renderDefaultPage(){$("#fields-content").html(this.translate("selectEntityType","messages","Admin"))}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Field Manager","labels","Admin"))}}e.default=s}),define("views/admin/field-manager/header",["exports","view"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{template="admin/field-manager/header";data(){return{scope:this.scope,field:this.field}}setup(){this.scope=this.options.scope,this.field=this.options.field}setField(e){this.field=e,this.isRendered()&&this.reRender()}}e.default=s}),define("views/admin/field-manager/edit",["exports","view","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="admin/field-manager/edit";paramWithTooltipList=["audited","required","default","min","max","maxLength","after","before","readOnly","readOnlyAfterCreate"];globalRestriction=null;hasAnyGlobalRestriction=!1;globalRestrictionTypeList=["forbidden","internal","onlyAdmin","readOnly","nonAdminReadOnly"];model;paramList;data(){return{scope:this.scope,field:this.field,defs:this.defs,paramList:this.paramList,type:this.type,fieldList:this.fieldList,isCustom:this.defs.isCustom,isNew:this.isNew,hasDynamicLogicPanel:this.hasDynamicLogicPanel,hasResetToDefault:!this.defs.isCustom&&!this.entityTypeIsCustom&&!this.isNew}}events={'click button[data-action="close"]':function(){this.actionClose()},'click button[data-action="save"]':function(){this.save()},'click button[data-action="resetToDefault"]':function(){this.resetToDefault()},"keydown.form":function(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Control+KeyS"!==t&&"Control+Enter"!==t||(this.save(),e.preventDefault(),e.stopPropagation())}};setupFieldData(a){var e;this.defs={},this.fieldList=[],this.model=new i.default,this.model.name="Admin",this.model.urlRoot="Admin/fieldManager/"+this.scope,this.model.defs={fields:{name:{required:!0,maxLength:50},label:{required:!0},tooltipText:{}}},this.entityTypeIsCustom=!!this.getMetadata().get(["scopes",this.scope,"isCustom"]),this.globalRestriction={},this.isNew?(this.model.scope=this.scope,this.model.set("type",this.type)):(this.model.id=this.field,this.model.scope=this.scope,this.model.set("name",this.field),this.model.set("label",this.getLanguage().translate(this.field,"fields",this.scope)),this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"tooltip"])&&this.model.set("tooltipText",this.getLanguage().translate(this.field,"tooltips",this.scope)),this.globalRestriction=this.getMetadata().get(["entityAcl",this.scope,"fields",this.field])||{},(e=this.globalRestrictionTypeList.filter(e=>this.globalRestriction[e])).length&&(this.model.set("globalRestrictions",e),this.hasAnyGlobalRestriction=!0)),this.listenTo(this.model,"change:readOnly",()=>{this.readOnlyControl()});let n=!1;this.getModelFactory().create(this.scope,e=>{this.isNew||(this.type=e.getFieldType(this.field)),this.getMetadata().get(["scopes",this.scope,"hasPersonalData"])&&this.getMetadata().get(["fields",this.type,"personalData"])&&(this.hasPersonalData=!0),this.hasInlineEditDisabled=!["foreign","autoincrement"].includes(this.type)&&!this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"customizationInlineEditDisabledDisabled"]),this.hasTooltipText=!this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"customizationTooltipTextDisabled"]),new Promise(t=>{this.isNew?t():Espo.Ajax.getRequest("Admin/fieldManager/"+this.scope+"/"+this.field).then(e=>{this.defs=e,t()})}).then(()=>{const e=[],t=(this.paramList=[],Espo.Utils.clone(this.getFieldManager().getParamList(this.type)||[]));if(!this.isNew){const i=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"fieldManagerAdditionalParamList"])||[];i.forEach(e=>{t.push(e)})}const s=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"fieldManagerParamList"]);t.forEach(e=>{var t,i=e.name;s&&-1===s.indexOf(i)||"readOnly"===i&&this.globalRestriction&&this.globalRestriction.readOnly||("required"===i&&(n=!0),"createButton"===i&&["assignedUser","assignedUsers","teams"].includes(this.field)||"autocompleteOnEmpty"===i&&["assignedUser"].includes(this.field)||(t="customization"+Espo.Utils.upperCaseFirst(i)+"Disabled",this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,t])||(t="customization"+Espo.Utils.upperCaseFirst(i)+"View",(i=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,t]))&&(e.view=i),this.paramList.push(e))))}),this.hasPersonalData&&this.paramList.push({name:"isPersonalData",type:"bool"}),this.hasInlineEditDisabled&&!this.globalRestriction.readOnly&&this.paramList.push({name:"inlineEditDisabled",type:"bool"}),this.hasTooltipText&&this.paramList.push({name:"tooltipText",type:"text",rowsMin:1,trim:!0}),s&&(this.paramList=this.paramList.filter(e=>-1!==s.indexOf(e.name))),this.paramList=this.paramList.filter(e=>!(this.globalRestriction.readOnly&&"required"===e.name)),(this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"customizationDisabled"])||this.globalRestriction.forbidden)&&(this.paramList=[]),this.hasAnyGlobalRestriction&&this.paramList.push({name:"globalRestrictions",type:"array",readOnly:!0,displayAsList:!0,translation:"FieldManager.options.globalRestrictions",options:this.globalRestrictionTypeList}),this.paramList.forEach(e=>{this.model.defs.fields[e.name]=e}),this.model.set(this.defs),this.isNew&&this.model.populateDefaults(),e.push(this.createFieldView("varchar","name",!this.isNew,{trim:!0})),e.push(this.createFieldView("varchar","label",null,{trim:!0})),this.hasDynamicLogicPanel=!1,e.push(this.setupDynamicLogicFields(n)),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.paramList.forEach(t=>{if(!t.hidden){const i={};if(t.tooltip||~this.paramWithTooltipList.indexOf(t.name)){i.tooltip=!0;let e=t.name;"string"==typeof t.tooltip&&(e=t.tooltip),i.tooltipText=this.translate(e,"tooltips","FieldManager")}t.readOnlyNotNew&&!this.isNew&&(i.readOnly=!0),e.push(this.createFieldView(t.type,t.name,null,t,i))}}),Promise.all(e).then(()=>a())})}),this.listenTo(this.model,"change",(e,t)=>{t.ui&&this.setIsChanged()})}setup(){if(this.scope=this.options.scope,this.field=this.options.field,this.type=this.options.type,this.isNew=!this.field,!this.getMetadata().get(["scopes",this.scope,"customizable"])||!1===this.getMetadata().get(`scopes.${this.scope}.entityManager.fields`)||this.field&&this.getMetadata().get(`entityDefs.${this.scope}.fields.${this.field}.customizationDisabled`))throw Espo.Ui.notify(!1),new Espo.Exceptions.NotFound("Entity type is not customizable.");this.wait(!0),this.setupFieldData(()=>{this.wait(!1)})}setupDynamicLogicFields(e){var t=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field])||{};if(t.disabled||t.dynamicLogicDisabled||t.layoutDetailDisabled||t.utility)return Promise.resolve();const i=[];t.dynamicLogicVisibleDisabled||(s=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"visible"]),this.model.set("dynamicLogicVisible",s),i.push(this.createFieldView(null,"dynamicLogicVisible",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0);var s=this.getMetadata().get(["fields",this.type,"readOnly"]),e=(t.dynamicLogicRequiredDisabled||s||!e||(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"required"]),this.model.set("dynamicLogicRequired",e),i.push(this.createFieldView(null,"dynamicLogicRequired",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0),t.dynamicLogicReadOnlyDisabled||s||(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"readOnly"]),this.model.set("dynamicLogicReadOnly",e),i.push(this.createFieldView(null,"dynamicLogicReadOnly",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0),this.getMetadata().get(["fields",this.type,"dynamicLogicOptions"]));return e&&!t.dynamicLogicOptionsDisabled&&(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","options",this.field]),this.model.set("dynamicLogicOptions",e),i.push(this.createFieldView(null,"dynamicLogicOptions",null,{view:"views/admin/field-manager/fields/dynamic-logic-options",scope:this.scope})),this.hasDynamicLogicPanel=!0),t.dynamicLogicInvalidDisabled||s||(e=this.getMetadata().get(["clientDefs",this.scope,"dynamicLogic","fields",this.field,"invalid"]),this.model.set("dynamicLogicInvalid",e),i.push(this.createFieldView(null,"dynamicLogicInvalid",null,{view:"views/admin/field-manager/fields/dynamic-logic-conditions",scope:this.scope})),this.hasDynamicLogicPanel=!0),Promise.all(i)}afterRender(){this.getView("name").on("change",()=>{let e=this.model.get("name"),t=e;t.length&&(t=t.charAt(0).toUpperCase()+t.slice(1)),this.model.set("label",t),e&&(e=e.replace(/-/g,"").replace(/_/g,"").replace(/[^\w\s]/gi,"").replace(/ (.)/g,(e,t)=>t.toUpperCase()).replace(" ","")).length&&(e=e.charAt(0).toLowerCase()+e.slice(1)),this.model.set("name",e)})}readOnlyControl(){this.model.get("readOnly")?(this.hideField("dynamicLogicReadOnly"),this.hideField("dynamicLogicRequired"),this.hideField("dynamicLogicOptions"),this.hideField("dynamicLogicInvalid")):(this.showField("dynamicLogicReadOnly"),this.showField("dynamicLogicRequired"),this.showField("dynamicLogicOptions"),this.showField("dynamicLogicInvalid"))}hideField(t){var e=()=>{const e=this.getView(t);e&&(this.$el.find('.cell[data-name="'+t+'"]').addClass("hidden"),e.setDisabled())};this.isRendered()?e():this.once("after:render",e)}showField(t){var e=()=>{const e=this.getView(t);e&&(this.$el.find('.cell[data-name="'+t+'"]').removeClass("hidden"),e.setNotDisabled())};this.isRendered()?e():this.once("after:render",e)}createFieldView(e,t,i,s,a,n){e=(s||{}).view||this.getFieldManager().getViewName(e),s={model:this.model,selector:'.field[data-name="'+t+'"]',defs:{name:t,params:s},mode:i?"detail":"edit",readOnly:i,scope:this.scope,field:this.field},_.extend(s,a||{}),i=this.createView(t,e,s,n);return this.fieldList.push(t),i}disableButtons(){this.$el.find('[data-action="save"]').attr("disabled","disabled").addClass("disabled"),this.$el.find('[data-action="resetToDefault"]').attr("disabled","disabled").addClass("disabled")}enableButtons(){this.$el.find('[data-action="save"]').removeAttr("disabled").removeClass("disabled"),this.$el.find('[data-action="resetToDefault"]').removeAttr("disabled").removeClass("disabled")}save(){this.disableButtons(),this.fieldList.forEach(e=>{const t=this.getView(e);t.readOnly||t.fetchToModel()});let i=!1;if(this.fieldList.forEach(e=>{const t=this.getView(e);i=t.validate()||i}),i)return Espo.Ui.error(this.translate("Not valid")),void this.enableButtons();this.model.get("tooltipText")&&""!==this.model.get("tooltipText")?this.model.set("tooltip",!0):this.model.set("tooltip",!1);const e=()=>{Espo.Ui.notify(!1),this.setIsNotChanged(),this.enableButtons(),Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>this.trigger("after:save")),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.broadcastUpdate()};if(Espo.Ui.notify(" ... "),this.isNew)this.model.save().then(()=>e()).catch(()=>this.enableButtons());else{const t=this.model.getClonedAttributes();this.model.fetchedAttributes.label===t.label&&delete t.label,this.model.fetchedAttributes.tooltipText!==t.tooltipText&&(this.model.fetchedAttributes.tooltipText||t.tooltipText)||delete t.tooltipText,"translatedOptions"in t&&_.isEqual(this.model.fetchedAttributes.translatedOptions,t.translatedOptions)&&delete t.translatedOptions,this.model.save(t,{patch:!0}).then(()=>e()).catch(()=>this.enableButtons())}}resetToDefault(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest("FieldManager/action/resetToDefault",{scope:this.scope,name:this.field}).then(()=>{Promise.all([this.getMetadata().loadSkipCache(),this.getLanguage().loadSkipCache()]).then(()=>{this.setIsNotChanged(),this.setupFieldData(()=>{Espo.Ui.success(this.translate("Done")),this.reRender(),this.broadcastUpdate()})})})})}broadcastUpdate(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language"),this.getHelper().broadcastChannel.postMessage("update:settings")}actionClose(){this.setIsNotChanged(),this.getRouter().navigate("#Admin/fieldManager/scope="+this.scope,{trigger:!0})}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}setIsChanged(){this.isChanged=!0,this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.setConfirmLeaveOut(!1)}}e.default=a}),define("views/admin/field-manager/modals/add-field",["views/modal"],function(e){return e.extend({backdrop:!0,template:"admin/field-manager/modals/add-field",events:{'click a[data-action="addField"]':function(e){e=$(e.currentTarget).data("type");this.addField(e)},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}},data:function(){return{typeList:this.typeList}},setup:function(){this.headerText=this.translate("Add Field","labels","Admin"),this.typeList=[];let t=this.getMetadata().get("fields");Object.keys(this.getMetadata().get("fields")).forEach(e=>{e in t&&(t[e].notCreatable||this.typeList.push(e))}),this.typeDataList=this.typeList.map(e=>({type:e,label:this.translate(e,"fieldTypes","Admin")})),this.typeList.sort((e,t)=>this.translate(e,"fieldTypes","Admin").localeCompare(this.translate(t,"fieldTypes","Admin")))},addField:function(e){this.trigger("add-field",e),this.remove()},afterRender:function(){this.$noData=this.$el.find(".no-data"),this.typeList.forEach(e=>{var t=this.translate(e,"fieldInfo","FieldManager");let i=this.$el.find('a.info[data-name="'+e+'"]');t!==e?(t=this.getHelper().transformMarkdownText(t,{linksInNewTab:!0}).toString(),Espo.Ui.popover(i,{content:t,placement:"left"},this)):i.addClass("hidden")}),setTimeout(()=>this.$el.find('input[data-name="quick-search"]').focus(),50)},processQuickSearch:function(e){e=e.trim();let s=this.$noData;if(s.addClass("hidden"),e){let i=[],t=e.toLowerCase();if(this.typeDataList.forEach(e=>{0!==e.label.toLowerCase().indexOf(t)&&0!==e.type.toLowerCase().indexOf(t)||i.push(e.type)}),0===i.length)return this.$el.find("ul .list-group-item").addClass("hidden"),void s.removeClass("hidden");this.typeDataList.forEach(e=>{let t=this.$el.find(`ul .list-group-item[data-name="${e.type}"]`);~i.indexOf(e.type)?t.removeClass("hidden"):t.addClass("hidden")})}else this.$el.find("ul .list-group-item").removeClass("hidden")}})}),define("views/admin/field-manager/fields/source-list",["views/fields/multi-enum"],function(e){return e.extend({setupOptions:function(){this.params.options=Espo.Utils.clone(this.getMetadata().get("entityDefs.Attachment.sourceList")||[]),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"scopeNamesPlural")})}})}),define("views/admin/field-manager/fields/pattern",["views/fields/varchar"],function(e){return e.extend({noSpellCheck:!0,setupOptions:function(){let t=this.getMetadata().get(["app","regExpPatterns"])||{};var e=Object.keys(t).filter(e=>!t[e].isSystem).map(e=>"$"+e);this.setOptionList(e)}})}),define("views/admin/field-manager/fields/options-with-style",["views/admin/field-manager/fields/options"],function(d){return d.extend({setup:function(){d.prototype.setup.call(this),this.optionsStyleMap=this.model.get("style")||{},this.styleList=["default","success","danger","warning","info","primary"],this.events['click [data-action="selectOptionItemStyle"]']=e=>{let t=$(e.currentTarget);var e=t.data("style"),i=t.data("value").toString();this.changeStyle(i,e)}},changeStyle:function(e,t){var i=e.replace(/"/g,'\\"');this.$el.find('[data-action="selectOptionItemStyle"][data-value="'+i+'"] .check-icon').addClass("hidden"),this.$el.find('[data-action="selectOptionItemStyle"][data-value="'+i+'"][data-style="'+t+'"] .check-icon').removeClass("hidden");let s=this.$el.find('.list-group-item[data-value="'+i+'"]').find(".item-text");this.styleList.forEach(e=>{s.removeClass("text-"+e)}),s.addClass("text-"+t),this.optionsStyleMap[e]=t="default"===t?null:t},getItemHtml:function(s){var e=d.prototype.getItemHtml.call(this,s);let t=this.styleList,a=this.optionsStyleMap,n="default",o=[];t.forEach(e=>{let t=!0;a[s]===e?(n=e,t=!1):"default"!==e||a[s]||(t=!1);var i=this.getLanguage().translateOption(e,"style","LayoutManager"),e=$("<li>").append($("<a>").attr("role","button").attr("tabindex","0").attr("data-action","selectOptionItemStyle").attr("data-style",e).attr("data-value",s).append($("<span>").addClass("check-icon fas fa-check pull-right").addClass(t?"hidden":""),$("<div>").addClass("text-"+e).text(i)));o.push(e)});var i=$("<div>").addClass("btn-group pull-right").append($("<button>").addClass("btn btn-link btn-sm dropdown-toggle").attr("type","button").attr("data-toggle","dropdown").append($("<span>").addClass("caret")),$("<ul>").addClass("dropdown-menu pull-right").append(o));let l=$(e);return l.find(".item-content > input").after(i),l.find(".item-text").addClass("text-"+n),l.addClass("link-group-item-with-columns"),l.get(0).outerHTML},fetch:function(){let t=d.prototype.fetch.call(this);return t.style={},(t.options||[]).forEach(e=>{t.style[e]=this.optionsStyleMap[e]||null}),t}})}),define("views/admin/field-manager/fields/options-reference",["views/fields/enum"],function(e){return e.extend({enumFieldTypeList:["enum","multiEnum","array","checklist","varchar"],setupOptions:function(){this.params.options=[""];let e=Object.keys(this.getMetadata().get(["entityDefs"])).filter(e=>this.getMetadata().get(["scopes",e,"object"])).sort((e,t)=>this.getLanguage().translate(e,"scopesName").localeCompare(this.getLanguage().translate(t,"scopesName")));this.translatedOptions={},e.forEach(n=>{let e=Object.keys(this.getMetadata().get(["entityDefs",n,"fields"])||[]).filter(e=>n!==this.model.scope||e!==this.model.get("name")).sort((e,t)=>this.getLanguage().translate(e,"fields",n).localeCompare(this.getLanguage().translate(t,"fields",n)));e.forEach(e=>{var{type:t,options:i,optionsPath:s,optionsReference:a}=this.getMetadata().get(["entityDefs",n,"fields",e])||{};this.enumFieldTypeList.includes(t)&&(s||a||i&&(this.params.options.push(t=n+"."+e),this.translatedOptions[t]=this.translate(n,"scopeName")+" · "+this.translate(e,"fields",n)))})})}})}),define("views/admin/field-manager/fields/not-actual-options",["exports","views/fields/multi-enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setup(){super.setup(),this.params.options=Espo.Utils.clone(this.model.get("options"))||[],this.listenTo(this.model,"change:options",e=>{this.params.options=Espo.Utils.clone(e.get("options"))||[],this.reRender()})}}e.default=s}),define("views/admin/field-manager/fields/entity-list",["views/fields/entity-type-list"],function(e){return e.extend({})}),define("views/admin/field-manager/fields/dynamic-logic-options",["views/fields/base","model"],function(e,s){return e.extend({editTemplate:"admin/field-manager/fields/dynamic-logic-options/edit",events:{'click [data-action="editConditions"]':function(e){e=parseInt($(e.currentTarget).data("index"));this.edit(e)},'click [data-action="addOptionList"]':function(e){this.addOptionList()},'click [data-action="removeOptionList"]':function(e){e=parseInt($(e.currentTarget).data("index"));this.removeItem(e)}},data:function(){return{itemDataList:this.itemDataList}},setup:function(){this.optionsDefsList=Espo.Utils.cloneDeep(this.model.get(this.name))||[],this.scope=this.options.scope,this.setupItems(),this.setupItemViews()},setupItems:function(){this.itemDataList=[],this.optionsDefsList.forEach((e,t)=>{this.itemDataList.push({conditionGroupViewKey:"conditionGroup"+t.toString(),optionsViewKey:"options"+t.toString(),index:t})})},setupItemViews:function(){this.optionsDefsList.forEach((e,t)=>{this.createStringView(t),this.createOptionsView(t)})},createOptionsView:function(t){var i,e="options"+t.toString();this.optionsDefsList[t]&&((i=new s).set("options",this.optionsDefsList[t].optionList||[]),this.createView(e,"views/fields/multi-enum",{selector:'.options-container[data-key="'+e+'"]',model:i,name:"options",mode:"edit",params:{options:this.model.get("options"),translatedOptions:this.model.get("translatedOptions")}},e=>{this.isRendered()&&e.render(),this.listenTo(this.model,"change:options",()=>{e.setTranslatedOptions(this.getTranslatedOptions()),e.setOptionList(this.model.get("options"))}),this.listenTo(i,"change",()=>{this.optionsDefsList[t].optionList=i.get("options")||[]})}))},getTranslatedOptions:function(){if(this.model.get("translatedOptions"))return this.model.get("translatedOptions");var t={};return(this.model.get("options")||[]).forEach(e=>{t[e]=this.getLanguage().translateOption(e,this.options.field,this.options.scope)}),t},createStringView:function(e){var t="conditionGroup"+e.toString();this.optionsDefsList[e]&&this.createView(t,"views/admin/dynamic-logic/conditions-string/group-base",{selector:'.string-container[data-key="'+t+'"]',itemData:{value:this.optionsDefsList[e].conditionGroup},operator:"and",scope:this.scope},e=>{this.isRendered()&&e.render()})},edit:function(t){this.createView("modal","views/admin/dynamic-logic/modals/edit",{conditionGroup:this.optionsDefsList[t].conditionGroup,scope:this.options.scope},e=>{e.render(),this.listenTo(e,"apply",e=>{this.optionsDefsList[t].conditionGroup=e,this.trigger("change"),this.createStringView(t)})})},addOptionList:function(){this.itemDataList.length;this.optionsDefsList.push({optionList:this.model.get("options")||[],conditionGroup:null}),this.setupItems(),this.reRender(),this.setupItemViews(),this.trigger("change")},removeItem:function(e){this.optionsDefsList.splice(e,1),this.setupItems(),this.reRender(),this.setupItemViews(),this.trigger("change")},fetch:function(){var e={};return e[this.name]=this.optionsDefsList,this.optionsDefsList.length||(e[this.name]=null),e}})}),define("views/admin/field-manager/fields/dynamic-logic-conditions",["views/fields/base"],function(e){return e.extend({detailTemplate:"admin/field-manager/fields/dynamic-logic-conditions/detail",editTemplate:"admin/field-manager/fields/dynamic-logic-conditions/edit",events:{'click [data-action="editConditions"]':function(){this.edit()}},data:function(){},setup:function(){this.conditionGroup=Espo.Utils.cloneDeep((this.model.get(this.name)||{}).conditionGroup||[]),this.scope=this.params.scope||this.options.scope,this.createStringView()},createStringView:function(){this.createView("conditionGroup","views/admin/dynamic-logic/conditions-string/group-base",{selector:".top-group-string-container",itemData:{value:this.conditionGroup},operator:"and",scope:this.scope},e=>{this.isRendered()&&e.render()})},edit:function(){this.createView("modal","views/admin/dynamic-logic/modals/edit",{conditionGroup:this.conditionGroup,scope:this.scope},e=>{e.render(),this.listenTo(e,"apply",e=>{this.conditionGroup=e,this.trigger("change"),this.createStringView()})})},fetch:function(){var e={};return e[this.name]={conditionGroup:this.conditionGroup},0===this.conditionGroup.length&&(e[this.name]=null),e}})}),define("views/admin/field-manager/fields/currency-default",["views/fields/enum"],function(e){return e.extend({fetchEmptyValueAsNull:!0,setupOptions:function(){this.params.options=[""],(this.getConfig().get("currencyList")||[]).forEach(e=>{this.params.options.push(e)})}})}),define("views/admin/field-manager/fields/phone/default",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.setOptionList(this.model.get("typeList")||[""]),this.listenTo(this.model,"change:typeList",()=>{this.setOptionList(this.model.get("typeList")||[""])})}})}),define("views/admin/field-manager/fields/options/default",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("listed"),this.updateAvailableOptions(),this.listenTo(this.model,"change",()=>{(this.model.hasChanged("options")||this.model.hasChanged("optionsReference"))&&this.updateAvailableOptions()})},updateAvailableOptions:function(){this.setOptionList(this.getAvailableOptions())},getAvailableOptions:function(){const e=this.model.get("optionsReference");var t,i;return e?([i,t]=e.split("."),i=this.getMetadata().get(`entityDefs.${i}.fields.${t}.options`)||[""],Espo.Utils.clone(i)):this.model.get("options")||[""]},validateListed:function(){var e=this.model.get(this.name)??"";if(!this.params.options)return!1;const t=this.getAvailableOptions();return-1===t.indexOf(e)&&(e=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0)}})}),define("views/admin/field-manager/fields/options/default-multi",["views/fields/multi-enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.validations.push("listed"),this.updateAvailableOptions(),this.listenTo(this.model,"change",()=>{(this.model.hasChanged("options")||this.model.hasChanged("optionsReference"))&&this.updateAvailableOptions()})},updateAvailableOptions:function(){this.setOptionList(this.getAvailableOptions())},getAvailableOptions:function(){const e=this.model.get("optionsReference");var t,i;return e?([i,t]=e.split("."),i=this.getMetadata().get(`entityDefs.${i}.fields.${t}.options`)||[],Espo.Utils.clone(i)):this.model.get("options")||[]},validateListed:function(){var e,t=this.model.get(this.name)??[];if(!this.params.options)return!1;const i=this.getAvailableOptions();for(const s of t)if(-1===i.indexOf(s))return e=this.translate("fieldInvalid","messages").replace("{field}",this.getLabelText()),this.showValidationMessage(e),!0;return!1}})}),define("views/admin/field-manager/fields/link-multiple/default",["views/fields/link-multiple"],function(s){return s.extend({data:function(){var e=this.model.get("defaultAttributes")||{},t=e[this.options.field+"Names"]||{},e=e[this.options.field+"Ids"]||[],i=s.prototype.data.call(this);return i.nameHash=t,i.idValues=e,i},setup:function(){s.prototype.setup.call(this),this.foreignScope=this.getMetadata().get(["entityDefs",this.options.scope,"links",this.options.field,"entity"])},fetch:function(){var e=s.prototype.fetch.call(this),t={};return t[this.options.field+"Ids"]=e[this.idsName],t[this.options.field+"Names"]=e[this.nameHashName],{defaultAttributes:t=null!==e[this.idsName]&&0!==e[this.idsName].length?t:null}},copyValuesFromModel:function(){var e=this.model.get("defaultAttributes")||{},t=e[this.options.field+"Ids"]||[],e=e[this.options.field+"Names"]||{};this.ids=t,this.nameHash=e}})}),define("views/admin/field-manager/fields/link/default",["views/fields/link"],function(s){return s.extend({data:function(){var e=this.model.get("defaultAttributes")||{},t=e[this.options.field+"Name"]||null,e=e[this.options.field+"Id"]||null,i=s.prototype.data.call(this);return i.nameValue=t,i.idValue=e,i},setup:function(){s.prototype.setup.call(this),this.foreignScope=this.getMetadata().get(["entityDefs",this.options.scope,"links",this.options.field,"entity"])},fetch:function(){var e=s.prototype.fetch.call(this),t={};return t[this.options.field+"Id"]=e[this.idName],t[this.options.field+"Name"]=e[this.nameName],{defaultAttributes:t=null===e[this.idName]?null:t}}})}),define("views/admin/field-manager/fields/int/max",["exports","views/fields/int"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupAutoNumericOptions(){super.setupAutoNumericOptions(),null==this.params.max&&(this.autoNumericOptions.maximumValue="9223372036854775807"),null==this.params.min&&(this.autoNumericOptions.minimumValue="-9223372036854775808")}}e.default=s}),define("views/admin/field-manager/fields/foreign/link",["views/fields/enum"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.model.isNew()||this.setReadOnly(!0)},setupOptions:function(){var t=this.getMetadata().get(["entityDefs",this.options.scope,"links"])||{},i=(this.params.options=Object.keys(Espo.Utils.clone(t)).filter(e=>{if(!("belongsTo"!==t[e].type&&"hasOne"!==t[e].type||t[e].noJoin||t[e].disabled||t[e].utility))return!0}),this.options.scope);this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"links",i)}),this.params.options=this.params.options.sort((e,t)=>this.translate(e,"links",i).localeCompare(this.translate(t,"links",i))),this.params.options.unshift("")}})}),define("views/admin/field-manager/fields/foreign/field",["views/fields/enum"],function(t){return t.extend({setup:function(){t.prototype.setup.call(this),this.model.isNew()||this.setReadOnly(!0),this.listenTo(this.model,"change:field",()=>{this.manageField()}),this.viewValue=this.model.get("view")},setupOptions:function(){this.listenTo(this.model,"change:link",()=>{this.setupOptionsByLink(),this.reRender()}),this.setupOptionsByLink()},setupOptionsByLink:function(){this.typeList=this.getMetadata().get(["fields","foreign","fieldTypeList"]);var i,s,e=this.model.get("link");e&&(i=this.getMetadata().get(["entityDefs",this.options.scope,"links",e,"entity"]))?(s=this.getMetadata().get(["entityDefs",i,"fields"])||{},this.params.options=Object.keys(Espo.Utils.clone(s)).filter(e=>{var t=s[e].type;if(~this.typeList.indexOf(t)&&!(s[e].disabled||s[e].utility||s[e].directAccessDisabled||s[e].notStorable))return!0}),this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",i)}),this.params.options=this.params.options.sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i))),this.params.options.unshift("")):this.params.options=[""]},manageField:function(){var e,t;this.model.isNew()&&(t=this.model.get("link"),e=this.model.get("field"),t&&e&&((t=this.getMetadata().get(["entityDefs",this.options.scope,"links",t,"entity"]))&&(t=this.getMetadata().get(["entityDefs",t,"fields",e,"type"]),this.viewValue=this.getMetadata().get(["fields","foreign","fieldTypeViewMap",t]))))},fetch:function(){var e=t.prototype.fetch.call(this);return this.model.isNew()&&this.viewValue&&(e.view=this.viewValue),e}})}),define("views/admin/field-manager/fields/date/default",["views/fields/enum"],function(t){return t.extend({fetch:function(){var e=t.prototype.fetch.call(this);return""===e[this.name]&&(e[this.name]=null),e},setupOptions:function(){t.prototype.setupOptions.call(this);var e=this.model.get(this.name);this.params.options&&e&&!~this.params.options.indexOf(e)&&this.params.options.push(e)}})}),define("views/admin/field-manager/fields/date/after-before",["views/fields/varchar"],function(t){return t.extend({setupOptions:function(){var e;t.prototype.setupOptions.call(this),this.model.scope&&(e=this.getFieldManager().getEntityTypeFieldList(this.model.scope,{typeList:["date","datetime","datetimeOptional"]}),this.model.get("name")&&(e=e.filter(function(e){return e!==this.model.get("name")},this)),this.params.options=e)}})}),define("views/admin/extensions/ready",["views/modal"],function(e){return e.extend({cssName:"ready-modal",header:!1,template:"admin/extensions/ready",createButton:!0,data:function(){return{version:this.upgradeData.version,text:this.translate("installExtension","messages","Admin").replace("{version}",this.upgradeData.version).replace("{name}",this.upgradeData.name)}},setup:function(){this.buttonList=[{name:"run",text:this.translate("Install","labels","Admin"),style:"danger"},{name:"cancel",label:"Cancel"}],this.upgradeData=this.options.upgradeData,this.header=this.getLanguage().translate("Ready for installation","labels","Admin")},actionRun:function(){this.trigger("run"),this.remove()}})}),define("views/admin/extensions/index",["exports","view","helpers/list/select-provider"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="admin/extensions/index";packageContents=null;events={'change input[name="package"]':function(e){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),this.$el.find(".message-container").html("");e=e.currentTarget.files;e.length&&this.selectFile(e[0])},'click button[data-action="upload"]':function(){this.upload()},'click [data-action="install"]':function(e){var e=$(e.currentTarget).data("id"),t=this.collection.get(e).get("name"),i=this.collection.get(e).get("version");this.run(e,t,i)},'click [data-action="uninstall"]':function(e){const t=$(e.currentTarget).data("id");this.confirm(this.translate("uninstallConfirmation","messages","Admin"),()=>{Espo.Ui.notify(this.translate("Uninstalling...","labels","Admin")),Espo.Ajax.postRequest("Extension/action/uninstall",{id:t},{timeout:0,bypassAppReload:!0}).then(()=>{Espo.Ui.success(this.translate("Done")),setTimeout(()=>window.location.reload(),500)}).catch(e=>{e=e.getResponseHeader("X-Status-Reason");this.showErrorNotification(this.translate("Error")+": "+e)})})}};setup(){const e=new i.default(this.getHelper().layoutManager,this.getHelper().metadata,this.getHelper().fieldManager);this.wait(this.getCollectionFactory().create("Extension").then(e=>{this.collection=e,this.collection.maxSize=this.getConfig().get("recordsPerPage")}).then(()=>e.get("Extension")).then(e=>{this.collection.data.select=e.join(",")}).then(()=>this.collection.fetch()).then(()=>{this.createView("list","views/extension/record/list",{collection:this.collection,selector:"> .list-container"}),0===this.collection.length&&this.once("after:render",()=>{this.$el.find(".list-container").addClass("hidden")})}))}selectFile(t){const e=new FileReader;e.onload=e=>{this.packageContents=e.target.result,this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled");var e=this.getHelper().getAppParam("maxUploadSize")||0;t.size>1024*e*1024&&(e=this.translate("fileExceedsMaxUploadSize","messages","Extension").replace("{maxSize}",e+"MB"),Espo.Ui.dialog({body:this.getHelper().transformMarkdownText(e).toString(),buttonList:[{name:"close",text:this.translate("Close"),onClick:e=>e.close()}]}).show())},e.readAsDataURL(t)}showError(e){e=this.translate(e,"errors","Admin"),this.$el.find(".message-container").html(e)}showErrorNotification(e){e?(e=this.translate(e,"errors","Admin"),this.$el.find(".notify-text").html(e),this.$el.find(".notify-text").removeClass("hidden")):this.$el.find(".notify-text").addClass("hidden")}upload(){this.$el.find('button[data-action="upload"]').addClass("disabled").attr("disabled","disabled"),Espo.Ui.notify(this.translate("Uploading...")),Espo.Ajax.postRequest("Extension/action/upload",this.packageContents,{timeout:0,contentType:"application/zip"}).then(t=>{t.id?(Espo.Ui.notify(!1),this.createView("popup","views/admin/extensions/ready",{upgradeData:t},e=>{e.render(),this.$el.find('button[data-action="upload"]').removeClass("disabled").removeAttr("disabled"),e.once("run",()=>{e.close(),this.$el.find(".panel.upload").addClass("hidden"),this.run(t.id,t.version,t.name)})})):this.showError(this.translate("Error occurred"))}).catch(e=>{this.showError(e.getResponseHeader("X-Status-Reason")),Espo.Ui.notify(!1)})}run(e,t,i){Espo.Ui.notify(this.translate("pleaseWait","messages")),this.showError(!1),this.showErrorNotification(!1),Espo.Ajax.postRequest("Extension/action/install",{id:e},{timeout:0,bypassAppReload:!0}).then(()=>{const e=this.getCache();e&&e.clear(),this.createView("popup","views/admin/extensions/done",{version:t,name:i},e=>{this.collection.length&&this.collection.fetch({bypassAppReload:!0}),this.$el.find(".list-container").removeClass("hidden"),this.$el.find(".panel.upload").removeClass("hidden"),Espo.Ui.notify(!1),e.render()})}).catch(e=>{this.$el.find(".panel.upload").removeClass("hidden");e=e.getResponseHeader("X-Status-Reason");this.showErrorNotification(this.translate("Error")+": "+e)})}}e.default=a}),define("views/admin/extensions/done",["views/modal"],function(e){return e.extend({cssName:"done-modal",header:!1,template:"admin/extensions/done",createButton:!0,data:function(){return{version:this.options.version,name:this.options.name,text:this.translate("extensionInstalled","messages","Admin").replace("{version}",this.options.version).replace("{name}",this.options.name)}},setup:function(){this.on("remove",()=>{window.location.reload()}),this.buttonList=[{name:"close",label:"Close"}],this.header=this.getLanguage().translate("Installed successfully","labels","Admin")}})}),define("views/admin/entity-manager/scope",["exports","view","views/record/detail","model","views/admin/entity-manager/fields/primary-filters"],function(e,t,i,s,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),s=n(s),a=n(a);class o extends t.default{template="admin/entity-manager/scope";scope;data(){return{scope:this.scope,isEditable:this.isEditable,isRemovable:this.isRemovable,isCustomizable:this.isCustomizable,type:this.type,hasLayouts:this.hasLayouts,label:this.label,hasFormula:this.hasFormula,hasFields:this.hasFields,hasRelationships:this.hasRelationships}}events={'click [data-action="editEntity"]':function(){this.getRouter().navigate("#Admin/entityManager/edit&scope="+this.scope,{trigger:!0})},'click [data-action="removeEntity"]':function(){this.removeEntity()},'click [data-action="editFormula"]':function(){this.editFormula()}};setup(){this.scope=this.options.scope,this.setupScopeData(),this.model=new s.default({name:this.scope,type:this.type,label:this.label,primaryFilters:this.getPrimaryFilters()}),this.model.setDefs({fields:{name:{type:"varchar"},type:{type:"varchar"},label:{type:"varchar"},primaryFilters:{type:"array"}}}),this.recordView=new i.default({model:this.model,inlineEditDisabled:!0,buttonsDisabled:!0,readOnly:!0,detailLayout:[{tabBreak:!0,tabLabel:this.translate("General","labels","Settings"),rows:[[{name:"name",labelText:this.translate("name","fields","EntityManager")},{name:"type",labelText:this.translate("type","fields","EntityManager")}],[{name:"label",labelText:this.translate("label","fields","EntityManager")},!1]]},{tabBreak:!0,tabLabel:this.translate("Details"),rows:[[{view:new a.default({name:"primaryFilters",labelText:this.translate("primaryFilters","fields","EntityManager"),targetEntityType:this.scope})},!1]]}]}),this.assignView("record",this.recordView,".record-container"),this.type||this.recordView.hideField("type")}setupScopeData(){var e=this.getMetadata().get(["scopes",this.scope]),t=this.getMetadata().get(["scopes",this.scope,"entityManager"])||{};if(!e)throw new Espo.Exceptions.NotFound;this.isRemovable=!!e.isCustom,e.isNotRemovable&&(this.isRemovable=!1),this.isCustomizable=!!e.customizable,this.type=e.type,this.isEditable=!0,this.hasLayouts=e.layouts,this.hasFormula=this.isCustomizable,this.hasFields=this.isCustomizable,this.hasRelationships=this.isCustomizable,e.customizable||(this.isEditable=!1),"edit"in t&&(this.isEditable=t.edit),"layouts"in t&&(this.hasLayouts=t.layouts),"formula"in t&&(this.hasFormula=t.formula),"fields"in t&&(this.hasFields=t.fields),"relationships"in t&&(this.hasRelationships=t.relationships),this.label=this.getLanguage().translate(this.scope,"scopeNames")}editFormula(){Espo.Ui.notify(" ... "),Espo.loader.requirePromise("views/admin/entity-manager/modals/select-formula").then(e=>{const t=new e({scope:this.scope});this.assignView("dialog",t).then(()=>{Espo.Ui.notify(!1),t.render()})})}removeEntity(){const e=this.scope;this.confirm(this.translate("confirmRemove","messages","EntityManager"),()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),this.disableButtons(),Espo.Ajax.postRequest("EntityManager/action/removeEntity",{name:e}).then(()=>{this.getMetadata().loadSkipCache().then(()=>{this.getConfig().load().then(()=>{Espo.Ui.notify(!1),this.broadcastUpdate(),this.getRouter().navigate("#Admin/entityManager",{trigger:!0})})})}).catch(()=>this.enableButtons())})}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Entity Manager","labels","Admin"))}disableButtons(){this.$el.find(".btn.action").addClass("disabled").attr("disabled","disabled"),this.$el.find(".item-dropdown-button").addClass("disabled").attr("disabled","disabled")}enableButtons(){this.$el.find(".btn.action").removeClass("disabled").removeAttr("disabled"),this.$el.find('.item-dropdown-button"]').removeClass("disabled").removeAttr("disabled")}broadcastUpdate(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:settings")}getPrimaryFilters(){const e=this.getMetadata().get(`clientDefs.${this.scope}.filterList`,[]).map(e=>"object"==typeof e&&e.name?e.name:e.toString());return this.getMetadata().get(`scopes.${this.scope}.stars`)&&e.unshift("starred"),e}}e.default=o}),define("views/admin/entity-manager/index",["exports","view","views/admin/entity-manager/modals/export"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="admin/entity-manager/index";scopeDataList=null;scope=null;data(){return{scopeDataList:this.scopeDataList}}events={'click button[data-action="createEntity"]':function(){this.getRouter().navigate("#Admin/entityManager/create&",{trigger:!0})},'keyup input[data-name="quick-search"]':function(e){this.processQuickSearch(e.currentTarget.value)}};setupScopeData(){this.scopeDataList=[];let e=Object.keys(this.getMetadata().get("scopes")).sort((e,t)=>e.localeCompare(t)),i=[];e.forEach(e=>{var t=this.getMetadata().get("scopes."+e);t.entity&&t.customizable&&i.push(e)}),e.forEach(e=>{var t=this.getMetadata().get("scopes."+e);t.entity&&!t.customizable&&i.push(e)}),(e=i).forEach(e=>{var t=this.getMetadata().get("scopes."+e);let i=!!t.isCustom;t.isNotRemovable&&(i=!1),this.scopeDataList.push({name:e,isCustom:t.isCustom,isRemovable:i,hasView:t.customizable,type:t.type,label:this.getLanguage().translate(e,"scopeNames"),layouts:t.layouts,module:"Crm"!==t.module?t.module:null})})}setup(){this.setupScopeData(),this.addActionHandler("export",()=>this.actionExport())}afterRender(){this.$noData=this.$el.find(".no-data"),this.$el.find('input[data-name="quick-search"]').focus()}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Entity Manager","labels","Admin"))}processQuickSearch(e){e=e.trim();let t=this.$noData;if(t.addClass("hidden"),e){let s=[],a=e.toLowerCase();if(this.scopeDataList.forEach(t=>{let i=!1;if(!(i=0!==t.label.toLowerCase().indexOf(a)&&0!==t.name.toLowerCase().indexOf(a)?i:!0)){let e=t.label.split(" ").concat(t.label.split(" "));e.forEach(e=>{0===e.toLowerCase().indexOf(a)&&(i=!0)})}i&&s.push(t.name)}),0===s.length)return this.$el.find("table tr.scope-row").addClass("hidden"),void t.removeClass("hidden");this.scopeDataList.map(e=>e.name).forEach(e=>{~s.indexOf(e)?this.$el.find('table tr.scope-row[data-scope="'+e+'"]').removeClass("hidden"):this.$el.find('table tr.scope-row[data-scope="'+e+'"]').addClass("hidden")})}else this.$el.find("table tr.scope-row").removeClass("hidden")}actionExport(){const e=new i.default;this.assignView("dialog",e).then(()=>{e.render()})}}e.default=a}),define("views/admin/entity-manager/formula",["exports","view","model","views/admin/entity-manager/record/edit-formula","underscore"],function(e,t,i,s,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=n(t),i=n(i),s=n(s),a=n(a);class o extends t.default{template="admin/entity-manager/formula";scope;attributes;data(){return{scope:this.scope,type:this.type}}setup(){if(this.addActionHandler("save",()=>this.actionSave()),this.addActionHandler("close",()=>this.actionClose()),this.addActionHandler("resetToDefault",()=>this.actionResetToDefault()),this.addHandler("keydown.form","","onKeyDown"),this.scope=this.options.scope,this.type=this.options.type,!this.scope||!this.type)throw Error("No scope or type.");if(!this.getMetadata().get(["scopes",this.scope,"customizable"])||!1===this.getMetadata().get(`scopes.${this.scope}.entityManager.formula`))throw new Espo.Exceptions.NotFound("Entity type is not customizable.");if(!["beforeSaveCustomScript","beforeSaveApiScript"].includes(this.type))throw Espo.Ui.error("No allowed formula type.",!0),new Espo.Exceptions.NotFound("No allowed formula type specified.");this.model=new i.default,this.model.name="EntityManager",this.wait(this.loadFormula().then(()=>{this.recordView=new s.default({model:this.model,targetEntityType:this.scope,type:this.type}),this.assignView("record",this.recordView,".record")})),this.listenTo(this.model,"change",(e,t)=>{t.ui&&this.setIsChanged()})}async loadFormula(){await Espo.Ajax.getRequest("Metadata/action/get",{key:"formula."+this.scope}).then(e=>{this.model.set(this.type,(e=e||{})[this.type]||null),this.updateAttributes()})}afterRender(){this.$save=this.$el.find('[data-action="save"]')}disableButtons(){this.$save.addClass("disabled").attr("disabled","disabled")}enableButtons(){this.$save.removeClass("disabled").removeAttr("disabled")}updateAttributes(){this.attributes=Espo.Utils.clone(this.model.attributes)}actionSave(){var e=this.recordView.fetch();a.default.isEqual(e,this.attributes)?Espo.Ui.warning(this.translate("notModified","messages")):this.recordView.validate()||(this.disableButtons(),Espo.Ui.notify(" ... "),Espo.Ajax.postRequest("EntityManager/action/formula",{data:e,scope:this.scope}).then(()=>{Espo.Ui.success(this.translate("Saved")),this.enableButtons(),this.setIsNotChanged(),this.updateAttributes()}).catch(()=>this.enableButtons()))}actionClose(){this.setIsNotChanged(),this.getRouter().navigate("#Admin/entityManager/scope="+this.scope,{trigger:!0})}async actionResetToDefault(){await this.confirm(this.translate("confirmation","messages")),this.disableButtons(),Espo.Ui.notify(" ... ");try{await Espo.Ajax.postRequest("EntityManager/action/resetFormulaToDefault",{scope:this.scope,type:this.type})}catch(e){return void this.enableButtons()}await this.loadFormula(),await this.recordView.reRender(),this.enableButtons(),this.setIsNotChanged(),Espo.Ui.success(this.translate("Done"))}setConfirmLeaveOut(e){this.getRouter().confirmLeaveOut=e}setIsChanged(){this.isChanged=!0,this.setConfirmLeaveOut(!0)}setIsNotChanged(){this.isChanged=!1,this.setConfirmLeaveOut(!1)}updatePageTitle(){this.setPageTitle(this.getLanguage().translate("Formula","labels","EntityManager"))}onKeyDown(e){var t=Espo.Utils.getKeyFromKeyEvent(e);"Control+KeyS"!==t&&"Control+Enter"!==t||(this.actionSave(),e.preventDefault(),e.stopPropagation())}}e.default=o}),define("views/admin/entity-manager/edit",["exports","view","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{template="admin/entity-manager/edit";additionalParams;defaultParamLocation="scopes";data(){return{isNew:this.isNew,scope:this.scope}}setupData(){const a=this.scope;var e=this.getMetadata().get(["scopes",a,"type"])||null;if(this.hasStreamField=!0,a&&(this.hasStreamField=this.getMetadata().get(["scopes",a,"customizable"])&&this.getMetadata().get(["scopes",a,"object"])||!1),"User"===a&&(this.hasStreamField=!1),this.hasColorField=!this.getConfig().get("scopeColorsDisabled"),a){this.additionalParams=Espo.Utils.cloneDeep({...this.getMetadata().get(["app","entityManagerParams","Global"]),...this.getMetadata().get(["app","entityManagerParams","@"+(e||"_")]),...this.getMetadata().get(["app","entityManagerParams",a])}),this.model.set("name",a),this.model.set("labelSingular",this.translate(a,"scopeNames")),this.model.set("labelPlural",this.translate(a,"scopeNamesPlural")),this.model.set("type",this.getMetadata().get("scopes."+a+".type")||""),this.model.set("stream",this.getMetadata().get("scopes."+a+".stream")||!1),this.model.set("disabled",this.getMetadata().get("scopes."+a+".disabled")||!1),this.model.set("sortBy",this.getMetadata().get("entityDefs."+a+".collection.orderBy")),this.model.set("sortDirection",this.getMetadata().get("entityDefs."+a+".collection.order")),this.model.set("textFilterFields",this.getMetadata().get(["entityDefs",a,"collection","textFilterFields"])||["name"]),this.model.set("fullTextSearch",this.getMetadata().get(["entityDefs",a,"collection","fullTextSearch"])||!1),this.model.set("countDisabled",this.getMetadata().get(["entityDefs",a,"collection","countDisabled"])||!1),this.model.set("statusField",this.getMetadata().get("scopes."+a+".statusField")||null),this.hasColorField&&this.model.set("color",this.getMetadata().get(["clientDefs",a,"color"])||null),this.model.set("iconClass",this.getMetadata().get(["clientDefs",a,"iconClass"])||null),this.model.set("kanbanViewMode",this.getMetadata().get(["clientDefs",a,"kanbanViewMode"])||!1),this.model.set("kanbanStatusIgnoreList",this.getMetadata().get(["scopes",a,"kanbanStatusIgnoreList"])||[]);for(const l in this.additionalParams){var t=this.additionalParams[l],i=t.location||this.defaultParamLocation,t="bool"!==t.fieldDefs.type&&null,i=this.getMetadata().get([i,a,l])||t;this.model.set(l,i)}}if(a){const d=this.getMetadata().get("entityDefs."+a+".fields")||{};this.orderableFieldList=Object.keys(d).filter(e=>!!this.getFieldManager().isEntityTypeFieldAvailable(a,e)&&!d[e].orderDisabled).sort((e,t)=>this.translate(e,"fields",a).localeCompare(this.translate(t,"fields",a))),this.sortByTranslation={},this.orderableFieldList.forEach(e=>{this.sortByTranslation[e]=this.translate(e,"fields",a)}),this.filtersOptionList=this.getTextFiltersOptionList(a),this.textFilterFieldsTranslation={},this.filtersOptionList.forEach(e=>{var t,i,s;if(~e.indexOf("."))return t=e.split(".")[0],i=e.split(".")[1],s=this.getMetadata().get(["entityDefs",a,"links",t,"entity"]),void(this.textFilterFieldsTranslation[e]=this.translate(t,"links",a)+"."+this.translate(i,"fields",s));this.textFilterFieldsTranslation[e]=this.translate(e,"fields",a)}),this.enumFieldList=Object.keys(d).filter(e=>{if(!d[e].disabled)return"enum"===d[e].type||void 0}).sort((e,t)=>this.translate(e,"fields",a).localeCompare(this.translate(t,"fields",a))),this.translatedStatusFields={},this.enumFieldList.forEach(e=>{this.translatedStatusFields[e]=this.translate(e,"fields",a)}),this.enumFieldList.unshift(""),this.translatedStatusFields[""]="-"+this.translate("None")+"-",this.statusOptionList=[],this.translatedStatusOptions={}}if(this.detailLayout=[{rows:[[{name:"name"},{name:"type",options:{tooltipText:this.translate("entityType","tooltips","EntityManager")}}],[{name:"labelSingular"},{name:"labelPlural"}],[{name:"iconClass"},{name:"color"}],[{name:"disabled"},{name:"stream"}],[{name:"sortBy",options:{translatedOptions:this.sortByTranslation}},{name:"sortDirection"}],[{name:"textFilterFields",options:{translatedOptions:this.textFilterFieldsTranslation}},{name:"statusField",options:{translatedOptions:this.translatedStatusFields}}],[{name:"fullTextSearch"},{name:"countDisabled"}],[{name:"kanbanViewMode"},{name:"kanbanStatusIgnoreList",options:{translatedOptions:this.translatedStatusOptions}}]]}],this.scope){var e=[],s=[];const r=Object.keys(this.additionalParams).filter(e=>!!this.getMetadata().get(["app","entityManagerParams","Global",e]));var n=Object.keys(this.additionalParams).filter(e=>!r.includes(e)),o=function(s,a){a.forEach((e,t)=>{t%2==0&&s.push([]);const i=s[s.length-1];i.push({name:e}),t===a.length-1&&1===i.length&&i.push(!1)})};o(e,r),o(s,n),e.length&&this.detailLayout.push({rows:e}),s.length&&this.detailLayout.push({rows:s})}}setup(){var e=this.scope=this.options.scope||!1;if(this.isNew=!e,this.model=new i.default,this.model.name="EntityManager",this.isNew||(this.isCustom=this.getMetadata().get(["scopes",e,"isCustom"])),this.scope&&(!this.getMetadata().get(`scopes.${e}.customizable`)||!1===this.getMetadata().get(`scopes.${e}.entityManager.edit`)))throw new Espo.Exceptions.NotFound("The entity type is not customizable.");this.setupData(),this.setupDefs(),this.model.fetchedAttributes=this.model.getClonedAttributes(),this.createRecordView()}setupDefs(){var e=this.scope;const t={fields:{type:{type:"enum",required:!0,options:this.getMetadata().get("app.entityTemplateList")||["Base"],readOnly:!1!==e,tooltip:!0},stream:{type:"bool",required:!0,tooltip:!0},disabled:{type:"bool",tooltip:!0},name:{type:"varchar",required:!0,trim:!0,maxLength:64,readOnly:!1!==e},labelSingular:{type:"varchar",required:!0,trim:!0},labelPlural:{type:"varchar",required:!0,trim:!0},color:{type:"varchar",view:"views/fields/colorpicker"},iconClass:{type:"varchar",view:"views/admin/entity-manager/fields/icon-class"},sortBy:{type:"enum",options:this.orderableFieldList},sortDirection:{type:"enum",options:["asc","desc"]},fullTextSearch:{type:"bool",tooltip:!0},countDisabled:{type:"bool",tooltip:!0},kanbanViewMode:{type:"bool"},textFilterFields:{type:"multiEnum",options:this.filtersOptionList,tooltip:!0},statusField:{type:"enum",options:this.enumFieldList,tooltip:!0},kanbanStatusIgnoreList:{type:"multiEnum",options:this.statusOptionList}}};this.getMetadata().get(["scopes",this.scope,"statusFieldLocked"])&&(t.fields.statusField.readOnly=!0);for(const i in this.additionalParams)t.fields[i]=this.additionalParams[i].fieldDefs;this.model.setDefs(t)}createRecordView(){return this.createView("record","views/admin/entity-manager/record/edit",{selector:".record",model:this.model,detailLayout:this.detailLayout,isNew:this.isNew,hasColorField:this.hasColorField,hasStreamField:this.hasStreamField,isCustom:this.isCustom,subjectEntityType:this.scope,shortcutKeysEnabled:!0}).then(e=>{this.listenTo(e,"save",()=>this.actionSave()),this.listenTo(e,"cancel",()=>this.actionCancel()),this.listenTo(e,"reset-to-default",()=>this.actionResetToDefault())})}hideField(e){this.getRecordView().hideField(e)}showField(e){this.getRecordView().showField(e)}toPlural(e){return"y"===e.slice(-1)?e.substr(0,e.length-1)+"ies":"s"===e.slice(-1)?e+"es":e+"s"}afterRender(){this.getFieldView("name").on("change",()=>{let e=this.model.get("name");e=e.charAt(0).toUpperCase()+e.slice(1),this.model.set("labelSingular",e),this.model.set("labelPlural",this.toPlural(e)),e&&(e=e.replace(/-/g," ").replace(/_/g," ").replace(/[^\w\s]/gi,"").replace(/ (.)/g,(e,t)=>t.toUpperCase()).replace(" ","")).length&&(e=e.charAt(0).toUpperCase()+e.slice(1)),this.model.set("name",e)})}actionSave(){let e=["name","type","labelSingular","labelPlural","disabled","statusField","iconClass"];this.hasStreamField&&e.push("stream"),this.scope&&(e.push("sortBy"),e.push("sortDirection"),e.push("kanbanViewMode"),e.push("kanbanStatusIgnoreList"),e=e.concat(Object.keys(this.additionalParams))),this.hasColorField&&e.push("color");const i=Espo.Utils.cloneDeep(this.model.fetchedAttributes)||{};let t=!1;if(e.forEach(e=>{this.getFieldView(e)&&"edit"===this.getFieldView(e).mode&&this.getFieldView(e).fetchToModel()}),e.forEach(e=>{this.getFieldView(e)&&"edit"===this.getFieldView(e).mode&&(t=this.getFieldView(e).validate()||t)}),!t){this.disableButtons();let e="EntityManager/action/createEntity";this.scope&&(e="EntityManager/action/updateEntity");const a={name:this.model.get("name"),labelSingular:this.model.get("labelSingular"),labelPlural:this.model.get("labelPlural"),type:this.model.get("type"),stream:this.model.get("stream"),disabled:this.model.get("disabled"),textFilterFields:this.model.get("textFilterFields"),fullTextSearch:this.model.get("fullTextSearch"),countDisabled:this.model.get("countDisabled"),statusField:this.model.get("statusField"),iconClass:this.model.get("iconClass")};if(this.hasColorField&&(a.color=this.model.get("color")||null),""===a.statusField&&(a.statusField=null),this.scope){a.sortBy=this.model.get("sortBy"),a.sortDirection=this.model.get("sortDirection"),a.kanbanViewMode=this.model.get("kanbanViewMode"),a.kanbanStatusIgnoreList=this.model.get("kanbanStatusIgnoreList");for(const n in this.additionalParams){var s=this.additionalParams[n].fieldDefs.type;this.getFieldManager().getAttributeList(s,n).forEach(e=>{a[e]=this.model.get(e)})}}this.isNew||(this.model.fetchedAttributes.labelPlural===a.labelPlural&&delete a.labelPlural,this.model.fetchedAttributes.labelSingular===a.labelSingular&&delete a.labelSingular),Espo.Ui.notify(this.translate("pleaseWait","messages")),Espo.Ajax.postRequest(e,a).then(t=>{this.model.fetchedAttributes=this.model.getClonedAttributes(),this.scope?Espo.Ui.success(this.translate("Saved")):Espo.Ui.success(this.translate("entityCreated","messages","EntityManager")),this.getMetadata().loadSkipCache().then(()=>Promise.all([this.getConfig().load(),this.getLanguage().loadSkipCache()])).then(()=>{var e=a.fullTextSearch&&!i.fullTextSearch;this.broadcastUpdate(),e&&this.createView("dialog","views/modal",{templateContent:"{{complexText viewObject.options.msg}}{{complexText viewObject.options.msgRebuild}}",headerText:this.translate("rebuildRequired","strings","Admin"),backdrop:"static",msg:this.translate("rebuildRequired","messages","Admin"),msgRebuild:"```php rebuild.php```",buttonList:[{name:"close",label:this.translate("Close")}]}).then(e=>e.render()),this.enableButtons(),this.getRecordView().setIsNotChanged(),this.isNew&&this.getRouter().navigate("#Admin/entityManager/scope="+t.name,{trigger:!0})})}).catch(()=>{this.enableButtons()})}}actionCancel(){this.getRecordView().setConfirmLeaveOut(!1),this.isNew?this.getRouter().navigate("#Admin/entityManager",{trigger:!0}):this.getRouter().navigate("#Admin/entityManager/scope="+this.scope,{trigger:!0})}actionResetToDefault(){this.confirm(this.translate("confirmation","messages"),()=>{Espo.Ui.notify(this.translate("pleaseWait","messages")),this.disableButtons(),Espo.Ajax.postRequest("EntityManager/action/resetToDefault",{scope:this.scope}).then(()=>{this.getMetadata().loadSkipCache().then(()=>this.getLanguage().loadSkipCache()).then(()=>{this.setupData(),this.model.fetchedAttributes=this.model.getClonedAttributes(),Espo.Ui.success(this.translate("Done")),this.enableButtons(),this.broadcastUpdate(),this.getRecordView().setIsNotChanged()})})})}getRecordView(){return this.getView("record")}getTextFiltersOptionList(a){const i=this.getMetadata().get(["entityDefs",a,"fields"])||{},n=Object.keys(i).filter(e=>{var t=i[e].type;return!!this.getMetadata().get(["fields",t,"textFilter"])&&(!!this.getFieldManager().isEntityTypeFieldAvailable(a,e)&&!this.getMetadata().get(["entityDefs",a,"fields",e,"textFilterDisabled"]))}),e=(n.unshift("id"),Object.keys(this.getMetadata().get(["entityDefs",a,"links"])||{}));return e.sort((e,t)=>this.translate(e,"links",a).localeCompare(this.translate(t,"links",a))),e.forEach(t=>{if("belongsTo"===this.getMetadata().get(["entityDefs",a,"links",t,"type"])){const i=this.getMetadata().get(["entityDefs",a,"links",t,"entity"]);if(i&&"Attachment"!==i){var e=this.getMetadata().get(["entityDefs",i,"fields"])||{};const s=Object.keys(e);s.sort((e,t)=>this.translate(e,"fields",i).localeCompare(this.translate(t,"fields",i))),s.filter(e=>{var t=this.getMetadata().get(["entityDefs",i,"fields",e,"type"]);return!!this.getMetadata().get(["fields",t,"textFilter"])&&(!!this.getMetadata().get(["fields",t,"textFilterForeign"])&&(!!this.getFieldManager().isEntityTypeFieldAvailable(i,e)&&(!this.getMetadata().get(["entityDefs",i,"fields",e,"textFilterDisabled"])&&!this.getMetadata().get(["entityDefs",i,"fields",e,"foreignAccessDisabled"]))))}).forEach(e=>{n.push(t+"."+e)})}}}),n}getFieldView(e){return this.getRecordView().getFieldView(e)}disableButtons(){this.getRecordView().disableActionItems()}enableButtons(){this.getRecordView().enableActionItems()}broadcastUpdate(){this.getHelper().broadcastChannel.postMessage("update:metadata"),this.getHelper().broadcastChannel.postMessage("update:language"),this.getHelper().broadcastChannel.postMessage("update:config")}}e.default=a}),define("views/admin/entity-manager/record/edit",["views/record/edit"],function(e){return e.extend({bottomView:null,sideView:null,dropdownItemList:[],accessControlDisabled:!0,saveAndContinueEditingAction:!1,saveAndNewAction:!1,shortcutKeys:{"Control+Enter":"save","Control+KeyS":"save"},setup:function(){this.isCreate=this.options.isNew,this.scope="EntityManager",this.subjectEntityType=this.options.subjectEntityType,this.isCreate?this.buttonList=[{name:"save",style:"danger",label:"Create"},{name:"cancel",label:"Cancel"}]:this.buttonList=[{name:"save",style:"danger",label:"Save"},{name:"cancel",label:"Cancel"}],this.isCreate||this.options.isCustom||this.buttonList.push({name:"resetToDefault",text:this.translate("Reset to Default","labels","Admin")}),e.prototype.setup.call(this),this.isCreate&&(this.hideField("sortBy"),this.hideField("sortDirection"),this.hideField("textFilterFields"),this.hideField("statusField"),this.hideField("fullTextSearch"),this.hideField("countDisabled"),this.hideField("kanbanViewMode"),this.hideField("kanbanStatusIgnoreList"),this.hideField("disabled")),this.options.hasColorField||this.hideField("color"),this.options.hasStreamField||this.hideField("stream"),this.isCreate||(this.manageKanbanFields({}),this.listenTo(this.model,"change:statusField",(e,t,i)=>{this.manageKanbanFields(i)}),this.manageKanbanViewModeField(),this.listenTo(this.model,"change:kanbanViewMode",()=>{this.manageKanbanViewModeField()}))},actionSave:function(){this.trigger("save")},actionCancel:function(){this.trigger("cancel")},actionResetToDefault:function(){this.trigger("reset-to-default")},manageKanbanViewModeField:function(){this.model.get("kanbanViewMode")?this.showField("kanbanStatusIgnoreList"):this.hideField("kanbanStatusIgnoreList")},manageKanbanFields:function(e){e.ui&&this.model.set("kanbanStatusIgnoreList",[]),this.model.get("statusField")?(this.setKanbanStatusIgnoreListOptions(),this.showField("kanbanViewMode"),this.model.get("kanbanViewMode")?this.showField("kanbanStatusIgnoreList"):this.hideField("kanbanStatusIgnoreList")):(this.hideField("kanbanViewMode"),this.hideField("kanbanStatusIgnoreList"))},setKanbanStatusIgnoreListOptions:function(){var e=this.model.get("statusField"),e=this.getMetadata().get(["entityDefs",this.subjectEntityType,"fields",e,"options"])||[],e=(this.setFieldOptionList("kanbanStatusIgnoreList",e),this.getFieldView("kanbanStatusIgnoreList"));e?this.setKanbanStatusIgnoreListTranslation():this.once("after:render",()=>this.setKanbanStatusIgnoreListTranslation())},setKanbanStatusIgnoreListTranslation:function(){var e=this.getFieldView("kanbanStatusIgnoreList"),t=this.model.get("statusField"),t=this.getMetadata().get(["entityDefs",this.subjectEntityType,"fields",t,"translation"])||this.subjectEntityType+".options."+t;e.params.translation=t,e.setupTranslation()}})}),define("views/admin/entity-manager/modals/select-icon",["views/modal","model"],function(e,t){return e.extend({template:"admin/entity-manager/modals/select-icon",buttonList:[{name:"cancel",label:"Cancel"}],data:function(){return{iconDataList:this.getIconDataList()}},setup:function(){this.events['keyup input[data-name="quick-search"]']=function(e){this.processQuickSearch(e.currentTarget.value)},this.itemCache={},this.iconList=["fas fa-ad","fas fa-address-book","fas fa-address-card","fas fa-adjust","fas fa-air-freshener","fas fa-align-center","fas fa-align-justify","fas fa-align-left","fas fa-align-right","fas fa-allergies","fas fa-ambulance","fas fa-american-sign-language-interpreting","fas fa-anchor","fas fa-angle-double-down","fas fa-angle-double-left","fas fa-angle-double-right","fas fa-angle-double-up","fas fa-angle-down","fas fa-angle-left","fas fa-angle-right","fas fa-angle-up","fas fa-angry","fas fa-ankh","fas fa-apple-alt","fas fa-archive","fas fa-archway","fas fa-arrow-alt-circle-down","fas fa-arrow-alt-circle-left","fas fa-arrow-alt-circle-right","fas fa-arrow-alt-circle-up","fas fa-arrow-circle-down","fas fa-arrow-circle-left","fas fa-arrow-circle-right","fas fa-arrow-circle-up","fas fa-arrow-down","fas fa-arrow-left","fas fa-arrow-right","fas fa-arrow-up","fas fa-arrows-alt","fas fa-arrows-alt-h","fas fa-arrows-alt-v","fas fa-assistive-listening-systems","fas fa-asterisk","fas fa-at","fas fa-atlas","fas fa-atom","fas fa-audio-description","fas fa-award","fas fa-baby","fas fa-baby-carriage","fas fa-backspace","fas fa-backward","fas fa-bacon","fas fa-bacteria","fas fa-bacterium","fas fa-bahai","fas fa-balance-scale","fas fa-balance-scale-left","fas fa-balance-scale-right","fas fa-ban","fas fa-band-aid","fas fa-barcode","fas fa-bars","fas fa-baseball-ball","fas fa-basketball-ball","fas fa-bath","fas fa-battery-empty","fas fa-battery-full","fas fa-battery-half","fas fa-battery-quarter","fas fa-battery-three-quarters","fas fa-bed","fas fa-beer","fas fa-bell","fas fa-bell-slash","fas fa-bezier-curve","fas fa-bible","fas fa-bicycle","fas fa-biking","fas fa-binoculars","fas fa-biohazard","fas fa-birthday-cake","fas fa-blender","fas fa-blender-phone","fas fa-blind","fas fa-blog","fas fa-bold","fas fa-bolt","fas fa-bomb","fas fa-bone","fas fa-bong","fas fa-book","fas fa-book-dead","fas fa-book-medical","fas fa-book-open","fas fa-book-reader","fas fa-bookmark","fas fa-border-all","fas fa-border-none","fas fa-border-style","fas fa-bowling-ball","fas fa-box","fas fa-box-open","fas fa-box-tissue","fas fa-boxes","fas fa-braille","fas fa-brain","fas fa-bread-slice","fas fa-briefcase","fas fa-briefcase-medical","fas fa-broadcast-tower","fas fa-broom","fas fa-brush","fas fa-bug","fas fa-building","fas fa-bullhorn","fas fa-bullseye","fas fa-burn","fas fa-bus","fas fa-bus-alt","fas fa-business-time","fas fa-calculator","fas fa-calendar","fas fa-calendar-alt","fas fa-calendar-check","fas fa-calendar-day","fas fa-calendar-minus","fas fa-calendar-plus","fas fa-calendar-times","fas fa-calendar-week","fas fa-camera","fas fa-camera-retro","fas fa-campground","fas fa-candy-cane","fas fa-cannabis","fas fa-capsules","fas fa-car","fas fa-car-alt","fas fa-car-battery","fas fa-car-crash","fas fa-car-side","fas fa-caravan","fas fa-caret-down","fas fa-caret-left","fas fa-caret-right","fas fa-caret-square-down","fas fa-caret-square-left","fas fa-caret-square-right","fas fa-caret-square-up","fas fa-caret-up","fas fa-carrot","fas fa-cart-arrow-down","fas fa-cart-plus","fas fa-cash-register","fas fa-cat","fas fa-certificate","fas fa-chair","fas fa-chalkboard","fas fa-chalkboard-teacher","fas fa-charging-station","fas fa-chart-area","fas fa-chart-bar","fas fa-chart-line","fas fa-chart-pie","fas fa-check","fas fa-check-circle","fas fa-check-double","fas fa-check-square","fas fa-cheese","fas fa-chess","fas fa-chess-bishop","fas fa-chess-board","fas fa-chess-king","fas fa-chess-knight","fas fa-chess-pawn","fas fa-chess-queen","fas fa-chess-rook","fas fa-chevron-circle-down","fas fa-chevron-circle-left","fas fa-chevron-circle-right","fas fa-chevron-circle-up","fas fa-chevron-down","fas fa-chevron-left","fas fa-chevron-right","fas fa-chevron-up","fas fa-child","fas fa-church","fas fa-circle","fas fa-circle-notch","fas fa-city","fas fa-clinic-medical","fas fa-clipboard","fas fa-clipboard-check","fas fa-clipboard-list","fas fa-clock","fas fa-clone","fas fa-closed-captioning","fas fa-cloud","fas fa-cloud-download-alt","fas fa-cloud-meatball","fas fa-cloud-moon","fas fa-cloud-moon-rain","fas fa-cloud-rain","fas fa-cloud-showers-heavy","fas fa-cloud-sun","fas fa-cloud-sun-rain","fas fa-cloud-upload-alt","fas fa-cocktail","fas fa-code","fas fa-code-branch","fas fa-coffee","fas fa-cog","fas fa-cogs","fas fa-coins","fas fa-columns","fas fa-comment","fas fa-comment-alt","fas fa-comment-dollar","fas fa-comment-dots","fas fa-comment-medical","fas fa-comment-slash","fas fa-comments","fas fa-comments-dollar","fas fa-compact-disc","fas fa-compass","fas fa-compress","fas fa-compress-alt","fas fa-compress-arrows-alt","fas fa-concierge-bell","fas fa-cookie","fas fa-cookie-bite","fas fa-copy","fas fa-copyright","fas fa-couch","fas fa-credit-card","fas fa-crop","fas fa-crop-alt","fas fa-cross","fas fa-crosshairs","fas fa-crow","fas fa-crown","fas fa-crutch","fas fa-cube","fas fa-cubes","fas fa-cut","fas fa-database","fas fa-deaf","fas fa-democrat","fas fa-desktop","fas fa-dharmachakra","fas fa-diagnoses","fas fa-dice","fas fa-dice-d20","fas fa-dice-d6","fas fa-dice-five","fas fa-dice-four","fas fa-dice-one","fas fa-dice-six","fas fa-dice-three","fas fa-dice-two","fas fa-digital-tachograph","fas fa-directions","fas fa-disease","fas fa-divide","fas fa-dizzy","fas fa-dna","fas fa-dog","fas fa-dollar-sign","fas fa-dolly","fas fa-dolly-flatbed","fas fa-donate","fas fa-door-closed","fas fa-door-open","fas fa-dot-circle","fas fa-dove","fas fa-download","fas fa-drafting-compass","fas fa-dragon","fas fa-draw-polygon","fas fa-drum","fas fa-drum-steelpan","fas fa-drumstick-bite","fas fa-dumbbell","fas fa-dumpster","fas fa-dumpster-fire","fas fa-dungeon","fas fa-edit","fas fa-egg","fas fa-eject","fas fa-ellipsis-h","fas fa-ellipsis-v","fas fa-envelope","fas fa-envelope-open","fas fa-envelope-open-text","fas fa-envelope-square","fas fa-equals","fas fa-eraser","fas fa-ethernet","fas fa-euro-sign","fas fa-exchange-alt","fas fa-exclamation","fas fa-exclamation-circle","fas fa-exclamation-triangle","fas fa-expand","fas fa-expand-alt","fas fa-expand-arrows-alt","fas fa-external-link-alt","fas fa-external-link-square-alt","fas fa-eye","fas fa-eye-dropper","fas fa-eye-slash","fas fa-fan","fas fa-fast-backward","fas fa-fast-forward","fas fa-faucet","fas fa-fax","fas fa-feather","fas fa-feather-alt","fas fa-female","fas fa-fighter-jet","fas fa-file","fas fa-file-alt","fas fa-file-archive","fas fa-file-audio","fas fa-file-code","fas fa-file-contract","fas fa-file-csv","fas fa-file-download","fas fa-file-excel","fas fa-file-export","fas fa-file-image","fas fa-file-import","fas fa-file-invoice","fas fa-file-invoice-dollar","fas fa-file-medical","fas fa-file-medical-alt","fas fa-file-pdf","fas fa-file-powerpoint","fas fa-file-prescription","fas fa-file-signature","fas fa-file-upload","fas fa-file-video","fas fa-file-word","fas fa-fill","fas fa-fill-drip","fas fa-film","fas fa-filter","fas fa-fingerprint","fas fa-fire","fas fa-fire-alt","fas fa-fire-extinguisher","fas fa-first-aid","fas fa-fish","fas fa-fist-raised","fas fa-flag","fas fa-flag-checkered","fas fa-flag-usa","fas fa-flask","fas fa-flushed","fas fa-folder","fas fa-folder-minus","fas fa-folder-open","fas fa-folder-plus","fas fa-font","fas fa-font-awesome-logo-full","fas fa-football-ball","fas fa-forward","fas fa-frog","fas fa-frown","fas fa-frown-open","fas fa-funnel-dollar","fas fa-futbol","fas fa-gamepad","fas fa-gas-pump","fas fa-gavel","fas fa-gem","fas fa-genderless","fas fa-ghost","fas fa-gift","fas fa-gifts","fas fa-glass-cheers","fas fa-glass-martini","fas fa-glass-martini-alt","fas fa-glass-whiskey","fas fa-glasses","fas fa-globe","fas fa-globe-africa","fas fa-globe-americas","fas fa-globe-asia","fas fa-globe-europe","fas fa-golf-ball","fas fa-gopuram","fas fa-graduation-cap","fas fa-greater-than","fas fa-greater-than-equal","fas fa-grimace","fas fa-grin","fas fa-grin-alt","fas fa-grin-beam","fas fa-grin-beam-sweat","fas fa-grin-hearts","fas fa-grin-squint","fas fa-grin-squint-tears","fas fa-grin-stars","fas fa-grin-tears","fas fa-grin-tongue","fas fa-grin-tongue-squint","fas fa-grin-tongue-wink","fas fa-grin-wink","fas fa-grip-horizontal","fas fa-grip-lines","fas fa-grip-lines-vertical","fas fa-grip-vertical","fas fa-guitar","fas fa-h-square","fas fa-hamburger","fas fa-hammer","fas fa-hamsa","fas fa-hand-holding","fas fa-hand-holding-heart","fas fa-hand-holding-medical","fas fa-hand-holding-usd","fas fa-hand-holding-water","fas fa-hand-lizard","fas fa-hand-middle-finger","fas fa-hand-paper","fas fa-hand-peace","fas fa-hand-point-down","fas fa-hand-point-left","fas fa-hand-point-right","fas fa-hand-point-up","fas fa-hand-pointer","fas fa-hand-rock","fas fa-hand-scissors","fas fa-hand-sparkles","fas fa-hand-spock","fas fa-hands","fas fa-hands-helping","fas fa-hands-wash","fas fa-handshake","fas fa-handshake-alt-slash","fas fa-handshake-slash","fas fa-hanukiah","fas fa-hard-hat","fas fa-hashtag","fas fa-hat-cowboy","fas fa-hat-cowboy-side","fas fa-hat-wizard","fas fa-hdd","fas fa-head-side-cough","fas fa-head-side-cough-slash","fas fa-head-side-mask","fas fa-head-side-virus","fas fa-heading","fas fa-headphones","fas fa-headphones-alt","fas fa-headset","fas fa-heart","fas fa-heart-broken","fas fa-heartbeat","fas fa-helicopter","fas fa-highlighter","fas fa-hiking","fas fa-hippo","fas fa-history","fas fa-hockey-puck","fas fa-holly-berry","fas fa-home","fas fa-horse","fas fa-horse-head","fas fa-hospital","fas fa-hospital-alt","fas fa-hospital-symbol","fas fa-hospital-user","fas fa-hot-tub","fas fa-hotdog","fas fa-hotel","fas fa-hourglass","fas fa-hourglass-end","fas fa-hourglass-half","fas fa-hourglass-start","fas fa-house-damage","fas fa-house-user","fas fa-hryvnia","fas fa-i-cursor","fas fa-ice-cream","fas fa-icicles","fas fa-icons","fas fa-id-badge","fas fa-id-card","fas fa-id-card-alt","fas fa-igloo","fas fa-image","fas fa-images","fas fa-inbox","fas fa-indent","fas fa-industry","fas fa-infinity","fas fa-info","fas fa-info-circle","fas fa-italic","fas fa-jedi","fas fa-joint","fas fa-journal-whills","fas fa-kaaba","fas fa-key","fas fa-keyboard","fas fa-khanda","fas fa-kiss","fas fa-kiss-beam","fas fa-kiss-wink-heart","fas fa-kiwi-bird","fas fa-landmark","fas fa-language","fas fa-laptop","fas fa-laptop-code","fas fa-laptop-house","fas fa-laptop-medical","fas fa-laugh","fas fa-laugh-beam","fas fa-laugh-squint","fas fa-laugh-wink","fas fa-layer-group","fas fa-leaf","fas fa-lemon","fas fa-less-than","fas fa-less-than-equal","fas fa-level-down-alt","fas fa-level-up-alt","fas fa-life-ring","fas fa-lightbulb","fas fa-link","fas fa-lira-sign","fas fa-list","fas fa-list-alt","fas fa-list-ol","fas fa-list-ul","fas fa-location-arrow","fas fa-lock","fas fa-lock-open","fas fa-long-arrow-alt-down","fas fa-long-arrow-alt-left","fas fa-long-arrow-alt-right","fas fa-long-arrow-alt-up","fas fa-low-vision","fas fa-luggage-cart","fas fa-lungs","fas fa-lungs-virus","fas fa-magic","fas fa-magnet","fas fa-mail-bulk","fas fa-male","fas fa-map","fas fa-map-marked","fas fa-map-marked-alt","fas fa-map-marker","fas fa-map-marker-alt","fas fa-map-pin","fas fa-map-signs","fas fa-marker","fas fa-mars","fas fa-mars-double","fas fa-mars-stroke","fas fa-mars-stroke-h","fas fa-mars-stroke-v","fas fa-mask","fas fa-medal","fas fa-medkit","fas fa-meh","fas fa-meh-blank","fas fa-meh-rolling-eyes","fas fa-memory","fas fa-menorah","fas fa-mercury","fas fa-meteor","fas fa-microchip","fas fa-microphone","fas fa-microphone-alt","fas fa-microphone-alt-slash","fas fa-microphone-slash","fas fa-microscope","fas fa-minus","fas fa-minus-circle","fas fa-minus-square","fas fa-mitten","fas fa-mobile","fas fa-mobile-alt","fas fa-money-bill","fas fa-money-bill-alt","fas fa-money-bill-wave","fas fa-money-bill-wave-alt","fas fa-money-check","fas fa-money-check-alt","fas fa-monument","fas fa-moon","fas fa-mortar-pestle","fas fa-mosque","fas fa-motorcycle","fas fa-mountain","fas fa-mouse","fas fa-mouse-pointer","fas fa-mug-hot","fas fa-music","fas fa-network-wired","fas fa-neuter","fas fa-newspaper","fas fa-not-equal","fas fa-notes-medical","fas fa-object-group","fas fa-object-ungroup","fas fa-oil-can","fas fa-om","fas fa-otter","fas fa-outdent","fas fa-pager","fas fa-paint-brush","fas fa-paint-roller","fas fa-palette","fas fa-pallet","fas fa-paper-plane","fas fa-paperclip","fas fa-parachute-box","fas fa-paragraph","fas fa-parking","fas fa-passport","fas fa-pastafarianism","fas fa-paste","fas fa-pause","fas fa-pause-circle","fas fa-paw","fas fa-peace","fas fa-pen","fas fa-pen-alt","fas fa-pen-fancy","fas fa-pen-nib","fas fa-pen-square","fas fa-pencil-alt","fas fa-pencil-ruler","fas fa-people-arrows","fas fa-people-carry","fas fa-pepper-hot","fas fa-percent","fas fa-percentage","fas fa-person-booth","fas fa-phone","fas fa-phone-alt","fas fa-phone-slash","fas fa-phone-square","fas fa-phone-square-alt","fas fa-phone-volume","fas fa-photo-video","fas fa-piggy-bank","fas fa-pills","fas fa-pizza-slice","fas fa-place-of-worship","fas fa-plane","fas fa-plane-arrival","fas fa-plane-departure","fas fa-plane-slash","fas fa-play","fas fa-play-circle","fas fa-plug","fas fa-plus","fas fa-plus-circle","fas fa-plus-square","fas fa-podcast","fas fa-poll","fas fa-poll-h","fas fa-poo","fas fa-poo-storm","fas fa-poop","fas fa-portrait","fas fa-pound-sign","fas fa-power-off","fas fa-pray","fas fa-praying-hands","fas fa-prescription","fas fa-prescription-bottle","fas fa-prescription-bottle-alt","fas fa-print","fas fa-procedures","fas fa-project-diagram","fas fa-pump-medical","fas fa-pump-soap","fas fa-puzzle-piece","fas fa-qrcode","fas fa-question","fas fa-question-circle","fas fa-quidditch","fas fa-quote-left","fas fa-quote-right","fas fa-quran","fas fa-radiation","fas fa-radiation-alt","fas fa-rainbow","fas fa-random","fas fa-receipt","fas fa-record-vinyl","fas fa-recycle","fas fa-redo","fas fa-redo-alt","fas fa-registered","fas fa-remove-format","fas fa-reply","fas fa-reply-all","fas fa-republican","fas fa-restroom","fas fa-retweet","fas fa-ribbon","fas fa-ring","fas fa-road","fas fa-robot","fas fa-rocket","fas fa-route","fas fa-rss","fas fa-rss-square","fas fa-ruble-sign","fas fa-ruler","fas fa-ruler-combined","fas fa-ruler-horizontal","fas fa-ruler-vertical","fas fa-running","fas fa-rupee-sign","fas fa-sad-cry","fas fa-sad-tear","fas fa-satellite","fas fa-satellite-dish","fas fa-save","fas fa-school","fas fa-screwdriver","fas fa-scroll","fas fa-sd-card","fas fa-search","fas fa-search-dollar","fas fa-search-location","fas fa-search-minus","fas fa-search-plus","fas fa-seedling","fas fa-server","fas fa-shapes","fas fa-share","fas fa-share-alt","fas fa-share-alt-square","fas fa-share-square","fas fa-shekel-sign","fas fa-shield-alt","fas fa-shield-virus","fas fa-ship","fas fa-shipping-fast","fas fa-shoe-prints","fas fa-shopping-bag","fas fa-shopping-basket","fas fa-shopping-cart","fas fa-shower","fas fa-shuttle-van","fas fa-sign","fas fa-sign-in-alt","fas fa-sign-language","fas fa-sign-out-alt","fas fa-signal","fas fa-signature","fas fa-sim-card","fas fa-sink","fas fa-sitemap","fas fa-skating","fas fa-skiing","fas fa-skiing-nordic","fas fa-skull","fas fa-skull-crossbones","fas fa-slash","fas fa-sleigh","fas fa-sliders-h","fas fa-smile","fas fa-smile-beam","fas fa-smile-wink","fas fa-smog","fas fa-smoking","fas fa-smoking-ban","fas fa-sms","fas fa-snowboarding","fas fa-snowflake","fas fa-snowman","fas fa-snowplow","fas fa-soap","fas fa-socks","fas fa-solar-panel","fas fa-sort","fas fa-sort-alpha-down","fas fa-sort-alpha-down-alt","fas fa-sort-alpha-up","fas fa-sort-alpha-up-alt","fas fa-sort-amount-down","fas fa-sort-amount-down-alt","fas fa-sort-amount-up","fas fa-sort-amount-up-alt","fas fa-sort-down","fas fa-sort-numeric-down","fas fa-sort-numeric-down-alt","fas fa-sort-numeric-up","fas fa-sort-numeric-up-alt","fas fa-sort-up","fas fa-spa","fas fa-space-shuttle","fas fa-spell-check","fas fa-spider","fas fa-spinner","fas fa-splotch","fas fa-spray-can","fas fa-square","fas fa-square-full","fas fa-square-root-alt","fas fa-stamp","fas fa-star","fas fa-star-and-crescent","fas fa-star-half","fas fa-star-half-alt","fas fa-star-of-david","fas fa-star-of-life","fas fa-step-backward","fas fa-step-forward","fas fa-stethoscope","fas fa-sticky-note","fas fa-stop","fas fa-stop-circle","fas fa-stopwatch","fas fa-stopwatch-20","fas fa-store","fas fa-store-alt","fas fa-store-alt-slash","fas fa-store-slash","fas fa-stream","fas fa-street-view","fas fa-strikethrough","fas fa-stroopwafel","fas fa-subscript","fas fa-subway","fas fa-suitcase","fas fa-suitcase-rolling","fas fa-sun","fas fa-superscript","fas fa-surprise","fas fa-swatchbook","fas fa-swimmer","fas fa-swimming-pool","fas fa-synagogue","fas fa-sync","fas fa-sync-alt","fas fa-syringe","fas fa-table","fas fa-table-tennis","fas fa-tablet","fas fa-tablet-alt","fas fa-tablets","fas fa-tachometer-alt","fas fa-tag","fas fa-tags","fas fa-tape","fas fa-tasks","fas fa-taxi","fas fa-teeth","fas fa-teeth-open","fas fa-temperature-high","fas fa-temperature-low","fas fa-tenge","fas fa-terminal","fas fa-text-height","fas fa-text-width","fas fa-th","fas fa-th-large","fas fa-th-list","fas fa-theater-masks","fas fa-thermometer","fas fa-thermometer-empty","fas fa-thermometer-full","fas fa-thermometer-half","fas fa-thermometer-quarter","fas fa-thermometer-three-quarters","fas fa-thumbs-down","fas fa-thumbs-up","fas fa-thumbtack","fas fa-ticket-alt","fas fa-times","fas fa-times-circle","fas fa-tint","fas fa-tint-slash","fas fa-tired","fas fa-toggle-off","fas fa-toggle-on","fas fa-toilet","fas fa-toilet-paper","fas fa-toilet-paper-slash","fas fa-toolbox","fas fa-tools","fas fa-tooth","fas fa-torah","fas fa-torii-gate","fas fa-tractor","fas fa-trademark","fas fa-traffic-light","fas fa-trailer","fas fa-train","fas fa-tram","fas fa-transgender","fas fa-transgender-alt","fas fa-trash","fas fa-trash-alt","fas fa-trash-restore","fas fa-trash-restore-alt","fas fa-tree","fas fa-trophy","fas fa-truck","fas fa-truck-loading","fas fa-truck-monster","fas fa-truck-moving","fas fa-truck-pickup","fas fa-tshirt","fas fa-tty","fas fa-tv","fas fa-umbrella","fas fa-umbrella-beach","fas fa-underline","fas fa-undo","fas fa-undo-alt","fas fa-universal-access","fas fa-university","fas fa-unlink","fas fa-unlock","fas fa-unlock-alt","fas fa-upload","fas fa-user","fas fa-user-alt","fas fa-user-alt-slash","fas fa-user-astronaut","fas fa-user-check","fas fa-user-circle","fas fa-user-clock","fas fa-user-cog","fas fa-user-edit","fas fa-user-friends","fas fa-user-graduate","fas fa-user-injured","fas fa-user-lock","fas fa-user-md","fas fa-user-minus","fas fa-user-ninja","fas fa-user-nurse","fas fa-user-plus","fas fa-user-secret","fas fa-user-shield","fas fa-user-slash","fas fa-user-tag","fas fa-user-tie","fas fa-user-times","fas fa-users","fas fa-users-cog","fas fa-users-slash","fas fa-utensil-spoon","fas fa-utensils","fas fa-vector-square","fas fa-venus","fas fa-venus-double","fas fa-venus-mars","fas fa-vest","fas fa-vest-patches","fas fa-vial","fas fa-vials","fas fa-video","fas fa-video-slash","fas fa-vihara","fas fa-virus","fas fa-virus-slash","fas fa-viruses","fas fa-voicemail","fas fa-volleyball-ball","fas fa-volume-down","fas fa-volume-mute","fas fa-volume-off","fas fa-volume-up","fas fa-vote-yea","fas fa-vr-cardboard","fas fa-walking","fas fa-wallet","fas fa-warehouse","fas fa-water","fas fa-wave-square","fas fa-weight","fas fa-weight-hanging","fas fa-wheelchair","fas fa-wifi","fas fa-wind","fas fa-window-close","fas fa-window-maximize","fas fa-window-minimize","fas fa-window-restore","fas fa-wine-bottle","fas fa-wine-glass","fas fa-wine-glass-alt","fas fa-won-sign","fas fa-wrench","fas fa-x-ray","fas fa-yen-sign","fas fa-yin-yang","far fa-address-book","far fa-address-card","far fa-angry","far fa-arrow-alt-circle-down","far fa-arrow-alt-circle-left","far fa-arrow-alt-circle-right","far fa-arrow-alt-circle-up","far fa-bell","far fa-bell-slash","far fa-bookmark","far fa-building","far fa-calendar","far fa-calendar-alt","far fa-calendar-check","far fa-calendar-minus","far fa-calendar-plus","far fa-calendar-times","far fa-caret-square-down","far fa-caret-square-left","far fa-caret-square-right","far fa-caret-square-up","far fa-chart-bar","far fa-check-circle","far fa-check-square","far fa-circle","far fa-clipboard","far fa-clock","far fa-clone","far fa-closed-captioning","far fa-comment","far fa-comment-alt","far fa-comment-dots","far fa-comments","far fa-compass","far fa-copy","far fa-copyright","far fa-credit-card","far fa-dizzy","far fa-dot-circle","far fa-edit","far fa-envelope","far fa-envelope-open","far fa-eye","far fa-eye-slash","far fa-file","far fa-file-alt","far fa-file-archive","far fa-file-audio","far fa-file-code","far fa-file-excel","far fa-file-image","far fa-file-pdf","far fa-file-powerpoint","far fa-file-video","far fa-file-word","far fa-flag","far fa-flushed","far fa-folder","far fa-folder-open","far fa-font-awesome-logo-full","far fa-frown","far fa-frown-open","far fa-futbol","far fa-gem","far fa-grimace","far fa-grin","far fa-grin-alt","far fa-grin-beam","far fa-grin-beam-sweat","far fa-grin-hearts","far fa-grin-squint","far fa-grin-squint-tears","far fa-grin-stars","far fa-grin-tears","far fa-grin-tongue","far fa-grin-tongue-squint","far fa-grin-tongue-wink","far fa-grin-wink","far fa-hand-lizard","far fa-hand-paper","far fa-hand-peace","far fa-hand-point-down","far fa-hand-point-left","far fa-hand-point-right","far fa-hand-point-up","far fa-hand-pointer","far fa-hand-rock","far fa-hand-scissors","far fa-hand-spock","far fa-handshake","far fa-hdd","far fa-heart","far fa-hospital","far fa-hourglass","far fa-id-badge","far fa-id-card","far fa-image","far fa-images","far fa-keyboard","far fa-kiss","far fa-kiss-beam","far fa-kiss-wink-heart","far fa-laugh","far fa-laugh-beam","far fa-laugh-squint","far fa-laugh-wink","far fa-lemon","far fa-life-ring","far fa-lightbulb","far fa-list-alt","far fa-map","far fa-meh","far fa-meh-blank","far fa-meh-rolling-eyes","far fa-minus-square","far fa-money-bill-alt","far fa-moon","far fa-newspaper","far fa-object-group","far fa-object-ungroup","far fa-paper-plane","far fa-pause-circle","far fa-play-circle","far fa-plus-square","far fa-question-circle","far fa-registered","far fa-sad-cry","far fa-sad-tear","far fa-save","far fa-share-square","far fa-smile","far fa-smile-beam","far fa-smile-wink","far fa-snowflake","far fa-square","far fa-star","far fa-star-half","far fa-sticky-note","far fa-stop-circle","far fa-sun","far fa-surprise","far fa-thumbs-down","far fa-thumbs-up","far fa-times-circle","far fa-tired","far fa-trash-alt","far fa-user","far fa-user-circle","far fa-window-close","far fa-window-maximize","far fa-window-minimize","far fa-window-restore"]},actionSelect:function(e){this.trigger("select",e.value)},getIconDataList:function(){var i=[];return this.iconList.forEach(function(e,t){t%12==0&&i.push([]),i[i.length-1].push(e)},this),i},processQuickSearch:function(i){var s;i?(s=this.$el.find(".icons"),this.iconList.forEach(function(e){var t=this.itemCache[e];t||(t=s.find('> .icon-container[data-name="'+e+'"]'),this.itemCache[e]=t),~e.indexOf(i)?t.removeClass("hidden"):t.addClass("hidden")}.bind(this))):this.$el.find(".icon-container").removeClass("hidden")}})}),define("views/admin/entity-manager/modals/select-formula",["views/modal"],function(e){return e.extend({templateContent:`
            <div class="panel no-side-margin">
                <table class="table table-bordered">
                    {{#each typeList}}
                    <tr>
                        <td style="width: 40%">
                            <a
                                class="btn btn-default btn-lg btn-full-wide"
                                href="#Admin/entityManager/formula&scope={{../scope}}&type={{this}}"
                            >
                            {{translate this category='fields' scope='EntityManager'}}
                            </a>
                        </td>
                        <td style="width: 60%">
                            <div class="complex-text">{{complexText (translate this category='messages' scope='EntityManager')}}
                        </td>
                    </tr>
                    {{/each}}
                </table>
            </div>
        `,backdrop:!0,data:function(){return{typeList:this.typeList,scope:this.scope}},setup:function(){this.scope=this.options.scope,this.typeList=["beforeSaveCustomScript","beforeSaveApiScript"],this.headerText=this.translate("Formula","labels","EntityManager")}})}),define("views/admin/entity-manager/fields/icon-class",["views/fields/base"],function(e){return e.extend({editTemplate:"admin/entity-manager/fields/icon-class/edit",setup:function(){e.prototype.setup.call(this),this.events['click [data-action="selectIcon"]']=function(){this.selectIcon()}},selectIcon:function(){this.createView("dialog","views/admin/entity-manager/modals/select-icon",{},t=>{t.render(),this.listenToOnce(t,"select",e=>{this.model.set(this.name,e=""===e?null:e),t.close()})})},fetch:function(){let e={};return e[this.name]=this.model.get(this.name),e}})}),define("views/admin/entity-manager/fields/duplicate-check-field-list",["exports","views/fields/multi-enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{fieldTypeList=["varchar","personName","email","phone","url","barcode"];setupOptions(){let t=this.model.get("name"),e=this.getFieldManager().getEntityTypeFieldList(t,{typeList:this.fieldTypeList,onlyAvailable:!0}).sort((e,t)=>this.getLanguage().translate(e,"fields",this.entityType).localeCompare(this.getLanguage().translate(t,"fields",this.entityType)));this.translatedOptions={},e.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",t)}),this.params.options=e}}e.default=s}),define("views/admin/dynamic-logic/modals/edit",["views/modal"],function(e){return e.extend({template:"admin/dynamic-logic/modals/edit",className:"dialog dialog-record",data:function(){return{}},events:{},buttonList:[{name:"apply",label:"Apply",style:"primary"},{name:"cancel",label:"Cancel"}],setup:function(){this.conditionGroup=Espo.Utils.cloneDeep(this.options.conditionGroup||[]),this.scope=this.options.scope,this.createView("conditionGroup","views/admin/dynamic-logic/conditions/and",{selector:".top-group-container",itemData:{value:this.conditionGroup},scope:this.options.scope})},actionApply:function(){var e=this.getView("conditionGroup").fetch().value;this.trigger("apply",e),this.close()}})}),define("views/admin/dynamic-logic/modals/add-field",["views/modal","model"],function(e,i){return e.extend({templateContent:'<div class="field" data-name="field">{{{field}}}</div>',events:{'click a[data-action="addField"]':function(e){this.trigger("add-field",$(e.currentTarget).data().name)}},setup:function(){this.header=this.translate("Add Field"),this.scope=this.options.scope;const t=new i;this.createView("field","views/admin/dynamic-logic/fields/field",{selector:'[data-name="field"]',model:t,mode:"edit",scope:this.scope,defs:{name:"field",params:{}}},e=>{this.listenTo(e,"change",()=>{var e=t.get("field")||[];e.length&&this.trigger("add-field",e[0])})})}})}),define("views/admin/dynamic-logic/fields/user-id",["exports","views/fields/base"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{detailTemplateContent=`
        <a href="#User/view/{{id}}">{{name}}</a>
    `;data(){return{id:this.model.get("$user.id"),name:this.model.get("name")}}}e.default=s}),define("views/admin/dynamic-logic/fields/field",["views/fields/multi-enum","ui/multi-select"],function(e,t){return e.extend({getFieldList:function(){let i=this.getMetadata().get("entityDefs."+this.options.scope+".fields"),e=Object.keys(i).filter(e=>{var t=i[e].type||null;if(!i[e].disabled&&!i[e].utility&&t&&this.getMetadata().get(["clientDefs","DynamicLogic","fieldTypes",t]))return!0});return e.push("id"),e.sort((e,t)=>this.translate(e,"fields",this.options.scope).localeCompare(this.translate(t,"fields",this.options.scope))),e},setupTranslatedOptions:function(){this.translatedOptions={},this.params.options.forEach(e=>{this.translatedOptions[e]=this.translate(e,"fields",this.options.scope)})},setupOptions:function(){e.prototype.setupOptions.call(this),this.params.options=this.getFieldList(),this.setupTranslatedOptions()},afterRender:function(){e.prototype.afterRender.call(this),this.$element&&t.focus(this.$element)}})}),define("views/admin/dynamic-logic/conditions-string/item-value-varchar",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/varchar",{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]'})}})}),define("views/admin/dynamic-logic/conditions-string/item-value-link",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/link",{model:this.model,name:"link",selector:'[data-view-key="'+e+'"]',foreignScope:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"entity"])||this.getMetadata().get(["entityDefs",this.scope,"links",this.field,"entity"])})}})}),define("views/admin/dynamic-logic/conditions-string/item-value-enum",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-base",createValueFieldView:function(){var e=this.getValueViewKey();this.createView("value","views/fields/enum",{model:this.model,name:this.field,selector:'[data-view-key="'+e+'"]',params:{options:this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"options"])||[]}})}})}),define("views/admin/dynamic-logic/conditions-string/item-multiple-values-base",["views/admin/dynamic-logic/conditions-string/item-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/item-multiple-values-base",data:function(){return{valueViewDataList:this.valueViewDataList,scope:this.scope,operator:this.operator,operatorString:this.operatorString,field:this.field}},populateValues:function(){},getValueViewKey:function(e){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+e.toString()},createValueFieldView:function(){var s=this.itemData.value||[],e=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"type"])||"base",a=this.getMetadata().get(["entityDefs",this.scope,"fields",this.field,"view"])||this.getFieldManager().getViewName(e);this.valueViewDataList=[],s.forEach(function(e,t){var i=this.model.clone(),e=(i.set(this.itemData.attribute,e),this.getValueViewKey(t));this.valueViewDataList.push({key:e,isEnd:t===s.length-1}),this.createView(e,a,{model:i,name:this.field,selector:'[data-view-key="'+e+'"]'})},this)}})}),define("views/admin/dynamic-logic/conditions-string/item-is-today",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"today"})}),define("views/admin/dynamic-logic/conditions-string/item-in-past",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"past"})}),define("views/admin/dynamic-logic/conditions-string/item-in-future",["views/admin/dynamic-logic/conditions-string/item-operator-only-date"],function(e){return e.extend({dateValue:"future"})}),define("views/admin/dynamic-logic/conditions-string/group-not",["views/admin/dynamic-logic/conditions-string/group-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions-string/group-not",data:function(){return{viewKey:this.viewKey,operator:this.operator}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.operator=this.options.operator||this.operator,this.itemData=this.options.itemData||{},this.viewList=[];var e="view-"+this.level.toString()+"-"+this.number.toString()+"-"+0..toString();this.createItemView(0,e,this.itemData.value),this.viewKey=e}})}),define("views/admin/dynamic-logic/conditions/or",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({operator:"or"})}),define("views/admin/dynamic-logic/conditions/not",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({template:"admin/dynamic-logic/conditions/not",operator:"not",data:function(){return{viewKey:this.viewKey,operator:this.operator,hasItem:this.hasView(this.viewKey),level:this.level,groupOperator:this.getGroupOperator()}},setup:function(){this.level=this.options.level||0,this.number=this.options.number||0,this.scope=this.options.scope,this.itemData=this.options.itemData||{},this.viewList=[];var e=this.getKey();this.createItemView(0,e,this.itemData.value),this.viewKey=e},removeItem:function(){var e=this.getKey();this.clearView(e),this.controlAddItemVisibility()},getKey:function(){return"view-"+this.level.toString()+"-"+this.number.toString()+"-"+0..toString()},getIndexForNewItem:function(){return 0},addItemContainer:function(){},addViewDataListItem:function(){},fetch:function(){const e=this.getView(this.viewKey);if(!e)return{type:"and",value:[]};var t=e.fetch();return{type:this.operator,value:t}},controlAddItemVisibility:function(){this.getView(this.getKey())?this.$el.find(" > .group-bottom").addClass("hidden"):this.$el.find(" > .group-bottom").removeClass("hidden")}})}),define("views/admin/dynamic-logic/conditions/and",["views/admin/dynamic-logic/conditions/group-base"],function(e){return e.extend({operator:"and"})}),define("views/admin/dynamic-logic/conditions/field-types/multi-enum",["views/admin/dynamic-logic/conditions/field-types/base"],function(t){return t.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t},getValueViewName:function(){var e=t.prototype.getValueViewName.call(this);return e=~["has","notHas"].indexOf(this.type)?"views/fields/enum":e}})}),define("views/admin/dynamic-logic/conditions/field-types/link",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field+"Id",data:{field:this.field}};return e&&(e.fetchToModel(),t.value=this.model.get(this.field+"Id"),(e={})[this.field+"Name"]=this.model.get(this.field+"Name"),t.data.values=e),t}})}),define("views/admin/dynamic-logic/conditions/field-types/link-parent",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({fetch:function(){var e,t=this.getView("value");return t&&t.fetchToModel(),"equals"===this.type||"notEquals"===this.type?((e={})[this.field+"Id"]=t.model.get(this.field+"Id"),e[this.field+"Name"]=t.model.get(this.field+"Name"),e[this.field+"Type"]=t.model.get(this.field+"Type"),"equals"===this.type?{type:"and",value:[{type:"equals",attribute:this.field+"Id",value:t.model.get(this.field+"Id")},{type:"equals",attribute:this.field+"Type",value:t.model.get(this.field+"Type")}],data:{field:this.field,type:"equals",values:e}}:{type:"or",value:[{type:"notEquals",attribute:this.field+"Id",value:t.model.get(this.field+"Id")},{type:"notEquals",attribute:this.field+"Type",value:t.model.get(this.field+"Type")}],data:{field:this.field,type:"notEquals",values:e}}):{type:this.type,attribute:this.field+"Id",data:{field:this.field}}}})}),define("views/admin/dynamic-logic/conditions/field-types/enum",["views/admin/dynamic-logic/conditions/field-types/base"],function(t){return t.extend({fetch:function(){var e=this.getView("value"),t={type:this.type,attribute:this.field};return e&&(e.fetchToModel(),t.value=this.model.get(this.field)),t},getValueViewName:function(){var e=t.prototype.getValueViewName.call(this);return e=~["in","notIn"].indexOf(this.type)?"views/fields/multi-enum":e}})}),define("views/admin/dynamic-logic/conditions/field-types/date",["views/admin/dynamic-logic/conditions/field-types/base"],function(e){return e.extend({})}),define("views/admin/dynamic-logic/conditions/field-types/current-user",["exports","views/admin/dynamic-logic/conditions/field-types/base","model"],function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=s(t),i=s(i);class a extends t.default{getValueViewName(){return"views/fields/user"}getValueFieldName(){return"link"}createModel(){const e=new i.default;return e.setDefs({fields:{link:{type:"link",entity:"User"}}}),Promise.resolve(e)}populateValues(){this.itemData.attribute&&this.model.set("linkId",this.itemData.value);var e=(this.additionalData.values||{}).name;this.model.set("linkName",e)}translateLeftString(){return"$"+this.translate("User","scopeNames")}fetch(){const e=this.getView("value");return e.fetchToModel(),{type:this.type,attribute:"$user.id",data:{values:{name:this.model.get("linkName")}},value:this.model.get("linkId")}}}e.default=a}),define("views/admin/dynamic-logic/conditions/field-types/current-user-teams",["exports","views/admin/dynamic-logic/conditions/field-types/link-multiple"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{translateLeftString(){return"$"+this.translate("User","scopeNames")+"."+super.translateLeftString()}fetch(){const e=super.fetch();return e.attribute="$user.teamsIds",e}}e.default=s}),define("views/admin/complex-expression/modals/add-function",["views/modal","model"],function(e,t){return e.extend({template:"admin/formula/modals/add-function",fitHeight:!0,backdrop:!0,events:{'click [data-action="add"]':function(e){this.trigger("add",$(e.currentTarget).data("value"))}},data:function(){var e=this.translate("formulaFunctions","messages","Admin").replace("{documentationUrl}",this.documentationUrl),e=this.getHelper().transformMarkdownText(e,{linksInNewTab:!0}).toString();return{functionDataList:this.functionDataList,text:e}},setup:function(){this.header=this.translate("Function"),this.documentationUrl="https://docs.espocrm.com/user-guide/complex-expressions/",this.functionDataList=this.options.functionDataList||this.getMetadata().get("app.complexExpression.functionList")||[]}})}),define("views/admin/authentication/fields/test-connection",["views/fields/base"],function(e){return e.extend({templateContent:`
            <button
                class="btn btn-default"
                data-action="testConnection"
            >{{translate 'Test Connection' scope='Settings'}}</button>
        `,events:{'click [data-action="testConnection"]':function(){this.testConnection()}},fetch:function(){return{}},getConnectionData:function(){return{host:this.model.get("ldapHost"),port:this.model.get("ldapPort"),useSsl:this.model.get("ldapSecurity"),useStartTls:this.model.get("ldapSecurity"),username:this.model.get("ldapUsername"),password:this.model.get("ldapPassword"),bindRequiresDn:this.model.get("ldapBindRequiresDn"),accountDomainName:this.model.get("ldapAccountDomainName"),accountDomainNameShort:this.model.get("ldapAccountDomainNameShort"),accountCanonicalForm:this.model.get("ldapAccountCanonicalForm")}},testConnection:function(){var e=this.getConnectionData();this.$el.find("button").prop("disabled",!0),this.notify("Connecting",null,null,"Settings"),Espo.Ajax.postRequest("Ldap/action/testConnection",e).then(()=>{this.$el.find("button").prop("disabled",!1),Espo.Ui.success(this.translate("ldapTestConnection","messages","Settings"))}).catch(e=>{let t=e.getResponseHeader("X-Status-Reason")||"",i=(t=(t=t.replace(/ $/,"")).replace(/,$/,""),this.translate("Error")+" "+e.status);t&&(i+=": "+t),Espo.Ui.error(i,!0),console.error(i),e.errorIsHandled=!0,this.$el.find("button").prop("disabled",!1)})}})}),define("views/admin/auth-token/list",["views/list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.menu.buttons=[]},getHeader:function(){return'<a href="#Admin">'+this.translate("Administration")+'</a> <span class="chevron-right"></span> '+this.getLanguage().translate("Auth Tokens","labels","Admin")},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Auth Tokens","labels","Admin"))}})}),define("views/admin/auth-token/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/admin/auth-token/record/row-actions/default",massActionList:["remove","setInactive"],checkAllResultMassActionList:["remove","setInactive"],massActionSetInactive:function(){let e=null;this.allResultIsChecked||(e=this.checkedList);Espo.Ajax.postRequest("MassAction",{action:"update",entityType:this.entityType,params:{ids:e||null,where:e&&0!==e.length?null:this.collection.getWhere(),searchParams:e&&0!==e.length?null:this.collection.data},data:{isActive:!1}}).then(()=>{this.collection.fetch().then(()=>{Espo.Ui.success(this.translate("Done")),e&&e.forEach(e=>{this.checkRecord(e)})})})},actionSetInactive:function(e){!e.id||(e=this.collection.get(e.id))&&(Espo.Ui.notify(this.translate("pleaseWait","messages")),e.save({isActive:!1},{patch:!0}).then(()=>{Espo.Ui.notify(!1)}))}})}),define("views/admin/auth-token/record/detail",["views/record/detail"],function(e){return e.extend({sideDisabled:!0,readOnly:!0})}),define("views/admin/auth-token/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideDisabled:!0,isWide:!0,bottomView:"views/record/detail-bottom"})}),define("views/admin/auth-token/record/row-actions/default",["views/record/row-actions/default"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this),this.listenTo(this.model,"change:isActive",()=>{setTimeout(()=>{this.reRender()},10)})},getActionList:function(){var e=[];return e.push({action:"quickView",label:"View",data:{id:this.model.id}}),this.model.get("isActive")&&e.push({action:"setInactive",label:"Set Inactive",data:{id:this.model.id}}),e.push({action:"quickRemove",label:"Remove",data:{id:this.model.id}}),e}})}),define("views/admin/auth-token/modals/detail",["views/modals/detail"],function(e){return e.extend({sideDisabled:!0,editDisabled:!0})}),define("views/admin/auth-log-record/list",["views/list"],function(e){return e.extend({setup:function(){e.prototype.setup.call(this)},getHeader:function(){return this.buildHeaderHtml([$("<a>").attr("href","#Admin").text(this.translate("Administration")),$("<span>").text(this.getLanguage().translate("Auth Log","labels","Admin"))])},updatePageTitle:function(){this.setPageTitle(this.getLanguage().translate("Auth Log","labels","Admin"))}})}),define("views/admin/auth-log-record/record/list",["views/record/list"],function(e){return e.extend({rowActionsView:"views/record/row-actions/view-and-remove",massActionList:["remove"],checkAllResultMassActionList:["remove"],forceSettings:!0})}),define("views/admin/auth-log-record/record/detail",["views/record/detail"],function(e){return e.extend({sideDisabled:!0,readOnly:!0})}),define("views/admin/auth-log-record/record/detail-small",["views/record/detail-small"],function(e){return e.extend({sideDisabled:!0,isWide:!0,bottomView:"views/record/detail-bottom"})}),define("views/admin/auth-log-record/modals/detail",["views/modals/detail"],function(e){return e.extend({sideDisabled:!0,editDisabled:!0})}),define("views/admin/auth-log-record/fields/authentication-method",["exports","views/fields/enum"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{setupOptions(){this.params.options=Object.keys(this.getMetadata().get("authenticationMethods")||{})}}e.default=s}),define("views/admin/app-log-record/record/list",["exports","views/record/list"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{forceSettings=!0}e.default=s}),define("controllers/role",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=s}),define("controllers/portal-role",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=s}),define("controllers/layout-set",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{actionEditLayouts(e){var t=e.id;if(!t)throw new Error("ID not passed.");this.main("views/layout-set/layouts",{layoutSetId:t,scope:e.scope,type:e.type})}}e.default=s}),define("controllers/inbound-email",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{checkAccess(e){return!!this.getUser().isAdmin()}}e.default=s}),define("controllers/api-user",["exports","controllers/record"],function(e,t){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;class s extends(t=(i=t)&&i.__esModule?i:{default:i}).default{entityType="User";getCollection(e){return super.getCollection().then(e=>(e.data.userType="api",e))}createViewView(e,t,i){if(!t.isApi())return t.isPortal()?void this.getRouter().dispatch("PortalUser","view",{id:t.id,model:t}):void this.getRouter().dispatch("User","view",{id:t.id,model:t});super.createViewView(e,t,i)}actionCreate(e){(e=e||{}).attributes=e.attributes||{},e.attributes.type="api",super.actionCreate(e)}}e.default=s}),define("controllers/admin",["exports","controller","search-manager","views/settings/edit","views/admin/index"],function(e,t,i,n,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t=a(t),i=a(i),n=a(n),s=a(s);class o extends t.default{checkAccessGlobal(){return!!this.getUser().isAdmin()}actionPage(e){const t=e.page;if(e.options&&delete(e={...Espo.Utils.parseUrlOptionsParam(e.options),...e}).options,!t)throw new Error;var i="action"+Espo.Utils.upperCaseFirst(t);if(this[i])this[i](e);else{const s=this.getPageDefs(t);if(!s)throw new Espo.Exceptions.NotFound;if(s.view)this.main(s.view,e);else{if(!s.recordView)throw new Espo.Exceptions.NotFound;const a=this.getSettingsModel();a.fetch().then(()=>{a.id="1";var e=new n.default({model:a,headerTemplate:"admin/settings/headers/page",recordView:s.recordView,page:t,label:s.label,optionsToPass:["page","label"]});this.main(e)})}}}actionIndex(e){let t=e.isReturn;var e="index",i=(!(t=this.getRouter().backProcessed?!0:t)&&this.getStoredMainView(e)&&this.clearStoredMainView(e),new s.default);this.main(i,null,e=>{e.render(),this.listenTo(e,"clear-cache",this.clearCache),this.listenTo(e,"rebuild",this.rebuild)},{useStored:t,key:e})}actionUsers(){this.getRouter().dispatch("User","list",{fromAdmin:!0})}actionPortalUsers(){this.getRouter().dispatch("PortalUser","list",{fromAdmin:!0})}actionApiUsers(){this.getRouter().dispatch("ApiUser","list",{fromAdmin:!0})}actionTeams(){this.getRouter().dispatch("Team","list",{fromAdmin:!0})}actionRoles(){this.getRouter().dispatch("Role","list",{fromAdmin:!0})}actionPortalRoles(){this.getRouter().dispatch("PortalRole","list",{fromAdmin:!0})}actionPortals(){this.getRouter().dispatch("Portal","list",{fromAdmin:!0})}actionLeadCapture(){this.getRouter().dispatch("LeadCapture","list",{fromAdmin:!0})}actionEmailFilters(){this.getRouter().dispatch("EmailFilter","list",{fromAdmin:!0})}actionGroupEmailFolders(){this.getRouter().dispatch("GroupEmailFolder","list",{fromAdmin:!0})}actionEmailTemplates(){this.getRouter().dispatch("EmailTemplate","list",{fromAdmin:!0})}actionPdfTemplates(){this.getRouter().dispatch("Template","list",{fromAdmin:!0})}actionDashboardTemplates(){this.getRouter().dispatch("DashboardTemplate","list",{fromAdmin:!0})}actionWebhooks(){this.getRouter().dispatch("Webhook","list",{fromAdmin:!0})}actionLayoutSets(){this.getRouter().dispatch("LayoutSet","list",{fromAdmin:!0})}actionWorkingTimeCalendar(){this.getRouter().dispatch("WorkingTimeCalendar","list",{fromAdmin:!0})}actionAttachments(){this.getRouter().dispatch("Attachment","list",{fromAdmin:!0})}actionAuthenticationProviders(){this.getRouter().dispatch("AuthenticationProvider","list",{fromAdmin:!0})}actionAddressCountries(){this.getRouter().dispatch("AddressCountry","list",{fromAdmin:!0})}actionEmailAddresses(){this.getRouter().dispatch("EmailAddress","list",{fromAdmin:!0})}actionPhoneNumbers(){this.getRouter().dispatch("PhoneNumber","list",{fromAdmin:!0})}actionPersonalEmailAccounts(){this.getRouter().dispatch("EmailAccount","list",{fromAdmin:!0})}actionGroupEmailAccounts(){this.getRouter().dispatch("InboundEmail","list",{fromAdmin:!0})}actionActionHistory(){this.getRouter().dispatch("ActionHistoryRecord","list",{fromAdmin:!0})}actionImport(){this.getRouter().dispatch("Import","index",{fromAdmin:!0})}actionLayouts(e){var t=e.scope||null,i=e.type||null,e=e.em||!1;this.main("views/admin/layouts/index",{scope:t,type:i,em:e})}actionLabelManager(e){var t=e.scope||null,e=e.language||null;this.main("views/admin/label-manager/index",{scope:t,language:e})}actionTemplateManager(e){e=e.name||null;this.main("views/admin/template-manager/index",{name:e})}actionFieldManager(e){var t=e.scope||null,e=e.field||null;this.main("views/admin/field-manager/index",{scope:t,field:e})}actionEntityManager(e){var t=e.scope||null;t&&e.edit?this.main("views/admin/entity-manager/edit",{scope:t}):e.create?this.main("views/admin/entity-manager/edit"):t&&e.formula?this.main("views/admin/entity-manager/formula",{scope:t,type:e.type}):t?this.main("views/admin/entity-manager/scope",{scope:t}):this.main("views/admin/entity-manager/index")}actionLinkManager(e){e=e.scope||null;this.main("views/admin/link-manager/index",{scope:e})}actionSystemRequirements(){this.main("views/admin/system-requirements/index")}getSettingsModel(){const e=this.getConfig().clone();return e.defs=this.getConfig().defs,this.listenTo(e,"after:save",()=>{this.getConfig().load(),this._broadcastChannel.postMessage("update:config")}),e}actionAuthTokens(){this.collectionFactory.create("AuthToken",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/auth-token/list",{scope:"AuthToken",collection:e,searchManager:t})})}actionAuthLog(){this.collectionFactory.create("AuthLogRecord",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/auth-log-record/list",{scope:"AuthLogRecord",collection:e,searchManager:t})})}actionJobs(){this.collectionFactory.create("Job",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/admin/job/list",{scope:"Job",collection:e,searchManager:t})})}actionAppLog(){this.collectionFactory.create("AppLogRecord",e=>{const t=new i.default(e,"list",this.getStorage(),this.getDateTime());t.loadStored(),e.where=t.getWhere(),e.maxSize=this.getConfig().get("recordsPerPage")||e.maxSize,this.main("views/list",{scope:"AppLogRecord",collection:e,searchManager:t})})}actionIntegrations(e){e=e.name||null;this.main("views/admin/integrations/index",{integration:e})}actionExtensions(){this.main("views/admin/extensions/index")}rebuild(){if(!this.rebuildRunning){this.rebuildRunning=!0;const t=this.get("master");Espo.Ui.notify(t.translate("pleaseWait","messages")),Espo.Ajax.postRequest("Admin/rebuild").then(()=>{var e=t.translate("Rebuild has been done","labels","Admin");Espo.Ui.success(e),this.rebuildRunning=!1}).catch(()=>{this.rebuildRunning=!1})}}clearCache(){if(!this.clearCacheRunning){this.clearCacheRunning=!0;const t=this.get("master");Espo.Ui.notify(t.translate("pleaseWait","messages")),Espo.Ajax.postRequest("Admin/clearCache").then(()=>{var e=t.translate("Cache has been cleared","labels","Admin");Espo.Ui.success(e),this.clearCacheRunning=!1}).catch(()=>{this.clearCacheRunning=!1})}}getPageDefs(e){var t=this.getMetadata().get(["app","adminPanel"])||{};let i=null;for(const s in t){for(const a of t[s].itemList||[])if(a.url==="#Admin/"+e){i=a;break}if(i)break}return i}}e.default=o});
//# sourceMappingURL=espo-admin.js.map